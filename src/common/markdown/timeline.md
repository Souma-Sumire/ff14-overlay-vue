# 时间轴语法指南

## 📝 显式语句（悬浮窗可见内容）

```text
时间 "提示文本" [tts "语音文本"]
```

### 参数说明

| 参数       | 格式                  | 说明                                                                 |
|------------|-----------------------|----------------------------------------------------------------------|
| **时间**   | `整数`/`浮点数`/`时:分` | 例：`120`、`84.38`、`01:35`                                         |
| **提示文本** | 双引号包裹            | 特殊语法：`<技能名>`显示图标，`<技能名>~`显示为`[图标]技能名`       |
| **语音文本**| `tts "内容"`（可选）   | 在时间点前1秒触发TTS语音。简写语法：`tts`（不写内容），内容为提示文本的尖括号内容 |

### 示例

```text
60  "机制来了"                                    # 显示文字
120 "<天赐祝福>~"                                 # 显示技能图标+文字
150 "高频平A" tts "注意奶T"                       # 显示文字+语音提醒
200 "<至黑之夜><献奉><暗影卫>开减伤" tts           # 显示多图标 + tts简写，实际播报：“至黑之夜, 献奉, 暗影卫”
```

---

## 🔍 匹配语句（时间轴同步规则）

通常无需手动编写。FFLOGS导入会自动生成，完整规则见 [timelineSpecialRules.ts](https://github.com/Souma-Sumire/ff14-overlay-vue/blob/main/src/services/timelineSpecialRules.ts)

### ✅ 新语法（推荐）

```text
时间 "注释" 日志类型 { 参数 } [window 前,后] [jump 目标时间] [once]
```

#### 日志类型

| 类型          | 参数格式                    | 说明                          |
|---------------|----------------------------|-----------------------------|
| `Ability`     | `{ id: "十六进制ID" }`      | 技能判定事件                 |
| `StartsUsing` | `{ id: "十六进制ID" }`      | 读条开始事件                 |

#### 可选参数

| 参数         | 格式              | 默认值    | 说明                                |
|--------------|-------------------|----------|-----------------------------------|
| `window`     | `向前秒数,向后秒数` | `2.5,2.5` | 匹配时间范围：`[时间-前, 时间+后]` |
| `jump`       | 秒数              | -        | 匹配成功后跳转到指定时间点         |
| `once`       |                   | -        | 整场战斗中，此正则仅匹配一次        |

### 示例

```text
00:10.0 "空间斩" StartsUsing { id: "A3DA" } window 2,4 # BOSS读条A3DA技能且时间处于8~14秒，修正时间至第10秒
736.5 "Beetle Avatar" Ability { id: "E82" } window 130,10 jump 413.9 # 匹配成功后跳转到413.9秒
00:21.1 "unknown_a38f" Ability { id: "A38F" } window 9999,9999 once # 全场战斗仅触发一次
```

---

### ⚠️ 旧语法（兼容保留）

```text
时间 "注释" sync[.once] /正则表达式/ [window 前,后] [jump 目标时间]
```

| 特殊修饰       | 说明                     |
|----------------|------------------------|
| `sync.once`    | 整场战斗仅匹配一次       |
| 正则表达式     | 匹配ACT原始日志          |

### 示例

```text
652.1 "究极超豪华野蛮大乱击" sync /^.{14} \w+ 14:4.{7}:[^:]+:942B:/ window 12,12
```

---

## 💡 核心功能说明

1. **时间修正**

   当日志事件发生在 `[时间-window前, 时间+window后]` 范围内时：
   - 自动将时间轴修正到该语句的时间点
   - 若设置了`jump`，则跳转到指定时间

2. **特殊场景**
   - 无血量/快慢轴的BOSS无需匹配语句
   - 分支时间轴使用`jump`实现跳转
   - `once: true` 或 `sync.once` 防止重复匹配
