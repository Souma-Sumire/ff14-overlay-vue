import{aA as Y,s as A,X as ne,b as j,o as g,e as x,x as i,a as n,w as o,F as oe,M as se,u as e,c as O,a0 as le,ac as re,a1 as ie,H as ce,I as ue,d as de,p as I,aB as pe,A as d,$ as B,y as b,aC as me,K as fe,ag as _e,C as he,ak as be,O as ge,am as we,aD as ve,au as ye,aE as Ce,aF as Se,ae as Ee,D as Te,af as Ve}from"./vendor-2a442634.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";import{C as p}from"./content_type-ecdd0c19.js";import{a as Z,r as H,c as De}from"./overlay_plugin_api-409cb9ea.js";import{N as M,c as Re,l as W}from"./netregexes-3f94ba22.js";import{z as Pe}from"./zoneInfo-6eb69bef.js";const xe=T=>(ce("data-v-66d37cfa"),T=T(),ue(),T),Ne={class:"language-switcher"},ke={class:"select-wrapper"},Ue=xe(()=>i("svg",{class:"globe-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[i("circle",{cx:"12",cy:"12",r:"10"}),i("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),i("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})],-1)),Le={__name:"LanguageSwitcher",setup(T){const{locale:a,availableLocales:c}=Y(),f={zhCn:"简体中文",en:"English",ja:"日本語"},w=A("user-locale",a.value);return ne(w,C=>{a.value=C}),j(()=>{a.value=w.value}),(C,N)=>{const k=re,U=ie;return g(),x("div",Ne,[i("div",ke,[Ue,n(U,{modelValue:e(w),"onUpdate:modelValue":N[0]||(N[0]=S=>le(w)?w.value=S:null),size:"small",class:"language-select"},{default:o(()=>[(g(!0),x(oe,null,se(e(c),(S,E)=>(g(),O(k,{key:E,value:S,label:f[S]},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])])}}},Ae=Q(Le,[["__scopeId","data-v-66d37cfa"]]),Oe={class:"obs-container"},Ie={class:"card-header"},Be={class:"act-not-ready-content"},Fe={key:1},$e={class:"card-header"},Ge={key:1},ze={class:"card-header"},qe={class:"status-info"},Ze={class:"button-container"},He={class:"card-header"},Me={class:"profile-info"},We={class:"file-path-explanation"},Ye={class:"file-name-explanation"},je={class:"card-header"},Qe=de({__name:"obs2",setup(T){const{t:a}=Y(),c=A("obs-user-config",{host:4455,password:"",path:"",fileName:""},localStorage,{writeDefaults:!0}),f=A("obs-user-content-setting",[]),w=A("obs-is-first-time",!0),C=I(!1),N=I(!1),k=I({});function U(){return new Promise(u=>{De({call:"cactbotRequestState"}).then(()=>{C.value=!0,u()}),setTimeout(()=>{C.value||U()},3e3)})}const S={inCombat:M.inCombat(),countdown:M.countdown(),wipe:Re.wipe},E=["Savage","Extreme","Chaotic","Ultimate","Dungeons","Raids","Trials","VCDungeonFinder","DeepDungeons","Guildhests","DisciplesOfTheLand","Eureka","GrandCompany","QuestBattles","TreasureHunt","Pvp","Default"],F={enter:!1,countdown:!0,combatStart:!0,combatEnd:!0,wipe:!0},$={enter:!1,countdown:!1,combatStart:!1,combatEnd:!1,wipe:!1};function K(){const u=["Savage","Extreme","Ultimate","Chaotic","Default"];if(w.value)w.value=!1,f.value=[...u.map(t=>({type:t,...F})),...E.filter(t=>!u.includes(t)).map(t=>({type:t,...$}))];else{f.value=f.value.filter(s=>E.includes(s.type));const t=E.filter(s=>!f.value.some(m=>m.type===s)&&s!=="Default").map(s=>u.includes(s)?{type:s,...F}:{type:s,...$});f.value.push(...t)}f.value.sort((t,s)=>E.indexOf(t.type)-E.indexOf(s.type))}class X{constructor(){this.handleConnectionError=()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath=""},this.handleConnectionClosed=()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath=""},this.ws=new me,this.status=fe({connecting:!1,connected:!1,recording:!1,outputActive:!1,outputPath:""}),this.ws.on("ConnectionClosed",this.handleConnectionClosed),this.ws.on("ConnectionError",this.handleConnectionError),this.ws.on("RecordStateChanged",t=>{this.status.connected=!0,this.status.recording=t.outputState==="OBS_WEBSOCKET_OUTPUT_STARTED",this.status.outputActive=t.outputActive,this.status.outputPath=t.outputPath})}connect(t){c.value.host&&c.value.password&&(this.status.connecting||(this.status.connecting=!0,this.ws.connect(`ws://127.0.0.1:${c.value.host}`,c.value.password).then(()=>{this.ws.call("GetRecordStatus").then(s=>{this.status.recording=s.outputActive,this.status.outputActive=s.outputActive}),this.status.connected=!0,t&&t()}).finally(()=>{this.status.connecting=!1,!c.value.path&&this.status.connected&&this.ws.call("GetRecordDirectory").then(s=>{s.recordDirectory&&(c.value.path=s.recordDirectory)}),c.value.fileName||(c.value.fileName="%CCYY-%MM-%DD %hh-%mm-%ss")})))}disconnect(){this.ws.disconnect()}async startRecord(){await this.setProfileParameter(),this.ws.call("StartRecord")}stopRecord(){this.ws.call("StopRecord")}splitRecord(){this.ws.call("StopRecord").finally(()=>{setTimeout(()=>{this.ws.call("StartRecord")},1e3)})}async setProfileParameter(){const t=c.value.path,s=c.value.fileName,m=[];return m.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"AdvOut",parameterName:"RecFilePath",parameterValue:t}}),m.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"Output",parameterName:"FilenameFormatting",parameterValue:s}}),c.value.path=t,c.value.fileName=s,this.ws.callBatch(m)}}const l=new X,G=u=>{const t=u.zoneID,s=Pe[t];k.value=s,V("enter")},z=u=>{const t=u.rawLine;for(const s in S)if(S[s].exec(t)){const v=t.split("|");switch(s){case"inCombat":{const _=v[W.InCombat.fields.inACTCombat]==="1",R=v[W.InCombat.fields.inGameCombat]==="1";if(_&&R){V("combatStart");return}if(!_&&!R){V("combatEnd");return}break}case"countdown":{V("countdown");break}case"wipe":{V("wipe");break}}}};function J(u){var t,s;switch(u.contentType){case p.ChaoticAllianceRaid:return"Chaotic";case p.UltimateRaids:return"Ultimate";case p.Pvp:return"Pvp";case p.Dungeons:return"Dungeons";case p.DeepDungeons:return"DeepDungeons";case p.VCDungeonFinder:return"VCDungeonFinder";case p.Trials:return(t=u.name.fr)!=null&&t.includes("(extrême)")?"Extreme":"Trials";case p.Raids:return(s=u.name.en)!=null&&s.includes("(Savage)")?"Savage":"Raids";case p.DisciplesOfTheLand:return"DisciplesOfTheLand";case p.Eureka:return"Eureka";case p.GrandCompany:return"GrandCompany";case p.QuestBattles:return"QuestBattles";case p.TreasureHunt:return"TreasureHunt";default:return"Default"}}function V(u){const t=J(k.value);if(!f.value.find(s=>s.type===t&&s[u])){u==="enter"&&l.status.recording&&l.stopRecord();return}switch(u){case"enter":case"countdown":case"combatStart":if(!l.status.connected){l.connect(()=>{l.startRecord()});return}if(l.status.recording===!1){l.startRecord();return}l.status.recording===!0&&u!=="combatStart"&&l.splitRecord();return;case"combatEnd":case"wipe":l.status.recording&&l.stopRecord()}}return j(async()=>{await U(),l.connect(),Z("ChangeZone",G),Z("LogLine",z),K()}),pe(()=>{l.disconnect(),H("ChangeZone",G),H("LogLine",z)}),(u,t)=>{const s=Ae,m=_e,D=he,v=be,_=ge,R=we,ee=ve,L=ye,q=Ce,te=Se,y=Ee,P=Te,ae=Ve;return g(),x("div",Oe,[i("header",null,[i("h1",null,d(e(a)("OBS Auto Record V2")),1),n(s)]),e(C)?B("",!0):(g(),O(m,{key:0,class:"act-not-ready-card"},{header:o(()=>[i("div",Ie,[i("span",null,d(e(a)("ACT Not Ready")),1)])]),default:o(()=>[i("div",Be,[i("p",null,d(e(a)("overlayTutorial")),1)])]),_:1})),e(C)?(g(),x("main",Fe,[e(l).status.connected?(g(),x("div",Ge,[n(L,{class:"instruction-alert",type:"info",description:e(a)("hideTutorial"),closable:!1,"show-icon":""},null,8,["description"]),e(N)?(g(),O(m,{key:0,class:"status-card"},{header:o(()=>[i("div",ze,[i("span",null,d(e(a)("Connection Status")),1),n(_,{type:"danger",size:"small",class:"disconnect-button",onClick:t[3]||(t[3]=r=>e(l).disconnect())},{default:o(()=>[b(d(e(a)("Disconnect")),1)]),_:1})])]),default:o(()=>[i("div",qe,[n(te,{direction:"vertical",column:1,border:""},{default:o(()=>[n(q,{label:e(a)("Recording")},{default:o(()=>[b(d(e(l).status.recording?e(a)("Yes"):e(a)("No")),1)]),_:1},8,["label"]),n(q,{label:e(a)("Output Path")},{default:o(()=>[b(d(e(l).status.outputPath||e(a)("None")),1)]),_:1},8,["label"])]),_:1})]),i("div",Ze,[n(_,{disabled:!e(l).status.connected||e(l).status.recording,type:"primary",onClick:t[4]||(t[4]=r=>e(l).startRecord())},{default:o(()=>[b(d(e(a)("Start Record")),1)]),_:1},8,["disabled"]),n(_,{disabled:!e(l).status.connected||!e(l).status.recording,type:"danger",onClick:t[5]||(t[5]=r=>e(l).stopRecord())},{default:o(()=>[b(d(e(a)("Stop Record")),1)]),_:1},8,["disabled"]),n(_,{disabled:!e(l).status.connected||!e(l).status.recording,type:"warning",onClick:t[6]||(t[6]=r=>e(l).splitRecord())},{default:o(()=>[b(d(e(a)("Split Record")),1)]),_:1},8,["disabled"]),n(_,{type:"primary",onClick:t[7]||(t[7]=r=>e(l).setProfileParameter())},{default:o(()=>[b(d(e(a)("Set Recording Name")),1)]),_:1})])]),_:1})):B("",!0),n(m,{class:"profile-card"},{header:o(()=>[i("div",He,[i("span",null,d(e(a)("Recording Profile")),1)])]),default:o(()=>[i("div",Me,[n(R,{"label-position":"top",class:"content-form"},{default:o(()=>[n(v,{label:e(a)("Record Path")},{default:o(()=>[n(D,{modelValue:e(c).path,"onUpdate:modelValue":t[8]||(t[8]=r=>e(c).path=r),placeholder:e(a)("recordPathPlaceholder")},null,8,["modelValue","placeholder"]),i("div",We,d(e(a)("filePathExplanation")),1)]),_:1},8,["label"]),n(v,{label:e(a)("Record File Name")},{default:o(()=>[n(D,{modelValue:e(c).fileName,"onUpdate:modelValue":t[9]||(t[9]=r=>e(c).fileName=r),placeholder:e(a)("recordFileNamePlaceholder")},null,8,["modelValue","placeholder"]),i("div",Ye,d(e(a)("fileNameExplanation")),1)]),_:1},8,["label"])]),_:1})])]),_:1}),n(m,{class:"table-card"},{header:o(()=>[i("div",je,[i("span",null,d(e(a)("User Content Settings")),1)])]),default:o(()=>[n(ae,{data:e(f),style:{width:"100%"},border:!0,stripe:""},{default:o(()=>[n(y,{prop:"type",label:e(a)("Type"),"min-width":"130",fixed:""},{default:o(r=>[i("span",null,d(e(a)(r.row.type)),1)]),_:1},8,["label"]),n(y,{label:e(a)("Start When"),align:"center"},{default:o(()=>[n(y,{prop:"enter",label:e(a)("Enter Zone"),align:"center","min-width":"95"},{default:o(r=>[n(P,{modelValue:r.row.enter,"onUpdate:modelValue":h=>r.row.enter=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),n(y,{prop:"countdown",label:e(a)("CountDown"),align:"center","min-width":"95"},{default:o(r=>[n(P,{modelValue:r.row.countdown,"onUpdate:modelValue":h=>r.row.countdown=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),n(y,{prop:"combatStart",label:e(a)("CombatStart"),align:"center","min-width":"95"},{default:o(r=>[n(P,{modelValue:r.row.combatStart,"onUpdate:modelValue":h=>r.row.combatStart=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),n(y,{label:e(a)("End When"),align:"center"},{default:o(()=>[n(y,{prop:"combatEnd",label:e(a)("CombatEnd"),align:"center","min-width":"95"},{default:o(r=>[n(P,{modelValue:r.row.combatEnd,"onUpdate:modelValue":h=>r.row.combatEnd=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),n(y,{prop:"wipe",label:e(a)("Wipe"),align:"center","min-width":"95"},{default:o(r=>[n(P,{modelValue:r.row.wipe,"onUpdate:modelValue":h=>r.row.wipe=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})])):(g(),O(m,{key:0,class:"connection-card"},{header:o(()=>[i("div",$e,[i("span",null,d(e(a)("Connect to OBS")),1)])]),default:o(()=>[n(R,{"label-position":"top",class:"connection-form"},{default:o(()=>[n(v,{label:e(a)("Port")},{default:o(()=>[n(D,{modelValue:e(c).host,"onUpdate:modelValue":t[0]||(t[0]=r=>e(c).host=r),placeholder:e(a)("portPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(v,{label:e(a)("Password")},{default:o(()=>[n(D,{modelValue:e(c).password,"onUpdate:modelValue":t[1]||(t[1]=r=>e(c).password=r),placeholder:e(a)("passwordPlaceholder"),type:"password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(v,null,{default:o(()=>[n(_,{type:"primary",class:"connect-button",loading:e(l).status.connecting,disabled:e(l).status.connecting||!e(c).host||!e(c).password,onClick:t[2]||(t[2]=r=>e(l).connect())},{default:o(()=>[b(d(e(l).status.connecting?e(a)("Connecting"):e(a)("Connect")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),n(ee,null,{default:o(()=>[b(d(e(a)("Instructions")),1)]),_:1}),n(L,{class:"instruction-alert",type:"info",description:e(a)("obsTutorial"),closable:!1,"show-icon":""},null,8,["description"]),n(L,{class:"instruction-alert",type:"info",description:e(a)("inputTutorial"),closable:!1,"show-icon":""},null,8,["description"]),n(L,{class:"instruction-alert",type:"info",description:e(a)("firewallTutorial"),closable:!1,"show-icon":""},null,8,["description"])]),_:1}))])):B("",!0)])}}});const nt=Q(Qe,[["__scopeId","data-v-21d21503"]]);export{nt as default};
