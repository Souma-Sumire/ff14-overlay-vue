import{c as e,d as a,_ as t}from"./shared-common-BkdhSTGj.js";import{d as r,x as o,K as n,o as s,B as l,h as d,g as u,a as i,b as c,c as p,n as m,r as y,F as f,f as b,p as v,v as g,t as h,e as k,A as S}from"./vendor-vue-MSvGQJWD.js";import{c as j,aq as x,f as J,U as C}from"./shared-core-BcyVo5ua.js";import{a as E,r as P,c as R}from"./cactbot-DtpbXwrG.js";import{t as $}from"./vendor-element-plus-CsMNiL2J.js";const L={class:"demo-text"},T={class:"cactbot-runtime-container"},_={class:"players",flex:"~ nowrap gap-1"},w={class:"fixed-rp"},U={class:"fixed-player"},V={class:"drag-job"},B={key:0,style:{position:"fixed",bottom:"0"}},D=t(r({__name:"cactbotRuntime",setup(t){const r=["tank","healer","dps"],D=j(),M=o(!1),q=J(),A=new x,H=n({party:[],partySorted:{tank:[],healer:[],dps:[]}});function O(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const F={tank:["MT","ST",...O("T",22,2)],healer:[...O("H",24)],dps:[...O("D",24)]},I=o("");function K(){const e=[...F.tank.slice(0,H.partySorted.tank.length),...F.healer.slice(0,H.partySorted.healer.length),...F.dps.slice(0,H.partySorted.dps.length)],a=[...H.partySorted.tank,...H.partySorted.healer,...H.partySorted.dps].map((a,t)=>({...a,rp:e[t]}));R({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a}})}function N(){const e=H.party.slice().sort((e,a)=>D.arr.indexOf(C.baseJobEnumConverted(e.job))-D.arr.indexOf(C.baseJobEnumConverted(a.job)));H.partySorted.tank=e.filter(e=>C.isTankJob(C.jobEnumToJob(e.job))),H.partySorted.healer=e.filter(e=>C.isHealerJob(C.jobEnumToJob(e.job))),H.partySorted.dps=e.filter(e=>C.isDpsJob(C.jobEnumToJob(e.job))),K()}function z(){N()}function G(){K()}const Q=()=>{M.value=!0},W=()=>{M.value=!1},X=e=>{q.value&&0===e.party.length||(H.party=e.party.filter(e=>e.inParty),N())},Y=e=>{q.value||(I.value=e.charName)},Z=e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&K()};function ee(){I.value=A.party.value[0].name,H.party=A.party.value.filter(e=>e.name===I.value),N()}function ae(){I.value=A.party.value[0].name,H.party=A.party.value,N()}function te(){A.shuffle({dps:4,healer:2,tank:2,crafter:3,gatherer:3,none:3}),ae()}return s(()=>{document.body.addEventListener("mouseenter",Q),document.body.addEventListener("mouseleave",W),E("ChangePrimaryPlayer",Y),E("PartyChanged",X),E("BroadcastMessage",Z)}),l(()=>{document.body.removeEventListener("mouseenter",Q),document.body.removeEventListener("mouseleave",W),P("PartyChanged",X),P("ChangePrimaryPlayer",Y),P("BroadcastMessage",Z)}),(t,o)=>{const n=$,s=a,l=e;return i(),d(l,null,{readme:u(()=>[c("span",L,[c("p",null,h(t.$t("cactbotRuntime.usageLine1")),1),c("ul",null,[c("li",null,h(t.$t("cactbotRuntime.usageLine2")),1),c("li",null,h(t.$t("cactbotRuntime.usageLine3")),1)])])]),default:u(()=>[c("div",T,[c("main",null,[c("div",_,[c("div",w,[(i(),p(f,null,y(r,(e,a)=>c("div",{key:`fixed-rp-${e}`,class:"player-role"},[(i(!0),p(f,null,y(b(H).partySorted[e],(a,t)=>(i(),p("div",{key:t,style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},[v(c("span",null,h(F[e][t]),513),[[g,b(M)||a.name===b(I)]])]))),128)),b(H).partySorted[e].length>0&&a<2&&b(M)?(i(),d(n,{key:0})):m("",!0)])),64))]),c("div",U,[(i(),p(f,null,y(r,(e,a)=>k(b(S),{key:`fixed-player-${e}`,modelValue:b(H).partySorted[e],"onUpdate:modelValue":a=>b(H).partySorted[e]=a,animation:200,"ghost-class":"ghost","force-fallback":!0,filter:".no-draggable",onUpdate:G},{default:u(()=>[(i(!0),p(f,null,y(b(H).partySorted[e],e=>v((i(),p("div",{key:e.id,class:"player-line"},[c("span",null,h(e.name),1)])),[[g,b(M)]])),128)),b(H).partySorted[e].length>0&&a<2&&b(M)?(i(),d(n,{key:0,class:"no-draggable"})):m("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])),64))])]),c("div",V,[b(M)?(i(),d(s,{key:0,party:b(H).party,onUpdate:z},null,8,["party"])):m("",!0)])]),b(q)?(i(),p("div",B,[c("button",{onClick:ee},h(t.$t("cactbotRuntime.testSolo")),1),c("button",{onClick:ae},h(t.$t("cactbotRuntime.testParty")),1),c("button",{onClick:te},h(t.$t("cactbotRuntime.testShuffleParty")),1)])):m("",!0)])]),_:1})}}}),[["__scopeId","data-v-e7558aa3"]]);export{D as default};
