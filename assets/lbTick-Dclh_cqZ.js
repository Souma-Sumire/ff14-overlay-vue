import{c as e,_ as n}from"./shared-common-BTkSSeU7.js";import{h as a,G as t,x as i,J as s,w as o,o as c,B as l,g as r,e as T,a as u,n as m,p as h,f as p,y as d,t as f,b as v,c as L,F as b,r as C,v as g}from"./vendor-vue-i6lpFrx4.js";import{E as y,b as k,f as w}from"./shared-core-3WpGeK2J.js";import{a as D,r as E}from"./cactbot-DtpbXwrG.js";import{n as F}from"./vendor-element-plus-C8e3lHeC.js";const _={class:"lb-container"},x={id:"percent"},j={id:"bonusTotal"},A={id:"extra"},B=3e4,I=n(a({__name:"lbTick",setup(n){const{zoneType:a}=y(),I=w(),$=k(),U=t(()=>"Pvp"!==a.value),Z=i(),z=s({prev:0,ratio:0,bonusTotal:0,chain:0,chainList:[]});function G(){z.prev=0,z.ratio=0,z.chain=0,z.chainList=[],z.bonusTotal=0}const J=e=>{if(U.value)if("36"===e.line[0]){const n=parseInt(e.line[2],16),a=n-z.prev;if(z.prev=n,z.ratio=n/B,0===n||a<-.1)z.chain=0,z.chainList=[];else{if(!(a>220))return void(z.chain=0);{z.chain+=a,z.bonusTotal+=a;const n=z.chainList[z.chainList.length-1];n&&n.timestamp+1e3>new Date(e.line[1]).getTime()&&(n.num===z.chain-300||n.num===z.chain-60)?z.chainList[z.chainList.length-1].num=z.chain:z.chainList.push({key:crypto.randomUUID(),num:z.chain,timestamp:new Date(e.line[1]).getTime()})}}}else"33"===e.line[0]&&["40000010","4000000F"].includes(e.line[3])&&G()};function P(){Z.value?.(),Z.value=function(e,n=2){const a=[];return function(t){let i=0;e({line:t[0],type:"LogLine",rawLine:""});for(let s=1;s<t.length;s++){const o=new Date(t[s][1]),c=new Date(t[s-1][1]);i+=o.getTime()-c.getTime();const l=window.setTimeout(()=>{e({line:t[s],type:"LogLine",rawLine:""})},i/n);a.push(l)}}([["36","2021-12-28T21:38:30.3580000+08:00","0000"],["36","2021-12-28T21:38:33.3580000+08:00","00DC"],["36","2021-12-28T21:38:34.8290000+08:00","0208"],["36","2021-12-28T21:38:36.3460000+08:00","02E4"],["36","2021-12-28T21:38:37.8630000+08:00","0410"],["36","2021-12-28T21:38:39.3360000+08:00","04EC"],["36","2021-12-28T21:38:42.3720000+08:00","05C8"],["36","2021-12-28T21:38:45.3620000+08:00","06A4"],["36","2021-12-28T21:38:47.8140000+08:00","07D0"],["36","2021-12-28T21:38:47.8140000+08:00","08FC"],["36","2021-12-28T21:38:47.8140000+08:00","0A28"],["36","2021-12-28T21:38:47.8140000+08:00","0B54"],["36","2021-12-28T21:38:47.8140000+08:00","0C80"],["36","2021-12-28T21:38:48.3510000+08:00","0D5C"],["36","2021-12-28T21:38:50.6220000+08:00","0E88"],["36","2021-12-28T21:38:50.8900000+08:00","0FB4"],["36","2021-12-28T21:38:51.0230000+08:00","10E0"],["36","2021-12-28T21:38:51.1570000+08:00","120C"],["36","2021-12-28T21:38:51.3360000+08:00","12E8"],["36","2021-12-28T21:38:54.3690000+08:00","13C4"],["36","2021-12-28T21:38:57.3570000+08:00","14A0"],["36","2021-12-28T21:38:58.3360000+08:00","15CC"],["36","2021-12-28T21:38:58.3360000+08:00","16F8"],["36","2021-12-28T21:38:58.3360000+08:00","1824"],["36","2021-12-28T21:38:58.3360000+08:00","1950"],["36","2021-12-28T21:38:58.3360000+08:00","1A7C"],["36","2021-12-28T21:39:00.3410000+08:00","1B58"],["36","2021-12-28T21:39:03.3690000+08:00","1C34"],["36","2021-12-28T21:39:04.2630000+08:00","1D60"],["36","2021-12-28T21:39:06.3600000+08:00","1E3C"]]),()=>{a.forEach(clearTimeout),a.length=0}}(J,1)}return o(()=>[$.value,I.value],()=>{Z.value?.(),G()}),c(()=>{D("ChangeZone",G),D("LogLine",J)}),l(()=>{E("ChangeZone",G),E("LogLine",J)}),(n,a)=>{const t=F,i=e;return u(),r(i,null,{default:T(()=>[p(I)||p($)?(u(),r(t,{key:0,type:"primary",class:"test-btn",onClick:P},{default:T(()=>[d(f(n.$t("lbTick.test")),1)]),_:1})):m("",!0),h(v("div",_,[v("p",x,f(n.$t("lbTick.lb"))+f((100*p(z).ratio).toFixed(2))+"% ",1),v("p",j,f(n.$t("lbTick.bonus"))+":"+f((p(z).bonusTotal/B*100).toFixed(0))+"% ",1),v("div",A,[(u(!0),L(b,null,C(p(z).chainList,e=>(u(),L("p",{key:e.key,class:"anime"}," +"+f((e.num/B*100).toFixed(0))+"% ",1))),128))])],512),[[g,p(U)]])]),_:1})}}}),[["__scopeId","data-v-e8d2049e"]]);export{I as default};
