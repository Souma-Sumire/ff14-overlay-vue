import{_ as e}from"./TimelineShow-Bo-jaBSN.js";import{_ as t}from"./zoneSelecter-B-MdNv9h.js";import{n as l,R as a,S as n,f as i,T as s,j as o,q as c,e as r,U as d,V as u,H as p,G as m,d as f,c as y,k as w,E as g,J as b,y as h,W as v,b as _,X as F,o as T,p as x,w as $,Y as V,K as S,Z as O,_ as k,v as I,$ as z,g as A,x as C,a0 as N,a1 as B,a2 as E,a as j,h as D}from"./vendor-element-plus-ICQGukrc.js";import{C as U,q as J,r as P,s as L,t as M,U as R,v as H,f as Z,w as K,y as q,z as W,Z as G}from"./shared-core-CJNBDgH7.js";import{o as X,B as Y,t as Q,H as ee,I as te,J as le,Y as ae,L as ne,u as ie,v as se,a as oe,X as ce,Z as re,K as de,R as ue,am as pe,r as me,ac as fe,G as ye,c as we,dt as ge,A as be,dj as he,M as ve,V as _e,_ as Fe,a6 as Te,du as xe,dv as $e,dw as Ve}from"./vendor-vue-iK2zA9mI.js";import{_ as Se,a as Oe}from"./shared-common-iS-rKQ6e.js";import{a as ke,c as Ie}from"./cactbot-Bq2Gp82n.js";const ze=new Map;ze.set(26155,{type:"cast",window:[999,999],battleOnce:!0}),ze.set(28027,{type:"cast",window:[999,999],battleOnce:!0}),ze.set(26340,{type:"cast",window:[999,999],battleOnce:!0}),ze.set(25533,{type:"begincast",window:[60,60]}),ze.set(26376,{type:"cast",window:[999,999],battleOnce:!0}),ze.set(26814,{type:"begincast",window:[999,999],battleOnce:!0}),ze.set(25313,{type:"begincast",window:[200,200]}),ze.set(27526,{type:"begincast",window:[999,999],battleOnce:!0}),ze.set(26215,{type:"cast",window:[500,30],battleOnce:!0}),ze.set(29050,{type:"begincast",window:[200,30],battleOnce:!0}),ze.set(29156,{type:"cast",window:[20,20]}),ze.set(27973,{type:"cast",window:[20,20]}),ze.set(27937,{type:"begincast",window:[20,20]}),ze.set(28059,{type:"begincast",window:[20,20]}),ze.set(28060,{type:"begincast",window:[20,20]}),ze.set(28061,{type:"begincast",window:[20,20]}),ze.set(27956,{type:"begincast",window:[20,20]}),ze.set(27957,{type:"begincast",window:[20,20]}),ze.set(27952,{type:"begincast",window:[30,30]}),ze.set(27969,{type:"begincast",window:[20,20]}),ze.set(27971,{type:"begincast",window:[20,20]}),ze.set(27939,{type:"begincast",window:[20,20]}),ze.set(27966,{type:"begincast",window:[20,20]}),ze.set(25316,{type:"begincast",window:[999,999],battleOnce:!0}),ze.set(25544,{type:"begincast",window:[10,10]}),ze.set(26379,{type:"begincast",window:[10,10]}),ze.set(31552,{type:"begincast",window:[30,30]}),ze.set(31573,{type:"begincast",window:[30,30]}),ze.set(31573,{type:"begincast",window:[30,30]}),ze.set(31617,{type:"begincast",window:[8,8]}),ze.set(31624,{type:"begincast",window:[30,30]}),ze.set(31649,{type:"begincast",window:[30,30]}),ze.set(18864,{type:"cast",window:[10,2.5],syncOnce:!0}),ze.set(18480,{type:"cast",window:[200,60],syncOnce:!0,battleOnce:!0}),ze.set(18516,{type:"cast",window:[250,65],syncOnce:!0,battleOnce:!0}),ze.set(18522,{type:"begincast",window:[500,500],syncOnce:!0,battleOnce:!0}),ze.set(18552,{type:"begincast",window:[67,67],syncOnce:!0}),ze.set(18553,{type:"cast",window:[67,67],syncOnce:!0}),ze.set(19083,{type:"cast",window:[900,200],syncOnce:!0,battleOnce:!0}),ze.set(40191,{type:"begincast",window:[200,20],syncOnce:!0}),ze.set(40265,{type:"begincast",window:[500,20],syncOnce:!0,battleOnce:!0}),ze.set(40246,{type:"begincast",window:[999,30],syncOnce:!0,battleOnce:!0}),ze.set(40306,{type:"begincast",window:[30,30],syncOnce:!0}),ze.set(11103,{type:"begincast",window:[310,30],syncOnce:!0,battleOnce:!0}),ze.set(11517,{type:"begincast",window:[600,30],syncOnce:!0,battleOnce:!0}),ze.set(11122,{type:"begincast",window:[100,30],syncOnce:!0,battleOnce:!0}),ze.set(11143,{type:"begincast",window:[60,60],syncOnce:!0}),ze.set(11126,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),ze.set(11596,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),ze.set(11597,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),ze.set(42785,{type:"begincast",window:[9.6,2],syncOnce:!0}),ze.set(42838,{type:"cast",window:[77.2,30],syncOnce:!0,battleOnce:!0}),ze.set(42863,{type:"cast",window:[30,30],syncOnce:!1}),ze.set(42787,{type:"cast",window:[30,30],syncOnce:!1}),ze.set(42864,{type:"cast",window:[30,30],syncOnce:!1}),ze.set(41946,{type:"begincast",window:[10,10],syncOnce:!1}),ze.set(41936,{type:"begincast",window:[20,30],syncOnce:!0}),ze.set(41939,{type:"begincast",window:[20,20],syncOnce:!0}),ze.set(42825,{type:"begincast",window:[60,60],syncOnce:!0,battleOnce:!0}),ze.set(41969,{type:"begincast",window:[20,20],syncOnce:!0}),ze.set(41871,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0}),ze.set(43053,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0}),ze.set(45645,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0});const Ae={class:"query-results"},Ce={flex:"~","m-t-10":""},Ne={class:"ability-filter-container"},Be={key:0,class:"loading-abilities"},Ee=["src","alt","onerror"],je=Se(X({__name:"FflogsImport",props:{filters:{}},emits:["showFFlogsToggle","editTimeline"],setup(e,{emit:t}){const b=e,h=t,v=new U({key:"souma-fflogs-cache",maxSize:2097152,cleanupRatio:.25});function _(e){const t=v.get(e);if(!t)return null;try{return JSON.parse(t)}catch{return null}}function F(e,t,l=2592e5){const a={data:t,expire:Date.now()+l};v.set(e,JSON.stringify(a),l)}function T(e){return e&&e.expire>Date.now()}Y(()=>{v.clearExpired(),J()});const x=new RegExp("(?<=^|\\/)(?<code>(?:a:)?\\w{16,})[#?]fight=(?<fight>\\d+|last)"),$=me("查询"),V=me(""),S=me(!1),O=me(!1),k=me(0),I=me(!1),z=fe({});j();const A=P();async function C(e){O.value=!0,k.value=2,z.player=e,z.type="friendies",z.abilityFilterEvents.length=0,z.abilityFilterCandidate.length=0,z.enemiesAbilityFilterSelected.length=0;try{await async function(){I.value=!1;const e=[];async function t(l){try{const a=`events:friendly:${z.code}:${l}:${z.player?.id}`,n=_(a);let i;n&&T(n)?i=n.data:(i=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${z.code}?start=${l}&end=${z.end}&hostility=0&sourceid=${z.player?.id}&api_key=${A.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),F(a,i)),e.push(...i.events),i.nextPageTimestamp&&i.nextPageTimestamp>0&&i.nextPageTimestamp<z.end&&await t(i.nextPageTimestamp)}catch(a){g.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${a}`,"获取友方技能数据失败",{confirmButtonText:"确定",type:"error"})}}async function l(t,a){if(a>=0)try{const n=`events:enemy:${z.code}:${t}:${z.bossIDs[a]}`,i=_(n);let s;i&&T(i)?s=i.data:(s=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${z.code}?start=${t}&end=${z.end}&hostility=1&sourceid=${z.bossIDs[a]}&api_key=${A.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),F(n,s)),e.push(...s.events),s.nextPageTimestamp&&s.nextPageTimestamp>0&&s.nextPageTimestamp<z.end&&await l(s.nextPageTimestamp,a),a<z.bossIDs.length-1&&await l(t,a+1)}catch(n){g.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${n}`,"获取敌方技能数据失败",{confirmButtonText:"确定",type:"error"})}}z.abilityFilterEvents.length=0,z.enemiesAbilityFilterSelected.length=0,await Promise.all([t(z.start),l(z.start,0)]);for(const a of e)"begincast"===a.type&&a.sourceIsFriendly||z.abilityFilterEvents.push({time:Number(((a.timestamp-z.start)/1e3).toFixed(1)),type:a.type,actionName:H(a.ability.guid)??a.ability.name,actionId:a.ability.guid,sourceIsFriendly:a.sourceIsFriendly,url:a?.ability?.abilityIcon.replace("-","/").replace(".png","")??"000000/000405",window:void 0,sourceID:a.sourceID});I.value=!0}(),z.abilityFilterCandidate=z.abilityFilterEvents.reduce((e,t)=>(t.sourceIsFriendly&&!e.find(e=>e.actionId===t.actionId)&&e.push(t),e),[]).sort((e,t)=>e.time-t.time),z.player?.icon&&b.filters[z.player.icon]&&(z.abilityFilterSelected=b.filters[z.player.icon]),z.abilityFilterSelected=z.abilityFilterSelected.filter(e=>z.abilityFilterCandidate.find(t=>t.actionId===e)),O.value=!1}catch(t){g.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${t}`,"获取玩家技能数据失败",{confirmButtonText:"确定",type:"error"}),O.value=!1}}function N(){O.value=!0,k.value=3,z.player?.icon&&A.updateFilters(z.player?.icon,JSON.parse(JSON.stringify(z.abilityFilterSelected))),z.abilityFilterEvents=z.abilityFilterEvents.filter(e=>e.sourceIsFriendly&&z.abilityFilterSelected.includes(e.actionId)||!e.sourceIsFriendly).sort((e,t)=>e.time-t.time),z.abilityFilterEvents=function(e){for(const t of e){const e=ze.get(t.actionId);e?.type===t.type&&(t.window=e?.window,t.syncOnce=Boolean(e?.syncOnce),t.battleOnce=Boolean(e?.battleOnce))}return e}(z.abilityFilterEvents),z.abilityFilterEventsAfterFilterRawTimeline=z.abilityFilterEvents.map(e=>{const{time:t,actionName:l,actionId:a,type:n,sourceID:i,window:s,sourceIsFriendly:o,syncOnce:c,battleOnce:r}=e;if(o)return`${t} "<${l}>~"${S.value?` tts "${l}"`:""}`;if(/^(?:攻击|attack|攻撃)$/i.test(l)&&!s||"cast"===n&&!s||z.battleSyncedIDs.includes(a))return`# ${t} "${l}"`;const d=z.enemies.find(e=>e.id===i);if(("NPC"===d?.type||/unknown/.test(l))&&!s)return null;const u=`${t} "${l}" ${"begincast"===n?"StartsUsing":"Ability"} { id: "${a.toString(16).toUpperCase()}" }`;return r&&s&&z.battleSyncedIDs.push(a),s?`${u} window ${s.join(",")} ${c?"once":""}`:`# ${u}`}).filter(e=>null!==e).join("\n");const e=A.newTimeline(`导入${z.player?.name}`,{zoneID:z.zoneID.toString(),jobs:[z.player?.icon??"NONE"],phase:void 0},z.abilityFilterEventsAfterFilterRawTimeline,`${z.code}#fight=${z.fightIndex+1}`);j(),h("showFFlogsToggle"),h("editTimeline",A.allTimelines[e]),setTimeout(()=>{k.value=0},500),O.value=!1}async function B(){O.value=!0,k.value=2,z.type="enemies",z.abilityFilterEvents.length=0,z.abilityFilterCandidate.length=0;try{await async function(){I.value=!1;const e=[];async function t(l,a){if(a>=0)try{const n=`events:enemy:${z.code}:${l}:${z.bossIDs[a]}`,i=_(n);let s;i&&T(i)?s=i.data:(s=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${z.code}?start=${l}&end=${z.end}&hostility=1&sourceid=${z.bossIDs[a]}&api_key=${A.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),F(n,s)),e.push(...s.events),s.nextPageTimestamp&&s.nextPageTimestamp>0&&s.nextPageTimestamp<z.end&&await t(s.nextPageTimestamp,a),a<z.bossIDs.length-1&&await t(l,a+1)}catch(n){g.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${n}`,"获取敌方技能数据失败",{confirmButtonText:"确定",type:"error"})}}z.abilityFilterEvents.length=0,z.enemiesAbilityFilterSelected.length=0,await Promise.all([t(z.start,0)]);for(const a of e)z.abilityFilterEvents.push({time:Number(((a.timestamp-z.start)/1e3).toFixed(1)),type:a.type,actionName:H(a.ability.guid)??a.ability.name,actionId:a.ability.guid,sourceIsFriendly:!1,url:"",window:void 0,sourceID:a.sourceID});I.value=!0,z.enemiesAbilityFilterSelected.length=0;const l=Array.from(new Set(z.abilityFilterEvents.map(e=>e.actionName)));z.enemiesAbilityFilterSelected.push(...l)}(),z.abilityFilterCandidate=z.abilityFilterEvents.reduce((e,t)=>(!1!==t.sourceIsFriendly||e.find(e=>e.actionName===t.actionName)||e.push(t),e),[]).sort((e,t)=>e.time-t.time),z.enemiesAbilityFilterSelected=z.enemiesAbilityFilterSelected.filter(e=>z.abilityFilterCandidate.find(t=>t.actionName===e)),O.value=!1}catch(e){g.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${e}`,"获取敌人技能数据失败",{confirmButtonText:"确定",type:"error"}),O.value=!1}}function E(){k.value=3,z.abilityFilterEvents=z.abilityFilterEvents.filter(e=>z.enemiesAbilityFilterSelected.includes(e.actionName)).sort((e,t)=>e.time-t.time),z.abilityFilterEventsAfterFilterRawTimeline=z.abilityFilterEvents.map(e=>{const{time:t,actionName:l,actionId:a,type:n}=e,i="begincast"===n?"StartsUsing":"Ability",s=a.toString(16).toUpperCase(),o=z.enemies.find(t=>t.id===e.sourceID),c="Boss"===o?.type?"Boss":"分身";return`${t} "${l}" ${i} { id: "${s}" } #${o?.name??"未知"}（${c}）`}).join("\n");const e=A.newTimeline("BOSS时间轴（使用前请删除非必要的正则）",{zoneID:z.zoneID.toString(),jobs:[],phase:void 0},z.abilityFilterEventsAfterFilterRawTimeline,`${z.code}#fight=${z.fightIndex+1}`);j(),h("showFFlogsToggle"),h("editTimeline",A.allTimelines[e]),setTimeout(()=>{k.value=0},500)}function j(){z.type="friendies",z.code="",z.fightIndex=0,z.start=0,z.end=0,z.friendlies=[],z.abilityFilterEvents=[],z.abilityFilterCandidate=[],z.abilityFilterSelected=[],z.enemiesAbilityFilterSelected=[],z.abilityFilterEventsAfterFilterRawTimeline="",z.player=void 0,z.zoneID=0,z.bossIDs=[],z.enemies=[],z.battleSyncedIDs=[]}function D(){window.open("https://cn.fflogs.com/profile","_blank")}return(e,t)=>{const b=l,h=a,v=n,U=o,J=s,P=c,H=r,Z=u,K=i,q=p,W=m,G=f,X=y,Y=w;return Q(),ee(ue,null,[te(b,{style:ne(ie(k)>0?{}:{visibility:"hidden",pointerEvent:"none"}),type:"primary",text:"","position-absolute":"","z-999":"",class:"guide",onClick:t[0]||(t[0]=e=>k.value--)},{default:le(()=>[...t[8]||(t[8]=[ae(" 上一步 ",-1)])]),_:1},8,["style"]),te(v,{active:ie(k),class:"steps-guide","align-center":""},{default:le(()=>[te(h,{title:"导入战斗"}),te(h,{title:"选择目标"}),te(h,{title:"过滤技能"})]),_:1},8,["active"]),0===ie(k)?(Q(),se(K,{key:0,class:"input-section"},{default:le(()=>[te(Z,{"label-width":"150px",class:"fflogs-form"},{default:le(()=>[te(J,{label:"FF Logs 战斗链接"},{default:le(()=>[te(U,{modelValue:ie(V),"onUpdate:modelValue":t[1]||(t[1]=e=>oe(V)?V.value=e:null),placeholder:"https://www.fflogs.com/reports/AAAaAaAAaa1aA1aA?fight=1",autocomplete:"on"},null,8,["modelValue"])]),_:1}),te(J,{label:"FF logs V1 Key"},{default:le(()=>[te(U,{modelValue:ie(A).settings.api,"onUpdate:modelValue":t[2]||(t[2]=e=>ie(A).settings.api=e),placeholder:"在 FF Logs 个人设置页面获取 V1 API Key",type:"password","show-password":""},{append:le(()=>[te(P,{content:"点击前往 FF Logs 个人设置页面，在最下方填写 V1客户名称 并点击确认后，再获取你的 V1 客户端密钥",placement:"top",effect:"light"},{default:le(()=>[te(b,{type:"primary",link:"",onClick:D},{default:le(()=>[...t[9]||(t[9]=[ae(" 如何获取 ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),te(J,null,{default:le(()=>[te(b,{disabled:"正在查询..."===ie($),type:"primary",onClick:t[3]||(t[3]=e=>async function(e){O.value=!0,j(),$.value="正在查询...";const t=e.match(x);if(!A.settings.api)return g.alert("请在FF Logs个人设置页面获取V1 API Key","FF logs API Key 未填写",{confirmButtonText:"确定",type:"error",dangerouslyUseHTMLString:!0,message:'<a href="https://cn.fflogs.com/profile">点击这里，在最下方<strong>填写 V1 客户名称并点击确认</strong>后，获取你的 V1 客户端密钥</a>'}),$.value="查询",void(O.value=!1);if(!t)return g.alert("请正确填写FF Logs链接","FF Logs链接格式错误",{confirmButtonText:"确定",type:"error"}),$.value="查询",void(O.value=!1);z.code=t.groups?.code??"";try{const e=`fights:${z.code}`,l=_(e);let a;l&&T(l)?a=l.data:(a=await fetch(`https://cn.fflogs.com/v1/report/fights/${z.code}?api_key=${A.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),F(e,a)),z.bossIDs=a.enemies.filter(e=>["Boss","NPC"].includes(e.type)).map(e=>e.id),z.enemies=a.enemies.slice(),z.fightIndex=("last"===t?.groups?.fight?a.fights.length:Number.parseInt(t?.groups?.fight??"0"))-1;const n=a.fights[z.fightIndex];z.zoneID=n.zoneID,z.start=n.start_time,z.end=n.end_time,z.friendlies=a.friendlies.filter(e=>"LimitBreak"!==e.icon&&e.fights.find(e=>e.id===z.fightIndex+1)),z.friendlies.sort((e,t)=>{const l=R.iconToJobEnum(e.icon),a=R.iconToJobEnum(t.icon);return R.enumSortMethod(l,a)}),$.value="查询",z.abilityFilterEvents.length=0,z.abilityFilterCandidate.length=0,O.value=!1,k.value=1}catch(l){g.alert(`\n  <h3 style="margin-bottom: 10px;">可能的原因：</h3>\n  <ul style="padding-left: 20px; margin-bottom: 10px;">\n    <li> <strong>90%概率</strong>：你没有<strong style="color: red;">先起名</strong>再获取 V1 客户端密钥</li>\n    <li> <strong>5%概率</strong>：该战斗记录是私人或匿名模式</li>\n    <li> <strong>5%概率</strong>：网络异常</li>\n  </ul>\n<p class="error-details"><strong>错误：</strong>${l}</p>\n`,"请求失败",{confirmButtonText:"确定",type:"error",dangerouslyUseHTMLString:!0}),$.value="查询",O.value=!1}}(ie(V)))},{default:le(()=>[ie(O)?(Q(),se(H,{key:0,class:"is-loading"},{default:le(()=>[te(ie(d))]),_:1})):ce("",!0),ae(" "+re(ie($)),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})):ce("",!0),de("div",Ae,[1===ie(k)?(Q(),se(K,{key:0,class:"player-selection"},{default:le(()=>[te(W,{data:ie(z).friendlies.filter(e=>!["NPC"].includes(e.icon)),stripe:"",border:"",class:"friendlies-table"},{default:le(()=>[te(q,{prop:"name",label:"玩家名称"}),te(q,{label:"职业"},{default:le(({row:e})=>{return[ae(re((t=e.icon,R.jobToFullName(R.jobEnumToJob(R.iconToJobEnum(t))).cn)),1)];var t}),_:1}),te(q,{label:"选定",width:"100",align:"center"},{default:le(e=>[te(b,{type:"primary",size:"small",onClick:t=>C(e.row)},{default:le(()=>[...t[10]||(t[10]=[ae(" 选择 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),de("div",Ce,[te(b,{type:"info",onClick:t[4]||(t[4]=e=>B())},{default:le(()=>[...t[11]||(t[11]=[ae(" 不选择玩家，而是生成BOSS时间轴 ",-1)])]),_:1})])]),_:1})):ce("",!0),2===ie(k)?(Q(),se(K,{key:1,class:"ability-filter"},{default:le(()=>[de("div",Ne,[ie(I)?ce("",!0):(Q(),ee("div",Be,[te(H,{class:"is-loading"},{default:le(()=>[te(ie(d))]),_:1}),t[12]||(t[12]=de("span",null,"正在加载技能列表...",-1))])),ie(I)&&"friendies"===ie(z).type?(Q(),ee(ue,{key:1},[te(X,{modelValue:ie(z).abilityFilterSelected,"onUpdate:modelValue":t[5]||(t[5]=e=>ie(z).abilityFilterSelected=e),multiple:"",placeholder:"选择需要导入的技能","fit-input-width":!0,class:"ability-filter-select",filterable:""},{default:le(()=>[(Q(!0),ee(ue,null,pe(ie(z).abilityFilterCandidate,e=>(Q(),se(G,{key:e.actionId,value:e.actionId,label:e.actionName,class:"ability-filter-option"},{default:le(()=>[de("img",{src:ie(M)(`/i/${e.url}.png`),class:"ability-filter-icon",alt:e.actionName,onerror:ie(L)},null,8,Ee),de("span",null,re(e.actionName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"]),te(J,{label:"添加 TTS 语法","m-t-3":"","w-60":""},{default:le(()=>[te(Y,{modelValue:ie(S),"onUpdate:modelValue":t[6]||(t[6]=e=>oe(S)?S.value=e:null)},null,8,["modelValue"])]),_:1}),te(b,{type:"success",class:"filter-confirm-btn",disabled:!ie(I),onClick:N},{default:le(()=>[...t[13]||(t[13]=[ae(re("生成玩家时间轴"),-1)])]),_:1},8,["disabled"])],64)):ie(I)&&"enemies"===ie(z).type?(Q(),ee(ue,{key:2},[ie(I)?(Q(),se(X,{key:0,modelValue:ie(z).enemiesAbilityFilterSelected,"onUpdate:modelValue":t[7]||(t[7]=e=>ie(z).enemiesAbilityFilterSelected=e),multiple:"",placeholder:"选择需要导入的技能","fit-input-width":!0,class:"ability-filter-select",filterable:""},{default:le(()=>[(Q(!0),ee(ue,null,pe(ie(z).abilityFilterCandidate,e=>(Q(),se(G,{key:e.actionName,value:e.actionName,class:"ability-filter-option"},{default:le(()=>[de("span",null,re(e.actionName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])):ce("",!0),te(b,{type:"success",class:"filter-confirm-btn",disabled:!ie(I),onClick:E},{default:le(()=>[...t[14]||(t[14]=[ae(re("生成敌人时间轴"),-1)])]),_:1},8,["disabled"])],64)):ce("",!0)])]),_:1})):ce("",!0)])],64)}}}),[["__scopeId","data-v-e2e2f41f"]]),De=Se(X({__name:"SettingsDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(t,{emit:l}){const a=t,n=l,i=P();ye(()=>{i.saveTimelineSettings()});const o=we({get:()=>a.modelValue,set:e=>n("update:modelValue",e)}),c=me(-15),r=me([{time:-15,action:"<圣光幕帘>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:-2,action:"<圣灵>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:0,action:"战斗开始！",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:3,action:"<挑衅>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:5,action:"<神圣领域>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1}]);return(t,l)=>{const a=_,n=s,d=v,p=h,m=F,f=e,y=u,w=b;return Q(),se(w,{modelValue:ie(o),"onUpdate:modelValue":l[1]||(l[1]=e=>oe(o)?o.value=e:null),modal:!0,overflow:"","close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"timeline-dialog",width:"600px","append-to-body":!0,draggable:!0},{header:le(()=>[...l[2]||(l[2]=[de("h3",{style:{margin:"0",padding:"10px","background-color":"#f5f7fa",cursor:"move"}}," 设置 ",-1)])]),default:le(()=>[te(y,{"label-position":"right","label-width":"120px",class:"timeline-form"},{default:le(()=>[l[3]||(l[3]=de("h3",{class:"form-section-title"}," 参数 ",-1)),te(p,{gutter:20},{default:le(()=>[(Q(!0),ee(ue,null,pe(ie(i).configValues,(e,t,l)=>(Q(),se(d,{key:l,span:12},{default:le(()=>[te(n,{label:ie(i).configTranslate[t]},{default:le(()=>[te(a,{modelValue:ie(i).configValues[t],"onUpdate:modelValue":e=>ie(i).configValues[t]=e,min:0,step:.1,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),l[4]||(l[4]=de("h3",{class:"form-section-title"}," 样式 ",-1)),te(p,{gutter:20},{default:le(()=>[(Q(!0),ee(ue,null,pe(ie(i).showStyle,(e,t,l)=>(Q(),se(d,{key:l,span:12},{default:le(()=>[te(n,{label:ie(i).showStyleTranslate[t]},{default:le(()=>[te(a,{modelValue:ie(i).showStyle[t],"onUpdate:modelValue":e=>ie(i).showStyle[t]=e,min:0,step:.01,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),l[5]||(l[5]=de("h3",{class:"form-section-title"}," 测试用例 ",-1)),te(p,{gutter:20},{default:le(()=>[te(m,{modelValue:ie(c),"onUpdate:modelValue":l[0]||(l[0]=e=>oe(c)?c.value=e:null),min:-15,max:5,step:.1,"show-input":""},null,8,["modelValue"]),te(f,{config:ie(i).configValues,lines:ie(r),runtime:ie(c),"show-style":ie(i).showStyle},null,8,["config","lines","runtime","show-style"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-fcf4e153"]]),Ue={class:"status-text"},Je={key:0,class:"sync-time"},Pe={style:{"font-size":"13px","line-height":"1.6",color:"var(--el-text-color-regular)"}},Le={class:"batch-operations",style:{"margin-bottom":"15px",display:"flex","flex-wrap":"wrap","justify-content":"space-between",gap:"10px"}},Me={style:{display:"flex",gap:"10px","flex-wrap":"wrap"}},Re={class:"editor-dialog-content"},He={class:"source-container"},Ze={class:"slider-demo-block"},Ke={class:"time-display",style:{width:"80px","text-align":"center"}},qe={class:"time-display-text"},We={class:"time-display-text"},Ge={style:{"margin-top":"1em"}},Xe={class:"export-size-info"},Ye={class:"export-size-info"},Qe={class:"export-size-info"},et={class:"dialog-footer"},tt=Se(X({__name:"timelineSettings",setup(a){const n=he(),{wsConnected:c}=Z({allowClose:!0,addWsParam:!0}),d=P(),w=Te(d,"allTimelines"),_=Te(d,"filters"),U=me(0),J=me([]),L=me(!1),M=me(!1),H=me(!1),X=me(!1),ye=me(!1),Se=me(!1),ze=me("compressed_full"),Ae=fe({compressedFull:"",compressedZip:"",rawJson:"",fullSize:0,optimizedSize:0,rawSize:0}),Ce=me("idle"),Ne=me(""),Be=me(!1),Ee=/^(?:a:)?\w{16,}(?:[#?]fight=(?:\d+|last))?$/,tt=we(()=>{const e=n.resolve({path:"/timeline"});return`${window.location.protocol}//${window.location.host}/ff14-overlay-vue/${e.href}`}),lt=ge("timelineCurrentlyEditing",{name:"空",condition:{zoneID:"0",jobs:["NONE"],phase:void 0},timeline:"空",source:"空",createdAt:"空"}),at=me([]);let nt=null,it=!1;const st=me(""),ot=me(""),ct=me(""),rt=me(""),dt=we(()=>w.value.filter(e=>{const t=e.name.toLowerCase().includes(st.value.toLowerCase()),l=!ot.value||e.condition.zoneID===ot.value,a=!ct.value||e.condition.jobs.includes(ct.value),n=!rt.value||("undefined"===rt.value?!e.condition.phase:e.condition.phase===rt.value);return t&&l&&a&&n})),ut=we(()=>{const e=U.value,t=e<0,l=Math.abs(Math.floor(e)),a=Math.floor(l/60),n=l%60;return`${t?"-":""}${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`});be(()=>lt.value.condition.zoneID,e=>{K[e]||(lt.value.condition.phase=void 0)}),be(ot,e=>{e&&!K[e]&&(rt.value="")});const pt=me(0);function mt(e){lt.value=e,M.value=!0,wt()}function ft(){M.value=!1}function yt(){mt(d.allTimelines[d.newTimeline()])}function wt(){at.value=[{time:0,action:"正在加载...",show:!0,windowBefore:0,windowAfter:0,alertAlready:!0}],q(lt.value.timeline).then(e=>{at.value=e;const t=Math.max(...at.value.map(e=>e.time),550);pt.value=t+30,U.value=-d.configValues.preBattle})}function gt(){0!==J.value.length?g.confirm(`确定要删除选中的 ${J.value.length} 个时间轴吗？`,"批量删除",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(()=>{const e=new Set(J.value);d.allTimelines=d.allTimelines.filter(t=>!e.has(t)),J.value=[],j.success("批量删除成功")}).catch(()=>{}):j.warning("请选择要删除的时间轴")}function bt(){g.confirm("确定要清空所有时间轴吗？此操作不可逆！","危险操作",{confirmButtonText:"确定清空",cancelButtonText:"取消",confirmButtonClass:"el-button--danger",type:"error"}).then(()=>{g.prompt('输入 "我确认清空" 以执行此操作',"二次确认",{confirmButtonText:"确定清空",cancelButtonText:"取消",inputPattern:/^我确认清空$/,inputErrorMessage:"请输入正确的确认文字",type:"warning"}).then(()=>{d.allTimelines=[],J.value=[],j.success("已清空所有时间轴")})}).catch(()=>{})}function ht(){L.value=!L.value,J.value=L.value?[...w.value]:[]}function vt(){0!==J.value.length?_t(J.value):j.warning("请选择要导出的时间轴")}function _t(e){const t=1===e.length,l=t?e[0]:e,a=JSON.stringify(l),n=JSON.stringify(l,null,2);let i;if(t)i=JSON.parse(a),i.timeline=i.timeline.replace(/^#.*(?:\n|$)/gm,"");else{i=JSON.parse(a);for(const e of i)e.timeline=e.timeline.replace(/^#.*(?:\n|$)/gm,"")}const s=JSON.stringify(i);Ae.compressedFull=$e.compressToBase64(a),Ae.compressedZip=$e.compressToBase64(s),Ae.rawJson=n,Ae.fullSize=Ae.compressedFull.length,Ae.optimizedSize=Ae.compressedZip.length,Ae.rawSize=n.length,ze.value="compressed_full",Se.value=!0}function Ft(){let e="";e="compressed_full"===ze.value?Ae.compressedFull:"compressed_zip"===ze.value?Ae.compressedZip:Ae.rawJson,function(e,t="复制成功",l="复制失败"){W(e).then(()=>j.success(t)).catch(()=>j.error(l))}(e,"数据复制成功，已写入剪切板。","复制失败，请手动复制！"),Se.value=!1}function Tt(){const e=e=>{if(!e)return null;try{const t=JSON.parse(e);return Array.isArray(t)?t:[t]}catch{const t=e.split("\n").filter(e=>""!==e.trim());let l=[];for(const e of t)try{const t=JSON.parse(e);l=l.concat(Array.isArray(t)?t:[t])}catch{try{const t=$e.decompressFromBase64(e);if(t){const e=JSON.parse(t);l=l.concat(Array.isArray(e)?e:[e])}}catch{}}return l.length>0?l:null}};g.prompt("请输入导出的字符串（支持单行、多行 JSON 或压缩格式）","导入时间轴",{confirmButtonText:"解析",cancelButtonText:"取消",inputType:"textarea",inputValidator:t=>!!e(t)||"无法解析任何有效的时间轴数据，请确保输入格式正确。",inputErrorMessage:"无效的输入"}).then(t=>{const{value:l}=t,a=e(l);if(!a)return;const n=a.length,i=a.map(e=>`「${e.name}」`).join(", ");g.confirm(`确定要导入这 ${n} 个时间轴吗？\n${i}`,"二次确认",{confirmButtonText:"确定导入",cancelButtonText:"取消",type:"warning"}).then(()=>{!function(e){d.allTimelines.push(...e),d.sortTimelines();for(const n of d.allTimelines)void 0===n.condition.jobs&&(n.condition.jobs=[n.condition?.job??"NONE"]);const t=[],l=new Set;for(const n of d.allTimelines){const e=JSON.stringify({name:n.name,condition:n.condition,timeline:n.timeline,source:n.source,createdAt:n.createdAt});l.has(e)||(l.add(e),t.push(n))}const a=d.allTimelines.length-t.length;d.allTimelines=t,j({message:`追加成功！共导入 ${e.length} 个时间轴${a>0?`，但其中 ${a} 个重复，已自动移除。`:""}`,type:"success",duration:3e3})}(a)}).catch(()=>{})}).catch(()=>{})}function xt(e,t={}){Ie({call:"broadcast",source:"soumaTimelineSettings",msg:{type:e,data:t}})}function $t(){const e=n.resolve({path:"/timeline"}),t=`${window.location.protocol}//${window.location.host}/ff14-overlay-vue/${e.href}`;it=!0,nt=D.service({lock:!0,text:`正在请求数据，请确保 ACT 中已添加并启用此悬浮窗：${t}`,background:"rgba(0, 0, 0, 0.7)"}),xt("get"),setTimeout(()=>{it&&(j.info("重新尝试获取数据..."),$t())},5e3)}const Vt=e=>{if("soumaTimeline"===e.source)if("post"===e.msg.type){it=!1,nt.close();const t=e.msg.data;for(const e of t.allTimelines)d.normalizeTimeline(e);d.allTimelines=t.allTimelines,d.configValues=t.configValues,d.showStyle=t.showStyle,j.closeAll(),j({message:"数据获取成功",type:"success",duration:3e3})}else"success"===e.msg.type?(Be.value=!1,Ce.value="idle",Ne.value=(new Date).toLocaleTimeString()):"hello"===e.msg.type&&Ct()};function St(){window.open("https://docs.qq.com/sheet/DTWxKT3lFbmpDV3Fm?tab=5ovrc8","_blank")}function Ot(){const e=n.resolve({path:"/timelineHelp"}).href;window.open(e,"_blank")}function kt(){H.value=!0}function It(e){d.configValues=e.configValues,d.showStyle=e.showStyle}function zt({row:e}){return e===lt.value?"editing-row":""}function At(){ye.value=!0}function Ct(){Be.value=!0,Ce.value="syncing",xt("post",d.$state)}function Nt(e){const t=G[e]?.name;return t?t.cn||`${t.ja} / ${t.en}`:"未知地图"}function Bt(e){return(R.jobToFullName(e.toUpperCase())?.cn??e).replace("冒险者","全部职业")}return Y(()=>{ke("BroadcastMessage",Vt);const e=be(c,t=>{t&&(0===d.allTimelines.length&&$t(),e())});d.allTimelines.forEach(e=>e.timeline=e.timeline.replaceAll(/^(?<a>.+), once: true(?<b>.+)$/gm,"$<a>$<b> once"));const t=Ve(()=>{Ct()},500);be(()=>d.$state,t,{deep:!0})}),d.loadTimelineSettings(),d.sortTimelines(),(a,n)=>{const D=p,P=m,R=b,Z=De,q=l,W=V,G=$,Y=r,me=O,fe=S,we=Oe,ge=h,be=x,he=je,Te=o,$e=t,Ve=f,ke=y,Ie=z,nt=A,it=i,xt=C,$t=I,Vt=s,Ct=v,Et=B,jt=N,Dt=u,Ut=F,Jt=e,Pt=E,Lt=T;return Q(),se(Lt,{class:"container"},{default:le(()=>[te(R,{modelValue:ie(ye),"onUpdate:modelValue":n[0]||(n[0]=e=>oe(ye)?ye.value=e:null),title:"时间轴解析结果","align-center":"",center:"",draggable:"",width:"80%"},{default:le(()=>[te(P,{data:ie(at)},{default:le(()=>[te(D,{property:"time",label:"time","min-width":"60"}),te(D,{property:"action",label:"action",width:"150"},{default:le(({row:e})=>[ae(re(e.action.replaceAll(/(^['"“”]|['"“”]$)/g,"")),1)]),_:1}),te(D,{property:"sync",label:"sync","min-width":"200"},{default:le(({row:e})=>[ae(re(e.sync?e.sync:"-"),1)]),_:1}),te(D,{property:"syncOnce",label:"once","min-width":"100"},{default:le(({row:e})=>[ae(re(e.syncOnce?"✅":"-"),1)]),_:1}),te(D,{label:"window","min-width":"100"},{default:le(({row:e})=>[ae(re(e.sync?`${e.windowBefore},${e.windowAfter}`:"-"),1)]),_:1}),te(D,{property:"jump",label:"jump","min-width":"100"},{default:le(({row:e})=>[ae(re(e.jump?e.jump:"-"),1)]),_:1}),te(D,{property:"tts",label:"tts","min-width":"150"},{default:le(({row:e})=>[ae(re(e.tts?e.tts:"-"),1)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),te(Z,{modelValue:ie(X),"onUpdate:modelValue":n[1]||(n[1]=e=>oe(X)?X.value=e:null),onSave:It},null,8,["modelValue"]),te(be,{class:"flex-header"},{default:le(()=>[te(ge,{justify:"space-between",align:"middle"},{default:le(()=>[te(G,null,{default:le(()=>[te(W,null,{default:le(()=>[te(q,{type:"primary",size:"small",onClick:kt},{default:le(()=>[...n[26]||(n[26]=[ae(" 从 FFlogs 生成 ",-1)])]),_:1}),te(q,{type:"primary",size:"small",onClick:St},{default:le(()=>[...n[27]||(n[27]=[ae(" 从 在线文档 获取 ",-1)])]),_:1}),te(q,{type:"primary",size:"small",onClick:yt},{default:le(()=>[...n[28]||(n[28]=[ae(" 手动编写 ",-1)])]),_:1})]),_:1}),te(W,null,{default:le(()=>[te(q,{size:"small",onClick:Tt},{default:le(()=>[...n[29]||(n[29]=[ae(" 导入字符串 ",-1)])]),_:1}),te(q,{size:"small",class:"export",onClick:n[2]||(n[2]=e=>_t(ie(w)))},{default:le(()=>[...n[30]||(n[30]=[ae(" 导出全部 ",-1)])]),_:1})]),_:1})]),_:1}),te(G,null,{default:le(()=>[te(fe,{placement:"bottom-end",title:"同步未生效",width:280,trigger:"hover",disabled:ie(c)||!ie(Be)},{reference:le(()=>[de("div",{class:ve(["connection-status",{connected:ie(c),warning:!ie(c)&&ie(Be)}])},[n[31]||(n[31]=de("span",{class:"dot"},null,-1)),de("span",Ue,[!ie(c)&&ie(Be)?(Q(),ee(ue,{key:0},[ae(" 改动暂未同步 (连接断开) ")],64)):(Q(),ee(ue,{key:1},[ae(re(ie(c)?"悬浮窗已连接":"悬浮窗未连接"),1)],64))]),!ie(Ne)||ie(Be)&&!ie(c)?ce("",!0):(Q(),ee("span",Je,"（同步于 "+re(ie(Ne))+"）",1)),"syncing"===ie(Ce)?(Q(),se(Y,{key:1,class:"is-loading",style:{"margin-left":"5px"}},{default:le(()=>[te(ie(k))]),_:1})):ce("",!0)],2)]),default:le(()=>[de("div",Pe,[n[33]||(n[33]=ae(" 检测到你有未同步的改动。请确保你在ACT中启用了 ",-1)),te(me,{type:"danger",href:ie(tt),target:"_blank",style:{"vertical-align":"baseline","font-weight":"bold","text-decoration":"underline"}},{default:le(()=>[...n[32]||(n[32]=[ae(" 时间轴悬浮窗 ",-1)])]),_:1},8,["href"]),n[34]||(n[34]=ae(" ，改动才能实时推送到时间轴。 ",-1))])]),_:1},8,["disabled"]),te(we,{"storage-key":"timeline-settings-theme"}),te(q,{color:"#626aef",style:{color:"white"},size:"small",onClick:n[3]||(n[3]=e=>X.value=!0)},{default:le(()=>[...n[35]||(n[35]=[ae(" 参数设置 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),te($t,null,{default:le(()=>[te(R,{modelValue:ie(H),"onUpdate:modelValue":n[5]||(n[5]=e=>oe(H)?H.value=e:null),title:"从 FFlogs 生成时间轴",width:"80%","before-close":()=>H.value=!1,"close-on-press-escape":!1,"close-on-click-modal":!1},{default:le(()=>[te(he,{filters:ie(_),onShowFFlogsToggle:n[4]||(n[4]=()=>H.value=!1),onEditTimeline:mt},null,8,["filters"])]),_:1},8,["modelValue","before-close"]),ie(w).length>0?(Q(),se(it,{key:0},{default:le(()=>[de("div",Le,[de("div",Me,[te(Te,{modelValue:ie(st),"onUpdate:modelValue":n[6]||(n[6]=e=>oe(st)?st.value=e:null),placeholder:"搜索名称...",clearable:"",size:"small",style:{width:"180px"}},null,8,["modelValue"]),te($e,{"select-zone":ie(ot),"onUpdate:selectZone":n[7]||(n[7]=e=>oe(ot)?ot.value=e:null),placeholder:"筛选地图",size:"small",style:{width:"180px"},clearable:!0},null,8,["select-zone"]),te(ke,{modelValue:ie(rt),"onUpdate:modelValue":n[8]||(n[8]=e=>oe(rt)?rt.value=e:null),placeholder:"筛选阶段",clearable:"",size:"small",style:{width:"120px"}},{default:le(()=>[te(Ve,{label:"全部",value:""}),te(Ve,{label:"门神",value:"door"}),te(Ve,{label:"本体",value:"final"}),te(Ve,{label:"无设定",value:"undefined"})]),_:1},8,["modelValue"]),te(ke,{modelValue:ie(ct),"onUpdate:modelValue":n[9]||(n[9]=e=>oe(ct)?ct.value=e:null),placeholder:"筛选职业",clearable:"",size:"small",style:{width:"180px"}},{default:le(()=>[te(Ve,{label:"全部职业",value:""}),(Q(!0),ee(ue,null,pe(ie(d).jobList,e=>(Q(),se(Ve,{key:e,label:Bt(e),value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_e(de("div",null,[te(Ie,{type:"info"},{default:le(()=>[ae(" 筛选结果：共 "+re(ie(dt).length)+" 个时间轴 ",1)]),_:1})],512),[[Fe,ie(st)||ie(ot)||ie(ct)||ie(rt)]]),de("div",null,[te(q,{type:"primary",size:"small",disabled:0===ie(J).length,onClick:vt},{default:le(()=>[ae(" 批量导出 ("+re(ie(J).length)+") ",1)]),_:1},8,["disabled"]),te(q,{type:"danger",size:"small",disabled:0===ie(J).length,style:{"margin-left":"10px"},onClick:gt},{default:le(()=>[ae(" 批量删除 ("+re(ie(J).length)+") ",1)]),_:1},8,["disabled"]),te(q,{type:"danger",size:"small",plain:"",style:{"margin-left":"10px"},onClick:bt},{default:le(()=>[...n[36]||(n[36]=[ae(" 清空列表 ",-1)])]),_:1})])]),te(P,{data:ie(dt),"row-class-name":zt,style:{width:"100%"},stripe:"","default-sort":{prop:"condition",order:"ascending"},onSelectionChange:n[11]||(n[11]=e=>{J.value=e,L.value=e.length===ie(w).length})},{default:le(()=>[te(D,{type:"selection",width:"55",align:"center"},{header:le(()=>[te(nt,{modelValue:ie(L),"onUpdate:modelValue":n[10]||(n[10]=e=>oe(L)?L.value=e:null),onChange:ht},null,8,["modelValue"])]),_:1}),te(D,{prop:"name",label:"名称",sortable:"","show-overflow-tooltip":!0}),te(D,{label:"地图",sortable:"",prop:"condition"},{default:le(e=>[ae(re(Nt(e.row.condition.zoneID)),1)]),_:1}),te(D,{prop:"condition",label:"阶段",width:"80"},{default:le(e=>[ae(re("door"===e.row.condition.phase?"门神":"final"===e.row.condition.phase?"本体":""),1)]),_:1}),te(D,{prop:"condition",label:"职业"},{default:le(e=>[ae(re(e.row.condition.jobs.map(e=>Bt(e)).join("、").replace("冒险者","全部职业")),1)]),_:1}),te(D,{label:"操作",width:"220"},{default:le(e=>[te(q,{type:"primary",size:"small",onClick:t=>mt(e.row)},{default:le(()=>[...n[37]||(n[37]=[ae(" 编辑 ",-1)])]),_:1},8,["onClick"]),te(q,{size:"small",onClick:t=>function(e){const t=JSON.parse(JSON.stringify(e));t.name=`${t.name} - 副本`,t.createdAt=(new Date).toLocaleString(),w.value.push(t),d.sortTimelines(),j.success(`已制作「${e.name}」的副本`)}(e.row)},{default:le(()=>[...n[38]||(n[38]=[ae(" 制作副本 ",-1)])]),_:1},8,["onClick"]),te(q,{type:"danger",size:"small",onClick:t=>{return l=e.row,void g.confirm(`确定要删除「${l.name}」吗？`,"删除时间轴",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning"}).then(()=>{w.value.splice(w.value.findIndex(e=>e===l),1)}).catch(()=>{});var l}},{default:le(()=>[...n[39]||(n[39]=[ae(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):(Q(),se(it,{key:1},{default:le(()=>[te(xt,{description:"点击上方新建或导入一个时间轴吧~"})]),_:1}))]),_:1}),te(R,{modelValue:ie(M),"onUpdate:modelValue":n[22]||(n[22]=e=>oe(M)?M.value=e:null),title:"编辑时间轴",center:"","align-center":"","before-close":ft,class:"timeline-dialog",width:"65%",style:{"min-width":"550px","max-width":"1000px"},"close-on-click-modal":!1,"close-on-press-escape":!1},{default:le(()=>[de("div",Re,[te(Dt,{model:ie(lt)},{default:le(()=>[te(ge,{class:"timeline-header",gutter:10},{default:le(()=>[te(Ct,{span:16},{default:le(()=>[te(Vt,{label:"名称"},{default:le(()=>[te(Te,{modelValue:ie(lt).name,"onUpdate:modelValue":n[12]||(n[12]=e=>ie(lt).name=e),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1})]),_:1}),te(Ct,{span:8},{default:le(()=>[te(Vt,{label:"来源"},{default:le(()=>[de("div",He,[Ee.test(ie(lt).source)?(Q(),se(me,{key:0,href:`https://cn.fflogs.com/reports/${ie(lt).source.replace("#","?")}&type=damage-done`,target:"_blank",class:"source-link"},{default:le(()=>[n[40]||(n[40]=de("img",{class:"site-logo",src:"https://assets.rpglogs.cn/img/ff/favicon.png?v=4",alt:"FF Logs"},null,-1)),de("span",null,re(ie(lt).source),1)]),_:1},8,["href"])):(Q(),se(Te,{key:1,value:`${ie(lt).source}${ie(lt).createdAt?`（${ie(lt).createdAt}）`:""}`,disabled:""},null,8,["value"]))])]),_:1})]),_:1}),te(Ct,{span:24},{default:le(()=>[te(ge,{gutter:10},{default:le(()=>[te(Ct,{span:ie(K)[ie(lt).condition.zoneID]?16:24},{default:le(()=>[te(Vt,{label:"地图"},{default:le(()=>[te($e,{"select-zone":ie(lt).condition.zoneID,"onUpdate:selectZone":n[13]||(n[13]=e=>ie(lt).condition.zoneID=e),size:"default",style:{width:"100%"}},null,8,["select-zone"])]),_:1})]),_:1},8,["span"]),ie(K)[ie(lt).condition.zoneID]?(Q(),se(Ct,{key:0,span:8},{default:le(()=>[te(Vt,{label:"阶段"},{default:le(()=>[te(jt,{modelValue:ie(lt).condition.phase,"onUpdate:modelValue":n[14]||(n[14]=e=>ie(lt).condition.phase=e),size:"default",style:{display:"flex","flex-wrap":"nowrap"}},{default:le(()=>[te(Et,{value:"door"},{default:le(()=>[...n[41]||(n[41]=[ae(" 门神 ",-1)])]),_:1}),te(Et,{value:"final"},{default:le(()=>[...n[42]||(n[42]=[ae(" 本体 ",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})):ce("",!0)]),_:1})]),_:1}),te(Ct,{span:24},{default:le(()=>[te(Vt,{label:"职业"},{default:le(()=>[te(ke,{modelValue:ie(lt).condition.jobs,"onUpdate:modelValue":n[15]||(n[15]=e=>ie(lt).condition.jobs=e),multiple:"","collapse-tags":"","collapse-tags-indicator":"",style:{width:"100%"},placeholder:"选择适用职业"},{default:le(()=>[(Q(!0),ee(ue,null,pe(ie(d).jobList,e=>(Q(),se(Ve,{key:e,label:Bt(e),value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),de("div",Ze,[te(Ut,{modelValue:ie(U),"onUpdate:modelValue":n[16]||(n[16]=e=>oe(U)?U.value=e:null),min:-ie(d).configValues.preBattle,max:ie(pt),step:.1},null,8,["modelValue","min","max"]),de("div",Ke,[de("p",qe,re(ie(ut)),1),de("p",We," ("+re(ie(U))+"s) ",1)])]),te(ge,{class:"timeline-editor-body",gutter:10},{default:le(()=>[te(Ct,null,{default:le(()=>[te(Te,{modelValue:ie(lt).timeline,"onUpdate:modelValue":n[17]||(n[17]=e=>ie(lt).timeline=e),style:ne({width:`calc(100% - ${ie(d).showStyle["--timeline-width"]}px)`}),type:"textarea",autosize:{minRows:10,maxRows:20},wrap:"off",placeholder:"请键入时间轴文本",onChange:n[18]||(n[18]=e=>wt())},null,8,["modelValue","style"])]),_:1}),te(Jt,{style:{position:"absolute",right:0,top:0},config:ie(d).configValues,lines:ie(at),runtime:ie(U),"show-style":ie(d).showStyle},null,8,["config","lines","runtime","show-style"])]),_:1}),de("div",Ge,[te(G,null,{default:le(()=>[te(q,{onClick:n[19]||(n[19]=e=>_t([ie(lt)]))},{default:le(()=>[...n[43]||(n[43]=[ae(" 导出 ",-1)])]),_:1}),te(q,{onClick:n[20]||(n[20]=e=>{lt.value.timeline=lt.value.timeline.replaceAll(new RegExp("(?<=^(?:#\\s*)?)(\\d+(?::\\d+(?:\\.\\d{1,2})?|(?:\\.\\d+)?))","gm"),e=>e.includes(":")?xe.duration(`00:${e}`).as("seconds").toString():xe.utc(1e3*Number(e)).format("mm:ss.S"))})},{default:le(()=>[...n[44]||(n[44]=[ae(" 切换时间格式 ",-1)])]),_:1}),te(q,{onClick:Ot},{default:le(()=>[...n[45]||(n[45]=[ae(" 时间轴语法 ",-1)])]),_:1}),te(q,{onClick:n[21]||(n[21]=e=>{g.confirm("要删除所有的注释行，仅保留必要的时间轴数据吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{lt.value.timeline=lt.value.timeline.replace(/^#.*(?:\n|$)/gm,""),j.success("完成")}).catch(()=>{})})},{default:le(()=>[...n[46]||(n[46]=[ae(" 去除注释行 ",-1)])]),_:1}),te(q,{onClick:At},{default:le(()=>[...n[47]||(n[47]=[ae(" 展示调试信息 ",-1)])]),_:1})]),_:1})])])]),_:1},8,["modelValue"]),te(R,{modelValue:ie(Se),"onUpdate:modelValue":n[25]||(n[25]=e=>oe(Se)?Se.value=e:null),title:"导出时间轴",width:"400px","append-to-body":""},{footer:le(()=>[de("span",et,[te(q,{onClick:n[24]||(n[24]=e=>Se.value=!1)},{default:le(()=>[...n[51]||(n[51]=[ae("取消",-1)])]),_:1}),te(q,{type:"primary",onClick:Ft},{default:le(()=>[...n[52]||(n[52]=[ae(" 复制到剪贴板 ",-1)])]),_:1})])]),default:le(()=>[n[53]||(n[53]=de("div",{style:{"margin-bottom":"15px",color:"var(--el-text-color-secondary)"}}," 请选择导出格式和压缩方案： ",-1)),te(jt,{modelValue:ie(ze),"onUpdate:modelValue":n[23]||(n[23]=e=>oe(ze)?ze.value=e:null),class:"export-radio-group"},{default:le(()=>[te(Pt,{value:"compressed_full",border:""},{default:le(()=>[n[48]||(n[48]=ae(" 完整压缩版 ",-1)),de("span",Xe,"("+re(ie(Ae).fullSize)+" 字节, 带注释)",1)]),_:1}),te(Pt,{value:"compressed_zip",border:""},{default:le(()=>[n[49]||(n[49]=ae(" 优化压缩版 ",-1)),de("span",Ye,"("+re(ie(Ae).optimizedSize)+" 字节, 去注释)",1)]),_:1}),te(Pt,{value:"raw_json",border:""},{default:le(()=>[n[50]||(n[50]=ae(" 原始 JSON 版 ",-1)),de("span",Qe,"("+re(ie(Ae).rawSize)+" 字节, 未压缩)",1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})}}}),[["__scopeId","data-v-193ad5ac"]]);export{tt as default};
