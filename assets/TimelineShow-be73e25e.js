import{T as F,n as R,d as L,K as z,o as j,e as y,F as U,M as q,R as O,$ as B,t as C,v as V,Q as P,x as v,A as D}from"./vendor-2a442634.js";import{U as d}from"./util-831b56e7.js";import{a as Q,b as W}from"./xivapi-a5c0f7f0.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";var m=(e=>(e.显示范围="displayDuration",e.变色时间="discoloration",e.零后持续="hold",e.战前准备="preBattle",e.TTS提前量="ttsAdvance",e))(m||{});class x{constructor(o,s,i,a){d.iconToJobEnum(s.jobs[0])&&(s.jobs[0]=d.jobEnumToJob(d.iconToJobEnum(s.jobs[0]))),this.name=o,this.condition=s,this.timeline=i,this.codeFight=a,this.create=new Date().toLocaleString()}}const K={[m.显示范围]:"显示范围（秒）",[m.变色时间]:"提前变色（秒）",[m.零后持续]:"后续保持（秒）",[m.战前准备]:"倒计时量（秒）",[m.TTS提前量]:"TTS预备（秒）"},G={[m.显示范围]:120,[m.变色时间]:2.75,[m.零后持续]:.5,[m.战前准备]:30,[m.TTS提前量]:1},k={"--timeline-width":"时间轴宽度","--font-size":"字体大小","--normal-scale":"等待缩放","--up-coming-scale":"来临缩放","--opacity":"等待不透明度","--tras-duration":"动画时间"},X={"--timeline-width":200,"--font-size":16,"--opacity":.5,"--normal-scale":.66,"--up-coming-scale":1,"--tras-duration":1},ie=F("timeline",{state:()=>({allTimelines:[],configValues:G,configTranslate:K,settings:{api:""},filters:{},showStyle:X,showStyleTranslate:k,jobList:[...d.getBattleJobs3(),"NONE"]}),getters:{},actions:{newTimeline(e="Demo",o={zoneId:"0",jobs:["NONE"]},s=`# 注释的内容不会被解析
# "<技能名>"会被解析为图片 紧接着一个波浪线可快捷重复技能名
-20 "<中间学派>~刷盾"
0 "战斗开始" tts "冲呀"
# 当sync在window的范围内被满足时将进行时间同步
30 "一运" sync / 14:4.{7}:[^:]*:AAAA:/ window 2.5,2.5
# 当存在jump时会进跳转至jump时间
50 "变异化型:蛇" sync / 14:4.{7}:[^:]*:BBBB:/ window 2.5,2.5 jump 1000
50 "变异化型:兽" sync / 14:4.{7}:[^:]*:CCCC:/ window 2.5,2.5 jump 2000
1000 "蛇轴"
2000 "兽轴"
`,i="用户创建"){return this.allTimelines.push(new x(e,o,s,i)),this.sortTimelines(),R.success("新建时间轴成功"),this.allTimelines.findIndex(u=>u.timeline===s&&u.name===e&&JSON.stringify(u.condition)===JSON.stringify(o)&&u.codeFight===i)},getTimeline(e){return this.allTimelines.filter(o=>(o.condition.zoneId==="0"||o.condition.zoneId===e.zoneId)&&(o.condition.jobs.includes("NONE")||o.condition.jobs.includes(e.jobs[0])))},saveTimelineSettings(){localStorage.setItem("timelines",JSON.stringify({allTimelines:this.allTimelines,configValues:this.configValues,settings:this.settings,showStyle:this.showStyle,filters:this.filters}))},loadTimelineSettings(){const e=localStorage.getItem("timelines");e&&(Object.assign(this,JSON.parse(e)),this.sortTimelines());for(const o of this.allTimelines)o.condition.jobs===void 0&&(o.condition.jobs=[o.condition.job]),o.condition.jobs.sort((s,i)=>this.jobList.indexOf(s)-this.jobList.indexOf(i)),d.iconToJobEnum(o.condition.jobs[0])&&(o.condition.jobs[0]=d.jobEnumToJob(d.iconToJobEnum(o.condition.jobs[0])))},sortTimelines(){for(const e of this.allTimelines)e.condition.jobs===void 0&&(e.condition.jobs=[e.condition.job]),e.condition.jobs.sort((o,s)=>this.jobList.indexOf(o)-this.jobList.indexOf(s)),Reflect.deleteProperty(e.condition,"job");this.allTimelines.sort((e,o)=>{const s=Number(e.condition.zoneId)-Number(o.condition.zoneId);if(s!==0)return s;const i=e.name.localeCompare(o.name);if(i!==0)return i;const a=d.jobToJobEnum(e.condition.jobs[0])-d.jobToJobEnum(o.condition.jobs[0]);return a!==0?a:e.create.localeCompare(o.create)})},updateFilters(e,o){this.filters[e]=o}}});function H(e){var s,i,a;const o=e.match(/^(?<negative>-)?(?<mm>[^:：]+):(?<ss>[^:：]+)$/);return o?Number.parseFloat(((s=o.groups)==null?void 0:s.mm)??"0")*60+Number.parseFloat(((i=o.groups)==null?void 0:i.ss)??"0")*((a=o.groups)!=null&&a.negative?-1:1):Number.parseFloat(e)}function Y(e){return e.matchAll(/<(?<name>[^<>]*?)!?>(?<repeat>~)?/g)}async function re(e){var i,a,u,t,r,n,c,g,f,h,p,b;const o=[],s=[...e.matchAll(/^\s*(?<time>[-:：\d.]+)\s+(?<action>(?:--|["'“”])[^"'\n]+?(?:--|["'“”])).*$/gm)];for(let w=0;w<s.length;w++){const l=s[w],S=(i=l[0].match(new RegExp("(?<=jump ?)[-:：\\d.]+")))==null?void 0:i[0],A=(a=l[0].match(new RegExp("(?<=sync(?:\\.once)? ?\\/).+(?=\\/)")))==null?void 0:a[0],I=/sync\.once/.test(l[0]),M=(u=l[0].match(new RegExp("(?<=window ?)[-:：\\d.]+")))==null?void 0:u[0],N=(t=l[0].match(new RegExp("(?<=window ?[-:：\\d.]+,)[-:：\\d.]+")))==null?void 0:t[0],E=(n=(r=l[0].match(/ tts ?["'“”](?<tts>[^"'“”]+)["'“”]/))==null?void 0:r.groups)==null?void 0:n.tts,J=/ tts(?: |$)/.test(l[0])?(h=(f=(g=Array.from(Y(((c=l.groups)==null?void 0:c.action)??"")))==null?void 0:g[0])==null?void 0:f.groups)==null?void 0:h.name:void 0;o.push({time:H(((p=l.groups)==null?void 0:p.time)??"0"),action:((b=l.groups)==null?void 0:b.action)||"",alertAlready:!1,sync:A?new RegExp(A):void 0,syncOnce:I,syncAlready:!1,show:!A,windowBefore:Number.parseFloat(M||N||"2.5"),windowAfter:Number.parseFloat(N||M||"2.5"),jump:S?Number.parseFloat(S):void 0,tts:E||J})}return o.sort((w,l)=>w.time-l.time),o}const _=["innerHTML"],$={class:"countdown"},T="data:image/png;base64,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",ee=L({__name:"TimelineShow",props:{config:{},lines:{},runtime:{},showStyle:{}},setup(e){const o=e,s=z({});function i(t){var c,g,f,h;let r=t.replaceAll(/^["'“”]|["'“”]$/g,"");const n=Y(r);if(!n)return r;for(const p of n)if((c=p.groups)!=null&&c.name){const b=a((g=p.groups)==null?void 0:g.name);r=r.replace(p[0],`${b?`<div class="skill_icon"><img src="${b}" style="background-image: url('${T}')" loading="auto"/></div>`:""}<span>${(f=p.groups)!=null&&f.repeat?(h=p.groups)==null?void 0:h.name:""}</span>`)}return r}function a(t){return typeof s[t]=="string"?s[t]:(typeof s[t]>"u"&&(s[t]=Q(t).then(r=>{r!=null&&r.Icon&&W(r.Icon).then(n=>{u(n).then(()=>{s[t]=n}).catch(()=>{s[t]=T})})})),T)}function u(t){return new Promise((r,n)=>{const c=new Image;c.onload=()=>r(),c.onerror=()=>n(new Error("Failed to load image")),c.src=t})}return(t,r)=>t.lines.length?(j(),y("ul",{key:0,class:"loadedTimelines",style:O(t.showStyle)},[(j(!0),y(U,null,q(o.lines,(n,c)=>C((j(),y("li",{key:c,class:P({upcoming:n.time-t.runtime<=t.config.discoloration,fade:n.time-t.runtime<=0-t.config.hold,passed:n.time-t.runtime<=0})},[v("aside",{style:O({right:`${Math.max((n.time-t.runtime)/t.config.displayDuration,0)*100}%`})},null,4),v("section",null,[v("span",{innerHTML:i(n.action)},null,8,_),v("span",$,D((n.time-t.runtime).toFixed(1)),1)])],2)),[[V,n.show&&n.time-t.runtime>0-t.config.hold-t.showStyle["--tras-duration"]&&n.time-t.runtime<=t.config.displayDuration]])),128))],4)):B("",!0)}});const ae=Z(ee,[["__scopeId","data-v-b34a30f2"]]);export{ae as _,re as p,ie as u};
