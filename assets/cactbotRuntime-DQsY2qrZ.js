import{_ as e}from"./ActWrapper-9IDiLVAi.js";import{u as a,l as t,_ as r}from"./DragJob-DPv1AbvN.js";import{d as o,r as s,f as n,h as l,bd as i,j as p,w as d,o as m,a as u,c,B as y,l as f,F as v,u as b,k as j,v as h,t as g,b as x}from"./index-Dv6uazMJ.js";import{E as k}from"./el-divider-2SVRhXhQ.js";import{u as S}from"./useDev-ROusmI0_.js";import{R as _}from"./demoParty-VqsYt8ja.js";import{U as J}from"./util-BOtaAWHW.js";import{a as C,r as E,c as T}from"./overlay_plugin_api-DHbPkDtN.js";import{u as w}from"./index-B8ZiaNRg.js";import{E as P}from"./index-Dew5K-Hh.js";import{_ as D}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-card-CAWIQgvX.js";import"./useDemo-BR9rtmHI.js";import"./el-checkbox-DJTc7zVL.js";import"./index-HvWNfzaX.js";import"./use-form-common-props-BZ_bSvEJ.js";import"./index-DIQGxWKX.js";import"./_baseClone-BLiqzqxL.js";import"./index-DivljuLu.js";import"./validator-CfA5umFP.js";import"./index-BVWLY_vR.js";import"./index-Dw77pAiT.js";import"./focus-trap-F4Xhixbk.js";import"./index-u1CjhNYI.js";import"./vnode-B4pGuigP.js";import"./scroll-C88JkI87.js";const L={class:"cactbot-runtime-container"},R={class:"players",flex:"~ nowrap gap-1"},U={class:"fixed-rp"},B={class:"fixed-player"},M={class:"drag-job"},V={key:0,style:{position:"fixed",bottom:"0"}},H=D(o({__name:"cactbotRuntime",setup(o){const D=w("cactbotRuntime-showNotification",!0),H=["tank","healer","dps"],z=a(),A=s(!1),I=S(),K=new _,N=n({party:[],partySorted:{tank:[],healer:[],dps:[]}});function O(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const $={tank:["MT","ST",...O("T",22,2)],healer:[...O("H",24)],dps:[...O("D",24)]},q=s("");function F(){const e=[...$.tank.slice(0,N.partySorted.tank.length),...$.healer.slice(0,N.partySorted.healer.length),...$.dps.slice(0,N.partySorted.dps.length)],a=[...N.partySorted.tank,...N.partySorted.healer,...N.partySorted.dps].map((a,t)=>({...a,rp:e[t]}));T({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a}})}function G(){const e=N.party.slice().sort((e,a)=>z.arr.indexOf(J.baseJobEnumConverted(e.job))-z.arr.indexOf(J.baseJobEnumConverted(a.job)));N.partySorted.tank=e.filter(e=>J.isTankJob(J.jobEnumToJob(e.job))),N.partySorted.healer=e.filter(e=>J.isHealerJob(J.jobEnumToJob(e.job))),N.partySorted.dps=e.filter(e=>J.isDpsJob(J.jobEnumToJob(e.job))),F()}function Q(){G()}function W(){F()}const Y=()=>{A.value=!0},X=()=>{A.value=!1},Z=e=>{I.value&&0===e.party.length||(N.party=e.party.filter(e=>e.inParty),G())},ee=e=>{I.value||(q.value=e.charName)},ae=e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&F()};function te(){D.value&&P.confirm("即日起，本悬浮窗将只在高难副本中显示，平时隐藏。","公告",{confirmButtonText:"不再提示",cancelButtonText:"关闭",type:"warning",buttonSize:"small"}).then(()=>{D.value=!1}).catch(()=>{})}function re(){q.value=K.party.value[0].name,N.party=K.party.value.filter(e=>e.name===q.value),G()}function oe(){q.value=K.party.value[0].name,N.party=K.party.value,G()}function se(){K.shuffle({dps:4,healer:2,tank:2,crafter:3,gatherer:3,none:3}),oe()}return l(()=>{document.body.addEventListener("mouseenter",Y),document.body.addEventListener("mouseleave",X),C("ChangePrimaryPlayer",ee),C("PartyChanged",Z),C("BroadcastMessage",ae)}),i(()=>{document.body.removeEventListener("mouseenter",Y),document.body.removeEventListener("mouseleave",X),E("PartyChanged",Z),E("ChangePrimaryPlayer",ee),E("BroadcastMessage",ae)}),(a,o)=>{const s=k,n=r,l=e;return m(),p(l,null,{readme:d(()=>[...o[0]||(o[0]=[u("span",{class:"demo-text"},[u("p",null,"使悬浮窗的位置分配对应游戏内的实际位置"),u("ul",null,[u("li",null,"每次小队变化时，会按规则进行排序"),u("li",null,"你可以上下拖拽玩家名称，临时调整")])],-1)])]),default:d(()=>[u("div",L,[u("main",null,[u("div",R,[u("div",U,[(m(),c(v,null,f(H,(e,a)=>u("div",{key:`fixed-rp-${e}`,class:"player-role"},[(m(!0),c(v,null,f(b(N).partySorted[e],(a,t)=>(m(),c("div",{key:t,style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},[j(u("span",null,g($[e][t]),513),[[h,b(A)||a.name===b(q)]])]))),128)),b(N).partySorted[e].length>0&&a<2&&b(A)?(m(),p(s,{key:0})):y("",!0)])),64))]),u("div",B,[(m(),c(v,null,f(H,(e,a)=>x(b(t),{key:`fixed-player-${e}`,modelValue:b(N).partySorted[e],"onUpdate:modelValue":a=>b(N).partySorted[e]=a,animation:200,"ghost-class":"ghost","force-fallback":!0,filter:".no-draggable",onUpdate:W},{default:d(()=>[(m(!0),c(v,null,f(b(N).partySorted[e],e=>j((m(),c("div",{key:e.id,class:"player-line"},[u("span",null,g(e.name),1)])),[[h,b(A)]])),128)),b(N).partySorted[e].length>0&&a<2&&b(A)?(m(),p(s,{key:0,class:"no-draggable"})):y("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])),64))])]),u("div",M,[b(A)?(m(),p(n,{key:0,party:b(N).party,onUpdate:Q},null,8,["party"])):y("",!0)])]),b(I)?(m(),c("div",V,[u("button",{onClick:re}," 测试单人 "),u("button",{onClick:oe}," 测试组队 "),u("button",{onClick:se}," 测试随机组队 "),u("button",{onClick:te}," 测试弹窗 ")])):y("",!0)])]),_:1})}}}),[["__scopeId","data-v-fac0a784"]]);export{H as default};
