import{M as e,V as t,g as a}from"./mapCoordinates-D6Cs2O2e.js";import{Z as n}from"./zoneInfo-Kvs06RCG.js";import{g as r}from"./contentFinderCondition-BIZz1N_J.js";import{d as o,h as s,r as i,i as l,B as u,c,o as p,G as f,q as m,F as v,m as y,s as d,t as g,k as h,u as k}from"./index-BGR0j1iG.js";import{_ as w}from"./_plugin-vue_export-helper-BCo6x5W8.js";const b=["src"],x=w(o({__name:"MapCanvas",props:{mapId:{type:Number,required:!0},markers:{type:Array,required:!0},size:{type:Number,default:180},forceTerritoryType:{type:Number,default:void 0}},setup(o){const h=o,k=s(()=>{if(0===h.mapId&&!h.forceTerritoryType)return;const t=h.forceTerritoryType??r(h.mapId),a=e[t.toString()];return a?`https://v2.xivapi.com/api/asset/map/${a.id}`:void 0});function w(e){const o=h.forceTerritoryType??r(h.mapId),s=n[o]??{sizeFactor:100,offsetX:0,offsetY:0},i=new t(e.x,e.z),l=new t(s.offsetX,s.offsetY);return a(i,l,s.sizeFactor)}const x=i(0),I=i(0),z=i(.5),M=i(16),D=i(!1);let T=0,A=0;function U(e){e.preventDefault(),D.value=!0,T=e.clientX-x.value,A=e.clientY-I.value}function F(e){e.preventDefault(),D.value&&(x.value=e.clientX-T,I.value=e.clientY-A)}function _(e){e.preventDefault(),D.value=!1}function $(e){e.preventDefault();const t=e.deltaY>0?.9:1.1;let a=z.value*t;a=Math.min(4,Math.max(.2,a));const n=e.currentTarget.getBoundingClientRect(),r=e.clientX-n.left,o=e.clientY-n.top;x.value=r-(r-x.value)*a/z.value,I.value=o-(o-I.value)*a/z.value,z.value=a}function C(e){const t=w(e),a=Math.max(1/z.value*M.value,M.value);return{"--left":`${t.x}px`,"--top":`${t.y}px`,"--font-size":`${a}px`}}const B=s(()=>({width:`${h.size}px`,height:`${h.size}px`,overflow:"hidden",position:"relative",cursor:D.value?"grabbing":"grab",userSelect:"none"})),V=s(()=>({transform:`translate(${x.value}px, ${I.value}px) scale(${z.value})`,transformOrigin:"top left",width:"2048px",height:"2048px",position:"absolute",left:0,top:0})),Y=i(null),j=i(!1);return l(()=>{const e=new IntersectionObserver(t=>{t[0]?.isIntersecting&&(j.value=!0,e.disconnect())},{rootMargin:"200px"});Y.value&&e.observe(Y.value)}),u(()=>h.markers,()=>{const e=h.markers.filter(e=>e.active);if(0===e.length)return z.value=.5,x.value=h.size/2-1024*z.value,void(I.value=h.size/2-1024*z.value);const t=e.reduce((e,t)=>{const a=w(t);return e.x+=a.x,e.y+=a.y,e},{x:0,y:0});t.x/=e.length,t.y/=e.length;let a=1/0,n=-1/0,r=1/0,o=-1/0;for(const p of e){const e=w(p);a=Math.min(a,e.x),n=Math.max(n,e.x),r=Math.min(r,e.y),o=Math.max(o,e.y)}const s=n-a,i=o-r,l=h.size/s,u=h.size/i;let c=Math.min(l,u);c=Math.min(1,Math.max(.5,.5*c)),z.value=c,x.value=h.size/2-t.x*z.value,I.value=h.size/2-t.y*z.value},{immediate:!0,deep:!0}),(e,t)=>(p(),c("div",{ref_key:"containerRef",ref:Y,class:"crop-custom",style:m(B.value),onMousedown:U,onMousemove:F,onMouseup:_,onMouseleave:_,onWheel:$},[j.value?(p(),c("div",{key:0,class:"crop-1024",style:m(V.value)},[k.value?(p(),c("img",{key:0,src:k.value,alt:""},null,8,b)):f("",!0),(p(!0),c(v,null,y(o.markers,e=>(p(),c("span",{key:e.key,class:d(`markIcon markIcon${e.key}`),style:m([C(e)])},g(e.active?e.label:""),7))),128))],4)):f("",!0)],36))}}),[["__scopeId","data-v-c4e50d24"]]),I=(e,t=49)=>e.map(e=>e^t),z=[{key:"A",label:"A",bit:1,id:0},{key:"B",label:"B",bit:2,id:1},{key:"C",label:"C",bit:4,id:2},{key:"D",label:"D",bit:8,id:3},{key:"One",label:"1",bit:16,id:4},{key:"Two",label:"2",bit:32,id:5},{key:"Three",label:"3",bit:64,id:6},{key:"Four",label:"4",bit:128,id:7}];function M(e,t,a){const n={enableFlag:a[t+96]??0,unknown:a[t+97]??0,regionID:e.getUint16(t+98,!0),timestamp:e.getInt32(t+100,!0)};return z.forEach((a,r)=>{n[a.key]={x:e.getInt32(t+12*r,!0),y:e.getInt32(t+12*r+4,!0),z:e.getInt32(t+12*r+8,!0)}}),n}async function D(e){const t=new Uint8Array(e),a=new DataView(t.buffer);if(3120===t.length){const e=[];for(let n=0;n<30;n++)e.push(M(a,104*n,t));return{fileFormatVersion:new Uint8Array(8),fileUnknown:new Uint8Array(4),payloadUnknown:new Uint8Array(8),userID:0n,wayMarks:e,markerHeader:new Uint8Array(16),markerTail:new Uint8Array(0),otherSections:new Uint8Array(0),belongsToWaymarkDat:!0}}if(t.length<16)throw new Error("File too small");const n=a.getInt32(8,!0),r=I(t.slice(16,16+n)),o=new DataView(r.buffer);let s=16;const i=[];let l=new Uint8Array(0),u=new Uint8Array(0);const c=[];for(;s<r.length-2;){const e=o.getInt16(s,!0),t=o.getInt32(s+8,!0),a=r.slice(s+16,s+16+t),n=r.slice(s,s+16+t+4);if(17===e){l=a.slice(0,16);const e=new DataView(a.buffer,a.byteOffset);for(let t=16;t+104<=a.length;t+=104)i.push(M(e,t,a));u=a.slice(104*i.length+16)}else c.push(n);s+=16+t+4}if(0===i.length)throw new Error("No waymark data found in UISAVE.DAT");const p=new Uint8Array(c.reduce((e,t)=>e+t.length,0));let f=0;return c.forEach(e=>{p.set(e,f),f+=e.length}),{fileFormatVersion:t.slice(0,8),fileUnknown:t.slice(12,16),payloadUnknown:r.slice(0,8),userID:o.getBigInt64(8,!0),wayMarks:i,markerHeader:l,markerTail:u,otherSections:p}}const T=o({__name:"WaymarkDisplay",props:{waymark:{},size:{}},setup(e){const t=e,a=t.size??180,n=["A","B","C","D","1","2","3","4"],r=[1,2,4,8,16,32,64,128];const o=s(()=>["A","B","C","D","One","Two","Three","Four"].map((e,a)=>{const o=t.waymark[e];return{key:e,label:n[a]??"",x:o.x/1e3,z:o.z/1e3,active:(s=a,0!==((t.waymark?.enableFlag??0)&(r[s]??0)))};var s}));return(t,n)=>(p(),h(x,{"map-id":e.waymark.regionID,markers:o.value,size:k(a)},null,8,["map-id","markers","size"]))}});export{x as M,T as _,z as a,D as p,I as x};
