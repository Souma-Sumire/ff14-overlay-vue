import{_ as e}from"./ActWrapper-3efebdce.js";import{u as a,_ as t}from"./DragJob-92e70759.js";import"./index-e58fcfa0.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                   */import{u as n,e as r,a as o}from"./index-78df6055.js";import{u as l}from"./useDev-c4e9ec84.js";import{U as s}from"./util-3591e9ca.js";import{a as u,c as i}from"./overlay_plugin_api-974cdd44.js";/* empty css                */import{L as p,q as m,n as c}from"./element-plus-3b00acc6.js";import{t as d,r as y,e as f,D as v,E as b,x as j,A as h,M as g,v as k,H as P,u as _,h as x,K as w,L as C,aa as J,G as T}from"./vue-vendor-37eb8ba2.js";import{_ as D}from"./_plugin-vue_export-helper-6a8c15be.js";/* empty css                */import"./useDemo-b712055f.js";/* empty css                    */const V={class:"cactbot-runtime"},O={key:0,class:"you"},E={key:1,class:"players"},R={class:"job-name"},U={key:0,class:"player-name"},L={key:0,style:{position:"fixed",bottom:"0"}},S=D(d({__name:"cactbotRuntime",setup(d){const D=a(),S=y(!1);function A(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const G=y(!1),H=[{id:"10000001",name:"虚构暗骑",job:32,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构龙骑",job:22,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0},{id:"10000007",name:"虚构画家",job:42,inParty:!0}],K=n("cactbotRuntime-data",{party:[]}),M=n("cactbotRuntime-showTips",y(!0)),N=n("cactbotRuntime-roleSelectLength",{tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0}),q={tank:["MT","ST",...A("T",6,2)],healer:[...A("H",8)],dps:[...A("D",8)],crafter:[...A("C",8)],gatherer:[...A("G",8)],none:[...A("N",8)]};function z(e){const a=W(e);return q[a].filter((e,t)=>t<N.value[a])}const B=l(),I=y(B.value?H[2].name:"");function W(e){return[1,3,19,21,32,37].includes(e)?"tank":[6,24,28,33,40].includes(e)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39,41,42].includes(e)?"dps":s.isCraftingJob(s.jobEnumToJob(e))?"crafter":s.isGatheringJob(s.jobEnumToJob(e))?"gatherer":"none"}function F(e){return q[W(e.job)].find(e=>!K.value.party.find(a=>a.rp===e))??"unknown"}function Z(){const e=[...q.tank,...q.healer,...q.dps,...q.crafter,...q.gatherer,...q.none];K.value.party.sort((a,t)=>e.indexOf(a.rp??"unknown")-e.indexOf(t.rp??"unknown")),i({call:"broadcast",source:"soumaRuntimeJS",msg:{party:K.value.party}})}function Q(){!function(){K.value.party.sort((e,a)=>D.arr.indexOf(e.job)-D.arr.indexOf(a.job));for(const e of K.value.party)e.rp=void 0;for(const e of K.value.party)e.rp=F(e)}(),function(){for(const e in N.value)Object.prototype.hasOwnProperty.call(N.value,e)&&(N.value[e]=K.value.party.reduce((a,t)=>W(t.job)===e?a+1:a,0))}(),Z()}function X(){const e={party:H};M.value&&(G.value=!0),K.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),Q()}return f(()=>{const e=r({storageKey:"cactbot-runtime-theme"}),a=o(e);!1===e.value&&a(),document.body.addEventListener("mouseenter",()=>S.value=!0),document.body.addEventListener("mouseleave",()=>S.value=!1),Z(),u("PartyChanged",e=>{M.value&&(G.value=!0),B.value&&0===e.party.length||(K.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),Q())}),u("ChangePrimaryPlayer",e=>{B.value||(I.value=e.charName)}),u("BroadcastMessage",e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&Z()})}),(a,n)=>{const r=p,o=m,l=c,u=t,i=e;return j(),v(i,null,{default:b(()=>[h("div",V,[g(r,{modelValue:_(G),"onUpdate:modelValue":n[0]||(n[0]=e=>x(G)?G.value=e:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:n[1]||(n[1]=e=>{G.value=!1,M.value=!1})},{header:b(()=>n[3]||(n[3]=[h("span",null,"用法",-1)])),default:b(()=>n[4]||(n[4]=[h("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1),h("ul",null,[h("li",null,"临时：下拉选择框修改。"),h("li",null,"长期：用鼠标拖动职能顺序。")],-1)])),_:1},8,["modelValue"]),h("main",null,[_(S)?(j(),k("div",E,[(j(!0),k(C,null,J(_(K).party,(e,a)=>{return j(),k("section",{key:e.id,class:T(["player",{"is-you":e.name===_(I)}])},[g(l,{modelValue:e.rp,"onUpdate:modelValue":a=>e.rp=a,size:"small",class:"select","fit-input-width":"",placement:"right",offset:8,onChange:e=>function(e){const a=K.value.party.find(a=>a.rp===K.value.party[e].rp&&a.id!==K.value.party[e].id);a&&(a.rp=F(a)),Z()}(a)},{default:b(()=>[(j(!0),k(C,null,J(z(e.job),(e,a)=>(j(),v(o,{key:a,value:e,label:e},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),h("span",R,w((t=e.job,s.jobToFullName(s.jobEnumToJob(t)).simple1)),1),_(S)?(j(),k("span",U,w(e.name),1)):P("",!0)],2);var t}),128)),_(S)?(j(),v(u,{key:0,class:"drag-job",party:_(K).party,"p-1":"",onUpdate:Q},null,8,["party"])):P("",!0)])):(j(),k("div",O,w(_(K).party.find(e=>e.name===_(I))?.rp??""),1))]),_(B)?(j(),k("div",L,[h("button",{onClick:n[2]||(n[2]=e=>{_(K).party=_(K).party.filter(e=>e.name===_(I)),Q()})}," 测试单人 "),h("button",{onClick:X}," 测试组队 ")])):P("",!0)])]),_:1})}}}),[["__scopeId","data-v-eb522f4e"]]);export{S as default};
