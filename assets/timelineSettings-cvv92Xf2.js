import{d as e,r as t,f as l,i,c as n,o as a,b as s,k as o,G as r,a as c,w as d,e as u,q as p,u as m,N as f,Q as y,W as g,t as w,F as b,m as h,X as v,h as x,C as _,Y as F,B as j,Z as T,l as $,v as S,E as O,$ as V,z as k}from"./index-CzRzQSp1.js";/* empty css                  *//* empty css                  *//* empty css                */import{u as I,_ as E,p as C}from"./TimelineShow-BgMz3xQL.js";/* empty css                  *//* empty css                 */import{E as A}from"./el-input-number-CShKAg2p.js";/* empty css                   */import{E as B}from"./el-popper-DctaLE59.js";/* empty css                *//* empty css               *//* empty css                *//* empty css                 */import{E as N}from"./el-card-DKHeYK7M.js";import{E as z}from"./el-checkbox-FxLnaTxK.js";import"./el-tag-Uzhf0KsR.js";import{a as U,b as D}from"./el-select-BxPyZUdR.js";import{_ as P}from"./zoneSelecter-4H9UdMt7.js";/* empty css                  *//* empty css                        *//* empty css                  */import{g as J}from"./actionChinese-DM96CSZ4.js";import{U as L}from"./util-BSI8OlRX.js";import{h as M,g as R}from"./xivapi-a6oZXlzI.js";import{E as K,a as H}from"./index-BdvBvIkC.js";import{E as Z,a as W,b as q}from"./index-Btf0T9ms.js";import{E as G,a as Q}from"./index-2BiKi0Rj.js";import{E as X}from"./validator-Bcy2GT2H.js";import{a as Y,E as ee}from"./index-QWWWajsC.js";import{E as te}from"./index-CiEIYTuB.js";import{E as le}from"./index-CRT613XH.js";import{_ as ie}from"./_plugin-vue_export-helper-BCo6x5W8.js";/* empty css               */import{_ as ne}from"./ThemeToggle-BCyJxJr7.js";/* empty css                 *//* empty css                        *//* empty css                   */import{E as ae}from"./index-DTafjwm7.js";import{E as se}from"./index-F3M4mU_p.js";import{E as oe}from"./index-CKDchHJK.js";import{E as re}from"./index-tyy9MGqn.js";import{l as ce}from"./lz-string-Bhlr6y1U.js";import{h as de}from"./moment-CBOc1lqT.js";import{u as ue}from"./useWebSocket-DKIGX48T.js";import{c as pe}from"./clipboard-BKuKuDeo.js";import{a as me,c as fe}from"./overlay_plugin_api-DHbPkDtN.js";import{Z as ye}from"./zoneInfo-Kvs06RCG.js";import{E as ge,a as we,b as be}from"./index-1hy0cUkN.js";import{E as he}from"./index-BHxXsxnR.js";import{E as ve}from"./index-T26kLdTA.js";import{E as xe}from"./index-C2ZMEfVv.js";import{E as _e}from"./index-RKg8GRKl.js";import{E as Fe}from"./index-BVVnxg27.js";import"./status-DO8_dJa3.js";import"./regexes-Blkj7yOl.js";import"./chineseToIcon-xFdmTerz.js";import"./index-DoVeqLwf.js";import"./use-form-common-props-C6fx3Lxj.js";import"./index-DmfQTB6Q.js";import"./focus-trap-dMRNTQNS.js";import"./index-wRyTdPi8.js";import"./_baseClone-BH5zud47.js";import"./index-q9mWOLnC.js";import"./vnode-4EGJhDHt.js";import"./el-radio-Bdnad8tt.js";import"./useLang-BeL2PBGo.js";import"./content_type-uhloenTS.js";import"./cloneDeep-DTFc75ee.js";import"./index-BdGsBesF.js";import"./index-C7iWj7cA.js";import"./_commonjsHelpers-CLPN-Npl.js";import"./zone_info-C8YMEhdS.js";const je=new Map;je.set(26155,{type:"cast",window:[999,999],battleOnce:!0}),je.set(28027,{type:"cast",window:[999,999],battleOnce:!0}),je.set(26340,{type:"cast",window:[999,999],battleOnce:!0}),je.set(25533,{type:"begincast",window:[60,60]}),je.set(26376,{type:"cast",window:[999,999],battleOnce:!0}),je.set(26814,{type:"begincast",window:[999,999],battleOnce:!0}),je.set(25313,{type:"begincast",window:[200,200]}),je.set(27526,{type:"begincast",window:[999,999],battleOnce:!0}),je.set(26215,{type:"cast",window:[500,30],battleOnce:!0}),je.set(29050,{type:"begincast",window:[200,30],battleOnce:!0}),je.set(29156,{type:"cast",window:[20,20]}),je.set(27973,{type:"cast",window:[20,20]}),je.set(27937,{type:"begincast",window:[20,20]}),je.set(28059,{type:"begincast",window:[20,20]}),je.set(28060,{type:"begincast",window:[20,20]}),je.set(28061,{type:"begincast",window:[20,20]}),je.set(27956,{type:"begincast",window:[20,20]}),je.set(27957,{type:"begincast",window:[20,20]}),je.set(27952,{type:"begincast",window:[30,30]}),je.set(27969,{type:"begincast",window:[20,20]}),je.set(27971,{type:"begincast",window:[20,20]}),je.set(27939,{type:"begincast",window:[20,20]}),je.set(27966,{type:"begincast",window:[20,20]}),je.set(25316,{type:"begincast",window:[999,999],battleOnce:!0}),je.set(25544,{type:"begincast",window:[10,10]}),je.set(26379,{type:"begincast",window:[10,10]}),je.set(31552,{type:"begincast",window:[30,30]}),je.set(31573,{type:"begincast",window:[30,30]}),je.set(31573,{type:"begincast",window:[30,30]}),je.set(31617,{type:"begincast",window:[8,8]}),je.set(31624,{type:"begincast",window:[30,30]}),je.set(31649,{type:"begincast",window:[30,30]}),je.set(18864,{type:"cast",window:[10,2.5],syncOnce:!0}),je.set(18480,{type:"cast",window:[200,60],syncOnce:!0,battleOnce:!0}),je.set(18516,{type:"cast",window:[250,65],syncOnce:!0,battleOnce:!0}),je.set(18522,{type:"begincast",window:[500,500],syncOnce:!0,battleOnce:!0}),je.set(18552,{type:"begincast",window:[67,67],syncOnce:!0}),je.set(18553,{type:"cast",window:[67,67],syncOnce:!0}),je.set(19083,{type:"cast",window:[900,200],syncOnce:!0,battleOnce:!0}),je.set(40191,{type:"begincast",window:[200,20],syncOnce:!0}),je.set(40265,{type:"begincast",window:[500,20],syncOnce:!0,battleOnce:!0}),je.set(40246,{type:"begincast",window:[999,30],syncOnce:!0,battleOnce:!0}),je.set(40306,{type:"begincast",window:[30,30],syncOnce:!0}),je.set(11103,{type:"begincast",window:[310,30],syncOnce:!0,battleOnce:!0}),je.set(11517,{type:"begincast",window:[600,30],syncOnce:!0,battleOnce:!0}),je.set(11122,{type:"begincast",window:[100,30],syncOnce:!0,battleOnce:!0}),je.set(11143,{type:"begincast",window:[60,60],syncOnce:!0}),je.set(11126,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),je.set(11596,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),je.set(11597,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),je.set(42785,{type:"begincast",window:[9.6,2],syncOnce:!0}),je.set(42838,{type:"cast",window:[77.2,30],syncOnce:!0,battleOnce:!0}),je.set(42863,{type:"cast",window:[30,30],syncOnce:!1}),je.set(42787,{type:"cast",window:[30,30],syncOnce:!1}),je.set(42864,{type:"cast",window:[30,30],syncOnce:!1}),je.set(41946,{type:"begincast",window:[10,10],syncOnce:!1}),je.set(41936,{type:"begincast",window:[20,30],syncOnce:!0}),je.set(41939,{type:"begincast",window:[20,20],syncOnce:!0}),je.set(42825,{type:"begincast",window:[60,60],syncOnce:!0,battleOnce:!0}),je.set(41969,{type:"begincast",window:[20,20],syncOnce:!0}),je.set(41871,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0}),je.set(43053,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0}),je.set(45645,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0});class Te{storageKey;maxSize;cleanupRatio;constructor(e){this.storageKey=e?.key??"cache:all",this.maxSize=e?.maxSize??2097152,this.cleanupRatio=e?.cleanupRatio??.25}loadAll(){try{const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):{}}catch{return{}}}saveAll(e){try{localStorage.setItem(this.storageKey,JSON.stringify(e))}catch{this.cleanupOldEntries(e);try{localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(t){}}}getTotalSize(e){return new Blob([JSON.stringify(e)]).size}cleanupOldEntries(e){const t=Object.entries(e),l=t.map(([e,t])=>({key:e,expire:t?.expire??0}));l.sort((e,t)=>e.expire-t.expire);const i=Math.ceil(t.length*this.cleanupRatio);for(let n=0;n<i;n++)delete e[l[n].key]}set(e,t,l=2592e5){const i=this.loadAll();i[e]={data:t,expire:Date.now()+l},this.getTotalSize(i)>this.maxSize&&this.cleanupOldEntries(i),this.saveAll(i)}get(e){const t=this.loadAll(),l=t[e];return l?l.expire<Date.now()?(delete t[e],this.saveAll(t),null):l.data:null}clearExpired(){const e=this.loadAll(),t=Date.now();let l=!1;for(const i in e)(!e[i].expire||e[i].expire<t)&&(delete e[i],l=!0);l&&this.saveAll(e)}clearAll(){localStorage.removeItem(this.storageKey)}}const $e={class:"query-results"},Se={flex:"~","m-t-10":""},Oe={class:"ability-filter-container"},Ve={key:0,class:"loading-abilities"},ke=["src","alt","onerror"],Ie=ie(e({__name:"FflogsImport",props:{filters:{}},emits:["showFFlogsToggle","editTimeline"],setup(e,{emit:v}){const x=e,_=v,F=new RegExp("(?<=^|\\/)(?<code>(?:a:)?\\w{16,})[#?]fight=(?<fight>\\d+|last)"),j=t("查询"),T=t(""),$=t(!1),S=t(!1),O=t(0),V=t(!1),k=l({});ae();const E=I(),C=new Te({key:"souma-fflogs-cache",maxSize:2097152,cleanupRatio:.25});function A(e){const t=C.get(e);if(!t)return null;try{return JSON.parse(t)}catch{return null}}function z(e,t,l=2592e5){const i={data:t,expire:Date.now()+l};C.set(e,JSON.stringify(i),l)}function P(e){return e&&e.expire>Date.now()}async function H(e){S.value=!0,O.value=2,k.player=e,k.type="friendies",k.abilityFilterEvents.length=0,k.abilityFilterCandidate.length=0,k.enemiesAbilityFilterSelected.length=0;try{await async function(){V.value=!1;const e=[];async function t(l){try{const i=`events:friendly:${k.code}:${l}:${k.player?.id}`,n=A(i);let a;n&&P(n)?a=n.data:(a=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${k.code}?start=${l}&end=${k.end}&hostility=0&sourceid=${k.player?.id}&api_key=${E.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),z(i,a)),e.push(...a.events),a.nextPageTimestamp&&a.nextPageTimestamp>0&&a.nextPageTimestamp<k.end&&await t(a.nextPageTimestamp)}catch(i){le.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${i}`,"获取友方技能数据失败",{confirmButtonText:"确定",type:"error"})}}async function l(t,i){if(i>=0)try{const n=`events:enemy:${k.code}:${t}:${k.bossIDs[i]}`,a=A(n);let s;a&&P(a)?s=a.data:(s=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${k.code}?start=${t}&end=${k.end}&hostility=1&sourceid=${k.bossIDs[i]}&api_key=${E.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),z(n,s)),e.push(...s.events),s.nextPageTimestamp&&s.nextPageTimestamp>0&&s.nextPageTimestamp<k.end&&await l(s.nextPageTimestamp,i),i<k.bossIDs.length-1&&await l(t,i+1)}catch(n){le.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${n}`,"获取敌方技能数据失败",{confirmButtonText:"确定",type:"error"})}}k.abilityFilterEvents.length=0,k.enemiesAbilityFilterSelected.length=0,await Promise.all([t(k.start),l(k.start,0)]);for(const i of e)"begincast"===i.type&&i.sourceIsFriendly||k.abilityFilterEvents.push({time:Number(((i.timestamp-k.start)/1e3).toFixed(1)),type:i.type,actionName:J(i.ability.guid)??i.ability.name,actionId:i.ability.guid,sourceIsFriendly:i.sourceIsFriendly,url:i?.ability?.abilityIcon.replace("-","/").replace(".png","")??"000000/000405",window:void 0,sourceID:i.sourceID});V.value=!0}(),k.abilityFilterCandidate=k.abilityFilterEvents.reduce((e,t)=>(t.sourceIsFriendly&&!e.find(e=>e.actionId===t.actionId)&&e.push(t),e),[]).sort((e,t)=>e.time-t.time),k.player?.icon&&x.filters[k.player.icon]&&(k.abilityFilterSelected=x.filters[k.player.icon]),k.abilityFilterSelected=k.abilityFilterSelected.filter(e=>k.abilityFilterCandidate.find(t=>t.actionId===e)),S.value=!1}catch(t){le.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${t}`,"获取玩家技能数据失败",{confirmButtonText:"确定",type:"error"}),S.value=!1}}function q(){S.value=!0,O.value=3,k.player?.icon&&E.updateFilters(k.player?.icon,JSON.parse(JSON.stringify(k.abilityFilterSelected))),k.abilityFilterEvents=k.abilityFilterEvents.filter(e=>e.sourceIsFriendly&&k.abilityFilterSelected.includes(e.actionId)||!e.sourceIsFriendly).sort((e,t)=>e.time-t.time),k.abilityFilterEvents=function(e){for(const t of e){const e=je.get(t.actionId);e?.type===t.type&&(t.window=e?.window,t.syncOnce=Boolean(e?.syncOnce),t.battleOnce=Boolean(e?.battleOnce))}return e}(k.abilityFilterEvents),k.abilityFilterEventsAfterFilterRawTimeline=k.abilityFilterEvents.map(e=>{const{time:t,actionName:l,actionId:i,type:n,sourceID:a,window:s,sourceIsFriendly:o,syncOnce:r,battleOnce:c}=e;if(o)return`${t} "<${l}>~"${$.value?` tts "${l}"`:""}`;if(/^(?:攻击|attack|攻撃)$/i.test(l)&&!s||"cast"===n&&!s||k.battleSyncedIDs.includes(i))return`# ${t} "${l}"`;const d=k.enemies.find(e=>e.id===a);if(("NPC"===d?.type||/unknown/.test(l))&&!s)return null;const u=`${t} "${l}" ${"begincast"===n?"StartsUsing":"Ability"} { id: "${i.toString(16).toUpperCase()}" }`;return c&&s&&k.battleSyncedIDs.push(i),s?`${u} window ${s.join(",")} ${r?"once":""}`:`# ${u}`}).filter(e=>null!==e).join("\n");const e=E.newTimeline(`导入${k.player?.name}`,{zoneId:k.zoneID.toString(),jobs:[k.player?.icon??"NONE"]},k.abilityFilterEventsAfterFilterRawTimeline,`${k.code}#fight=${k.fightIndex+1}`);ae(),_("showFFlogsToggle"),_("editTimeline",E.allTimelines[e]),setTimeout(()=>{O.value=0},500),S.value=!1}async function ie(){S.value=!0,O.value=2,k.type="enemies",k.abilityFilterEvents.length=0,k.abilityFilterCandidate.length=0;try{await async function(){V.value=!1;const e=[];async function t(l,i){if(i>=0)try{const n=`events:enemy:${k.code}:${l}:${k.bossIDs[i]}`,a=A(n);let s;a&&P(a)?s=a.data:(s=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${k.code}?start=${l}&end=${k.end}&hostility=1&sourceid=${k.bossIDs[i]}&api_key=${E.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),z(n,s)),e.push(...s.events),s.nextPageTimestamp&&s.nextPageTimestamp>0&&s.nextPageTimestamp<k.end&&await t(s.nextPageTimestamp,i),i<k.bossIDs.length-1&&await t(l,i+1)}catch(n){le.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${n}`,"获取敌方技能数据失败",{confirmButtonText:"确定",type:"error"})}}k.abilityFilterEvents.length=0,k.enemiesAbilityFilterSelected.length=0,await Promise.all([t(k.start,0)]);for(const i of e)k.abilityFilterEvents.push({time:Number(((i.timestamp-k.start)/1e3).toFixed(1)),type:i.type,actionName:J(i.ability.guid)??i.ability.name,actionId:i.ability.guid,sourceIsFriendly:!1,url:"",window:void 0,sourceID:i.sourceID});V.value=!0,k.enemiesAbilityFilterSelected.length=0;const l=Array.from(new Set(k.abilityFilterEvents.map(e=>e.actionName)));k.enemiesAbilityFilterSelected.push(...l)}(),k.abilityFilterCandidate=k.abilityFilterEvents.reduce((e,t)=>(!1!==t.sourceIsFriendly||e.find(e=>e.actionName===t.actionName)||e.push(t),e),[]).sort((e,t)=>e.time-t.time),k.enemiesAbilityFilterSelected=k.enemiesAbilityFilterSelected.filter(e=>k.abilityFilterCandidate.find(t=>t.actionName===e)),S.value=!1}catch(e){le.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${e}`,"获取敌人技能数据失败",{confirmButtonText:"确定",type:"error"}),S.value=!1}}function ne(){O.value=3,k.abilityFilterEvents=k.abilityFilterEvents.filter(e=>k.enemiesAbilityFilterSelected.includes(e.actionName)).sort((e,t)=>e.time-t.time),k.abilityFilterEventsAfterFilterRawTimeline=k.abilityFilterEvents.map(e=>{const{time:t,actionName:l,actionId:i,type:n}=e,a="begincast"===n?"StartsUsing":"Ability",s=i.toString(16).toUpperCase(),o=k.enemies.find(t=>t.id===e.sourceID),r="Boss"===o?.type?"Boss":"分身";return`${t} "${l}" ${a} { id: "${s}" } #${o?.name??"未知"}（${r}）`}).join("\n");const e=E.newTimeline("BOSS时间轴（使用前请删除非必要的正则）",{zoneId:k.zoneID.toString(),jobs:[]},k.abilityFilterEventsAfterFilterRawTimeline,`${k.code}#fight=${k.fightIndex+1}`);ae(),_("showFFlogsToggle"),_("editTimeline",E.allTimelines[e]),setTimeout(()=>{O.value=0},500)}function ae(){k.type="friendies",k.code="",k.fightIndex=0,k.start=0,k.end=0,k.friendlies=[],k.abilityFilterEvents=[],k.abilityFilterCandidate=[],k.abilityFilterSelected=[],k.enemiesAbilityFilterSelected=[],k.abilityFilterEventsAfterFilterRawTimeline="",k.player=void 0,k.zoneID=0,k.bossIDs=[],k.enemies=[],k.battleSyncedIDs=[]}function se(){window.open("https://cn.fflogs.com/profile","_blank")}return i(()=>{C.clearExpired()}),(e,t)=>{const l=K,i=Z,v=W,x=X,_=G,I=B,C=y,J=Q,oe=N,re=Y,ce=ee,de=U,ue=D,pe=te;return a(),n(b,null,[s(l,{style:p(m(O)>0?{}:{visibility:"hidden",pointerEvent:"none"}),type:"primary",text:"","position-absolute":"","z-999":"",class:"guide",onClick:t[0]||(t[0]=e=>O.value--)},{default:d(()=>[...t[8]||(t[8]=[u(" 上一步 ",-1)])]),_:1},8,["style"]),s(v,{active:m(O),class:"steps-guide","align-center":""},{default:d(()=>[s(i,{title:"导入战斗"}),s(i,{title:"选择目标"}),s(i,{title:"过滤技能"})]),_:1},8,["active"]),0===m(O)?(a(),o(oe,{key:0,class:"input-section"},{default:d(()=>[s(J,{"label-width":"150px",class:"fflogs-form"},{default:d(()=>[s(_,{label:"FF Logs 战斗链接"},{default:d(()=>[s(x,{modelValue:m(T),"onUpdate:modelValue":t[1]||(t[1]=e=>f(T)?T.value=e:null),placeholder:"https://www.fflogs.com/reports/AAAaAaAAaa1aA1aA?fight=1",autocomplete:"on"},null,8,["modelValue"])]),_:1}),s(_,{label:"FF logs V1 Key"},{default:d(()=>[s(x,{modelValue:m(E).settings.api,"onUpdate:modelValue":t[2]||(t[2]=e=>m(E).settings.api=e),placeholder:"在 FF Logs 个人设置页面获取 V1 API Key",type:"password","show-password":""},{append:d(()=>[s(I,{content:"点击前往 FF Logs 个人设置页面，在最下方填写 V1客户名称 并点击确认后，再获取你的 V1 客户端密钥",placement:"top",effect:"light"},{default:d(()=>[s(l,{type:"primary",link:"",onClick:se},{default:d(()=>[...t[9]||(t[9]=[u(" 如何获取 ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(_,null,{default:d(()=>[s(l,{disabled:"正在查询..."===m(j),type:"primary",onClick:t[3]||(t[3]=e=>async function(e){S.value=!0,ae(),j.value="正在查询...";const t=e.match(F);if(!E.settings.api)return le.alert("请在FF Logs个人设置页面获取V1 API Key","FF logs API Key 未填写",{confirmButtonText:"确定",type:"error",dangerouslyUseHTMLString:!0,message:'<a href="https://cn.fflogs.com/profile">点击这里，在最下方<strong>填写 V1 客户名称并点击确认</strong>后，获取你的 V1 客户端密钥</a>'}),j.value="查询",void(S.value=!1);if(!t)return le.alert("请正确填写FF Logs链接","FF Logs链接格式错误",{confirmButtonText:"确定",type:"error"}),j.value="查询",void(S.value=!1);k.code=t.groups?.code??"";try{const e=`fights:${k.code}`,l=A(e);let i;l&&P(l)?i=l.data:(i=await fetch(`https://cn.fflogs.com/v1/report/fights/${k.code}?api_key=${E.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),z(e,i)),k.bossIDs=i.enemies.filter(e=>["Boss","NPC"].includes(e.type)).map(e=>e.id),k.enemies=i.enemies.slice(),k.fightIndex=("last"===t?.groups?.fight?i.fights.length:Number.parseInt(t?.groups?.fight??"0"))-1;const n=i.fights[k.fightIndex];k.zoneID=n.zoneID,k.start=n.start_time,k.end=n.end_time,k.friendlies=i.friendlies.filter(e=>"LimitBreak"!==e.icon&&e.fights.find(e=>e.id===k.fightIndex+1)),k.friendlies.sort((e,t)=>{const l=L.iconToJobEnum(e.icon),i=L.iconToJobEnum(t.icon);return L.enumSortMethod(l,i)}),j.value="查询",k.abilityFilterEvents.length=0,k.abilityFilterCandidate.length=0,S.value=!1,O.value=1}catch(l){le.alert(`\n  <h3 style="margin-bottom: 10px;">可能的原因：</h3>\n  <ul style="padding-left: 20px; margin-bottom: 10px;">\n    <li> <strong>90%概率</strong>：你没有<strong style="color: red;">先起名</strong>再获取 V1 客户端密钥</li>\n    <li> <strong>5%概率</strong>：该战斗记录是私人或匿名模式</li>\n    <li> <strong>5%概率</strong>：网络异常</li>\n  </ul>\n<p class="error-details"><strong>错误：</strong>${l}</p>\n`,"请求失败",{confirmButtonText:"确定",type:"error",dangerouslyUseHTMLString:!0}),j.value="查询",S.value=!1}}(m(T)))},{default:d(()=>[m(S)?(a(),o(C,{key:0,class:"is-loading"},{default:d(()=>[s(m(g))]),_:1})):r("",!0),u(" "+w(m(j)),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})):r("",!0),c("div",$e,[1===m(O)?(a(),o(oe,{key:0,class:"player-selection"},{default:d(()=>[s(ce,{data:m(k).friendlies.filter(e=>!["NPC"].includes(e.icon)),stripe:"",border:"",class:"friendlies-table"},{default:d(()=>[s(re,{prop:"name",label:"玩家名称"}),s(re,{label:"职业"},{default:d(({row:e})=>{return[u(w((t=e.icon,L.jobToFullName(L.jobEnumToJob(L.iconToJobEnum(t))).cn)),1)];var t}),_:1}),s(re,{label:"选定",width:"100",align:"center"},{default:d(e=>[s(l,{type:"primary",size:"small",onClick:t=>H(e.row)},{default:d(()=>[...t[10]||(t[10]=[u(" 选择 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),c("div",Se,[s(l,{type:"info",onClick:t[4]||(t[4]=e=>ie())},{default:d(()=>[...t[11]||(t[11]=[u("不选择玩家，而是生成BOSS时间轴",-1)])]),_:1})])]),_:1})):r("",!0),2===m(O)?(a(),o(oe,{key:1,class:"ability-filter"},{default:d(()=>[c("div",Oe,[m(V)?r("",!0):(a(),n("div",Ve,[s(C,{class:"is-loading"},{default:d(()=>[s(m(g))]),_:1}),t[12]||(t[12]=c("span",null,"正在加载技能列表...",-1))])),m(V)&&"friendies"===m(k).type?(a(),n(b,{key:1},[s(ue,{modelValue:m(k).abilityFilterSelected,"onUpdate:modelValue":t[5]||(t[5]=e=>m(k).abilityFilterSelected=e),multiple:"",placeholder:"选择需要导入的技能","fit-input-width":!0,class:"ability-filter-select",filterable:""},{default:d(()=>[(a(!0),n(b,null,h(m(k).abilityFilterCandidate,e=>(a(),o(de,{key:e.actionId,value:e.actionId,label:e.actionName,class:"ability-filter-option"},{default:d(()=>[c("img",{src:m(R)(`/i/${e.url}.png`),class:"ability-filter-icon",alt:e.actionName,onerror:m(M)},null,8,ke),c("span",null,w(e.actionName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"]),s(_,{label:"添加 TTS 语法","w-60":"","m-t-3":""},{default:d(()=>[s(pe,{modelValue:m($),"onUpdate:modelValue":t[6]||(t[6]=e=>f($)?$.value=e:null)},null,8,["modelValue"])]),_:1}),s(l,{type:"success",class:"filter-confirm-btn",disabled:!m(V),onClick:q},{default:d(()=>[...t[13]||(t[13]=[u(w("生成玩家时间轴"),-1)])]),_:1},8,["disabled"])],64)):m(V)&&"enemies"===m(k).type?(a(),n(b,{key:2},[m(V)?(a(),o(ue,{key:0,modelValue:m(k).enemiesAbilityFilterSelected,"onUpdate:modelValue":t[7]||(t[7]=e=>m(k).enemiesAbilityFilterSelected=e),multiple:"",placeholder:"选择需要导入的技能","fit-input-width":!0,class:"ability-filter-select",filterable:""},{default:d(()=>[(a(!0),n(b,null,h(m(k).abilityFilterCandidate,e=>(a(),o(de,{key:e.actionName,value:e.actionName,class:"ability-filter-option"},{default:d(()=>[c("span",null,w(e.actionName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])):r("",!0),s(l,{type:"success",class:"filter-confirm-btn",disabled:!m(V),onClick:ne},{default:d(()=>[...t[14]||(t[14]=[u(w("生成敌人时间轴"),-1)])]),_:1},8,["disabled"])],64)):r("",!0)])]),_:1})):r("",!0)])],64)}}}),[["__scopeId","data-v-d2ef8fea"]]),Ee=ie(e({__name:"SettingsDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:l}){const i=e,r=l,u=I();v(()=>{u.saveTimelineSettings()});const p=x({get:()=>i.modelValue,set:e=>r("update:modelValue",e)}),y=t(-15),g=t([{time:-15,action:"<圣光幕帘>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:-2,action:"<圣灵>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:0,action:"战斗开始！",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:3,action:"<挑衅>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:5,action:"<神圣领域>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1}]);return(e,t)=>{const l=A,i=G,r=oe,w=se,v=re,x=E,_=Q,F=ae;return a(),o(F,{modelValue:m(p),"onUpdate:modelValue":t[1]||(t[1]=e=>f(p)?p.value=e:null),modal:!0,overflow:"","close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"timeline-dialog",width:"600px","append-to-body":!0,draggable:!0},{header:d(()=>[...t[2]||(t[2]=[c("h3",{style:{margin:"0",padding:"10px","background-color":"#f5f7fa",cursor:"move"}}," 设置 ",-1)])]),default:d(()=>[s(_,{"label-position":"right","label-width":"120px",class:"timeline-form"},{default:d(()=>[t[3]||(t[3]=c("h3",{class:"form-section-title"}," 参数 ",-1)),s(w,{gutter:20},{default:d(()=>[(a(!0),n(b,null,h(m(u).configValues,(e,t,n)=>(a(),o(r,{key:n,span:12},{default:d(()=>[s(i,{label:m(u).configTranslate[t]},{default:d(()=>[s(l,{modelValue:m(u).configValues[t],"onUpdate:modelValue":e=>m(u).configValues[t]=e,min:0,step:.1,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),t[4]||(t[4]=c("h3",{class:"form-section-title"}," 样式 ",-1)),s(w,{gutter:20},{default:d(()=>[(a(!0),n(b,null,h(m(u).showStyle,(e,t,n)=>(a(),o(r,{key:n,span:12},{default:d(()=>[s(i,{label:m(u).showStyleTranslate[t]},{default:d(()=>[s(l,{modelValue:m(u).showStyle[t],"onUpdate:modelValue":e=>m(u).showStyle[t]=e,min:0,step:.01,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),t[5]||(t[5]=c("h3",{class:"form-section-title"}," 测试用例 ",-1)),s(w,{gutter:20},{default:d(()=>[s(v,{modelValue:m(y),"onUpdate:modelValue":t[0]||(t[0]=e=>f(y)?y.value=e:null),min:-15,max:5,step:.1,"show-input":""},null,8,["modelValue"]),s(x,{config:m(u).configValues,lines:m(g),runtime:m(y),"show-style":m(u).showStyle},null,8,["config","lines","runtime","show-style"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-fcf4e153"]]),Ce={class:"batch-operations",style:{"margin-bottom":"15px",display:"flex","flex-wrap":"wrap","justify-content":"space-between",gap:"10px"}},Ae={style:{display:"flex",gap:"10px","flex-wrap":"wrap"}},Be={class:"editor-dialog-content"},Ne=["value"],ze={class:"slider-demo-block"},Ue={class:"time-display",style:{width:"80px","text-align":"center"}},De={class:"time-display-text"},Pe={class:"time-display-text"},Je={style:{"margin-top":"1em"}},Le=ie(e({__name:"timelineSettings",setup(e){const l=T(),{wsConnected:r}=ue({allowClose:!0,addWsParam:!0}),y=I(),g=_(y,"allTimelines"),v=_(y,"filters"),A=t(0),B=t([]),J=t(!1),M=t(!1),R=t(!1),Z=t(!1),W=t(!1);let Q,te;const ie=F("timelineCurrentlyEditing",{name:"空",condition:{zoneId:"0",jobs:["NONE"]},timeline:"空",codeFight:"空",create:"空"}),je=t([]);let Te=null,$e=!1;const Se=t(""),Oe=t(""),Ve=t("");let ke;const Le=x(()=>g.value.filter(e=>{const t=e.name.toLowerCase().includes(Se.value.toLowerCase()),l=!Oe.value||e.condition.zoneId===Oe.value,i=!Ve.value||e.condition.jobs.includes(Ve.value);return t&&l&&i})),Me=x(()=>{const e=A.value,t=e<0,l=Math.abs(Math.floor(e)),i=Math.floor(l/60),n=l%60;return`${t?"-":""}${String(i).padStart(2,"0")}:${String(n).padStart(2,"0")}`}),Re=t(0);function Ke(e){ie.value=e,M.value=!0,We()}function He(){M.value=!1}function Ze(){Ke(y.allTimelines[y.newTimeline()])}function We(){je.value=[{time:0,action:"正在加载...",show:!0,windowBefore:0,windowAfter:0,alertAlready:!0}],C(ie.value.timeline).then(e=>{je.value=e;const t=Math.max(...je.value.map(e=>e.time),550);Re.value=t+30,A.value=-y.configValues.preBattle})}function qe(){if(0===B.value.length)return void O.warning("请选择要删除的时间轴");const e=B.value.map(e=>`「${e.name}」`).join("<br/>");le.confirm(`确定要删除选中的 ${B.value.length} 个时间轴吗？<br>${e}`,"批量删除时间轴",{confirmButtonText:"确认删除",cancelButtonText:"取消",dangerouslyUseHTMLString:!0,type:"warning"}).then(()=>{O.success(`成功删除 ${B.value.length} 个时间轴`),g.value=g.value.filter(e=>!B.value.includes(e)),B.value=[],J.value=!1}).catch(()=>{})}function Ge(){J.value=!J.value,B.value=J.value?[...g.value]:[]}function Qe(){0!==B.value.length?Xe(B.value):O.warning("请选择要导出的时间轴")}function Xe(e){const t=JSON.stringify(e),l=JSON.parse(t);for(const c of l)c.timeline=c.timeline.replace(/^#.*(?:\n|$)/gm,"");const i=JSON.stringify(l),n=ce.compressToBase64(t),a=ce.compressToBase64(i),s=n.length,o=a.length;if(s===o)return void rt(n,"数据复制成功，已写入剪切板。","复制失败，请手动复制！");const r=((s-o)/s*100).toFixed(2);le.confirm(`\n     1. 完整版本（包含注释）<br>\n     &nbsp;&nbsp;&nbsp;- 大小：${s} 字节<br>\n     &nbsp;&nbsp;&nbsp;- 包含所有时间轴信息和注释<br><br>\n     2. 优化版本（不含注释）<br>\n     &nbsp;&nbsp;&nbsp;- 大小：${o} 字节<br>\n     &nbsp;&nbsp;&nbsp;- 节省 ${r}% 的空间<br>\n     &nbsp;&nbsp;&nbsp;- 仅包含必要的时间轴数据`,"请选择导出版本：",{confirmButtonText:"导出优化版本",cancelButtonText:"导出完整版本",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnPressEscape:!1,dangerouslyUseHTMLString:!0,showClose:!0,type:"info",callback:e=>{if("cancel"===e||"confirm"===e){rt("confirm"===e?a:n,"数据复制成功，已写入剪切板。","复制失败，请手动复制！")}}})}function Ye(){le.prompt("请输入导出的字符串（支持多行导入）","导入时间轴",{confirmButtonText:"解析",cancelButtonText:"取消",inputType:"textarea",inputValidator:e=>{if(!e)return"请输入导出的字符串";const t=e.split("\n").filter(e=>""!==e.trim());let l=[];for(const i of t){let e;try{e=JSON.parse(i)}catch{try{const t=ce.decompressFromBase64(i);e=JSON.parse(t)}catch{return`无法解析输入的数据：${i}，请确保每行都是正确的JSON或压缩后的字符串。`}}if(!Array.isArray(e))return`导入的数据格式不正确：${i}`;l=l.concat(e)}return 0!==l.length||"导入的数据不包含任何时间轴。"},inputErrorMessage:"无效的输入"}).then(({value:e})=>{const t=e.split("\n").filter(e=>""!==e.trim());let l=[];for(const a of t){let e;try{e=JSON.parse(a)}catch{const t=ce.decompressFromBase64(a);e=JSON.parse(t)}l=l.concat(e)}const i=l.length,n=l.map(e=>`「${e.name}」`).join(", ");le({title:"确认",message:`导入 ${i} 个时间轴：\n${n}\n？`,showCancelButton:!0,showConfirmButton:!0,confirmButtonText:"追加",cancelButtonText:"覆盖",distinguishCancelAndClose:!0,type:"warning",callback:e=>{"cancel"===e?le.prompt('覆盖操作将删除所有现有的时间轴。请输入"我确认"以继续。',"二次确认",{confirmButtonText:"确定覆盖",cancelButtonText:"取消",inputPattern:/^我确认$/,inputErrorMessage:'请输入"我确认"以确认覆盖操作',type:"warning"}).then(({value:e})=>{"我确认"===e&&et(l,!0)}).catch(()=>{}):"confirm"===e&&et(l,!1)}})}).catch(()=>{})}function et(e,t){t&&(y.allTimelines.length=0),y.allTimelines.push(...e),y.sortTimelines();for(const a of y.allTimelines)void 0===a.condition.jobs&&(a.condition.jobs=[a.condition?.job??"NONE"]);if(t)return void O({type:"success",message:"覆盖成功！",duration:2e3});const l=[],i=new Set;for(const a of y.allTimelines){const e=JSON.stringify({name:a.name,condition:a.condition,timeline:a.timeline,codeFight:a.codeFight,create:a.create});i.has(e)||(i.add(e),l.push(a))}const n=y.allTimelines.length-l.length;y.allTimelines=l,O({message:`追加成功！共导入 ${e.length} 个时间轴${n>0?`，但其中 ${n} 个重复，已自动移除。`:""}`,type:"success",duration:3e3})}function tt(e,t={}){fe({call:"broadcast",source:"soumaTimelineSettings",msg:{type:e,data:t}})}function lt(){const e=l.resolve({path:"/timeline"}),t=`${window.location.protocol}//${window.location.host}/ff14-overlay-vue/${e.href}`;$e=!0,Te=Fe.service({lock:!0,text:`正在请求数据，请确保 ACT 中已添加并启用此悬浮窗：${t}`,background:"rgba(0, 0, 0, 0.7)"}),tt("get"),setTimeout(()=>{$e&&(O.info("重新尝试获取数据..."),lt())},5e3)}const it=e=>{if("soumaTimeline"===e.source)if("post"===e.msg.type){$e=!1,Te.close();const t=e.msg.data;for(const e of t.allTimelines)void 0===e.condition.jobs&&(e.condition.jobs=[e.condition.job]),e.condition.jobs.sort((e,t)=>y.jobList.indexOf(e)-y.jobList.indexOf(t)),Reflect.deleteProperty(e.condition,"job");y.allTimelines=t.allTimelines,y.configValues=t.configValues,y.showStyle=t.showStyle,O.closeAll(),O({message:"数据获取成功",type:"success",duration:3e3})}else"success"===e.msg.type?(Q&&(clearTimeout(Q),Q=void 0),te&&(te.close(),te=void 0),_e.closeAll(),_e({message:"数据同步成功",type:"success",duration:1e3,position:"bottom-left",icon:"el-icon-success",zIndex:1,showClose:!1})):"hello"===e.msg.type&&te&&ut()};function nt(){window.open("https://docs.qq.com/sheet/DTWxKT3lFbmpDV3Fm?tab=5ovrc8","_blank")}function at(){const e=l.resolve({path:"/timelineHelp"}).href;window.open(e,"_blank")}function st(){R.value=!0}function ot(e){y.configValues=e.configValues,y.showStyle=e.showStyle}function rt(e,t="复制成功",l="复制失败"){pe(e).then(()=>O.success(t)).catch(()=>O.error(l))}function ct({row:e}){return e===ie.value?"editing-row":""}function dt(){W.value=!0}function ut(){tt("post",y.$state),clearTimeout(Q),Q=window.setTimeout(()=>{const e=l.resolve({path:"/timeline"}),t=`${window.location.protocol}//${window.location.host}/ff14-overlay-vue/${e.href}`;te?.close(),te=_e({title:"同步数据失败",message:k("div",{style:"color:#f00"},[k("div",["请确保你已正确启用了 ",k("a",{href:t,target:"_blank",style:"color:#f00; text-decoration: underline;"},"此悬浮窗"),"。"])]),showClose:!1,duration:0,position:"bottom-left"})},500)}function pt(e){const t=ye[e]?.name;return t?t.cn||`${t.ja} / ${t.en}`:"未知地图"}function mt(e){return(L.jobToFullName(e.toUpperCase())?.cn??e).replace("冒险者","全部职业")}return i(()=>{me("BroadcastMessage",it);const e=j(r,t=>{t&&(0===y.allTimelines.length&&lt(),e(),ke&&(ke.close(),ut()))});y.allTimelines.forEach(e=>e.timeline=e.timeline.replaceAll(/^(?<a>.+), once: true(?<b>.+)$/gm,"$<a>$<b> once"));const t=V(()=>{r.value?ut():(ke?.close(),ke=_e({title:"你修改了时间轴，但",message:k("i",{style:"color: #f00"},"改动未应用，直到你成功连接到 WebSocket。"),showClose:!1,duration:0,position:"bottom-left"}))},500);j(()=>y.$state,t,{deep:!0})}),y.loadTimelineSettings(),y.sortTimelines(),(e,t)=>{const l=Y,i=ee,r=ae,x=Ee,_=K,F=H,j=he,T=ne,V=se,k=we,I=Ie,C=X,L=P,Q=U,te=D,ce=q,ue=z,pe=N,me=ve,fe=be,ye=G,_e=oe,Fe=xe,Te=re,$e=E,ke=ge;return a(),o(ke,{class:"container"},{default:d(()=>[s(r,{modelValue:m(W),"onUpdate:modelValue":t[0]||(t[0]=e=>f(W)?W.value=e:null),title:"时间轴解析结果","align-center":"",center:"",draggable:"",width:"80%"},{default:d(()=>[s(i,{data:m(je)},{default:d(()=>[s(l,{property:"time",label:"time","min-width":"60"}),s(l,{property:"action",label:"action",width:"150"},{default:d(({row:e})=>[u(w(e.action.replaceAll(/(^['"“”]|['"“”]$)/g,"")),1)]),_:1}),s(l,{property:"sync",label:"sync","min-width":"200"},{default:d(({row:e})=>[u(w(e.sync?e.sync:"-"),1)]),_:1}),s(l,{property:"syncOnce",label:"once","min-width":"100"},{default:d(({row:e})=>[u(w(e.syncOnce?"✅":"-"),1)]),_:1}),s(l,{label:"window","min-width":"100"},{default:d(({row:e})=>[u(w(e.sync?`${e.windowBefore},${e.windowAfter}`:"-"),1)]),_:1}),s(l,{property:"jump",label:"jump","min-width":"100"},{default:d(({row:e})=>[u(w(e.jump?e.jump:"-"),1)]),_:1}),s(l,{property:"tts",label:"tts","min-width":"150"},{default:d(({row:e})=>[u(w(e.tts?e.tts:"-"),1)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),s(x,{modelValue:m(Z),"onUpdate:modelValue":t[1]||(t[1]=e=>f(Z)?Z.value=e:null),onSave:ot},null,8,["modelValue"]),s(k,{class:"flex-header"},{default:d(()=>[s(V,{justify:"space-between",align:"middle"},{default:d(()=>[s(j,null,{default:d(()=>[s(F,null,{default:d(()=>[s(_,{type:"primary",size:"small",onClick:st},{default:d(()=>[...t[21]||(t[21]=[u(" 从 FFlogs 生成 ",-1)])]),_:1}),s(_,{type:"primary",size:"small",onClick:nt},{default:d(()=>[...t[22]||(t[22]=[u(" 从 在线文档 获取 ",-1)])]),_:1}),s(_,{type:"primary",size:"small",onClick:Ze},{default:d(()=>[...t[23]||(t[23]=[u(" 手动编写 ",-1)])]),_:1})]),_:1}),s(F,null,{default:d(()=>[s(_,{size:"small",onClick:Ye},{default:d(()=>[...t[24]||(t[24]=[u(" 导入字符串 ",-1)])]),_:1}),s(_,{size:"small",class:"export",onClick:t[2]||(t[2]=e=>Xe(m(g)))},{default:d(()=>[...t[25]||(t[25]=[u(" 导出全部 ",-1)])]),_:1})]),_:1})]),_:1}),s(j,null,{default:d(()=>[s(T,{"storage-key":"timeline-settings-theme"}),s(_,{color:"#626aef",style:{color:"white"},size:"small",onClick:t[3]||(t[3]=e=>Z.value=!0)},{default:d(()=>[...t[26]||(t[26]=[u(" 参数设置 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(fe,null,{default:d(()=>[s(r,{modelValue:m(R),"onUpdate:modelValue":t[5]||(t[5]=e=>f(R)?R.value=e:null),title:"从 FFlogs 生成时间轴",width:"80%","before-close":()=>R.value=!1,"close-on-press-escape":!1,"close-on-click-modal":!1},{default:d(()=>[s(I,{filters:m(v),onShowFFlogsToggle:t[4]||(t[4]=()=>R.value=!1),onEditTimeline:Ke},null,8,["filters"])]),_:1},8,["modelValue","before-close"]),m(g).length>0?(a(),o(pe,{key:0},{default:d(()=>[c("div",Ce,[c("div",Ae,[s(C,{modelValue:m(Se),"onUpdate:modelValue":t[6]||(t[6]=e=>f(Se)?Se.value=e:null),placeholder:"搜索名称...",clearable:"",size:"small",style:{width:"180px"}},null,8,["modelValue"]),s(L,{selectZone:m(Oe),"onUpdate:selectZone":t[7]||(t[7]=e=>f(Oe)?Oe.value=e:null),placeholder:"筛选地图",size:"small",style:{width:"180px"},clearable:!0},null,8,["selectZone"]),s(te,{modelValue:m(Ve),"onUpdate:modelValue":t[8]||(t[8]=e=>f(Ve)?Ve.value=e:null),placeholder:"筛选职业",clearable:"",size:"small",style:{width:"180px"}},{default:d(()=>[s(Q,{label:"全部职业",value:""}),(a(!0),n(b,null,h(m(y).jobList,e=>(a(),o(Q,{key:e,label:mt(e),value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),$(c("div",null,[s(ce,{type:"info"},{default:d(()=>[u(" 筛选结果：共 "+w(m(Le).length)+" 个时间轴 ",1)]),_:1})],512),[[S,m(Se)||m(Oe)||m(Ve)]]),c("div",null,[s(_,{type:"primary",size:"small",disabled:0===m(B).length,onClick:Qe},{default:d(()=>[u(" 批量导出 ("+w(m(B).length)+") ",1)]),_:1},8,["disabled"]),s(_,{type:"danger",size:"small",disabled:0===m(B).length,style:{"margin-left":"10px"},onClick:qe},{default:d(()=>[u(" 批量删除 ("+w(m(B).length)+") ",1)]),_:1},8,["disabled"])])]),s(i,{data:m(Le),"row-class-name":ct,style:{width:"100%"},stripe:"","default-sort":{prop:"condition",order:"ascending"},onSelectionChange:t[10]||(t[10]=e=>{B.value=e,J.value=e.length===m(g).length})},{default:d(()=>[s(l,{type:"selection",width:"55",align:"center"},{header:d(()=>[s(ue,{modelValue:m(J),"onUpdate:modelValue":t[9]||(t[9]=e=>f(J)?J.value=e:null),onChange:Ge},null,8,["modelValue"])]),_:1}),s(l,{prop:"name",label:"名称"}),s(l,{prop:"condition",label:"地图",sortable:""},{default:d(e=>[u(w(pt(e.row.condition.zoneId)),1)]),_:1}),s(l,{prop:"condition",label:"职业"},{default:d(e=>[u(w(e.row.condition.jobs.map(e=>mt(e)).join("、").replace("冒险者","全部职业")),1)]),_:1}),s(l,{label:"操作",width:"150"},{default:d(e=>[s(_,{type:"primary",size:"small",onClick:t=>Ke(e.row)},{default:d(()=>[...t[27]||(t[27]=[u(" 编辑 ",-1)])]),_:1},8,["onClick"]),s(_,{type:"danger",size:"small",onClick:t=>{return l=e.row,void le.confirm(`确定要删除「${l.name}」吗？`,"删除时间轴",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning"}).then(()=>{g.value.splice(g.value.findIndex(e=>e===l),1)}).catch(()=>{});var l}},{default:d(()=>[...t[28]||(t[28]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):(a(),o(pe,{key:1},{default:d(()=>[s(me,{description:"点击上方新建或导入一个时间轴吧~"})]),_:1}))]),_:1}),s(r,{modelValue:m(M),"onUpdate:modelValue":t[20]||(t[20]=e=>f(M)?M.value=e:null),title:"编辑时间轴",top:"5vh","before-close":He,class:"timeline-dialog",width:"65%",style:{"min-width":"550px","max-width":"1000px"},"close-on-click-modal":!1,"close-on-press-escape":!1},{default:d(()=>[c("div",Be,[s(V,{class:"timeline-header",gutter:10},{default:d(()=>[s(_e,{span:14},{default:d(()=>[s(ye,{label:"名称"},{default:d(()=>[s(C,{modelValue:m(ie).name,"onUpdate:modelValue":t[11]||(t[11]=e=>m(ie).name=e)},null,8,["modelValue"])]),_:1})]),_:1}),s(_e,{span:8},{default:d(()=>[s(ye,{label:"来源"},{default:d(()=>["用户创建"!==m(ie).codeFight?(a(),o(Fe,{key:0,href:`https://cn.fflogs.com/reports/${m(ie).codeFight.replace("#","?")}&type=damage-done`,target:"_blank"},{default:d(()=>[t[29]||(t[29]=c("img",{class:"site-logo",src:"https://assets.rpglogs.cn/img/ff/favicon.png?v=4",alt:"FF Logs",style:{width:"34px",height:"33.4688px"}},null,-1)),u(w(m(ie).codeFight),1)]),_:1},8,["href"])):(a(),n("input",{key:1,type:"text",value:`${m(ie).codeFight}（${m(ie).create}）`,"w-80":"","p-1.3":"",disabled:""},null,8,Ne))]),_:1})]),_:1}),s(_e,{span:22},{default:d(()=>[s(ye,{label:"地图"},{default:d(()=>[s(L,{selectZone:m(ie).condition.zoneId,"onUpdate:selectZone":t[12]||(t[12]=e=>m(ie).condition.zoneId=e),size:"default"},null,8,["selectZone"])]),_:1})]),_:1}),s(_e,{span:22},{default:d(()=>[s(ye,{label:"职业"},{default:d(()=>[s(te,{modelValue:m(ie).condition.jobs,"onUpdate:modelValue":t[13]||(t[13]=e=>m(ie).condition.jobs=e),multiple:""},{default:d(()=>[(a(!0),n(b,null,h(m(y).jobList,e=>(a(),o(Q,{key:e,label:mt(e),value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),c("div",ze,[s(Te,{modelValue:m(A),"onUpdate:modelValue":t[14]||(t[14]=e=>f(A)?A.value=e:null),min:-m(y).configValues.preBattle,max:m(Re),step:.1},null,8,["modelValue","min","max"]),c("div",Ue,[c("p",De,w(m(Me)),1),c("p",Pe,"("+w(m(A))+"s)",1)])]),s(V,{class:"timeline-editor-body",gutter:10},{default:d(()=>[s(_e,null,{default:d(()=>[s(C,{modelValue:m(ie).timeline,"onUpdate:modelValue":t[15]||(t[15]=e=>m(ie).timeline=e),style:p({width:`calc(100% - ${m(y).showStyle["--timeline-width"]}px)`}),type:"textarea",autosize:{minRows:10,maxRows:20},wrap:"off",placeholder:"请键入时间轴文本",onChange:t[16]||(t[16]=e=>We())},null,8,["modelValue","style"])]),_:1}),s($e,{style:{position:"absolute",right:0,top:0},config:m(y).configValues,lines:m(je),runtime:m(A),"show-style":m(y).showStyle},null,8,["config","lines","runtime","show-style"])]),_:1}),c("div",Je,[s(j,null,{default:d(()=>[s(_,{onClick:t[17]||(t[17]=e=>Xe([m(ie)]))},{default:d(()=>[...t[30]||(t[30]=[u(" 导出 ",-1)])]),_:1}),s(_,{onClick:t[18]||(t[18]=e=>{ie.value.timeline=ie.value.timeline.replaceAll(new RegExp("(?<=^|^#\\s*)(\\d+:\\d+(?:\\.\\d{1,2})?|\\d+(?:\\.\\d+)?)","gm"),e=>e.includes(":")?de.duration(`00:${e}`).as("seconds").toString():de.utc(1e3*Number(e)).format("mm:ss.S"))})},{default:d(()=>[...t[31]||(t[31]=[u(" 切换时间格式 ",-1)])]),_:1}),s(_,{onClick:at},{default:d(()=>[...t[32]||(t[32]=[u(" 时间轴语法 ",-1)])]),_:1}),s(_,{onClick:t[19]||(t[19]=e=>{le.confirm("要删除所有的注释行，仅保留必要的时间轴数据吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{ie.value.timeline=ie.value.timeline.replace(/^#.*(?:\n|$)/gm,""),O.success("完成")}).catch(()=>{})})},{default:d(()=>[...t[33]||(t[33]=[u(" 去除注释行 ",-1)])]),_:1}),s(_,{onClick:dt},{default:d(()=>[...t[34]||(t[34]=[u(" 展示调试信息 ",-1)])]),_:1})]),_:1})])])]),_:1},8,["modelValue"])]),_:1})}}}),[["__scopeId","data-v-7591524f"]]);export{Le as default};
