import{_ as a}from"./ActWrapper-5069e8c1.js";import{u as e,_ as t}from"./DragJob-b424de72.js";import{J as n,m as r,k as o}from"./element-plus-901ad096.js";import{k as l,r as s,aP as u,J as i,aX as p,aS as m,x as c,y as d,o as y,q as f,G as v,l as b,B as j,u as h,d as g,E as k,F as P,ae as _,A as w}from"./vue-49c48d91.js";import{u as J}from"./useDev-861d544b.js";import{U as x}from"./util-3591e9ca.js";import{a as C,c as T}from"./cactbot-49e370f3.js";import"./vendor-979eac9e.js";import{_ as D}from"./_plugin-vue_export-helper-6a8c15be.js";import"./useDemo-86956ef5.js";const V={class:"cactbot-runtime"},E={key:0,class:"you"},O={key:1,class:"players"},R={class:"job-name"},S={key:0,class:"player-name"},U={key:0,style:{position:"fixed",bottom:"0"}},G=D(l({__name:"cactbotRuntime",setup(l){const D=e(),G=s(!1);function A(a,e,t=0){return Array.from({length:e},()=>a).map((a,e)=>a+(+e+1+t))}const F=s(!1),L=[{id:"10000001",name:"虚构暗骑",job:32,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构龙骑",job:22,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0},{id:"10000007",name:"虚构画家",job:42,inParty:!0}],M=u("cactbotRuntime-data",{party:[]}),N=u("cactbotRuntime-showTips",s(!0)),q=u("cactbotRuntime-roleSelectLength",{tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0}),z={tank:["MT","ST",...A("T",6,2)],healer:[...A("H",8)],dps:[...A("D",8)],crafter:[...A("C",8)],gatherer:[...A("G",8)],none:[...A("N",8)]};function B(a){const e=K(a);return z[e].filter((a,t)=>t<q.value[e])}const H=J(),I=s(H.value?L[2].name:"");function K(a){return[1,3,19,21,32,37].includes(a)?"tank":[6,24,28,33,40].includes(a)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39,41,42].includes(a)?"dps":x.isCraftingJob(x.jobEnumToJob(a))?"crafter":x.isGatheringJob(x.jobEnumToJob(a))?"gatherer":"none"}function Q(a){return z[K(a.job)].find(a=>!M.value.party.find(e=>e.rp===a))??"unknown"}function W(){const a=[...z.tank,...z.healer,...z.dps,...z.crafter,...z.gatherer,...z.none];M.value.party.sort((e,t)=>a.indexOf(e.rp??"unknown")-a.indexOf(t.rp??"unknown")),T({call:"broadcast",source:"soumaRuntimeJS",msg:{party:M.value.party}})}function X(){!function(){M.value.party.sort((a,e)=>D.arr.indexOf(a.job)-D.arr.indexOf(e.job));for(const a of M.value.party)a.rp=void 0;for(const a of M.value.party)a.rp=Q(a)}(),function(){for(const a in q.value)Object.prototype.hasOwnProperty.call(q.value,a)&&(q.value[a]=M.value.party.reduce((e,t)=>K(t.job)===a?e+1:e,0))}(),W()}function Y(){const a={party:L};N.value&&(F.value=!0),M.value.party=a.party.filter(a=>a.inParty).map(a=>({...a,rp:"unknown"})),X()}return i(()=>{const a=p({storageKey:"cactbot-runtime-theme"}),e=m(a);!1===a.value&&e(),document.body.addEventListener("mouseenter",()=>G.value=!0),document.body.addEventListener("mouseleave",()=>G.value=!1),W(),C("PartyChanged",a=>{N.value&&(F.value=!0),H.value&&0===a.party.length||(M.value.party=a.party.filter(a=>a.inParty).map(a=>({...a,rp:"unknown"})),X())}),C("ChangePrimaryPlayer",a=>{H.value||(I.value=a.charName)}),C("BroadcastMessage",a=>{"soumaUserJS"===a.source&&"object"==typeof a.msg&&null!==a.msg&&"requestData"===Reflect.get(a.msg,"text")&&W()})}),(e,l)=>{const s=n,u=r,i=o,p=t,m=a;return y(),c(m,null,{default:d(()=>[f("div",V,[v(s,{modelValue:h(F),"onUpdate:modelValue":l[0]||(l[0]=a=>g(F)?F.value=a:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:l[1]||(l[1]=a=>{F.value=!1,N.value=!1})},{header:d(()=>l[3]||(l[3]=[f("span",null,"用法",-1)])),default:d(()=>l[4]||(l[4]=[f("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1),f("ul",null,[f("li",null,"临时：下拉选择框修改。"),f("li",null,"长期：用鼠标拖动职能顺序。")],-1)])),_:1},8,["modelValue"]),f("main",null,[h(G)?(y(),b("div",O,[(y(!0),b(P,null,_(h(M).party,(a,e)=>{return y(),b("section",{key:a.id,class:w(["player",{"is-you":a.name===h(I)}])},[v(i,{modelValue:a.rp,"onUpdate:modelValue":e=>a.rp=e,size:"small",class:"select","fit-input-width":"",placement:"right",offset:8,onChange:a=>function(a){const e=M.value.party.find(e=>e.rp===M.value.party[a].rp&&e.id!==M.value.party[a].id);e&&(e.rp=Q(e)),W()}(e)},{default:d(()=>[(y(!0),b(P,null,_(B(a.job),(a,e)=>(y(),c(u,{key:e,value:a,label:a},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),f("span",R,k((t=a.job,x.jobToFullName(x.jobEnumToJob(t)).simple1)),1),h(G)?(y(),b("span",S,k(a.name),1)):j("",!0)],2);var t}),128)),h(G)?(y(),c(p,{key:0,class:"drag-job",party:h(M).party,"p-1":"",onUpdate:X},null,8,["party"])):j("",!0)])):(y(),b("div",E,k(h(M).party.find(a=>a.name===h(I))?.rp??""),1))]),h(H)?(y(),b("div",U,[f("button",{onClick:l[2]||(l[2]=a=>{h(M).party=h(M).party.filter(a=>a.name===h(I)),X()})}," 测试单人 "),f("button",{onClick:Y}," 测试组队 ")])):j("",!0)])]),_:1})}}}),[["__scopeId","data-v-eb522f4e"]]);export{G as default};
