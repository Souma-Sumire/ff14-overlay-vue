import{t as e,r as i,f as a,P as r,v as s,x as t,A as n,az as l,L as o,a9 as c,K as m,u as d,G as p,J as u,D as y,E as f,M as g,H as h,S as b,c as v,V as k,d as w,ai as F,F as C,O as I,h as N,ac as x}from"./vue-vendor-e9f6d682.js";import{_ as j}from"./_plugin-vue_export-helper-6a8c15be.js";import{s as $,c as E,a as T}from"./status-84583663.js";import{c as A,u as _}from"./index-bc46afe1.js";import{h as H,g as D}from"./xivapi-3a0d4d4e.js";import{V as S}from"./index-cb6d85bc.js";/* empty css                  *//* empty css                   */import{X as O}from"./element-plus-31eb5454.js";import"./style-1f970b29.js";import{g as L}from"./actionChinese-e2356100.js";import{U as z}from"./util-c5e2dd68.js";import{l as P}from"./regexes-da03e94d.js";import{N as W}from"./netregexes-ed180b06.js";import{a as M}from"./overlay_plugin_api-974cdd44.js";const R={class:"upload select"},B=j(e({__name:"TestLog",emits:["handleLine","beforeHandle","afterHandle"],setup(e,{emit:l}){const o=l,c=i(null),m=i(null);async function d(e){m.value?.classList.remove("drag");const i=e.target.files;if(i&&0!==i.length){o("beforeHandle");for(let e=0;e<i.length;e++){const a=i[e],r=await a.text();for(const e of r.split("\n"))o("handleLine",e)}o("afterHandle"),m.value?.classList.remove("drag")}}function p(e){e.preventDefault(),m.value?.classList.add("drag")}function u(e){e.preventDefault(),m.value?.classList.remove("drag")}return a(()=>{c.value?.addEventListener("change",d),m.value?.addEventListener("dragover",p),m.value?.addEventListener("dragleave",u)}),r(()=>{c.value?.removeEventListener("change",d),m.value?.removeEventListener("dragover",p),m.value?.removeEventListener("dragleave",u)}),(e,i)=>(t(),s("div",R,[n("div",{ref_key:"select",ref:m,class:"upload-select"},[i[0]||(i[0]=n("div",{class:"upload text"},[n("span",null,"+"),n("p",null,"上传或拖入ACT日志")],-1)),n("input",{ref_key:"input",ref:c,type:"file"},null,512)],512)]))}}),[["__scopeId","data-v-8f57d020"]]),G=[{name:"铁壁",id:1191,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"盾阵",id:1856,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"干预",id:1174,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"预警",id:74,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"武装",id:1176,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神圣领域",id:82,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣光幕帘",id:1362,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣盾阵",id:2674,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"骑士的坚守",id:2675,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"壁垒",id:77,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的直觉",id:735,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的勇猛",id:1857,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的武猛",id:1858,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"战栗",id:87,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"复仇",id:89,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"摆脱",id:1457,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死斗",id:409,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血气",id:2678,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血潮",id:2679,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血烟",id:2680,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"至黑之夜",id:1178,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"弃明投暗",id:746,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"暗影墙",id:747,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑布道",id:1894,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"行尸走肉",id:810,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死而不僵",id:811,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"出死入生",id:3255,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"献奉",id:2682,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"石之心",id:1840,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残暴弹",id:1898,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"伪装",id:1832,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"星云",id:1834,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"光之心",id:1839,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"超火流星",id:1836,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之心",id:2683,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之清",id:2684,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神祝祷",id:1218,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"节制",id:1873,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"水流幕",id:2708,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"鼓舞",id:297,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"激励",id:1918,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"炽天的幕帘",id:1917,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"野战治疗阵",id:299,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"异想的幻光",id:317,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"炽天的幻光",id:1875,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"生命回生法",id:2710,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"怒涛之计",id:2711,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"命运之轮",id:849,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"天星交错",id:1889,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"擢升",id:2717,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"中间学派",id:1921,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡诊断",id:2607,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"齐衡诊断",id:2608,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡预后",id:2609,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚角清汁",id:2618,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"白牛清汁",id:2619,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体论",id:3003,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体盾",id:3365,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"输血",id:2612,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"泛输血",id:2613,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"心眼",id:1232,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"金刚极意",id:1179,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"行吟",id:1934,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"策动",id:1951,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"防守之桑巴",id:1826,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"即兴表演结束",id:2697,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残影",id:488,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"魔罩",id:168,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护之光",id:2702,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护纹",id:2597,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"抗死",id:2707,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"雪仇",id:1193,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"牵制",id:1195,type:"multiplier",performance:{physics:1,magic:.5,darkness:0},isFriendly:!1},{name:"昏乱",id:1203,type:"multiplier",performance:{physics:.5,magic:1,darkness:0},isFriendly:!1},{name:"武装解除",id:860,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"减速",id:9,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"体力增加",id:2120,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"腐臭",id:1715,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"智力精神降低",id:2115,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!1},{name:"龙之力",id:2500,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"超硬化",id:1722,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"玄结界",id:2496,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"仙人盾",id:2119,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"强力守护",id:1719,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"哥布防御",id:2114,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"铜墙铁盾",id:194,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚守要塞",id:195,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"终极堡垒",id:196,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初大地",id:863,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑之力",id:864,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"灵魂之青",id:1931,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"极致防御",id:3829,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"极致护盾",id:3830,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"戮罪",id:3832,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗影卫",id:3835,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"大星云",id:3838,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坦培拉涂层",id:3686,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"油性坦培拉涂层",id:3687,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"世界树之干",id:3890,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"建筑神之塔",id:3892,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"太阳星座",id:3896,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神爱抚",id:3903,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0}],U=[...G],Z=new Map;let V="Chinese";function Y(e){if(V!==e||0===Z.size){Z.clear();for(const i of"Chinese"===e?G:U){const e=$[i.id][1];i.fullIcon=E(e),Z.set(i.id.toString(16).toUpperCase().padStart(2,"0"),i)}V=e}}function J(e){return Z.get(e)}function q(e){return 1===e?"useful":0===e?"unuseful":"half-useful"}Y("Chinese");function K(e,i){return Object.entries($).reduce((a,[r,[s,t]])=>(e.test(s)&&a.set(r,{name:s,icon:t,isFriendly:i}),a),new Map)}const X=K(/(?:耐性|防御力)(?:大幅)?(?:降低|提升|低下|下降)|受伤(?:加重|减轻)|体力(?:增加|衰减|减少)|伤害屏障/,!0),Q=K(/(?:精神|力量|灵巧|智力){1,2}(?:大幅)?降低/,!1),ee=A("hash"),ie=l("keigennRecord2",{state:()=>({userOptions:{scale:ae(ee.scale,1),opacity:ae(ee.opacity,.8),showHeader:ae(ee.showHeader,!0),showIcon:ae(ee.showIcon,!0),iconType:ae(ee.iconType,3),showName:ae(ee.showName,!1),abbrId:ae(ee.abbrId,!0),anonymous:ae(ee.anonymous,!0),replaceWithYou:ae(ee.replaceWithYou,!1),parseAA:ae(ee.parseAA,!0),parseDoT:ae(ee.parseDoT,!1),minimize:ae(ee.minimize,!1),actionCN:ae(ee.actionCN,!0),statusCN:ae(ee.statusCN,!0)},isBrowser:!1}),getters:{icon4k:e=>e.userOptions.scale>=2||window.devicePixelRatio>=2?"_hr1":""},actions:{checkIsBrowser(){this.isBrowser=!window.OverlayPluginApi&&!ee.OVERLAY_WS&&!ee.HOST_PORT,this.isBrowser&&setTimeout(()=>this.checkIsBrowser(),1e3)},formatterName:e=>e,initEnvironment(e){/^[A-Z]\S+ [A-Z]\S+$/.test(e)?(this.userOptions.abbrId&&(this.formatterName=e=>e.replace(/^([A-Z])\S+ ([A-Z])\S+$/,"$1.$2.")),Y("Global")):(this.userOptions.abbrId&&(this.formatterName=e=>e.substring(0,2)),Y("Chinese"))}}});function ae(e,i){return"boolean"==typeof i?"0"!==e&&"false"!==e?.toLocaleLowerCase()&&("1"===e||"true"===e?.toLocaleLowerCase()||i):"number"==typeof i?Number.isNaN(+e)?i:+e:i}function re(e){return{dodge:"闪避","damage done":"击中","blocked damage":"格挡","parried damage":"招架","instant death":"即死",heal:"治疗","crit heal":"暴击治疗",damage:"普通","crit damage":"暴击","direct hit damage":"直击","crit direct hit damage":"直暴",physics:"物理",magic:"魔法",darkness:"暗黑",dot:"持续伤害"}[e]}function se(e){const i=function(e){switch(!0){case e.endsWith("1"):return"dodge";case e.endsWith("3"):return"damage done";case e.endsWith("5"):return"blocked damage";case e.endsWith("6"):return"parried damage";case e.endsWith("33"):return"instant death";case e.endsWith("4"):return"heal";case/2\w{4}4$/.test(e):return"crit heal";default:throw new Error(`Unknown effect flag ${e}`)}}(e),a=function(e){switch(!0){case/2\w{3}$/.test(e):return"crit damage";case/4\w{3}$/.test(e):return"direct hit damage";case/6\w{3}$/.test(e):return"crit direct hit damage";default:return"damage"}}(e),r=function(e){switch(!0){case/7?[1-4]\w{3}[35]$|[16]$/.test(e):return"physics";case/^E$/.test(e):case/5\w{4}$/.test(e):return"magic";case/^(?:\d0)?3$/.test(e):case/6\w{4}$/.test(e):return"darkness";default:return"physics"}}(e);return{effect:i,properties:a,type:r}}const te=["3E","113","213","313"],ne=["A10","E"],le=["04"],oe=["01","03","05","06","36"];function ce(e){let i=0,a=e[8]??"",r=e[9]??"";te.includes(a)&&(i+=2,a=e[8+i]??a,r=e[8+i+1]??r),ne.includes(a)&&(i+=2,a=e[8+i]??a,r=e[8+i+1]??r);const s=function(e){if(void 0===e)return 0;const i=e.length;if(i<=4)return 0;let a=Number.parseInt(e.slice(0,i-4),16);if("4"===e[i-4]){const r=Number.parseInt(e.slice(i-2,i),16);a=a-r+(r<<16)}return a}(r),t=`00${a}`.slice(-2);return{amount:s,lowByte:t,flags:a,isHeal:le.includes(t),isAttack:oe.includes(t)}}const me={key:0},de={key:1},pe=["title","data-duration","data-sourcePov"],ue=["src","alt"],ye=e({__name:"StatusShow",props:{row:{type:Object,required:!0}},setup(e){const i=e,a=ie().icon4k;return(r,l)=>"dot"===i.row.type?(t(),s("div",me," （不支持） ")):(t(),s("div",de,[(t(!0),s(o,null,c(i.row.keigenns,(i,r)=>(t(),s("span",{key:r},[n("span",{class:"status",title:`${i.name}(${i.source})`,"data-duration":i.remainingDuration,"data-sourcePov":i.isPov},[n("img",{class:p(`statusIcon ${d(q)(i.performance[e.row.type])}`),src:d(D)(`/i/${i.fullIcon}${d(a)}.png`),alt:i.effect,loading:"lazy",onError:l[0]||(l[0]=(...e)=>d(H)&&d(H)(...e))},null,42,ue)],8,pe)]))),128)),n("span",null,m("damage done"===e.row.effect?"":d(re)(e.row.effect)),1)]))}}),fe=e({__name:"AmountDetails",props:{row:{type:Object,required:!0}},setup(e){const i=e;return(e,a)=>(t(),s("div",null,[n("span",null,"来源:"+m(i.row.source),1),a[1]||(a[1]=n("br",null,null,-1)),n("span",null,"目标:"+m(i.row.target),1),a[2]||(a[2]=n("br",null,null,-1)),n("span",null," 护盾:"+m(Math.round(i.row.maxHp*+i.row.shield/100))+" ("+m(i.row.shield)+"%) ",1),a[3]||(a[3]=n("br",null,null,-1)),n("span",null," 血量:"+m(i.row.currentHp)+"/"+m(i.row.maxHp)+" ("+m(Math.round(i.row.currentHp/i.row.maxHp*100))+"%) ",1),a[4]||(a[4]=n("br",null,null,-1)),n("span",null,[a[0]||(a[0]=u("伤害:")),n("span",{class:p(i.row.type)},m(i.row.amount),3)]),a[5]||(a[5]=n("br",null,null,-1)),n("span",null," 剩余:"+m(i.row.currentHp-i.row.amount)+" ("+m(Math.round((i.row.currentHp-i.row.amount)/i.row.maxHp*100))+"%) ",1)]))}}),ge=[Number(409).toString(16).toUpperCase(),Number(810).toString(16).toUpperCase(),Number(811).toString(16).toUpperCase(),Number(1836).toString(16).toUpperCase()];function he(e){return e.currentHp-e.amount<0&&!e.keigenns.find(e=>ge.includes(e.effectId))}const be={class:"amount"},ve=e({__name:"Amount",props:{row:{type:Object,required:!0}},setup(e){const i=e;return(a,r)=>{const s=fe,l=O;return t(),y(l,{"append-to":".wrapper",effect:"dark",placement:"right-start",title:"",trigger:"hover",enterable:!1,"hide-after":0,"popper-class":"my-el-popover"},{reference:f(()=>[n("span",be,[n("span",{class:p(i.row.type)},[n("span",{class:p(""+(d(he)(e.row)?"lethal":""))},m(e.row.amount.toLocaleString().padStart(3,"　")),3)],2)])]),default:f(()=>[g(s,{row:e.row},null,8,["row"])]),_:1})}}}),ke={key:0,class:"target"},we=["src","alt","data-job"],Fe={key:1,class:"alt-text"},Ce=j(e({__name:"Target",props:{row:{type:Object,required:!0}},setup(e){const a=e,r=ie(),n=i(!1);function l(e){n.value=!0;e.target.style.display="none"}return(e,i)=>{return t(),s("div",null,[d(r).userOptions.showIcon?(t(),s("span",ke,[d(n)?(t(),s("span",Fe,m(a.row.job),1)):(t(),s("img",{key:0,class:p(`jobIcon cj${d(r).userOptions.iconType}`),src:(o=a.row.jobIcon,c=d(r).userOptions.iconType,`https://souma.diemoe.net/resources/img/cj${c}/${o.replace(/([A-Z])/g," $1").trim()}.png`),alt:a.row.jobIcon,"data-job":d(r).userOptions.showName?"":a.row.job,onError:l},null,42,we)),d(r).userOptions.showName?(t(),s("span",{key:2,class:p(`job ${a.row.jobIcon} ${a.row.targetId===a.row.povId?"YOU":""}`),style:b(!d(r).userOptions.abbrId&&d(r).userOptions.showName?{overflow:"hidden",textOverflow:"ellipsis"}:{})},m(a.row.targetId===a.row.povId&&d(r).userOptions.replaceWithYou?"YOU":d(r).userOptions.anonymous?a.row.job:d(r).formatterName(a.row.target)),7)):h("",!0)])):h("",!0)]);var o,c}}}),[["__scopeId","data-v-cc3d6ca7"]]),Ie="function"==typeof structuredClone?structuredClone:e=>{if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e.source,e.flags);if(Array.isArray(e))return e.map(e=>Ie(e));const i=new e.constructor;for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(i[a]=Ie(e[a]));return i},Ne={key:0},xe={class:"header-select"},je={key:0,class:"testLog"},$e="souma-keigenn-record-2",Ee=e({__name:"keigennRecord2",setup(e){S.setTheme("dark");const r=ie(),l=r.userOptions;r.checkIsBrowser();const m=v(()=>l.actionCN?"actionCN":"action"),u=i(l.minimize),j={line_height:28*l.scale,time:35*l.scale,action:65*l.scale,target:((l.showIcon?24:0)+(l.showName?l.anonymous||!l.anonymous&&l.abbrId?24:36:0)+7)*l.scale,amount:44*l.scale},$={"--vxe-font-size-mini":12*l.scale+"px","--vxe-ui-row-line-height":30*l.scale+"px","--vxe-ui-row-height-mini":30*l.scale+"px","--vxe-input-height-mini":20*l.scale+"px","--vxe-select-option-height-mini":24*l.scale+"px","--vxe-ui-layout-background-color":`rgba(12, 12, 12, ${l.opacity})`},A=99,H=i(!1),D=i(),O=_("keigenn-record-2-pov-name",""),R=_("keigenn-record-2-pov-id",""),G=_("keigenn-record-2-party-list",[]),U=_("keigenn-record-2-job-map",{}),Z=_("keigenn-record-2-party-event-party",[]),V=i(0),Y=i([{zoneName:"",duration:"00:00",table:[],key:"init",timestamp:-1}]),q={rsv:/^262\|(?<timestamp>[^|]*)\|[^|]*\|[^|]*\|_rsv_(?<id>\d+)_[^|]+\|(?<real>[^|]*)\|/i,ability:W.ability(),statusEffectExplicit:W.statusEffectExplicit(),gainsEffect:W.gainsEffect(),losesEffect:W.losesEffect(),inCombat:/^260\|(?<timestamp>[^|]*)\|(?<inACTCombat>[^|]*)\|(?<inGameCombat>[^|]*)\|/,changeZone:W.changeZone(),partyList:/^11\|(?<timestamp>[^|]*)\|(?<partyCount>\d*)\|(?<list>(?:\w{8}\|)*)\w{16}/,primaryPlayer:/^02\|(?<timestamp>[^|]*)\|(?<id>[^|]*)\|(?<name>[^|]*)/,addCombatant:W.addedCombatant(),removingCombatant:W.removingCombatant(),networkDoT:W.networkDoT()},K=i(0),ee=_("souma-keigenn-record-2-zone-name",""),ae=_("souma-keigenn-record-2-rsv-data",{}),te={},ne={friendly:{},enemy:{}};function le(){var e;H.value=!0,K.value=0,V.value=0,Y.value.length=1,(e=Y.value[0]).table.length=0,e.zoneName="",e.duration="00:00",e.key="init"}function oe(){fe(),H.value=!1}function me(e){for(const i in q){const a=q[i].exec(e);if(a){const s=e.split("|");switch(i){case"statusEffectExplicit":a.groups?.targetId.startsWith("1")&&(te[a.groups?.targetId]=a.groups?.currentShield);break;case"gainsEffect":{const e=s[P.GainsEffect.fields.effectId],i=s[P.GainsEffect.fields.effect],a=s[P.GainsEffect.fields.target],r=s[P.GainsEffect.fields.targetId],t=Number.parseInt(s[P.GainsEffect.fields.count],16);let n=J(e);if(!n){const i=r.startsWith("1")&&X.get(Number.parseInt(e,16).toString())||r.startsWith("4")&&Q.get(Number.parseInt(e,16).toString());if(!i)return;const a=E(i.icon),s=t>1?T(a,t):a;n={type:"multiplier",performance:{physics:1,magic:1,darkness:1},id:Number.parseInt(e,16),fullIcon:s,name:i.name,isFriendly:i.isFriendly}}const l=s[P.GainsEffect.fields.duration],o=s[P.GainsEffect.fields.source],c=s[P.GainsEffect.fields.sourceId],m=new Date(s[P.GainsEffect.fields.timestamp]).getTime()+1e3*Number.parseFloat(l),d={name:n.name,count:t,effect:i,effectId:e,source:o,sourceId:c,target:a,targetId:r,expirationTimestamp:m,performance:n.performance,fullIcon:n.fullIcon,isPov:R.value===c};r.startsWith("1")&&n.isFriendly?(void 0===ne.friendly[r]&&(ne.friendly[r]={}),ne.friendly[r][e]=d):r.startsWith("4")&&!n.isFriendly&&(void 0===ne.enemy[a]&&(ne.enemy[a]={}),ne.enemy[a][e]=d)}break;case"losesEffect":{const e=s[P.LosesEffect.fields.target],i=s[P.LosesEffect.fields.targetId],a=s[P.LosesEffect.fields.effectId];i.startsWith("1")?ne.friendly[i]&&Reflect.deleteProperty(ne.friendly[i],a):ne.enemy[e]&&Reflect.deleteProperty(ne.enemy[e],a)}break;case"addCombatant":if("00"!==s[P.AddedCombatant.fields.job]){const e=s[P.AddedCombatant.fields.job],i=new Date(s[P.AddedCombatant.fields.timestamp]).getTime();U.value[s[P.AddedCombatant.fields.id]]={job:Number.parseInt(e,16),timestamp:i}}break;case"removingCombatant":Reflect.deleteProperty(U.value,s[P.RemovedCombatant.fields.id]);break;case"primaryPlayer":{R.value=s[P.ChangedPlayer.fields.id];const e=s[P.ChangedPlayer.fields.name];if(O.value===e)return;O.value=e,r.initEnvironment(s[P.ChangedPlayer.fields.name]);break}case"partyList":G.value=a.groups?.list?.split("|")??[];break;case"changeZone":ee.value=s[P.ChangeZone.fields.name],ue(new Date(s[P.ChangeZone.fields.timestamp]).getTime());break;case"inCombat":{const e="1"===s[P.InCombat.fields.inACTCombat],i="1"===s[P.InCombat.fields.inGameCombat],a=new Date(s[P.InCombat.fields.timestamp]).getTime();if(e||i){if(K.value>0)return;return"placeholder"===Y.value[0].key&&Y.value.splice(0,1),0!==Y.value[0].table.length&&(Y.value[0]=x(Y.value[0]),Y.value.unshift({zoneName:"",duration:"00:00",table:[],key:s[P.InCombat.fields.timestamp],timestamp:a}),Y.value.length>=A&&Y.value.splice(Y.value.length-1,1)),K.value=a,Y.value[0].zoneName=ee.value,void(V.value=0)}if(!e&&!i)return void ue(a)}break;case"rsv":{const e=Number(a.groups?.id),i=s[P.RSVData.fields.value];e&&i&&(ae.value[Number(e)]=i)}break;case"networkDoT":if(!l.parseDoT)return;{const e=s[P.NetworkDoT.fields.which],i=s[P.NetworkDoT.fields.id];if("DoT"!==e||i.startsWith("4")||i!==R.value&&!G.value.includes(i)&&!Z.value.find(e=>e.id===i))return;const a=s[P.NetworkDoT.fields.name],r=s[P.NetworkDoT.fields.damage],t=Number.parseInt(r,16),n=new Date(s[P.Ability.fields.timestamp]??"???").getTime(),l=Number(s[P.NetworkDoT.fields.currentHp]),o=Number(s[P.NetworkDoT.fields.maxHp]),c=ge(0===K.value?0:n-K.value),m=de(i),d=z.nameToFullName(z.jobEnumToJob(m)).simple2,p=m,u=z.jobEnumToIcon(p);pe({time:c,id:void 0,action:e,actionCN:e,source:"",target:a,targetId:i,job:d,jobIcon:u,jobEnum:p,amount:t,keigenns:[],currentHp:l,maxHp:o,effect:"damage done",type:"dot",shield:te[i],povId:R.value})}break;case"ability":if(0===K.value)return;{const e=ce(s);if(e.isAttack&&e.amount>=0){const i=s[P.Ability.fields.sourceId]??"???",r=s[P.Ability.fields.targetId]??"???";if(!i.startsWith("4")||!r.startsWith("1"))return;if(r!==R.value&&!G.value.includes(r)&&!Z.value.find(e=>e.id===r))return;const t=new Date(s[P.Ability.fields.timestamp]??"???").getTime(),n=s[P.Ability.fields.ability],o=n.match(/^_rsv_(?<id>\d+)_/),c=s[P.Ability.fields.id]??"???";let m=n;if(o){const e=Number(o.groups?.id);m=ae.value[e]??n.match(/^_(?<id>rsv_\d+)_/)?.groups?.id}else if(m=m.replace(/unknown_.*/,"攻击"),!1===l.parseAA&&/^攻击|攻撃|[Aa]ttack$/.test(m))return;const d=L(Number.parseInt(c,16)),p=d&&""!==d?d:m,u=Number(s[P.Ability.fields.targetCurrentHp])??"???",y=Number(s[P.Ability.fields.targetMaxHp])??"???",f=s[P.Ability.fields.source]??"???",g=s[P.Ability.fields.target]??"???",{effect:h,type:b}=se(e.flags),v=ge(0===K.value?0:t-K.value),k=de(r),w=z.nameToFullName(z.jobEnumToJob(k)).simple2,F=k,C=z.jobEnumToIcon(F),I=Ie(Object.values(ne.friendly[r]??[]).concat(Object.values(ne.enemy[f]??[])).filter(e=>{const i=Math.max(0,(e.expirationTimestamp-t)/1e3);return e.remainingDuration=i>=999?"":i.toFixed(i>.05&&i<.95?1:0),Number(e.remainingDuration)>-3}));pe({time:v,id:c,action:m,actionCN:p,source:f,target:g,targetId:r,job:w,jobIcon:C,jobEnum:F,amount:e.amount,keigenns:I,currentHp:u,maxHp:y,effect:h,type:b,shield:te[a.groups?.targetId??""],povId:R.value}),Y.value[0].duration=ge(new Date(s[P.Ability.fields.timestamp]).getTime()-K.value)}break}}}}}function de(e){return[U.value[e],Z.value.find(i=>i.id===e)??{job:0,timestamp:0}].sort((e,i)=>i.timestamp-e.timestamp)[0].job}function pe(e){Y.value[0].table.unshift(e)}function ue(e){0!==K.value&&(Y.value[0].duration=ge(e-K.value),K.value=0,ne.friendly={},ne.enemy={},fe())}function fe(){localStorage.setItem($e,JSON.stringify(Y.value.filter(e=>"placeholder"!==e.key&&"00:00"!==e.duration&&e.timestamp>0).slice().sort((e,i)=>i.timestamp-e.timestamp).slice(0,A)))}function ge(e){const i=Math.max(Math.floor(e/6e4),0),a=Math.max(Math.floor((e-6e4*i)/1e3),0);return`${i<10?"0":""}${i}:${a<10?"0":""}${a}`}const he=v(()=>{const e=new Set(Y.value[V.value].table.map(e=>l.actionCN?e.actionCN:e.action));return Array.from(e).map(e=>({label:e,value:e}))}),be=v(()=>{const e={},i=new Set(Y.value[V.value].table.slice().sort((e,i)=>z.enumSortMethod(e.jobEnum,i.jobEnum)).map(i=>(e[i.target]=i.job,i.target)));return Array.from(i).map(i=>({label:`${e[i]}（${i}）`,value:i}))});function ke(e){const{actionCN:i,amount:a,job:r,keigenns:s,time:t,type:n}=e,o="damage done"===e.effect?"":`,${re(e.effect)}`,c=`${t} ${r} ${i} ${a.toLocaleString()}(${re(n)}) 减伤:${0===s.length&&""===o?"无":s.map(e=>l.statusCN?e.name:e.effect).join(",")+o} HP:${e.currentHp}/${e.maxHp}(${Math.round(e.currentHp/e.maxHp*100)}%)+盾:${Math.round(e.maxHp*+e.shield/100)}(${e.shield}%)`;var m;m=c,navigator.clipboard.writeText(m).catch(()=>{const e=document.createElement("input");e.value=m,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}),S.modal.close(),S.modal.message({content:"已复制到剪贴板",status:"success",duration:800})}r.isBrowser&&(O.value="测试用户"),""!==O.value&&r.initEnvironment(O.value),a(()=>{for(const e in U.value){const i=U.value[e];Date.now()-i.timestamp>864e5&&Reflect.deleteProperty(U.value,e)}!function(){const e=localStorage.getItem($e);if(e)try{const i=JSON.parse(e);Y.value.length=0,Y.value.push(...i)}catch(i){}}(),M("LogLine",e=>{me(e.rawLine)}),M("PartyChanged",e=>{Z.value=e.party.map(e=>({...e,timestamp:Date.now()}))}),M("ChangePrimaryPlayer",e=>{O.value=e.charName,R.value=Number(e.charID).toString(16).toUpperCase()})});const we=i({target:!1,action:!1}),Fe=i(),Ee=k({className:"my-menus",trigger:"cell",visibleMethod:({row:e})=>!!e,body:{options:[]}});function Te(){u.value=!u.value}w(()=>{Ee.body?.options&&D.value&&(Ee.body.options[0]=[{code:"clearFilterAction",name:"取消技能筛选",prefixIcon:"vxe-icon-funnel-clear",className:"my-clear-filter",visible:we.value.action,disabled:!1},{code:"filterSelectAction",name:Fe.value?.[m.value]?`只看 ${Fe.value?.[m.value]}`:"只看该技能",prefixIcon:"vxe-icon-info-circle",visible:!we.value.action,disabled:!1},{code:"clearFilterTarget",name:"取消玩家筛选",prefixIcon:"vxe-icon-funnel-clear",visible:we.value.target,disabled:!1},{code:"filterSelectTarget",name:Fe.value?.target?`只看 [${Fe.value.job}] ${Fe.value.target}`:"只看该玩家",prefixIcon:"vxe-icon-user-fill",visible:!we.value.target,disabled:!1}])});const Ae=({row:e})=>{e?ke(e):S.modal.message({content:"未选中有效数据行",status:"error"})},_e=({row:e})=>{const i=D.value;e&&i&&(i.setCurrentRow(e),Fe.value=e)},He=({menu:e,row:i})=>{const a=D.value;switch(e.code){case"clearFilterTarget":a&&(a.clearFilter(a.getColumnByField("target")),we.value.target=!1);break;case"clearFilterAction":a&&(a.clearFilter(a.getColumnByField(m.value)),we.value.action=!1);break;case"filterSelectTarget":if(a){const e=a.getColumnByField("target");if(e){const r=e.filters.find(e=>e.value===i.target);if(!r)return;r.checked=!0,a.updateData().then(()=>{a.scrollToRow(i),we.value.target=!0})}}break;case"filterSelectAction":if(a){const e=a.getColumnByField(m.value);if(e){const r=e.filters.find(e=>e.value===i[m.value]);if(!r)return;r.checked=!0,a.updateData().then(()=>{a.scrollToRow(i),we.value.action=!0})}}}};return(e,i)=>{const a=F("vxe-option"),m=F("vxe-select"),v=F("vxe-button"),k=F("vxe-column"),w=Ce,x=ve,E=ye,T=F("vxe-table"),A=B;return t(),s(o,null,[n("div",{class:p(["wrapper",d(r).isBrowser?"is-browser":"not-browser"]),style:$},[d(l).showHeader?(t(),s("header",Ne,[n("div",xe,[C(g(m,{modelValue:d(V),"onUpdate:modelValue":i[0]||(i[0]=e=>N(V)?V.value=e:null),size:"mini",class:"combat-select","popup-class-name":"combat-select-popup"},{default:f(()=>[(t(!0),s(o,null,c(d(Y).length,e=>(t(),y(a,{key:`${d(Y)[e-1].key}-${d(Y)[e-1].duration}-${d(Y)[e-1].zoneName}`,value:e-1,label:`${d(Y)[e-1].duration} ${d(Y)[e-1].zoneName}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),[[I,!d(u)]])]),g(v,{class:p(["minimize",d(u)?"in-minimize":"not-minimize"]),icon:d(u)?"vxe-icon-fullscreen":"vxe-icon-minimize",style:b({opacity:d(u)?.5:1}),onClick:Te},null,8,["class","icon","style"])])):h("",!0),C(n("main",null,[g(T,{ref_key:"xTable",ref:D,size:"mini",class:"vxe-table","show-overflow":"tooltip",round:"",height:"100%","scroll-y":{enabled:!0},loading:d(H),"show-header":d(l).showHeader,data:d(Y)[d(V)].table,"row-config":{isHover:!0},"cell-config":{height:j.line_height},"header-cell-style":{padding:"0px",top:"-0.5em"},"menu-config":d(Ee),onCellClick:Ae,onCellMenu:_e,onMenuClick:He},{default:f(()=>[g(k,{width:j.time,field:"time",title:"时间",align:"center"},null,8,["width"]),g(k,{width:j.action,field:d(l).actionCN?"actionCN":"action",title:"技能",filters:d(he),"filter-multiple":!1,resizable:!0,align:"center"},null,8,["width","field","filters"]),g(k,{width:j.target,field:"target",title:"标",filters:d(be),"filter-multiple":!1,resizable:!d(l).anonymous&&!d(l).abbrId,align:"left","header-align":"center","header-class-name":d(l).showName?"target-name-column-full":"target-name-column-abbr"},{default:f(({row:e})=>[g(w,{row:e},null,8,["row"])]),_:1},8,["width","filters","resizable","header-class-name"]),g(k,{width:j.amount,title:"伤害","header-align":"center"},{default:f(({row:e})=>[g(x,{row:e},null,8,["row"])]),_:1},8,["width"]),g(k,{title:"减伤",align:"left"},{default:f(({row:e})=>[g(E,{row:e},null,8,["row"])]),_:1})]),_:1},8,["loading","show-header","data","cell-config","menu-config"])],512),[[I,!d(u)]])],2),d(r).isBrowser?(t(),s("div",je,[g(A,{"m-1":"",onBeforeHandle:le,onAfterHandle:oe,onHandleLine:me})])):h("",!0)],64)}}});export{Ee as default};
