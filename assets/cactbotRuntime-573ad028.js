import{_ as e}from"./ActWrapper-e3037e7f.js";import{u as a,_ as t}from"./DragJob-15989787.js";import{d as r,r as o,o as n,g as s,j as l,n as i,f as u,i as p,e as m,B as c,u as d,$ as y,t as f,F as j,k as v,q as b}from"./index-fc245f0d.js";/* empty css               */import{b as g,E as h}from"./el-select-d7ba95f8.js";import"./el-scrollbar-3a2220aa.js";import"./el-popper-6ae04a38.js";import{E as k}from"./el-overlay-af081999.js";import{u as x,e as P,a as _}from"./index-d45555b3.js";import{u as w}from"./useDev-205d3359.js";import{U as C}from"./util-3591e9ca.js";import{a as E,c as J}from"./overlay_plugin_api-974cdd44.js";/* empty css                */import{_ as T}from"./_plugin-vue_export-helper-6a8c15be.js";import"./el-card-abfa9915.js";import"./useDemo-a422fbc1.js";import"./el-checkbox-3d15b13e.js";import"./index-728685c5.js";import"./use-form-common-props-69af7afb.js";import"./isEqual-f8669546.js";import"./index-e320aa47.js";import"./index-21674c79.js";import"./index-e4b4d817.js";import"./focus-trap-748c0e67.js";import"./scroll-a394cdc9.js";import"./vnode-b4be41fe.js";import"./index-68ac2f19.js";import"./index-825690c9.js";const D={class:"cactbot-runtime"},U={key:0,class:"you"},V={key:1,class:"players"},O={class:"job-name"},R={key:0,class:"player-name"},F={key:0,style:{position:"fixed",bottom:"0"}},L=T(r({__name:"cactbotRuntime",setup(r){const T=a(),L=o(!1);function N(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const S=o(!1),q=[{id:"10000001",name:"虚构暗骑",job:32,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构龙骑",job:22,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0},{id:"10000007",name:"虚构画家",job:42,inParty:!0}],z=x("cactbotRuntime-data",{party:[]}),A=x("cactbotRuntime-showTips",o(!0)),G=x("cactbotRuntime-roleSelectLength",{tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0}),M={tank:["MT","ST",...N("T",6,2)],healer:[...N("H",8)],dps:[...N("D",8)],crafter:[...N("C",8)],gatherer:[...N("G",8)],none:[...N("N",8)]};function B(e){const a=H(e);return M[a].filter((e,t)=>t<G.value[a])}const I=w(),K=o(I.value?q[2].name:"");function H(e){return[1,3,19,21,32,37].includes(e)?"tank":[6,24,28,33,40].includes(e)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39,41,42].includes(e)?"dps":C.isCraftingJob(C.jobEnumToJob(e))?"crafter":C.isGatheringJob(C.jobEnumToJob(e))?"gatherer":"none"}function W(e){return M[H(e.job)].find(e=>!z.value.party.find(a=>a.rp===e))??"unknown"}function $(){const e=[...M.tank,...M.healer,...M.dps,...M.crafter,...M.gatherer,...M.none];z.value.party.sort((a,t)=>e.indexOf(a.rp??"unknown")-e.indexOf(t.rp??"unknown")),J({call:"broadcast",source:"soumaRuntimeJS",msg:{party:z.value.party}})}function Q(){!function(){z.value.party.sort((e,a)=>T.arr.indexOf(e.job)-T.arr.indexOf(a.job));for(const e of z.value.party)e.rp=void 0;for(const e of z.value.party)e.rp=W(e)}(),function(){for(const e in G.value)Object.prototype.hasOwnProperty.call(G.value,e)&&(G.value[e]=z.value.party.reduce((a,t)=>H(t.job)===e?a+1:a,0))}(),$()}function X(){const e={party:q};A.value&&(S.value=!0),z.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),Q()}return n(()=>{const e=P({storageKey:"cactbot-runtime-theme"}),a=_(e);!1===e.value&&a(),document.body.addEventListener("mouseenter",()=>L.value=!0),document.body.addEventListener("mouseleave",()=>L.value=!1),$(),E("PartyChanged",e=>{A.value&&(S.value=!0),I.value&&0===e.party.length||(z.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),Q())}),E("ChangePrimaryPlayer",e=>{I.value||(K.value=e.charName)}),E("BroadcastMessage",e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&$()})}),(a,r)=>{const o=k,n=g,x=h,P=t,_=e;return i(),s(_,null,{default:l(()=>[u("div",D,[p(o,{modelValue:d(S),"onUpdate:modelValue":r[0]||(r[0]=e=>y(S)?S.value=e:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:r[1]||(r[1]=e=>{S.value=!1,A.value=!1})},{header:l(()=>r[3]||(r[3]=[u("span",null,"用法",-1)])),default:l(()=>r[4]||(r[4]=[u("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1),u("ul",null,[u("li",null,"临时：下拉选择框修改。"),u("li",null,"长期：用鼠标拖动职能顺序。")],-1)])),_:1},8,["modelValue"]),u("main",null,[d(L)?(i(),m("div",V,[(i(!0),m(j,null,v(d(z).party,(e,a)=>{return i(),m("section",{key:e.id,class:b(["player",{"is-you":e.name===d(K)}])},[p(x,{modelValue:e.rp,"onUpdate:modelValue":a=>e.rp=a,size:"small",class:"select","fit-input-width":"",placement:"right",offset:8,onChange:e=>function(e){const a=z.value.party.find(a=>a.rp===z.value.party[e].rp&&a.id!==z.value.party[e].id);a&&(a.rp=W(a)),$()}(a)},{default:l(()=>[(i(!0),m(j,null,v(B(e.job),(e,a)=>(i(),s(n,{key:a,value:e,label:e},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),u("span",O,f((t=e.job,C.jobToFullName(C.jobEnumToJob(t)).simple1)),1),d(L)?(i(),m("span",R,f(e.name),1)):c("",!0)],2);var t}),128)),d(L)?(i(),s(P,{key:0,class:"drag-job",party:d(z).party,"p-1":"",onUpdate:Q},null,8,["party"])):c("",!0)])):(i(),m("div",U,f(d(z).party.find(e=>e.name===d(K))?.rp??""),1))]),d(I)?(i(),m("div",F,[u("button",{onClick:r[2]||(r[2]=e=>{d(z).party=d(z).party.filter(e=>e.name===d(K)),Q()})}," 测试单人 "),u("button",{onClick:X}," 测试组队 ")])):c("",!0)])]),_:1})}}}),[["__scopeId","data-v-eb522f4e"]]);export{L as default};
