import{_ as e}from"./ActWrapper-f9723ce8.js";import{_ as a}from"./DragJob-7ef47683.js";import"./index-4d3eeda3.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                   */import{u as t,e as n,a as r}from"./index-9c6472dd.js";import{u as o}from"./useDevMode-55881ae6.js";import{U as l}from"./util-c5e2dd68.js";import{a as s,c as u}from"./overlay_plugin_api-974cdd44.js";/* empty css                */import{L as i,q as p,n as m}from"./element-plus-3b00acc6.js";import{t as c,r as d,e as y,D as f,E as v,x as b,A as j,M as h,v as g,H as k,u as P,h as _,K as x,L as w,aa as C,G as J}from"./vue-vendor-37eb8ba2.js";import{_ as R}from"./_plugin-vue_export-helper-6a8c15be.js";/* empty css                *//* empty css                    */const T={class:"cactbot-runtime"},V={key:0,class:"you"},D={key:1,class:"players"},E={class:"job-name"},O={key:0,class:"player-name"},S={key:0,style:{position:"fixed",bottom:"0"}},U=R(c({__name:"cactbotRuntime",setup(c){const R=d(!1);function U(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const A=d(!1),L=t("cactbotRuntime-sortArr",[]),G=[{id:"10000001",name:"虚构暗骑",job:32,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构龙骑",job:22,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0},{id:"10000007",name:"虚构画家",job:42,inParty:!0}],M=t("cactbotRuntime-data",{party:[]}),K=t("cactbotRuntime-showTips",d(!0)),N=t("cactbotRuntime-roleSelectLength",{tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0}),q={tank:["MT","ST",...U("T",6,2)],healer:[...U("H",8)],dps:[...U("D",8)],crafter:[...U("C",8)],gatherer:[...U("G",8)],none:[...U("N",8)]};function z(e){const a=B(e);return q[a].filter((e,t)=>t<N.value[a])}const F=o(),H=d(F.value?G[2].name:"");function B(e){return[1,3,19,21,32,37].includes(e)?"tank":[6,24,28,33,40].includes(e)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39,41,42].includes(e)?"dps":l.isCraftingJob(l.jobEnumToJob(e))?"crafter":l.isGatheringJob(l.jobEnumToJob(e))?"gatherer":"none"}function I(e){return q[B(e.job)].find(e=>!M.value.party.find(a=>a.rp===e))??"unknown"}function W(){const e=[...q.tank,...q.healer,...q.dps,...q.crafter,...q.gatherer,...q.none];M.value.party.sort((a,t)=>e.indexOf(a.rp??"unknown")-e.indexOf(t.rp??"unknown")),u({call:"broadcast",source:"soumaRuntimeJS",msg:{party:M.value.party}})}function Q(e){L.value=e,X()}function X(){!function(){M.value.party.sort((e,a)=>L.value.indexOf(e.job)-L.value.indexOf(a.job));for(const e of M.value.party)e.rp=void 0;for(const e of M.value.party)e.rp=I(e)}(),function(){for(const e in N.value)Object.prototype.hasOwnProperty.call(N.value,e)&&(N.value[e]=M.value.party.reduce((a,t)=>B(t.job)===e?a+1:a,0))}(),W()}function Y(){const e={party:G};K.value&&(A.value=!0),M.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),X()}return y(()=>{const e=n({storageKey:"cactbot-runtime-theme"}),a=r(e);!1===e.value&&a(),document.body.addEventListener("mouseenter",()=>R.value=!0),document.body.addEventListener("mouseleave",()=>R.value=!1),W(),s("PartyChanged",e=>{K.value&&(A.value=!0),F.value&&0===e.party.length||(M.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),X())}),s("ChangePrimaryPlayer",e=>{F.value||(H.value=e.charName)}),s("BroadcastMessage",e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&W()})}),(t,n)=>{const r=i,o=p,s=m,u=a,c=e;return b(),f(c,null,{default:v(()=>[j("div",T,[h(r,{modelValue:P(A),"onUpdate:modelValue":n[0]||(n[0]=e=>_(A)?A.value=e:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:n[1]||(n[1]=e=>{A.value=!1,K.value=!1})},{header:v(()=>n[3]||(n[3]=[j("span",null,"用法",-1)])),default:v(()=>n[4]||(n[4]=[j("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1),j("ul",null,[j("li",null,"临时：下拉选择框修改。"),j("li",null,"长期：用鼠标拖动职能顺序。")],-1)])),_:1},8,["modelValue"]),j("main",null,[P(R)?(b(),g("div",D,[(b(!0),g(w,null,C(P(M).party,(e,a)=>{return b(),g("section",{key:e.id,class:J(["player",{"is-you":e.name===P(H)}])},[h(s,{modelValue:e.rp,"onUpdate:modelValue":a=>e.rp=a,size:"small",class:"select","fit-input-width":"",placement:"right",offset:8,onChange:e=>function(e){const a=M.value.party.find(a=>a.rp===M.value.party[e].rp&&a.id!==M.value.party[e].id);a&&(a.rp=I(a)),W()}(a)},{default:v(()=>[(b(!0),g(w,null,C(z(e.job),(e,a)=>(b(),f(o,{key:a,value:e,label:e},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),j("span",E,x((t=e.job,l.nameToFullName(l.jobEnumToJob(t)).simple1)),1),P(R)?(b(),g("span",O,x(e.name),1)):k("",!0)],2);var t}),128)),P(R)?(b(),f(u,{key:0,class:"drag-job",party:P(M).party,"p-1":"",onUpdateSortArr:Q},null,8,["party"])):k("",!0)])):(b(),g("div",V,x(P(M).party.find(e=>e.name===P(H))?.rp??""),1))]),P(F)?(b(),g("div",S,[j("button",{onClick:n[2]||(n[2]=e=>{P(M).party=P(M).party.filter(e=>e.name===P(H)),X()})}," 测试单人 "),j("button",{onClick:Y}," 测试组队 ")])):k("",!0)])]),_:1})}}}),[["__scopeId","data-v-b16ef71f"]]);export{U as default};
