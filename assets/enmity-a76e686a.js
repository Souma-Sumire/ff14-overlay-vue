import{_ as e}from"./ActWrapper-6c4cf913.js";import{t,r as n,e as a,P as o,D as r,E as i,x as s,F as m,O as u,u as l,A as c}from"./vue-vendor-6f37fd53.js";import{t as d}from"./tts-5e313398.js";import{U as p}from"./util-3591e9ca.js";import{N as f}from"./netregexes-ed180b06.js";import{a as w,r as b,c as v}from"./overlay_plugin_api-974cdd44.js";import{d as g}from"./index-c9f4301b.js";import{_ as h}from"./_plugin-vue_export-helper-6a8c15be.js";import"./index-5bc95ff7.js";import"./element-plus-cb4c922a.js";/* empty css                */import"./useDev-cab88d81.js";import"./useDemo-dea69d31.js";import"./regexes-da03e94d.js";const j=h(t({__name:"enmity",setup(t){let h=0;const j=n([]),T=g("hash"),y=n(!1),C=[p.iconToJobEnum("Paladin"),p.iconToJobEnum("Warrior"),p.iconToJobEnum("DarkKnight"),p.iconToJobEnum("Gunbreaker")],I=[2843,3124,743,1833];let P,_;const L={countdown:f.countdown(),countdownCancel:f.countdownCancel(),wipe:f.network6d({command:["40000010","4000000F"]}),inCombat:f.inCombat()};async function k(){const e=(await v({call:"getCombatants"})).combatants.filter(e=>j.value.some(t=>Number.parseInt(t.id,16)===e.ID&&t.inParty)),t=e.find(e=>e.ID===h)?.Job;if(void 0===t)return D(),y.value=!1,Promise.reject(new Error("未找到玩家职业"));if(!C.includes(t))return D(),y.value=!1,Promise.reject(new Error("玩家不是坦克职业"));return{enmityTanks:e.filter(e=>e.Effects.some(e=>I.includes(e.BuffID))),partyCombatState:e}}function x(){D(),P=window.setInterval(()=>{k().then(({enmityTanks:e})=>{0!==e.length?y.value=!1:y.value=!0}).catch(()=>{y.value=!1})},500)}function D(){_&&clearTimeout(_),P&&clearInterval(P)}const E=e=>{const t=L.countdown.exec(e.rawLine)?.groups?.countdownTime;if(void 0!==t)x(),_=window.setTimeout(()=>{k().then(({enmityTanks:e})=>{2===e.length&&d("双T都开盾了"),0===e.length&&d("没人开盾")}).catch(()=>{y.value=!1})},1e3*(Number.parseInt(t)-10));else if(L.countdownCancel.test(e.rawLine))D(),y.value=!1;else if(L.wipe.test(e.rawLine))D(),y.value=!1;else if(L.inCombat.test(e.rawLine)){if("false"===T.stRemind)return;const{inACTCombat:t,inGameCombat:n}=L.inCombat.exec(e.rawLine).groups||{};"1"===t&&"1"===n&&(x(),_=window.setTimeout(()=>{k().then(({enmityTanks:e,partyCombatState:t})=>{2===t.filter(e=>p.isTankJob(p.jobEnumToJob(e.Job))).length&&1===e.length&&e[0]?.ID!==h&&d("ST开盾")}).catch(()=>{y.value=!1})},2e4))}},J=e=>{j.value=e.party},A=e=>{h=e.charID};return a(()=>{w("LogLine",E),w("PartyChanged",J),w("ChangePrimaryPlayer",A)}),o(()=>{P&&clearInterval(P),_&&clearTimeout(_),b("LogLine",E),b("PartyChanged",J),b("ChangePrimaryPlayer",A)}),(t,n)=>{const a=e;return s(),r(a,null,{default:i(()=>[m(c("strong",null,"没人开盾",512),[[u,l(y)]])]),_:1})}}}),[["__scopeId","data-v-55dd9f0d"]]);export{j as default};
