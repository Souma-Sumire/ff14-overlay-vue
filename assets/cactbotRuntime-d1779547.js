import{_ as a}from"./ActWrapper-693a4c4c.js";import{_ as e}from"./DragJob-c32c0722.js";import{t,r as n,f as o,ae as r,D as l,x as s,E as u,A as i,F as p,M as m,v as c,H as d,O as f,u as y,h as v,S as b,ab as j,L as h,a9 as g,K as _}from"./vue-vendor-3ae2ccec.js";import{V as x}from"./index-59b8e199.js";import"./style-1f970b29.js";import{u as k}from"./useDevMode-8c677e90.js";import{U as w}from"./util-c5e2dd68.js";import{a as P,c as C}from"./overlay_plugin_api-974cdd44.js";/* empty css                */import{u as T}from"./index-c6b82793.js";import{_ as J}from"./_plugin-vue_export-helper-6a8c15be.js";/* empty css                */import"./element-plus-1c4f27f5.js";const O={class:"text-white text-shadow-sm text-shadow-color-black"},V={class:"players"},D={class:"name"},R={key:0,style:{position:"fixed",bottom:"0"}},M=J(t({__name:"cactbotRuntime",setup(t){function J(a,e,t=0){return Array.from({length:e},()=>a).map((a,e)=>a+(+e+1+t))}x.setTheme("dark");const M=n(!1),S=T("cactbotRuntime-sortArr",[]),U=[{id:"10000001",name:"虚构暗骑",job:32,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构龙骑",job:22,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0},{id:"10000007",name:"虚构画家",job:42,inParty:!0}],A=T("cactbotRuntime-data",{party:[]}),E=T("cactbotRuntime-showTips",n(!0)),L=T("cactbotRuntime-roleSelectLength",{tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0}),F={tank:["MT","ST",...J("T",6,2)],healer:[...J("H",8)],dps:[...J("D",8)],crafter:[...J("C",8)],gatherer:[...J("G",8)],none:[...J("N",8)]};function G(a){const e=I(a);return F[e].filter((a,t)=>t<L.value[e])}const H=k(),N=n(!1),z=n(H?U[2].name:"");function I(a){return[1,3,19,21,32,37].includes(a)?"tank":[6,24,28,33,40].includes(a)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39,41,42].includes(a)?"dps":w.isCraftingJob(w.jobEnumToJob(a))?"crafter":w.isGatheringJob(w.jobEnumToJob(a))?"gatherer":"none"}function K(a){return F[I(a.job)].find(a=>!A.value.party.find(e=>e.rp===a))??"unknown"}function q(){const a=[...F.tank,...F.healer,...F.dps,...F.crafter,...F.gatherer,...F.none];A.value.party.sort((e,t)=>a.indexOf(e.rp??"unknown")-a.indexOf(t.rp??"unknown")),C({call:"broadcast",source:"soumaRuntimeJS",msg:{party:A.value.party}})}function B(){N.value=!0}function W(){N.value=!1}function Q(a){S.value=a,X()}function X(){!function(){A.value.party.sort((a,e)=>S.value.indexOf(a.job)-S.value.indexOf(e.job));for(const a of A.value.party)a.rp=void 0;for(const a of A.value.party)a.rp=K(a)}(),function(){for(const a in L.value)Object.prototype.hasOwnProperty.call(L.value,a)&&(L.value[a]=A.value.party.reduce((e,t)=>I(t.job)===a?e+1:e,0))}(),q()}function Y(){const a={party:U};E.value&&(M.value=!0),A.value.party=a.party.filter(a=>a.inParty).map(a=>({...a,rp:"unknown"})),X()}return o(()=>{q(),P("PartyChanged",a=>{E.value&&(M.value=!0),H&&0===a.party.length||(A.value.party=a.party.filter(a=>a.inParty).map(a=>({...a,rp:"unknown"})),X())}),P("ChangePrimaryPlayer",a=>{H||(z.value=a.charName)}),P("BroadcastMessage",a=>{"soumaUserJS"===a.source&&"object"==typeof a.msg&&null!==a.msg&&"requestData"===Reflect.get(a.msg,"text")&&q()})}),(t,n)=>{const o=r("vxe-modal"),x=r("vxe-option"),k=r("vxe-select"),P=e,C=a;return s(),l(C,null,{default:u(()=>[i("div",{onMouseenter:B,onMouseleave:W},[p(i("span",O,"...",512),[[f,y(A).party.length<=1]]),m(o,{modelValue:y(M),"onUpdate:modelValue":n[0]||(n[0]=a=>v(M)?M.value=a:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:n[1]||(n[1]=a=>{M.value=!1,E.value=!1})},{title:u(()=>n[3]||(n[3]=[i("span",null,"用法",-1)])),default:u(()=>n[4]||(n[4]=[i("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1),i("ul",null,[i("li",null,"临时：下拉选择框修改。"),i("li",null,"长期：用鼠标拖动职能顺序。")],-1)])),_:1},8,["modelValue"]),i("main",{style:b({width:y(N)?+(y(A).party.find(a=>36===a.job)?1:0)+18+"em":"4em"})},[i("div",V,[m(j,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:u(()=>[(s(!0),c(h,null,g(y(A).party,(a,e)=>{return p((s(),c("section",{key:a.id,flex:"~ nowrap",style:b({opacity:y(N)?1:.5}),class:"player"},[m(k,{modelValue:a.rp,"onUpdate:modelValue":e=>a.rp=e,size:"mini","class-name":"select",onChange:a=>function(a){const e=A.value.party.find(e=>e.rp===A.value.party[a].rp&&e.id!==A.value.party[a].id);e&&(e.rp=K(e)),q()}(e)},{default:u(()=>[(s(!0),c(h,null,g(G(a.job),(a,e)=>(s(),l(x,{key:e,value:a,label:a},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),i("span",D,_((t=a.job,w.nameToFullName(w.jobEnumToJob(t)).simple1))+" "+_(y(N)?a.name:""),1)],4)),[[f,y(A).party.length>1&&(y(N)||a.name===y(z))]]);var t}),128))]),_:1})]),p(m(P,{party:y(A).party,"m-b-1":"","p-1":"",onUpdateSortArr:Q},null,8,["party"]),[[f,y(N)]])],4),y(H)?(s(),c("div",R,[i("button",{onClick:n[2]||(n[2]=a=>{y(A).party=y(A).party.filter(a=>a.name===y(z)),X()})}," 测试单人 "),i("button",{onClick:Y}," 测试组队 ")])):d("",!0)],32)]),_:1})}}}),[["__scopeId","data-v-fb6031df"]]);export{M as default};
