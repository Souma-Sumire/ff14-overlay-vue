const e=new URLSearchParams(window.location.href.split("?")[1]).get("api"),t="cafemaker.wakingsands.com",n="xivapi.com",s=new Map,r={first:`https://${"xivapi"===e?.toLowerCase()?n:t}`,second:`https://${"xivapi"===e?.toLowerCase()?t:n}`},c="souma-action-cache",o=JSON.parse(localStorage.getItem(c)||"[]"),a=Date.now(),i=o.filter((e,t)=>e.expirationTime>=a&&t<1e3);localStorage.setItem(c,JSON.stringify(i));const p=/(\d{6})\/(\d{6})\.png$/;async function f(e,t,n=["ID","Icon","ActionCategoryTargetID"]){if(s.has(t))return s.get(t);const c=function(e,t,n){const s=`${r.first}/${e}/${t}?columns=${n.join(",")}`;return[s,s.replace(r.first,r.second)]}(e,t,n);try{const e=await async function(e,t){const n=Object.assign({cache:"force-cache"},t);for(const s of e){const e=await g(fetch(s,n),3e3);if(e.ok){return{...await e.json(),Host:new URL(s).host}}}throw new Error("All fetch attempts failed.")}(c,{mode:"cors"});return s.set(t,e),e}catch(o){return Promise.resolve({ActionCategoryTargetID:0,ID:t,Icon:"/i/000000/000405.png"})}}async function m(e,t=!1){return`${r.first}${e}`.replace(p,(e,n,s)=>`${n}/${t?"hq/":""}${s}.png`)}async function u(e){return m((await f("action",e,["Icon"])).Icon)}async function g(e,t){let n;const s=new Promise((e,s)=>{n=window.setTimeout(()=>{s(new Error("Promise timed out"))},t)});return Promise.race([e,s]).finally(()=>{clearTimeout(n)})}const w=new Map;function l(e){return w.has(e)?w.get(e):`${r.first}${e}`}function h(e){const t=e.target,n=t.src.match(new RegExp("(?<=\\.\\w+)\\/.+$"))?.[0];n&&""!==t.src&&(/pictomancer\.png$/.test(t.src)?t.src="//souma.diemoe.net/resources/img/pictomancer.png":/viper\.png$/.test(t.src)?t.src="//souma.diemoe.net/resources/img/viper.png":t.src.includes(r.first)?t.src=t.src.replace(r.first,r.second):t.src="",w.set(n,t.src))}export{m as a,u as b,s as c,l as g,h,f as p,r as s};
