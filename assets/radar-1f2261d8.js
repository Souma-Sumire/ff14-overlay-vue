import{_ as e}from"./ActWrapper-693a4c4c.js";import"./index-59b8e199.js";/* empty css                 */import{t as a,r as t,ay as l,c as n,f as i,P as o,D as s,x as r,E as u,A as v,H as c,F as d,u as f,v as h,K as m,S as p,O as g}from"./vue-vendor-3ae2ccec.js";import{u as y}from"./useZone-4e7bc539.js";import{N as w}from"./netregexes-ed180b06.js";import{a as P,r as b,c as x}from"./overlay_plugin_api-974cdd44.js";import{U as M}from"./element-plus-1c4f27f5.js";import{_ as T}from"./_plugin-vue_export-helper-6a8c15be.js";/* empty css                */import"./useDevMode-8c677e90.js";import"./index-c6b82793.js";import"./zoneInfo-40d5d60a.js";import"./zone_info-e69ac441.js";import"./content_type-e6dd7239.js";import"./regexes-da03e94d.js";const j={class:"radar-container"},k={class:"radar-wrapper"},_=["disabled"],S=["disabled"],I={class:"target-header"},L={class:"target-name"},C={class:"radar-canvas-container"},N=["width","height"],E=T(a({__name:"radar",setup(a){const T=t(""),E=t([]),W=t(0),z=t(""),H=t([]),A={echo:w.echo({line:"find\\s*(?<target>.+)"})},R=l("canvas");let U=null;const F=t(window.devicePixelRatio||1),O=t(Math.min(window.innerWidth,window.innerHeight)-80),$=n(()=>O.value/2-20),D=t("flex"===document.getElementById("unlocked")?.style?.display),{zoneType:K}=y(),X="#0f0",Y="#060",q="#0f0",B="#ff0",G="#f00",Z="#fff",J=18,Q=3,V=2,ee=6,ae="10px Arial",te=n(()=>O.value/2),le=n(()=>O.value/2);async function ne(){const e=await x({call:"getCombatants"});H.value=e.combatants??[]}async function ie(){await ne(),"Pvp"!==K.value&&T.value&&z.value?(!function(){if(!U)return;const e=E.value[W.value],a=H.value.find(e=>e.Name===z.value);if(!e)return U.clearRect(0,0,O.value,O.value),U.fillStyle="#fff",U.font="20px Arial",void U.fillText("找不到目标",te.value-100,le.value-50);if(!a)return;U.clearRect(0,0,O.value,O.value),U.strokeStyle=X,U.lineWidth=1,U.beginPath(),U.arc(te.value,le.value,$.value,0,2*Math.PI),U.stroke(),U.strokeStyle=Y,U.beginPath(),U.moveTo(te.value-$.value,le.value),U.lineTo(te.value+$.value,le.value),U.moveTo(te.value,le.value-$.value),U.lineTo(te.value,le.value+$.value),U.stroke();const t=e.PosX-a.PosX,l=e.PosY-a.PosY,n=Math.sqrt(t*t+l*l);let i=te.value+t/.1,o=le.value+l/.1;const s=Math.hypot(i-te.value,o-le.value);if(s>$.value){const e=$.value/s;i=te.value+(i-te.value)*e,o=le.value+(o-le.value)*e}U.strokeStyle=G,U.lineWidth=V,U.beginPath(),U.moveTo(te.value,le.value),U.lineTo(i,o),U.stroke(),U.fillStyle=B,U.beginPath(),U.arc(i,o,Q,0,2*Math.PI),U.fill();const r=-(a.Heading??0)+Math.PI;U.save(),U.translate(te.value,le.value),U.rotate(r),U.fillStyle=q;const u=J,v=u/3,c=-.2*u;U.beginPath(),U.moveTo(0,-u/2+c),U.lineTo(-v,u/2+c),U.lineTo(v,u/2+c),U.closePath(),U.fill(),U.restore();const d=Math.atan2(o-le.value,i-te.value);U.fillStyle=G,U.beginPath(),U.moveTo(i,o),U.lineTo(i-ee*Math.cos(d-Math.PI/6),o-ee*Math.sin(d-Math.PI/6)),U.lineTo(i-ee*Math.cos(d+Math.PI/6),o-ee*Math.sin(d+Math.PI/6)),U.closePath(),U.fill(),U.fillStyle=Z,U.font=ae,U.fillText(`${n.toFixed(1)}y`,i+5,o-5)}(),setTimeout(ie,100)):T.value=""}const oe=e=>{if("00"===e.line[0]){const a=A.echo.exec(e.rawLine);a?.groups?.target&&(T.value=a.groups.target,ne().then(()=>{!function(){if(!T.value)return E.value=[],void(W.value=0);const e=H.value.filter(e=>e.Name&&e.Name.includes(T.value));E.value=e,W.value=0}(),ie()}))}},se=e=>{z.value=e.charName};function re(){O.value=Math.min(window.innerWidth,window.innerHeight)-80,F.value=window.devicePixelRatio||1,U&&(U.setTransform(1,0,0,1,0,0),U.scale(F.value,F.value))}function ue(e){D.value=!1===e?.detail?.isLocked}return i(()=>{U=R.value?.getContext("2d")??null,U&&U.scale(F.value,F.value),P("LogLine",oe),P("ChangePrimaryPlayer",se),window.addEventListener("resize",re),document.addEventListener("onOverlayStateUpdate",ue)}),o(()=>{b("LogLine",oe),b("ChangePrimaryPlayer",se),window.removeEventListener("resize",re),document.removeEventListener("onOverlayStateUpdate",ue)}),(a,t)=>{const l=M,n=e;return r(),s(n,null,{default:u(()=>[v("div",j,[f(D)?(r(),s(l,{key:0,class:"el-alert-info",type:"info",closable:!1,"show-icon":"",title:"宏命令：/e find 目标名称",description:"名称允许部分匹配"})):c("",!0),d(v("div",k,[f(E).length>1?(r(),h("button",{key:0,class:"nav-arrow left-arrow",disabled:f(E).length<=1,"aria-label":"上一目标",onClick:t[0]||(t[0]=e=>W.value=(f(W)-1+f(E).length)%f(E).length)}," ← ",8,_)):c("",!0),f(E).length>1?(r(),h("button",{key:1,class:"nav-arrow right-arrow",disabled:f(E).length<=1,"aria-label":"下一目标",onClick:t[1]||(t[1]=e=>W.value=(f(W)+1)%f(E).length)}," → ",8,S)):c("",!0),v("div",I,[v("span",L,m(f(E)[f(W)]?.Name??""),1),v("button",{class:"cancel-btn",onClick:t[2]||(t[2]=e=>{T.value="",E.value=[]})}," 取消 ")]),v("div",C,[v("canvas",{ref_key:"canvas",ref:R,class:"radar-canvas",width:f(O)*f(F),height:f(O)*f(F),style:p({width:`${f(O)}px`,height:`${f(O)}px`})},null,12,N)])],512),[[g,f(T)]])])]),_:1})}}}),[["__scopeId","data-v-75c1c767"]]);export{E as default};
