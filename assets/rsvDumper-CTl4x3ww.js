import{d as e,aI as t,r as o,c as s,a as r,b as n,k as l,G as a,w as i,o as p,e as c,t as u,E as d}from"./index-BbxLgENd.js";/* empty css                   *//* empty css                        */import"./el-checkbox-D_es4kj1.js";/* empty css                   */import"./el-popper-j3St_hm6.js";import"./el-tag-CI0oDLjb.js";/* empty css                 *//* empty css                  *//* empty css                    */import{_ as m}from"./ThemeToggle-EFZ5OSBN.js";import{E as f}from"./index-DcHaUzti.js";import{E as _}from"./index-BRgx7k-4.js";import{E as h,a as x}from"./index-fiR-RG--.js";import{E as j}from"./index-CsJ8irs2.js";import{E as g}from"./index-BYq9Y1gw.js";import{_ as v}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-CnHgy-C_.js";import"./use-form-common-props-CetOw3Mu.js";import"./index-Cm81kAuR.js";import"./_baseClone-dr49TqTs.js";import"./index-yAWeK51J.js";import"./focus-trap-DBuCqDDh.js";import"./index-DmNaDCCu.js";import"./cloneDeep-rNpf0Bs-.js";import"./vnode-B_ym6lIN.js";import"./index-yJbKNz5T.js";const b={class:"min-h-screen p-6"},y={style:{position:"absolute",top:"2em",right:"2em"}},E={class:"overflow-auto rounded bg-black p-3 text-xs text-green-400"},C=v(e({__name:"rsvDumper",setup(e){t();const v={SE2DC5B04_EE2DC5B04:"Action",S64755250_E64755250:"BNpcName",S74CFC3B0_E74CFC3B0:"Status",S13095D61_E13095D61:"InstanceContentTextData",SF15185AF_EF15185AF:"LogMessage",SCFE39641_ECFE39641:"NpcYell"},C=o([]),D=o(!1),w=o("");const k=async e=>{const t=e.raw,o=(await t.text()).split(/\r?\n/),s=new Set;C.value=[];for(const r of o){const e=r.split("|");if("252"!==e[0])continue;const t=S(e.slice(3,-2));if(!$(t,(new TextEncoder).encode("_rsv_")))continue;const o=F(t.slice(30)),n=o.str1.replace(/^(rsv_\d+)_[^_]+_[^_]+_[^_]+_[^_]+_([^_]{9}_[^_]+)$/,"$1_$2");if(s.has(n))continue;s.add(n);const l=v[n.slice(-19)]||"Unknown",a=Number(n.match(/_rsv_(\d+)_/)?.[1]);C.value.push({type:l,id:a,...o})}};function S(e){const t=[];for(const o of e){const e=Number.parseInt(o,16)>>>0;t.push(255&e,e>>8&255,e>>16&255,e>>24&255)}return new Uint8Array(t)}function $(e,t){const o=e.length-t.length;for(let s=0;s<=o;s++){let o=!0;for(let r=0;r<t.length;r++)if(e[s+r]!==t[r]){o=!1;break}if(o)return!0}return!1}function F(e){return{str1:U(e.slice(2)),str2:U(e.slice(50)),hexDump:B(e)}}function U(e){const t=e.indexOf(0),o=-1!==t?e.slice(0,t):e;let s="";const r=new TextDecoder;let n=[],l=[];const a=()=>{n.length&&(s+=r.decode(Uint8Array.from(n)),n=[])},i=()=>{l.length&&(s+=`<hex:${l.map(e=>e.toString(16).padStart(2,"0")).join("").toUpperCase()}>`,l=[])};let p=0;for(;p<o.length;p++){const e=o[p];if(0!==e&&e>=32)break}const c=o.slice(p);for(const u of c)0===u||u<=31||127===u?(a(),l.push(u)):(i(),n.push(u));return a(),i(),s.replace(/(<hex:(00)+>)$/,"")}function B(e,t=16){let o=e.length;for(;o>0&&0===e[o-1];)o--;const s=e.slice(0,o),r="0123456789ABCDEF",n=[];for(let l=0;l<s.length;l+=t){let e="",o="";for(let n=0;n<t;n++)if(l+n<s.length){const t=s[l+n];e+=`${r[t>>4]}${r[15&t]} `,o+=t>=32&&t<127?String.fromCharCode(t):"."}else e+="   ",o+=" ";n.push(`${e} ${o}`)}return n.join("\n")}function R(){if(0===C.value.length)return void d.error("请先上传日志文件");const e={};C.value.forEach(({type:t,id:o,str2:s})=>{e[t]||(e[t]=[]),e[t].push(`${o} ${s}`)});let t="";for(const[n,l]of Object.entries(e))t+=`=== ${n} ===\n${l.join("\n")}\n\n`;const o=new Blob([t],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(o),r=document.createElement("a");r.href=s,r.download="rsv_results.txt",r.click(),URL.revokeObjectURL(s)}return(e,t)=>{const o=m,d=f,v=_,S=g,$=x,F=h,U=j;return p(),s("div",b,[t[4]||(t[4]=r("h1",{class:"mb-4 text-2xl font-bold"}," FFXIV RSV Dumper ",-1)),r("span",y,[n(o,{"storage-key":"rsv-dumper-theme"})]),n(d,{drag:"",action:"","auto-upload":!1,"show-file-list":!1,accept:".log,.txt",class:"upload-box",onChange:k},{default:i(()=>[...t[1]||(t[1]=[r("i",{class:"el-icon-upload"},null,-1),r("div",{class:"el-upload__text"},[c(" 拖拽日志文件到此处或 "),r("em",null,"点击上传")],-1)])]),_:1}),C.value.length?(p(),l(v,{key:0,type:"success",class:"mb-4",disabled:0===C.value.length,onClick:R},{default:i(()=>[...t[2]||(t[2]=[c(" 保存结果到文件 ",-1)])]),_:1},8,["disabled"])):a("",!0),C.value.length?(p(),l(F,{key:2,data:C.value,stripe:"",style:{width:"100%","margin-top":"20px"},border:""},{default:i(()=>[n($,{prop:"type",label:"Type"}),n($,{prop:"id",label:"ID"}),n($,{prop:"str1",label:"RSV Data 1",width:"400"}),n($,{prop:"str2",label:"RSV Data 2"}),n($,{label:"操作",width:"150"},{default:i(e=>[n(v,{size:"small",type:"primary",onClick:t=>{return o=e.row,w.value=o.hexDump,void(D.value=!0);var o}},{default:i(()=>[...t[3]||(t[3]=[c(" 查看 HexDump ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(p(),l(S,{key:1,description:"请上传 act.log 文件",class:"mt-6"})),n(U,{modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=e=>D.value=e),title:"HexDump 原始数据",width:"50%","append-to-body":!0},{default:i(()=>[r("pre",E,u(w.value),1)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-308d8d0c"]]);export{C as default};
