import{u as e}from"./index-c9f4301b.js";import{r as t,aC as n,V as o,c as r}from"./vue-vendor-6f37fd53.js";import{u as i}from"./useDemo-dea69d31.js";import{u as a}from"./useDev-cab88d81.js";import{U as s}from"./util-3591e9ca.js";import{g as l}from"./actionChinese-a1a2f77a.js";import{c as m}from"./chineseToIcon-e0fcd48d.js";import{c as d}from"./status-9bc9036c.js";import{t as c}from"./tts-5e313398.js";const y=new Map(Object.entries({16483:0,16484:16486,16485:16486,25779:16487,7496:16481,2874:0,2890:0,2872:16500,16003:16192,16191:16192,16004:16196,16193:16196,16194:16196,16195:16196,3551:25751,16464:25751,25752:7387,16510:16508,3581:16549,16494:3562,16499:16498,16527:7515,38:7389,7415:16502,92:16478,23287:23290,18324:18325,23272:23285,23280:23285,23273:23275,11426:11427,11428:11429,52:0,48:0,3629:0,3580:0,7429:0,7449:0,16516:0,3631:0,16142:0,28:0,2259:0,2261:0,2262:0,2263:0,3582:0,110:0,117:0,16161:25758,16144:16165,3641:3643,25755:0,16546:0,16548:0,802:0,8324:0,24307:24313,2246:0,24402:24401,24403:0,17206:0,24288:24302,24289:24313,17:36920,44:36923,3636:36927,16148:36935,2248:36957}).map(([e,t])=>[Number(e),t]));function u(e){return y.get(e)||e}function v(e,t){if("number"==typeof e)return e;const n=Number(e);if(!Number.isNaN(n))return n;try{if(!/^[\s\w=>()*+\-/.,:;<?@[\]^{}!]+$/.test(e))throw new Error("函数表达式中的字符无效");const n=new Function("level",`return (${e})(level)`)(t);if("number"!=typeof n||Number.isNaN(n))throw new TypeError(`Function returned non-number: ${n}`);return n}catch(o){return 0}}function U(e){"string"==typeof e&&(e=v(e,999));const t=l(e)||l(u(e));if(!t)return"";const n=m(t);return n?function(e){return`//cafemaker.wakingsands.com/i/${d(e)}_hr1.png`}(n):""}const b=[{key:crypto.randomUUID(),id:30,tts:"",duration:10,recast1000ms:420,job:[19],line:1,minLevel:50},{key:crypto.randomUUID(),id:43,tts:"",duration:10,recast1000ms:240,job:[3,21],line:1,minLevel:42},{key:crypto.randomUUID(),id:3638,tts:"",duration:10,recast1000ms:300,job:[32],line:1,minLevel:50},{key:crypto.randomUUID(),id:16152,tts:"",duration:10,recast1000ms:360,job:[37],line:1,minLevel:50},{key:crypto.randomUUID(),id:140,tts:"天赐",duration:0,recast1000ms:180,job:[24],line:1,minLevel:50},{key:crypto.randomUUID(),id:25862,tts:"礼仪之铃",duration:15,recast1000ms:180,job:[24],line:1,minLevel:90},{key:crypto.randomUUID(),id:25868,tts:"跑快快",duration:20,recast1000ms:120,job:[28],line:1,minLevel:90},{key:crypto.randomUUID(),id:25874,tts:"大宇宙",duration:15,recast1000ms:180,job:[33],line:1,minLevel:90},{key:crypto.randomUUID(),id:7549,tts:"牵制",duration:"(lv) => lv>=98 ? 15 : 10",recast1000ms:90,job:[2,4,20,22,30,34,39,41],line:2,minLevel:22},{key:crypto.randomUUID(),id:7560,tts:"昏乱",duration:"(lv) => lv>=98 ? 15 : 10",recast1000ms:90,job:[7,25,26,27,35,36,42],line:2,minLevel:8},{key:crypto.randomUUID(),id:7535,tts:"雪愁",duration:"(lv) => lv>=98 ? 15 : 10",recast1000ms:60,job:[1,3,19,21,32,37],line:2,minLevel:22},{key:crypto.randomUUID(),id:3540,tts:"幕帘",duration:30,recast1000ms:90,job:[19],line:2,minLevel:56},{key:crypto.randomUUID(),id:7385,tts:"大翅膀",duration:5,recast1000ms:120,job:[19],line:2,minLevel:70},{key:crypto.randomUUID(),id:7388,tts:"摆脱",duration:15,recast1000ms:90,job:[21],line:2,minLevel:68},{key:crypto.randomUUID(),id:16471,tts:"布道",duration:15,recast1000ms:90,job:[32],line:2,minLevel:66},{key:crypto.randomUUID(),id:16160,tts:"光心",duration:15,recast1000ms:90,job:[37],line:2,minLevel:64},{key:crypto.randomUUID(),id:16536,tts:"节制",duration:20,recast1000ms:120,job:[24],line:2,minLevel:80},{key:crypto.randomUUID(),id:7405,tts:"行吟",duration:15,recast1000ms:"(lv) => lv>=88 ? 90 : 120",job:[23],line:2,minLevel:62},{key:crypto.randomUUID(),id:16889,tts:"策动",duration:15,recast1000ms:"(lv) => lv>=88 ? 90 : 120",job:[31],line:2,minLevel:56},{key:crypto.randomUUID(),id:2887,tts:"武解",duration:10,recast1000ms:120,job:[31],line:2,minLevel:62},{key:crypto.randomUUID(),id:16012,tts:"桑巴",duration:15,recast1000ms:"(lv) => lv>=88 ? 90 : 120",job:[38],line:2,minLevel:56},{key:crypto.randomUUID(),id:25857,tts:"抗死",duration:10,recast1000ms:120,job:[35],line:2,minLevel:86},{key:crypto.randomUUID(),id:118,tts:"战歌",duration:20,recast1000ms:120,job:[5,23],line:3,minLevel:50},{key:crypto.randomUUID(),id:25785,tts:"光神曲",duration:20,recast1000ms:110,job:[5,23],line:3,minLevel:90},{key:crypto.randomUUID(),id:"(lv) => lv>=66 ? 36957 : 2248",tts:"背刺",duration:20,recast1000ms:120,job:[29,30],line:3,minLevel:15},{key:crypto.randomUUID(),id:24405,tts:"神秘环",duration:20,recast1000ms:120,job:[39],line:3,minLevel:72},{key:crypto.randomUUID(),id:3557,tts:"连祷",duration:20,recast1000ms:120,job:[4,22],line:3,minLevel:52},{key:crypto.randomUUID(),id:7396,tts:"义结金兰",duration:20,recast1000ms:120,job:[2,20],line:3,minLevel:70},{key:crypto.randomUUID(),id:25801,tts:"灼热之光",duration:20,recast1000ms:120,job:[27],line:3,minLevel:66},{key:crypto.randomUUID(),id:34675,tts:"星空构想",duration:20,recast1000ms:120,job:[42],line:3,minLevel:70},{key:crypto.randomUUID(),id:7436,tts:"连环计",duration:20,recast1000ms:120,job:[28],line:3,minLevel:66},{key:crypto.randomUUID(),id:7520,tts:"鼓励",duration:20,recast1000ms:120,job:[35],line:3,minLevel:58},{key:crypto.randomUUID(),id:16196,tts:"技巧舞",duration:20,recast1000ms:120,job:[38],line:3,minLevel:70},{key:crypto.randomUUID(),id:16011,tts:"探戈",duration:20,recast1000ms:120,job:[38],line:3,minLevel:62},{key:crypto.randomUUID(),id:16552,tts:"占卜",duration:20,recast1000ms:120,job:[33],line:3,minLevel:50}],j=[{key:crypto.randomUUID(),id:30,tts:"",duration:10,recast1000ms:420,job:[19],line:1,minLevel:50},{key:crypto.randomUUID(),id:43,tts:"",duration:10,recast1000ms:240,job:[3,21],line:1,minLevel:42},{key:crypto.randomUUID(),id:3638,tts:"",duration:10,recast1000ms:300,job:[32],line:1,minLevel:50},{key:crypto.randomUUID(),id:16152,tts:"",duration:10,recast1000ms:360,job:[37],line:1,minLevel:50},{key:crypto.randomUUID(),id:140,tts:"天赐",duration:0,recast1000ms:180,job:[24],line:1,minLevel:50},{key:crypto.randomUUID(),id:25862,tts:"礼仪之铃",duration:15,recast1000ms:180,job:[24],line:1,minLevel:90},{key:crypto.randomUUID(),id:25868,tts:"跑快快",duration:20,recast1000ms:120,job:[28],line:1,minLevel:90},{key:crypto.randomUUID(),id:25874,tts:"大宇宙",duration:15,recast1000ms:180,job:[33],line:1,minLevel:90},{key:crypto.randomUUID(),id:7549,tts:"牵制",duration:"(lv) => lv>=98 ? 15 : 10",recast1000ms:90,job:[2,4,20,22,30,34,39,41],line:2,minLevel:22},{key:crypto.randomUUID(),id:7560,tts:"昏乱",duration:"(lv) => lv>=98 ? 15 : 10",recast1000ms:90,job:[7,25,26,27,35,36,42],line:2,minLevel:8},{key:crypto.randomUUID(),id:7535,tts:"雪愁",duration:"(lv) => lv>=98 ? 15 : 10",recast1000ms:60,job:[1,3,19,21,32,37],line:2,minLevel:22},{key:crypto.randomUUID(),id:3540,tts:"幕帘",duration:30,recast1000ms:90,job:[19],line:2,minLevel:56},{key:crypto.randomUUID(),id:7385,tts:"大翅膀",duration:5,recast1000ms:120,job:[19],line:2,minLevel:70},{key:crypto.randomUUID(),id:7388,tts:"摆脱",duration:15,recast1000ms:90,job:[21],line:2,minLevel:68},{key:crypto.randomUUID(),id:16471,tts:"布道",duration:15,recast1000ms:90,job:[32],line:2,minLevel:66},{key:crypto.randomUUID(),id:16160,tts:"光心",duration:15,recast1000ms:90,job:[37],line:2,minLevel:64},{key:crypto.randomUUID(),id:16536,tts:"节制",duration:20,recast1000ms:120,job:[24],line:2,minLevel:80},{key:crypto.randomUUID(),id:7405,tts:"行吟",duration:15,recast1000ms:"(lv) => lv>=88 ? 90 : 120",job:[23],line:2,minLevel:62},{key:crypto.randomUUID(),id:16889,tts:"策动",duration:15,recast1000ms:"(lv) => lv>=88 ? 90 : 120",job:[31],line:2,minLevel:56},{key:crypto.randomUUID(),id:2887,tts:"武解",duration:10,recast1000ms:120,job:[31],line:2,minLevel:62},{key:crypto.randomUUID(),id:16012,tts:"桑巴",duration:15,recast1000ms:"(lv) => lv>=88 ? 90 : 120",job:[38],line:2,minLevel:56},{key:crypto.randomUUID(),id:25857,tts:"抗死",duration:10,recast1000ms:120,job:[35],line:2,minLevel:86},{key:crypto.randomUUID(),id:118,tts:"战歌",duration:20,recast1000ms:120,job:[5,23],line:3,minLevel:50},{key:crypto.randomUUID(),id:25785,tts:"光神曲",duration:20,recast1000ms:110,job:[5,23],line:3,minLevel:90},{key:crypto.randomUUID(),id:"(lv) => lv>=66 ? 36957 : 2248",tts:"背刺",duration:20,recast1000ms:120,job:[29,30],line:3,minLevel:66},{key:crypto.randomUUID(),id:24405,tts:"神秘环",duration:20,recast1000ms:120,job:[39],line:3,minLevel:72},{key:crypto.randomUUID(),id:3557,tts:"连祷",duration:20,recast1000ms:120,job:[4,22],line:3,minLevel:52},{key:crypto.randomUUID(),id:7396,tts:"义结金兰",duration:20,recast1000ms:120,job:[2,20],line:3,minLevel:70},{key:crypto.randomUUID(),id:25801,tts:"灼热之光",duration:20,recast1000ms:120,job:[27],line:3,minLevel:66},{key:crypto.randomUUID(),id:34675,tts:"星空构想",duration:20,recast1000ms:120,job:[42],line:3,minLevel:70},{key:crypto.randomUUID(),id:7436,tts:"连环计",duration:20,recast1000ms:120,job:[28],line:3,minLevel:66},{key:crypto.randomUUID(),id:7520,tts:"鼓励",duration:20,recast1000ms:120,job:[35],line:3,minLevel:58},{key:crypto.randomUUID(),id:16196,tts:"技巧舞",duration:20,recast1000ms:120,job:[38],line:3,minLevel:70},{key:crypto.randomUUID(),id:16011,tts:"探戈",duration:20,recast1000ms:120,job:[38],line:3,minLevel:62},{key:crypto.randomUUID(),id:16552,tts:"占卜",duration:20,recast1000ms:120,job:[33],line:3,minLevel:50}],p=[{id:"骑士ID",name:"虚构骑士",job:19,inParty:!0,level:100},{id:"武僧ID",name:"虚构武僧",job:20,inParty:!0,level:100},{id:"战士ID",name:"虚构战士",job:21,inParty:!0,level:100},{id:"龙骑ID",name:"虚构龙骑士",job:22,inParty:!0,level:100},{id:"诗人ID",name:"虚构吟游诗人",job:23,inParty:!0,level:100},{id:"白魔ID",name:"虚构白魔法师",job:24,inParty:!0,level:100},{id:"黑魔ID",name:"虚构黑魔法师",job:25,inParty:!0,level:100},{id:"召唤ID",name:"虚构召唤师",job:27,inParty:!0,level:100},{id:"学者ID",name:"虚构学者",job:28,inParty:!0,level:100},{id:"忍者ID",name:"虚构忍者",job:30,inParty:!0,level:100},{id:"机工ID",name:"虚构机工士",job:31,inParty:!0,level:100},{id:"暗骑ID",name:"虚构暗黑骑士",job:32,inParty:!0,level:100},{id:"占星ID",name:"虚构占星术士",job:33,inParty:!0,level:100},{id:"武士ID",name:"虚构武士",job:34,inParty:!0,level:100},{id:"赤魔ID",name:"虚构赤魔法师",job:35,inParty:!0,level:100},{id:"绝枪ID",name:"虚构绝枪战士",job:37,inParty:!0,level:100},{id:"舞者ID",name:"虚构舞者",job:38,inParty:!0,level:100},{id:"钐镰ID",name:"虚构钐镰客",job:39,inParty:!0,level:100},{id:"贤者ID",name:"虚构贤者",job:40,inParty:!0,level:100},{id:"蝰蛇ID",name:"虚构蝰蛇剑士",job:41,inParty:!0,level:100},{id:"画家ID",name:"虚构绘灵法师",job:42,inParty:!0,level:100}],I={tank:2,healer:2,dps:4};const D=new class{party;constructor(){this.party=t([]),this.shuffle()}fullPary(){this.party.value=p.slice()}shuffle(e=I){const t={...I,...e},n=[...p].sort(()=>Math.random()-.5),o=[],r=Object.values(t).reduce((e,t)=>e+t,0);for(const i of n){const e=s.jobEnumToJob(i.job),n=s.jobToRole(e),a=t[n]??0;if(!(a<=0)&&(t[n]=a-1,o.push(i),o.length>=r))break}this.party.value=o}},k=n("keySkill",()=>{const n=a(),l=i(),m=t([]),d=e("keySkills-fix",{chinese:b,global:j}),y=t("chinese"),u=o({}),p=r(()=>d.value[y.value]),I=t(1),k=r(()=>{const e=[],t=r(()=>n.value||l.value?D.party.value:m.value);for(const n of t.value)for(const t of p.value)if(t.job.includes(n.job)&&(void 0===n.level||t.minLevel<=n.level)){const o=v(t.duration,n.level||999),r=v(t.id,n.level||999),i=v(t.recast1000ms,n.level||999),a=v(t.minLevel,n.level||999),l={id:n.id,name:n.name,job:n.job,jobIcon:s.jobEnumToIcon(n.job),jobName:s.jobToFullName(s.jobEnumToJob(n.job)).simple1,hasDuplicate:{skill:!1,job:!1}},m=`${n.id}-${r}`,d=U(r),c=t.tts,y=t.line,u=t.job;e.push({duration:o,id:r,owner:l,key:m,minLevel:a,recast1000ms:i,src:d,tts:c,line:y,job:u})}for(const n of e)n.owner.hasDuplicate={skill:e.some(e=>e.id===n.id&&e.owner.id!==n.owner.id),job:e.some(e=>e.owner.job===n.owner.job&&e.owner.id!==n.owner.id)};return e.sort((e,t)=>{const n=p.value.findIndex(t=>t.id===e.id),o=p.value.findIndex(e=>e.id===t.id);return n===o?s.enumSortMethod(e.owner.job,t.owner.job):n-o}),e});return{party:m,skillStates:u,dev:n,demo:l,speed:I,usedSkills:k,triggerSkill:function(e,t,n){const r=k.value.find(n=>n.id===e&&n.owner.id===t);if(!r)return;const i=r.key,{duration:a,recast1000ms:s}=r;u[i]?.rafId&&cancelAnimationFrame(u[i].rafId);const l=o({startTime:performance.now(),isRecast:0===a,durationLeft:a,recastLeft:s-a,text:(a||s).toString(),active:!0,animationKey:Date.now(),clipPercent:0,rafId:void 0}),m=I.value,d=performance.now(),y=1e3*a,v=1e3*(s-a);l.rafId=requestAnimationFrame(function e(){const t=performance.now(),n=(t-d)*m;if(l.isRecast){const e=n-y;if(!(e<v))return l.text="",l.active=!1,l.isRecast=!1,l.clipPercent=0,l.rafId&&cancelAnimationFrame(l.rafId),l.rafId=void 0,void Reflect.deleteProperty(u,i);{const t=v-e;l.recastLeft=Math.ceil(t/1e3),l.text=l.recastLeft.toString(),l.clipPercent=e/v*100}}else if(n<y){const e=y-n;l.durationLeft=Math.ceil(e/1e3),l.text=l.durationLeft.toString(),l.clipPercent=e/y*100}else l.isRecast=!0,l.startTime=t,l.clipPercent=0;l.rafId=requestAnimationFrame(e)}),u[i]=l,n&&c(r.tts)},wipe:function(){for(const e in u){const t=u[e];t&&(t.rafId&&cancelAnimationFrame(t.rafId),t.text="",t.active=!1)}},shuffle:function(){D.shuffle()},demoFullParty:function(){D.fullPary()},language:y,keySkillsData:d}});export{j as a,u as c,U as i,b as s,k as u};
