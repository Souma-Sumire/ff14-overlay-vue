import{_ as e}from"./ActWrapper-5069e8c1.js";import{m as t,k as a,q as l,I as o,D as n,c as s,f as c,X as r,V as i,Y as d,Z as u,x as p,y as m,b as h,d as f}from"./element-plus-901ad096.js";import{aZ as w,aP as b,K as g,J as v,l as y,o as C,q as _,G as V,y as S,F as P,ae as R,u as U,x as k,d as E,k as T,r as x,L as D,W as N,B as A,E as O,D as j}from"./vue-49c48d91.js";import{_ as L}from"./_plugin-vue_export-helper-6a8c15be.js";import{_ as B}from"./ThemeToggle-fb2e4d42.js";import{an as z}from"./vendor-979eac9e.js";import{u as I}from"./useDev-861d544b.js";import{u as q,C as F}from"./useZone-1661c0fc.js";import{z as W}from"./res-zoneInfo-5ea06bcd.js";import{N as Z,a as G,r as Y,c as M,e as K,l as H}from"./cactbot-49e370f3.js";import"./useDemo-86956ef5.js";const J={class:"language-switcher"},Q={class:"select-wrapper"},X=L({__name:"LanguageSwitcher",setup(e){const{locale:l,availableLocales:o}=w(),n={zhCn:"简体中文",en:"English",ja:"日本語"},s=b("user-locale",l.value);return g(s,e=>{l.value=e}),v(()=>{l.value=s.value}),(e,l)=>{const c=t,r=a;return C(),y("div",J,[_("div",Q,[l[1]||(l[1]=_("svg",{class:"globe-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[_("circle",{cx:"12",cy:"12",r:"10"}),_("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),_("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})],-1)),V(r,{modelValue:U(s),"onUpdate:modelValue":l[0]||(l[0]=e=>E(s)?s.value=e:null),size:"small",class:"language-select"},{default:S(()=>[(C(!0),y(P,null,R(U(o),(e,t)=>(C(),k(c,{key:t,value:e,label:n[e]},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-20ae48e5"]]),$={class:"obs-container"},ee={class:"button-container"},te={class:"card-header"},ae={class:"act-not-ready-content"},le={key:1},oe={class:"card-header"},ne={key:1},se={class:"card-header"},ce={class:"status-info"},re={class:"button-container"},ie={class:"card-header"},de={class:"profile-info"},ue={class:"file-path-explanation"},pe={class:"file-name-explanation"},me={class:"card-header"},he=L(T({__name:"obs2",setup(t){const{t:a}=w(),{zoneType:g}=q(),P=b("obs-user-config",{host:4455,password:"",path:"",fileName:""},localStorage,{writeDefaults:!0}),R=b("obs-user-content-setting",[]),E=b("obs-is-first-time",!0),T=x(!1),L=I(),J=x(1);function Q(){return L.value?Promise.resolve():new Promise(e=>{M({call:"cactbotRequestState"}).then(()=>{T.value=!0,e()}),setTimeout(()=>{T.value||Q()},3e3)})}const he={inCombat:Z.inCombat(),countdown:Z.countdown(),countdownCancel:Z.countdownCancel(),wipe:K.wipe},fe={enter:!1,countdown:!0,countdownCancel:!0,combatStart:!0,combatEnd:!0,wipe:!0,partyLength:4},we={enter:!1,countdown:!1,countdownCancel:!1,combatStart:!1,combatEnd:!1,wipe:!1,partyLength:1};const be=new class{ws;status;handleConnectionError=()=>{ye("OBS connection error"),this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath=""};handleConnectionClosed=()=>{ye("OBS connection closed"),this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath=""};handleRecordStateChanged=e=>{this.status.connected=!0,this.status.recording="OBS_WEBSOCKET_OUTPUT_STARTED"===e.outputState,this.status.outputActive=e.outputActive,this.status.outputPath=e.outputPath||""};constructor(){this.ws=new z,this.status=N({connecting:!1,connected:!1,recording:!1,outputActive:!1,outputPath:""}),this.ws.on("ConnectionClosed",this.handleConnectionClosed),this.ws.on("ConnectionError",this.handleConnectionError),this.ws.on("RecordStateChanged",this.handleRecordStateChanged)}connect(e){ye("Attempting to connect to OBS"),P.value.host&&P.value.password&&(this.status.connecting||(this.status.connecting=!0,this.ws.connect(`ws://127.0.0.1:${P.value.host}`,P.value.password).then(()=>{this.ws.call("GetRecordStatus").then(e=>{this.status.recording=e.outputActive,this.status.outputActive=e.outputActive}),this.status.connected=!0,e&&e()}).finally(()=>{this.status.connecting=!1,!P.value.path&&this.status.connected&&this.ws.call("GetRecordDirectory").then(e=>{e.recordDirectory&&(P.value.path=e.recordDirectory)}),P.value.fileName||(P.value.fileName="%CCYY-%MM-%DD %hh-%mm-%ss")})))}disconnect(){ye("Disconnecting from OBS"),this.ws.disconnect()}async startRecord(){ye("Starting recording"),await this.setProfileParameter(),this.ws.call("StartRecord")}stopRecord(){ye("Stopping recording"),this.ws.call("StopRecord")}splitRecord(){ye("Splitting recording"),this.ws.call("StopRecord").finally(()=>{setTimeout(()=>{this.ws.call("StartRecord")},1e3)})}async setProfileParameter(){const e=P.value.path,t=P.value.fileName,a=[];return a.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"AdvOut",parameterName:"RecFilePath",parameterValue:e}}),a.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"Output",parameterName:"FilenameFormatting",parameterValue:t}}),P.value.path=e,P.value.fileName=t,this.ws.callBatch(a)}},ge=e=>{ye("Zone changed:",e);const t=e.zoneID;void 0!==W[t]&&Ce("enter")},ve=e=>{const t=e.rawLine;for(const a in he){if(he[a].exec(t)){const e=t.split("|");switch(a){case"inCombat":{const t="1"===e[H.InCombat.fields.inACTCombat],a="1"===e[H.InCombat.fields.inGameCombat];if(t&&a)return void Ce("combatStart");if(!t&&!a)return void Ce("combatEnd");break}case"countdown":Ce("countdown");break;case"countdownCancel":Ce("countdownCancel");break;case"wipe":Ce("wipe")}}}};function ye(...e){L.value}function Ce(e){ye();const t=R.value.find(e=>e.type===g.value);if(t)if(t[e])if(ye(g.value),!1===t.enter&&"enter"===e&&be.status.recording)be.stopRecord();else switch(e){case"enter":case"countdown":case"combatStart":if(J.value<t.partyLength)return;return be.status.connected?!1===be.status.recording?void be.startRecord():void(!0===be.status.recording&&"combatStart"!==e&&be.splitRecord()):void be.connect(()=>{be.startRecord()});case"countdownCancel":case"combatEnd":case"wipe":be.status.recording&&be.stopRecord()}else ye()}const _e=e=>{ye(),J.value=e.party.map(e=>e.inParty)?.length||1};return v(async()=>{await Q(),be.connect(),G("ChangeZone",ge),G("LogLine",ve),G("PartyChanged",_e),function(){const e=["Savage","Extreme","Ultimate","Chaotic","OccultCrescent","Default"];if(E.value)E.value=!1,R.value=[...e.map(e=>({type:e,...fe})),...F.filter(t=>!e.includes(t)).map(e=>({type:e,...we}))];else{R.value=R.value.filter(e=>F.includes(e.type));const t=F.filter(e=>!R.value.some(t=>t.type===e)&&"Default"!==e).map(t=>e.includes(t)?{type:t,...fe}:{type:t,...we});R.value.push(...t)}R.value.sort((e,t)=>F.indexOf(e.type)-F.indexOf(t.type)),R.value=R.value.map(t=>({...e.includes(t.type)?fe:we,...t}))}()}),D(()=>{be.disconnect(),Y("ChangeZone",ge),Y("LogLine",ve)}),(t,w)=>{const b=B,g=X,v=l,E=s,x=n,D=c,N=o,z=r,I=i,q=u,F=d,W=m,Z=h,G=f,Y=p,M=e;return C(),k(M,null,{default:S(()=>[_("div",$,[_("header",null,[_("h1",null,O(U(a)("OBS Auto Record V2")),1),_("div",ee,[V(b,{"storage-key":"obs-2-theme"}),V(g)])]),!U(T)||U(L)?(C(),k(v,{key:0,class:"act-not-ready-card"},{header:S(()=>[_("div",te,[_("span",null,O(U(a)("ACT Not Ready")),1)])]),default:S(()=>[_("div",ae,[_("p",null,O(U(a)("overlayTutorial")),1)])]),_:1})):A("",!0),U(T)||U(L)?(C(),y("main",le,[U(be).status.connected||U(L)?(C(),y("div",ne,[V(I,{class:"instruction-alert",type:"info",description:U(a)("hideTutorial"),closable:!1,"show-icon":""},null,8,["description"]),U(L)?(C(),k(v,{key:0,class:"status-card"},{header:S(()=>[_("div",se,[_("span",null,O(U(a)("Connection Status")),1),V(D,{type:"danger",size:"small",class:"disconnect-button",onClick:w[3]||(w[3]=e=>U(be).disconnect())},{default:S(()=>[j(O(U(a)("Disconnect")),1)]),_:1})])]),default:S(()=>[_("div",ce,[V(F,{direction:"vertical",column:1,border:""},{default:S(()=>[V(q,{label:U(a)("Recording")},{default:S(()=>[j(O(U(be).status.recording?U(a)("Yes"):U(a)("No")),1)]),_:1},8,["label"]),V(q,{label:U(a)("Output Path")},{default:S(()=>[j(O(U(be).status.outputPath||U(a)("None")),1)]),_:1},8,["label"])]),_:1})]),_("div",re,[V(D,{disabled:!U(be).status.connected||U(be).status.recording,type:"primary",onClick:w[4]||(w[4]=e=>U(be).startRecord())},{default:S(()=>[j(O(U(a)("Start Record")),1)]),_:1},8,["disabled"]),V(D,{disabled:!U(be).status.connected||!U(be).status.recording,type:"danger",onClick:w[5]||(w[5]=e=>U(be).stopRecord())},{default:S(()=>[j(O(U(a)("Stop Record")),1)]),_:1},8,["disabled"]),V(D,{disabled:!U(be).status.connected||!U(be).status.recording,type:"warning",onClick:w[6]||(w[6]=e=>U(be).splitRecord())},{default:S(()=>[j(O(U(a)("Split Record")),1)]),_:1},8,["disabled"]),V(D,{type:"primary",onClick:w[7]||(w[7]=e=>U(be).setProfileParameter())},{default:S(()=>[j(O(U(a)("Set Recording Name")),1)]),_:1})])]),_:1})):A("",!0),V(v,{class:"profile-card"},{header:S(()=>[_("div",ie,[_("span",null,O(U(a)("Recording Profile")),1)])]),default:S(()=>[_("div",de,[V(N,{"label-position":"top",class:"content-form"},{default:S(()=>[V(x,{label:U(a)("Record Path")},{default:S(()=>[V(E,{modelValue:U(P).path,"onUpdate:modelValue":w[8]||(w[8]=e=>U(P).path=e),placeholder:U(a)("recordPathPlaceholder")},null,8,["modelValue","placeholder"]),_("div",ue,O(U(a)("filePathExplanation")),1)]),_:1},8,["label"]),V(x,{label:U(a)("Record File Name")},{default:S(()=>[V(E,{modelValue:U(P).fileName,"onUpdate:modelValue":w[9]||(w[9]=e=>U(P).fileName=e),placeholder:U(a)("recordFileNamePlaceholder")},null,8,["modelValue","placeholder"]),_("div",pe,O(U(a)("fileNameExplanation")),1)]),_:1},8,["label"])]),_:1})])]),_:1}),V(v,{class:"table-card"},{header:S(()=>[_("div",me,[_("span",null,O(U(a)("User Content Settings")),1)])]),default:S(()=>[V(Y,{data:U(R),style:{width:"100%"},border:!0,stripe:""},{default:S(()=>[V(W,{prop:"type",label:U(a)("Type"),"min-width":"120",fixed:""},{default:S(e=>[_("span",null,O(U(a)(e.row.type)),1)]),_:1},8,["label"]),V(W,{label:U(a)("Start When"),align:"center"},{default:S(()=>[V(W,{label:U(a)("When Party"),align:"center","min-width":"110"},{default:S(e=>[V(Z,{modelValue:e.row.partyLength,"onUpdate:modelValue":t=>e.row.partyLength=t,min:1,max:8,style:{width:"85px"},size:"small",class:"party-length-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),V(W,{prop:"enter",label:U(a)("Enter Zone"),align:"center","min-width":"95"},{default:S(e=>[V(G,{modelValue:e.row.enter,"onUpdate:modelValue":t=>e.row.enter=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),V(W,{prop:"countdown",label:U(a)("CountDown"),align:"center","min-width":"95"},{default:S(e=>[V(G,{modelValue:e.row.countdown,"onUpdate:modelValue":t=>e.row.countdown=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),V(W,{prop:"combatStart",label:U(a)("CombatStart"),align:"center","min-width":"95"},{default:S(e=>[V(G,{modelValue:e.row.combatStart,"onUpdate:modelValue":t=>e.row.combatStart=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),V(W,{label:U(a)("End When"),align:"center"},{default:S(()=>[V(W,{prop:"combatEnd",label:U(a)("CombatEnd"),align:"center","min-width":"95"},{default:S(e=>[V(G,{modelValue:e.row.combatEnd,"onUpdate:modelValue":t=>e.row.combatEnd=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),V(W,{prop:"wipe",label:U(a)("Wipe"),align:"center","min-width":"95"},{default:S(e=>[V(G,{modelValue:e.row.wipe,"onUpdate:modelValue":t=>e.row.wipe=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),V(W,{prop:"countdown",label:U(a)("CountDownCancel"),align:"center","min-width":"95"},{default:S(e=>[V(G,{modelValue:e.row.countdownCancel,"onUpdate:modelValue":t=>e.row.countdownCancel=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})])):(C(),k(v,{key:0,class:"connection-card"},{header:S(()=>[_("div",oe,[_("span",null,O(U(a)("Connect to OBS")),1)])]),default:S(()=>[V(N,{"label-position":"top",class:"connection-form"},{default:S(()=>[V(x,{label:U(a)("Port")},{default:S(()=>[V(E,{modelValue:U(P).host,"onUpdate:modelValue":w[0]||(w[0]=e=>U(P).host=e),placeholder:U(a)("portPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),V(x,{label:U(a)("Password")},{default:S(()=>[V(E,{modelValue:U(P).password,"onUpdate:modelValue":w[1]||(w[1]=e=>U(P).password=e),placeholder:U(a)("passwordPlaceholder"),type:"password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),V(x,null,{default:S(()=>[V(D,{type:"primary",class:"connect-button",loading:U(be).status.connecting,disabled:U(be).status.connecting||!U(P).host,onClick:w[2]||(w[2]=e=>U(be).connect())},{default:S(()=>[j(O(U(be).status.connecting?U(a)("Connecting"):U(a)("Connect")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),V(z,null,{default:S(()=>[j(O(U(a)("Instructions")),1)]),_:1}),V(I,{class:"instruction-alert",type:"info",description:U(a)("obsTutorial"),closable:!1,"show-icon":""},null,8,["description"]),V(I,{class:"instruction-alert",type:"info",description:U(a)("inputTutorial"),closable:!1,"show-icon":""},null,8,["description"]),V(I,{class:"instruction-alert",type:"info",description:U(a)("firewallTutorial"),closable:!1,"show-icon":""},null,8,["description"])]),_:1}))])):A("",!0)])]),_:1})}}}),[["__scopeId","data-v-9e2d980b"]]);export{he as default};
