const t=new URLSearchParams(window.location.href.split("?")[1]).get("api"),e="cafemaker.wakingsands.com",n="xivapi.com",s=new Map,c={first:`https://${"xivapi"===t?.toLowerCase()?n:e}`,second:`https://${"xivapi"===t?.toLowerCase()?e:n}`},r="souma-action-cache",o=JSON.parse(localStorage.getItem(r)||"[]"),a=Date.now(),i=o.filter((t,e)=>t.expirationTime>=a&&e<1e3);localStorage.setItem(r,JSON.stringify(i));const p=/(\d{6})\/(\d{6})\.png$/;async function f(t,e,n=["ID","Icon","ActionCategoryTargetID"]){if(s.has(e))return s.get(e);const r=function(t,e,n){const s=`${c.first}/${t}/${e}?columns=${n.join(",")}`;return[s,s.replace(c.first,c.second)]}(t,e,n);try{const t=await async function(t,e){const n=Object.assign({cache:"force-cache"},e);for(const s of t)try{const t=await g(fetch(s,n),3e3);if(t.ok){const e=await t.json(),n=new URL(s).host;return{...e,Host:n}}}catch{}throw new Error("All fetch attempts failed.")}(r,{mode:"cors"});return s.set(e,t),t}catch(o){return Promise.resolve({ActionCategoryTargetID:0,ID:e,Icon:"/i/000000/000405.png"})}}async function m(t,e=!1){return`${c.first}${t}`.replace(p,(t,n,s)=>`${n}/${e?"hq/":""}${s}.png`)}async function u(t){return m((await f("action",t,["Icon"])).Icon)}async function g(t,e){let n;const s=new Promise((t,s)=>{n=window.setTimeout(()=>{s(new Error("Promise timed out"))},e)});return Promise.race([t,s]).finally(()=>{clearTimeout(n)})}const w=new Map;function l(t){return w.has(t)?w.get(t):`${c.first}${t}`}function h(t){const e=t.target,n=e.src.match(new RegExp("(?<=\\.\\w+)\\/.+$"))?.[0];n&&""!==e.src&&(/pictomancer\.png$/.test(e.src)?e.src="//souma.diemoe.net/resources/img/pictomancer.png":/viper\.png$/.test(e.src)?e.src="//souma.diemoe.net/resources/img/viper.png":e.src.includes(c.first)?e.src=e.src.replace(c.first,c.second):e.src="",w.set(n,e.src))}export{m as a,u as b,s as c,l as g,h,f as p,c as s};
