import{_ as e}from"./ActWrapper-7141acc0.js";import{_ as a}from"./DragJob-2f67ebe2.js";import"./index-a135a9d0.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                   */import{u as t,e as n,a as r}from"./index-9c6472dd.js";import{u as o}from"./useDevMode-55881ae6.js";import{U as l}from"./util-c5e2dd68.js";import{a as s,c as u}from"./overlay_plugin_api-974cdd44.js";/* empty css                */import{L as i,q as p,n as m}from"./element-plus-3b00acc6.js";import{t as c,r as d,e as y,D as f,E as v,x as b,A as j,M as g,v as h,H as k,u as P,h as _,K as x,L as w,aa as C,G as T}from"./vue-vendor-37eb8ba2.js";import{_ as J}from"./_plugin-vue_export-helper-6a8c15be.js";/* empty css                *//* empty css                    */const R={class:"cactbot-runtime"},D={key:0,class:"you"},U={key:1,class:"players"},V={class:"job-name"},A={key:0,class:"player-name"},E={key:0,style:{position:"fixed",bottom:"0"}},O=J(c({__name:"cactbotRuntime",setup(c){const J=d(!1);function O(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const L=d(!1),M=t("cactbotRuntime-sortArr",[]),S=[{id:"10000001",name:"虚构暗骑",job:32,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构龙骑",job:22,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0},{id:"10000007",name:"虚构画家",job:42,inParty:!0}],G=t("cactbotRuntime-data",{party:[]}),H=t("cactbotRuntime-showTips",d(!0)),N=t("cactbotRuntime-roleSelectLength",{tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0}),q={tank:["MT","ST",...O("T",6,2)],healer:[...O("H",8)],dps:[...O("D",8)],crafter:[...O("C",8)],gatherer:[...O("G",8)],none:[...O("N",8)]};function z(e){const a=B(e);return q[a].filter((e,t)=>t<N.value[a])}const I=o(),K=d(I.value?S[2].name:"");function B(e){return[1,3,19,21,32,37].includes(e)?"tank":[6,24,28,33,40].includes(e)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39,41,42].includes(e)?"dps":l.isCraftingJob(l.jobEnumToJob(e))?"crafter":l.isGatheringJob(l.jobEnumToJob(e))?"gatherer":"none"}function F(e){return q[B(e.job)].find(e=>!G.value.party.find(a=>a.rp===e))??"unknown"}function W(){const e=[...q.tank,...q.healer,...q.dps,...q.crafter,...q.gatherer,...q.none];G.value.party.sort((a,t)=>e.indexOf(a.rp??"unknown")-e.indexOf(t.rp??"unknown")),u({call:"broadcast",source:"soumaRuntimeJS",msg:{party:G.value.party}})}function X(e){M.value=e,Q()}function Q(){!function(){G.value.party.sort((e,a)=>M.value.indexOf(e.job)-M.value.indexOf(a.job));for(const e of G.value.party)e.rp=void 0;for(const e of G.value.party)e.rp=F(e)}(),function(){for(const e in N.value)Object.prototype.hasOwnProperty.call(N.value,e)&&(N.value[e]=G.value.party.reduce((a,t)=>B(t.job)===e?a+1:a,0))}(),W()}function Y(){const e={party:S};H.value&&(L.value=!0),G.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),Q()}return y(()=>{const e=n({storageKey:"cactbot-runtime-theme"}),a=r(e);!1===e.value&&a(),document.body.addEventListener("mouseenter",()=>J.value=!0),document.body.addEventListener("mouseleave",()=>J.value=!1),W(),s("PartyChanged",e=>{H.value&&(L.value=!0),I.value&&0===e.party.length||(G.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),Q())}),s("ChangePrimaryPlayer",e=>{I.value||(K.value=e.charName)}),s("BroadcastMessage",e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&W()})}),(t,n)=>{const r=i,o=p,s=m,u=a,c=e;return b(),f(c,null,{default:v(()=>[j("div",R,[g(r,{modelValue:P(L),"onUpdate:modelValue":n[0]||(n[0]=e=>_(L)?L.value=e:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:n[1]||(n[1]=e=>{L.value=!1,H.value=!1})},{header:v(()=>n[3]||(n[3]=[j("span",null,"用法",-1)])),default:v(()=>n[4]||(n[4]=[j("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1),j("ul",null,[j("li",null,"临时：下拉选择框修改。"),j("li",null,"长期：用鼠标拖动职能顺序。")],-1)])),_:1},8,["modelValue"]),j("main",null,[P(J)?(b(),h("div",U,[(b(!0),h(w,null,C(P(G).party,(e,a)=>{return b(),h("section",{key:e.id,class:T(["player",{"is-you":e.name===P(K)}])},[g(s,{modelValue:e.rp,"onUpdate:modelValue":a=>e.rp=a,size:"small",class:"select","fit-input-width":"",placement:"right",offset:8,onChange:e=>function(e){const a=G.value.party.find(a=>a.rp===G.value.party[e].rp&&a.id!==G.value.party[e].id);a&&(a.rp=F(a)),W()}(a)},{default:v(()=>[(b(!0),h(w,null,C(z(e.job),(e,a)=>(b(),f(o,{key:a,value:e,label:e},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),j("span",V,x((t=e.job,l.nameToFullName(l.jobEnumToJob(t)).simple1)),1),P(J)?(b(),h("span",A,x(e.name),1)):k("",!0)],2);var t}),128)),P(J)?(b(),f(u,{key:0,class:"drag-job",party:P(G).party,"p-1":"",onUpdateSortArr:X},null,8,["party"])):k("",!0)])):(b(),h("div",D,x(P(G).party.find(e=>e.name===P(K))?.rp??""),1))]),P(I)?(b(),h("div",E,[j("button",{onClick:n[2]||(n[2]=e=>{P(G).party=P(G).party.filter(e=>e.name===P(K)),Q()})}," 测试单人 "),j("button",{onClick:Y}," 测试组队 ")])):k("",!0)])]),_:1})}}}),[["__scopeId","data-v-b16ef71f"]]);export{O as default};
