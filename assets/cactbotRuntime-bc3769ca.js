import{d as $,s as k,x as C,o as d,b as c,G as w,H as L,a as m,w as y,u as s,O as ae,t as M,aC as te,A as ne,B as oe,a5 as re,f as h,F as se,a0 as le,aD as ie,C as D,D as N,P as ue,M as de,aE as ce,h as pe,e as fe,p as _e,i as me,c as ye,ac as ve,a1 as be}from"./vendor-5deaef20.js";import{U as V}from"./util-6278c68e.js";import{_ as F}from"./index-cfd16e90.js";const he={flex:"~ col"},ge=$({__name:"dragJob",props:{party:{}},emits:["updateSortArr"],setup(g,{emit:j}){const v=k(),b=k(!0),x=j,E=g,T=()=>{x("updateSortArr",Object.values(l.value).flat().map(t=>t.id))},n=[{name:"tank",color:"blue"},{name:"healer",color:"green"},{name:"dps",color:"red"}];function O(t){return E.party.find(r=>r.job===t)}const o={tank:[21,32,37,19],healer:[33,24,40,28],dps:[34,30,39,22,20,38,23,31,25,27,35,36],unknown:[]},p=Object.values(o).flat().map(t=>({name:V.nameToFullName(V.jobEnumToJob(t)).simple1,id:t})),l=C("cactbotRuntime-jobList",{tank:p.filter(t=>o.tank.includes(t.id)).sort((t,r)=>o.tank.indexOf(t.id)-o.tank.indexOf(r.id)),healer:p.filter(t=>o.healer.includes(t.id)).sort((t,r)=>o.healer.indexOf(t.id)-o.healer.indexOf(r.id)),dps:p.filter(t=>o.dps.includes(t.id)).sort((t,r)=>o.dps.indexOf(t.id)-o.dps.indexOf(r.id)),unknown:[]});return(t,r)=>(d(),c("div",he,[(d(),c(w,null,L(n,f=>m(s(te),{ref_for:!0,ref_key:"el",ref:v,disabled:!b.value,modelValue:s(l)[f.name],"onUpdate:modelValue":_=>s(l)[f.name]=_,animation:"150",ghostClass:"ghost",class:"flex flex-row gap-0.25 p-0 m-t-0.25 m-b-0.25 rounded",onUpdate:T,filter:".no-draggable",forceFallback:!0},{default:y(()=>[(d(!0),c(w,null,L(s(l)[f.name],_=>(d(),c("div",{key:_.id,class:ae(`${O(_.id)?`draggable bg-${f.color}`:"no-draggable bg-gray-700/50"} rounded p-l-0.6 p-r-0.6 p-t-0 p-b-0.3 m-0 color-white cursor-move`)},M(_.name),3))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])),64))]))}});const ke=F(ge,[["__scopeId","data-v-e5ffedcd"]]),z=g=>(_e("data-v-df3f4c97"),g=g(),me(),g),je={key:0,style:{color:"white","text-shadow":"1px 1px 2px black"}},xe=z(()=>h("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1)),Pe=z(()=>h("ul",null,[h("li",null,"长期：用鼠标拖动职能顺序。"),h("li",null,"临时：下拉选择框修改。")],-1)),we={class:"dialog-footer"},Oe={style:{"white-space":"nowrap"}},Se=$({__name:"cactbotRuntime",setup(g){const j=(e,a)=>Array(a).fill(e).map((u,A)=>u+ ++A),v={tank:["MT","ST",...j("T",70)],healer:[...j("H",72)],dps:[...j("D",72)],unknown:["unknown"]},b=k(!1),x=C("cactbotRuntime-sortArr",[21,32,37,19,33,24,40,28,34,30,39,22,20,38,23,31,25,27,35,36]),E=[{id:"10000001",name:"虚构战士",job:21,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构武士",job:34,inParty:!0},{id:"10000007",name:"虚构黑魔",job:25,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0}],n=C("cactbotRuntime-data",{party:[]}),O=C("cactbotRuntime-showTips",k(!0)),o={tank:0,healer:0,dps:0,unknown:1};function R(){o.tank=n.value.party.reduce((e,a)=>r(a.job)==="tank"?e+1:e,0),o.healer=n.value.party.reduce((e,a)=>r(a.job)==="healer"?e+1:e,0),o.dps=n.value.party.reduce((e,a)=>r(a.job)==="dps"?e+1:e,0)}const p=location.href.includes("localhost"),l=k(!1),t=k(p?"虚构占星":"");p&&f({party:E});function r(e){const a=Number(e);return[1,3,19,21,32,37].includes(a)?"tank":[6,24,28,33,40].includes(a)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39].includes(a)?"dps":"unknown"}function f(e){O.value&&(b.value=!0),!(p&&e.party.length===0)&&(n.value.party=e.party.filter(a=>a.inParty).map(a=>({...a,rp:"",specify:!1})),_(),R(),P())}function _(){n.value.party.sort((e,a)=>x.value.indexOf(e.job)-x.value.indexOf(a.job)),n.value.party.forEach(e=>e.rp=void 0),n.value.party.forEach(e=>e.rp=U(e))}function H(e){n.value.party[e].specify=!0;const a=n.value.party.find(u=>u.rp===n.value.party[e].rp&&u.id!==n.value.party[e].id);a&&(a.rp=U(a))&&(a.specify=!0),P()}function U(e){return v[r(e.job)].find(a=>!n.value.party.find(u=>u.rp===a))??"unknown"}function P(){const e=[...v.tank,...v.healer,...v.dps];n.value.party.sort((a,u)=>e.indexOf(a.rp)-e.indexOf(u.rp)),callOverlayHandler({call:"broadcast",source:"soumaRuntimeJS",msg:{party:n.value.party}})}function B(e){p||(t.value=e.charName)}function J(e){if(e.source==="soumaUserJS")switch(e.msg.text){case"updateNewPartyRP Success":break;case"requestData":P();break}}function G(){l.value=!0}function q(){l.value=!1}function Q(e){x.value=e,_(),R(),P()}return ne(()=>{P(),addOverlayListener("PartyChanged",f),addOverlayListener("ChangePrimaryPlayer",B),addOverlayListener("BroadcastMessage",J),startOverlayEvents()}),oe(()=>{removeOverlayListener("PartyChanged",f),removeOverlayListener("ChangePrimaryPlayer",B),removeOverlayListener("BroadcastMessage",J)}),(e,a)=>{const u=de,A=ce,K=ve,W=be,X=ke,Y=pe,Z=fe;return d(),c(w,null,[s(n).party.length===0?(d(),c("span",je,"等待小队...")):re("",!0),h("div",{onMouseenter:G,onMouseleave:q},[m(A,{modelValue:s(b),"onUpdate:modelValue":a[1]||(a[1]=i=>le(b)?b.value=i:null),title:"初见提示",width:"90%","destroy-on-close":!0,"close-on-click-modal":!1},{footer:y(()=>[h("span",we,[m(u,{type:"primary",onClick:a[0]||(a[0]=i=>{b.value=!1,O.value=!1})},{default:y(()=>[se("明白了")]),_:1})])]),default:y(()=>[xe,Pe]),_:1},8,["modelValue"]),m(Z,{style:ue({width:s(l)?"16.75rem":"5rem"})},{default:y(()=>[m(Y,null,{default:y(()=>[m(ie,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:y(()=>[(d(!0),c(w,null,L(s(n).party,(i,ee)=>D((d(),c("div",{key:i.id,flex:"~ nowrap"},[m(W,{modelValue:i.rp,"onUpdate:modelValue":S=>i.rp=S,size:"small","m-0":"","p-0":"",onChange:S=>H(ee),teleported:!1},{default:y(()=>[(d(!0),c(w,null,L(v[r(i.job)],(S,I)=>D((d(),ye(K,{key:I,value:S,"fit-input-width":!0},null,8,["value"])),[[N,I<o[r(i.job)]]])),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),h("span",Oe,M(s(V).nameToFullName(s(V).jobEnumToJob(i.job)).simple2)+" "+M(s(l)?i.name:""),1)])),[[N,s(l)||i.name===s(t)]])),128))]),_:1}),D(m(X,{class:"dragJob",onUpdateSortArr:Q,party:s(n).party,"m-b-1":"","p-1":""},null,8,["party"]),[[N,s(l)]])]),_:1})]),_:1},8,["style"])],32)],64)}}});const Ee=F(Se,[["__scopeId","data-v-df3f4c97"]]);export{Ee as default};
