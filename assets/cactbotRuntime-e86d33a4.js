import{_ as e}from"./ActWrapper-becdb444.js";import{u as a,_ as t}from"./DragJob-56eacf4d.js";import"./index-347bec65.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                   */import{u as n,e as r,a as o}from"./index-78df6055.js";import{u as l}from"./useDevMode-efb02b03.js";import{U as s}from"./util-fa8c2ae1.js";import{a as u,c as i}from"./overlay_plugin_api-974cdd44.js";/* empty css                */import{L as p,q as m,n as c}from"./element-plus-3b00acc6.js";import{t as d,r as y,e as f,D as v,E as b,x as j,A as g,M as h,v as k,H as P,u as _,h as x,K as w,L as C,aa as T,G as J}from"./vue-vendor-37eb8ba2.js";import{_ as D}from"./_plugin-vue_export-helper-6a8c15be.js";/* empty css                *//* empty css                    */const R={class:"cactbot-runtime"},U={key:0,class:"you"},V={key:1,class:"players"},E={class:"job-name"},O={key:0,class:"player-name"},L={key:0,style:{position:"fixed",bottom:"0"}},M=D(d({__name:"cactbotRuntime",setup(d){const D=a(),M=y(!1);function A(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const G=y(!1),S=[{id:"10000001",name:"虚构暗骑",job:32,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构龙骑",job:22,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0},{id:"10000007",name:"虚构画家",job:42,inParty:!0}],H=n("cactbotRuntime-data",{party:[]}),N=n("cactbotRuntime-showTips",y(!0)),q=n("cactbotRuntime-roleSelectLength",{tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0}),z={tank:["MT","ST",...A("T",6,2)],healer:[...A("H",8)],dps:[...A("D",8)],crafter:[...A("C",8)],gatherer:[...A("G",8)],none:[...A("N",8)]};function I(e){const a=F(e);return z[a].filter((e,t)=>t<q.value[a])}const K=l(),B=y(K.value?S[2].name:"");function F(e){return[1,3,19,21,32,37].includes(e)?"tank":[6,24,28,33,40].includes(e)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39,41,42].includes(e)?"dps":s.isCraftingJob(s.jobEnumToJob(e))?"crafter":s.isGatheringJob(s.jobEnumToJob(e))?"gatherer":"none"}function W(e){return z[F(e.job)].find(e=>!H.value.party.find(a=>a.rp===e))??"unknown"}function X(){const e=[...z.tank,...z.healer,...z.dps,...z.crafter,...z.gatherer,...z.none];H.value.party.sort((a,t)=>e.indexOf(a.rp??"unknown")-e.indexOf(t.rp??"unknown")),i({call:"broadcast",source:"soumaRuntimeJS",msg:{party:H.value.party}})}function Q(){!function(){H.value.party.sort((e,a)=>D.arr.indexOf(e.job)-D.arr.indexOf(a.job));for(const e of H.value.party)e.rp=void 0;for(const e of H.value.party)e.rp=W(e)}(),function(){for(const e in q.value)Object.prototype.hasOwnProperty.call(q.value,e)&&(q.value[e]=H.value.party.reduce((a,t)=>F(t.job)===e?a+1:a,0))}(),X()}function Y(){const e={party:S};N.value&&(G.value=!0),H.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),Q()}return f(()=>{const e=r({storageKey:"cactbot-runtime-theme"}),a=o(e);!1===e.value&&a(),document.body.addEventListener("mouseenter",()=>M.value=!0),document.body.addEventListener("mouseleave",()=>M.value=!1),X(),u("PartyChanged",e=>{N.value&&(G.value=!0),K.value&&0===e.party.length||(H.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),Q())}),u("ChangePrimaryPlayer",e=>{K.value||(B.value=e.charName)}),u("BroadcastMessage",e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&X()})}),(a,n)=>{const r=p,o=m,l=c,u=t,i=e;return j(),v(i,null,{default:b(()=>[g("div",R,[h(r,{modelValue:_(G),"onUpdate:modelValue":n[0]||(n[0]=e=>x(G)?G.value=e:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:n[1]||(n[1]=e=>{G.value=!1,N.value=!1})},{header:b(()=>n[3]||(n[3]=[g("span",null,"用法",-1)])),default:b(()=>n[4]||(n[4]=[g("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1),g("ul",null,[g("li",null,"临时：下拉选择框修改。"),g("li",null,"长期：用鼠标拖动职能顺序。")],-1)])),_:1},8,["modelValue"]),g("main",null,[_(M)?(j(),k("div",V,[(j(!0),k(C,null,T(_(H).party,(e,a)=>{return j(),k("section",{key:e.id,class:J(["player",{"is-you":e.name===_(B)}])},[h(l,{modelValue:e.rp,"onUpdate:modelValue":a=>e.rp=a,size:"small",class:"select","fit-input-width":"",placement:"right",offset:8,onChange:e=>function(e){const a=H.value.party.find(a=>a.rp===H.value.party[e].rp&&a.id!==H.value.party[e].id);a&&(a.rp=W(a)),X()}(a)},{default:b(()=>[(j(!0),k(C,null,T(I(e.job),(e,a)=>(j(),v(o,{key:a,value:e,label:e},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),g("span",E,w((t=e.job,s.nameToFullName(s.jobEnumToJob(t)).simple1)),1),_(M)?(j(),k("span",O,w(e.name),1)):P("",!0)],2);var t}),128)),_(M)?(j(),v(u,{key:0,class:"drag-job",party:_(H).party,"p-1":"",onUpdate:Q},null,8,["party"])):P("",!0)])):(j(),k("div",U,w(_(H).party.find(e=>e.name===_(B))?.rp??""),1))]),_(K)?(j(),k("div",L,[g("button",{onClick:n[2]||(n[2]=e=>{_(H).party=_(H).party.filter(e=>e.name===_(B)),Q()})}," 测试单人 "),g("button",{onClick:Y}," 测试组队 ")])):P("",!0)])]),_:1})}}}),[["__scopeId","data-v-0b754a7b"]]);export{M as default};
