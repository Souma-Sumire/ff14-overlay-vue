import{aB as e,r as t,h as n,i as o,ab as s,au as a,_ as r,d as u,N as d,y as c,u as i,aE as l,av as f,a7 as v,P as p}from"./index-BjHMYI2D.js";const m=e=>Array.from(e.querySelectorAll('a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])')).filter(e=>E(e)&&(e=>"fixed"!==getComputedStyle(e).position&&null!==e.offsetParent)(e)),E=e=>{if(e.tabIndex>0||0===e.tabIndex&&null!==e.getAttribute("tabIndex"))return!0;if(e.tabIndex<0||e.hasAttribute("disabled")||"true"===e.getAttribute("aria-disabled"))return!1;switch(e.nodeName){case"A":return!!e.href&&"ignore"!==e.rel;case"INPUT":return!("hidden"===e.type||"file"===e.type);case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},b="focus-trap.focus-after-trapped",y="focus-trap.focus-after-released",h={cancelable:!0,bubbles:!1},w={cancelable:!0,bubbles:!1},L="focusAfterTrapped",T="focusAfterReleased",g=Symbol("elFocusTrap"),A=t(),x=t(0),N=t(0);let I=0;const P=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},R=(e,t)=>{for(const n of e)if(!S(n,t))return n},S=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1},F=(t,n)=>{if(t&&t.focus){const o=document.activeElement;let s=!1;!e(t)||E(t)||t.getAttribute("tabindex")||(t.setAttribute("tabindex","-1"),s=!0),t.focus({preventScroll:!0}),N.value=window.performance.now(),t!==o&&(e=>e instanceof HTMLInputElement&&"select"in e)(t)&&n&&t.select(),e(t)&&s&&t.removeAttribute("tabindex")}};function k(e,t){const n=[...e],o=e.indexOf(t);return-1!==o&&n.splice(o,1),n}const K=(()=>{let e=[];return{push:t=>{const n=e[0];n&&t!==n&&n.pause(),e=k(e,t),e.unshift(t)},remove:t=>{var n,o;e=k(e,t),null==(o=null==(n=e[0])?void 0:n.resume)||o.call(n)}}})(),C=()=>{A.value="pointer",x.value=window.performance.now()},_=()=>{A.value="keyboard",x.value=window.performance.now()},O=e=>new CustomEvent("focus-trap.focusout-prevented",{...w,detail:e});let B=[];const U=e=>{e.code===a.esc&&B.forEach(t=>t(e))};var j=r(u({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[L,T,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:r}){const u=t();let d,m;const{focusReason:E}=(n(()=>{0===I&&(document.addEventListener("mousedown",C),document.addEventListener("touchstart",C),document.addEventListener("keydown",_)),I++}),o(()=>{I--,I<=0&&(document.removeEventListener("mousedown",C),document.removeEventListener("touchstart",C),document.removeEventListener("keydown",_))}),{focusReason:A,lastUserFocusTimestamp:x,lastAutomatedFocusTimestamp:N});var w;w=t=>{e.trapped&&!S.paused&&r("release-requested",t)},n(()=>{0===B.length&&document.addEventListener("keydown",U),s&&B.push(w)}),o(()=>{B=B.filter(e=>e!==w),0===B.length&&s&&document.removeEventListener("keydown",U)});const S={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},k=t=>{if(!e.loop&&!e.trapped)return;if(S.paused)return;const{code:n,altKey:o,ctrlKey:s,metaKey:u,currentTarget:d,shiftKey:c}=t,{loop:i}=e,l=n===a.tab&&!o&&!s&&!u,f=document.activeElement;if(l&&f){const e=d,[n,o]=(e=>{const t=P(e);return[R(t,e),R(t.reverse(),e)]})(e);if(n&&o)if(c||f!==o){if(c&&[n,e].includes(f)){const e=O({focusReason:E.value});r("focusout-prevented",e),e.defaultPrevented||(t.preventDefault(),i&&F(o,!0))}}else{const e=O({focusReason:E.value});r("focusout-prevented",e),e.defaultPrevented||(t.preventDefault(),i&&F(n,!0))}else if(f===e){const e=O({focusReason:E.value});r("focusout-prevented",e),e.defaultPrevented||t.preventDefault()}}};p(g,{focusTrapRef:u,onKeydown:k}),c(()=>e.focusTrapEl,e=>{e&&(u.value=e)},{immediate:!0}),c([u],([e],[t])=>{e&&(e.addEventListener("keydown",k),e.addEventListener("focusin",D),e.addEventListener("focusout",H)),t&&(t.removeEventListener("keydown",k),t.removeEventListener("focusin",D),t.removeEventListener("focusout",H))});const j=e=>{r(L,e)},q=e=>r(T,e),D=t=>{const n=i(u);if(!n)return;const o=t.target,s=t.relatedTarget,a=o&&n.contains(o);if(!e.trapped){s&&n.contains(s)||(d=s)}a&&r("focusin",t),S.paused||e.trapped&&(a?m=o:F(m,!0))},H=t=>{const n=i(u);if(!S.paused&&n)if(e.trapped){const o=t.relatedTarget;l(o)||n.contains(o)||setTimeout(()=>{if(!S.paused&&e.trapped){const e=O({focusReason:E.value});r("focusout-prevented",e),e.defaultPrevented||F(m,!0)}},0)}else{const e=t.target;e&&n.contains(e)||r("focusout",t)}};async function M(){await f();const t=i(u);if(t){K.push(S);const n=t.contains(document.activeElement)?d:document.activeElement;d=n;if(!t.contains(n)){const o=new Event(b,h);t.addEventListener(b,j),t.dispatchEvent(o),o.defaultPrevented||f(()=>{let o=e.focusStartEl;v(o)||(F(o),document.activeElement!==o&&(o="first")),"first"===o&&((e,t=!1)=>{const n=document.activeElement;for(const o of e)if(F(o,t),document.activeElement!==n)return})(P(t),!0),document.activeElement!==n&&"container"!==o||F(t)})}}}function W(){const e=i(u);if(e){e.removeEventListener(b,j);const t=new CustomEvent(y,{...h,detail:{focusReason:E.value}});e.addEventListener(y,q),e.dispatchEvent(t),t.defaultPrevented||"keyboard"!=E.value&&x.value>N.value&&!e.contains(document.activeElement)||F(null!=d?d:document.body),e.removeEventListener(y,q),K.remove(S)}}return n(()=>{e.trapped&&M(),c(()=>e.trapped,e=>{e?M():W()})}),o(()=>{e.trapped&&W(),u.value&&(u.value.removeEventListener("keydown",k),u.value.removeEventListener("focusin",D),u.value.removeEventListener("focusout",H),u.value=void 0)}),{onKeydown:k}}}),[["render",function(e,t,n,o,s,a){return d(e.$slots,"default",{handleKeydown:e.onKeydown})}],["__file","focus-trap.vue"]]);export{j as E,g as F,E as i,m as o,F as t};
