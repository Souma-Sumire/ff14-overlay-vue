import{_ as e}from"./ActWrapper-693a4c4c.js";import{t as a,V as t,r as n,f as r,ae as o,D as l,x as s,E as i,F as c,A as u,M as d,S as m,u as p,O as g,h as f,J as h}from"./vue-vendor-3ae2ccec.js";import{j as y}from"./obs-3ab203c1.js";import{V as v}from"./index-59b8e199.js";import"./style-1f970b29.js";import{d as b}from"./content_type-e6dd7239.js";import{N as P,c as D}from"./netregexes-ed180b06.js";import{a as C}from"./overlay_plugin_api-974cdd44.js";import{R as x}from"./regexes-da03e94d.js";import{U as w}from"./user_config-cf0555d1.js";import{z as F}from"./zoneInfo-40d5d60a.js";import{u as T}from"./index-c6b82793.js";/* empty css                */import"./useDevMode-8c677e90.js";import"./element-plus-1c4f27f5.js";import"./_plugin-vue_export-helper-6a8c15be.js";import"./zone_id-712c4b9c.js";import"./zone_info-e69ac441.js";const z={countdownStart:{en:"Battle commencing in (?<time>\\y{Float}) seconds! \\((?<player>.*?)\\)",de:"Noch (?<time>\\y{Float}) Sekunden bis Kampfbeginn! \\((?<player>.*?)\\)",fr:"Début du combat dans (?<time>\\y{Float}) secondes[ ]?! \\((?<player>.*?)\\)",ja:"戦闘開始まで(?<time>\\y{Float})秒！ （(?<player>.*?)）",cn:"距离战斗开始还有(?<time>\\y{Float})秒！ （(?<player>.*?)）",ko:"전투 시작 (?<time>\\y{Float})초 전! \\((?<player>.*?)\\)"},countdownEngage:{en:"Engage!",de:"Start!",fr:"À l'attaque[ ]?!",ja:"戦闘開始！",cn:"战斗开始！",ko:"전투 시작!"},countdownCancel:{en:"Countdown canceled by (?<player>\\y{Name})",de:"(?<player>\\y{Name}) hat den Countdown abgebrochen",fr:"Le compte à rebours a été interrompu par (?<player>\\y{Name})[ ]?\\.",ja:"(?<player>\\y{Name})により、戦闘開始カウントがキャンセルされました。",cn:"(?<player>\\y{Name})取消了战斗开始倒计时。",ko:"(?<player>\\y{Name}) 님이 초읽기를 취소했습니다\\."},areaSeal:{en:"(?<area>.*?) will be sealed off in (?<time>\\y{Float}) seconds!",de:"Noch (?<time>\\y{Float}) Sekunden, bis sich (?<area>.*?) schließt",fr:"Fermeture (?<area>.*?) dans (?<time>\\y{Float}) secondes[ ]?\\.",ja:"(?<area>.*?)の封鎖まであと(?<time>\\y{Float})秒",cn:"距(?<area>.*?)被封锁还有(?<time>\\y{Float})秒",ko:"(?<time>\\y{Float})초 후에 (?<area>.*?)(이|가) 봉쇄됩니다\\."},areaUnseal:{en:"(?<area>.*?) is no longer sealed.",de:"(?<area>.*?) öffnet sich erneut.",fr:"Ouverture (?<area>.*?)[ ]?!",ja:"(?<area>.*?)の封鎖が解かれた……",cn:"(?<area>.*?)的封锁解除了",ko:"(?<area>.*?)의 봉쇄가 해제되었습니다\\."},craftingStart:{en:"You begin synthesizing (?<count>(an?|\\d+) )?(?<recipe>.*)\\.",de:"Du hast begonnen, durch Synthese (?<count>(ein(e|es|em|er)?|\\d+) )?(?<recipe>.*) herzustellen\\.",fr:"Vous commencez à fabriquer (?<count>(une?|\\d+) )?(?<recipe>.*)\\.",ja:"(?<player>\\y{Name})は(?<recipe>.*)(×(?<count>\\d+))?の製作を開始した。",cn:"(?<player>\\y{Name})开始制作“(?<recipe>.*)”(×(?<count>\\d+))?。",ko:"(?<recipe>.*)(×(?<count>\\d+)개)? 제작을 시작합니다\\."},trialCraftingStart:{en:"You begin trial synthesis of (?<recipe>.*)\\.",de:"Du hast mit der Testsynthese von (?<recipe>.*) begonnen\\.",fr:"Vous commencez une synthèse d'essai pour une? (?<recipe>.*)\\.",ja:"(?<player>\\y{Name})は(?<recipe>.*)の製作練習を開始した。",cn:"(?<player>\\y{Name})开始练习制作(?<recipe>.*)。",ko:"(?<recipe>.*) 제작 연습을 시작합니다\\."},craftingFinish:{en:"You synthesize (?<count>(an?|\\d+) )?(?<recipe>.*)()?\\.",de:"Du hast erfolgreich (?<count>(ein(e|es|em|er)?|\\d+) )?(?<recipe>.*)()? hergestellt\\.",fr:"Vous fabriquez (?<count>(une?|\\d+) )?(?<recipe>.*)()?\\.",ja:"(?<player>\\y{Name})は(?<recipe>.*)()?(×(?<count>\\d+))?を完成させた！",cn:"(?<player>\\y{Name})制作“(?<recipe>.*)()?”(×(?<count>\\d+))?成功！",ko:"(?<player>\\y{Name}) 님이 (?<recipe>.*)()?(×(?<count>\\d+)개)?(을|를) 완성했습니다!"},trialCraftingFinish:{en:"Your trial synthesis of (?<recipe>.*) proved a success!",de:"Die Testsynthese von (?<recipe>.*) war erfolgreich!",fr:"Votre synthèse d'essai pour fabriquer (?<recipe>.*) a été couronnée de succès!",ja:"(?<player>\\y{Name})は(?<recipe>.*)の製作練習に成功した！",cn:"(?<player>\\y{Name})练习制作(?<recipe>.*)成功了！",ko:"(?<recipe>.*) 제작 연습에 성공했습니다!"},craftingFail:{en:"Your synthesis fails!",de:"Deine Synthese ist fehlgeschlagen!",fr:"La synthèse échoue\\.{3}",ja:"(?<player>\\y{Name})は製作に失敗した……",cn:"(?<player>\\y{Name})制作失败了……",ko:"제작에 실패했습니다……\\."},trialCraftingFail:{en:"Your trial synthesis of (?<recipe>.*) failed\\.{3}",de:"Die Testsynthese von (?<recipe>.*) ist fehlgeschlagen\\.{3}",fr:"Votre synthèse d'essai pour fabriquer (?<recipe>.*) s'est soldée par un échec\\.{3}",ja:"(?<player>\\y{Name})は(?<recipe>.*)の製作練習に失敗した……",cn:"(?<player>\\y{Name})练习制作(?<recipe>.*)失败了……",ko:"(?<recipe>.*) 제작 연습에 실패했습니다……\\."},craftingCancel:{en:"You cancel the synthesis\\.",de:"Du hast die Synthese abgebrochen\\.",fr:"La synthèse est annulée\\.",ja:"(?<player>\\y{Name})は製作を中止した。",cn:"(?<player>\\y{Name})中止了制作作业。",ko:"제작을 중지했습니다\\."},trialCraftingCancel:{en:"You abandoned trial synthesis\\.",de:"Testsynthese abgebrochen\\.",fr:"Vous avez interrompu la synthèse d'essai\\.",ja:"(?<player>\\y{Name})は製作練習を中止した。",cn:"(?<player>\\y{Name})停止了练习。",ko:"제작 연습을 중지했습니다\\."}};const V=new class{regexes;netRegexes;get localeRegex(){return this.regexes||(this.regexes=this.buildLocaleRegexes(z,e=>x.gameLog({line:`${e}.*?`}))),this.regexes}get localeNetRegex(){return this.netRegexes||(this.netRegexes=this.buildLocaleRegexes(z,e=>P.gameLog({line:`${e}[^|]*?`}))),this.netRegexes}buildLocaleRegexes(e,a){return Object.fromEntries(Object.entries(e).map(([e,t])=>[e,this.buildLocaleRegex(t,a)]))}buildLocaleRegex(e,a){const t=a(e.en);return{en:t,de:void 0!==e.de?a(e.de):t,fr:void 0!==e.fr?a(e.fr):t,ja:void 0!==e.ja?a(e.ja):t,cn:void 0!==e.cn?a(e.cn):t,ko:void 0!==e.ko?a(e.ko):t}}};V.localeRegex;const N=V.localeNetRegex,R=a({__name:"obs",setup(a){const P=[b.DutyRoulette,b.Dungeons,b.DeepDungeons,b.VCDungeonFinder,b.Pvp,b.Trials,b.Raids,b.UltimateRaids],x={Default:"default",UltimateOrRaidOrTrials:"ultimateOrRaidOrTrials",VcOrDeepDungeons:"vcOrDeepDungeons",Pvp:"pvp"},z=JSON.parse(window.localStorage.getItem("obs2-data")??"{}")?.password,V=T("obs-passwd",z??""),R=T("aster-obs-config",{host:"4455",greaterThan:0,userRecFilePath:"",suffixByZone:!0,inCombatStart:!0,autoForZones:P,recFilePaths:Object.fromEntries(Object.values(x).map(e=>[e,""]))});R.value.host=R.value.host.replace(/^.+?:/,"");const j={partyLength:1,inACTCombat:!1,zoneID:0,zoneName:"Unknown",zoneType:x.Default,reason:""},S=t({connected:!1,recording:!1}),O=new y,_=n(!1),k=n(!0),U=n(!1),L={...w.getDefaultBaseOptions()},Z=window.location.href.includes("?dev=1")?console.log:()=>{};async function B(e=!1){return O.connect(`ws://127.0.0.1:${R.value.host}`,V.value).then(()=>(R.value.userRecFilePath||A(),O.call("GetRecordStatus").then(e=>{S.recording=e.outputActive}),v.modal.message({content:"连接成功",status:"success",width:"7rem",size:"mini",top:8}),S.connected=!0,k.value=!1,_.value=!0,Promise.resolve(!0))).catch(()=>(S.connected=!1,e?v.modal.message({content:"连接失败",status:"error",width:"7rem",size:"mini",top:8}):k.value=!1,Promise.resolve(!1)))}async function A(){return O.call("GetRecordDirectory").then(e=>{e.recordDirectory&&(R.value.userRecFilePath=e.recordDirectory,""===R.value.recFilePaths.default&&(R.value.recFilePaths.default=e.recordDirectory))})}async function E(e=!1){if(!S.connected&&!(await B()))return Promise.resolve(!1);let a=R.value.userRecFilePath,t="";R.value.suffixByZone&&(t="%CCYY-%MM-%DD %hh-%mm-%ss"),e||(t&&(t+=` ${j.zoneName.replaceAll(":","_")}`),R.value.userRecFilePath||await A(),a=R.value.recFilePaths[j.zoneType]?.trim(),a||(a=R.value.recFilePaths.default));const n=[];return""!==a&&(Z("[setFolder] ",{revert:e,recFilePath:a}),n.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"SimpleOutput",parameterName:"FilePath",parameterValue:a}}),n.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"AdvOut",parameterName:"RecFilePath",parameterValue:a}})),""!==t&&(Z("[setName] ",{revert:e,filenameFormatting:t}),n.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"Output",parameterName:"FilenameFormatting",parameterValue:t}})),n.length>0?O.callBatch(n):Promise.resolve(!0)}async function I(e,a=!0,t=!1){Z("[obs_start_prepare] ",{recording:S.recording,data:j,reason:e,restart:a,justDoIt:t});try{if("countDown"===j.reason&&(j.reason=e),!t&&j.partyLength<=R.value.greaterThan)return Promise.resolve(!0);if(!S.connected&&!(await B()))return Promise.resolve(!1);if(S.recording&&!a)return Promise.resolve(!0);if(j.reason=e,S.recording&&a&&(await O.call("StopRecord"),await new Promise(e=>setTimeout(e,2e3))),!1!==await E(!1))return await new Promise(e=>setTimeout(e,500)),Z("[obs_start] ",{recording:S.recording,data:j,reason:e,restart:a,justDoIt:t}),O.call("StartRecord").then(()=>setTimeout(()=>E(!0),2e3))}catch(n){}return Promise.resolve(!1)}async function q(e=""){return Z("[obs_stop] ",{recording:S.recording,data:j,reason:e}),S.recording?O.call("StopRecord"):Promise.resolve(!0)}function Y(){S.connected=!1}function K(e){switch(e.outputState){case"OBS_WEBSOCKET_OUTPUT_STARTED":return void(S.recording=!0);case"OBS_WEBSOCKET_OUTPUT_STOPPED":S.recording=!1}}async function M(e){if(S.recording){if(a=e.rawLine,D.wipe.test(a)||/^41\|[^|]*\|[^|]*\|7DE\|/.test(a))return q("wipe");if("countDown"===j.reason&&function(e){return N.countdownCancel[L.ParserLanguage].test(e)}(e.rawLine))return q("countDown")}else if(function(e){return N.countdownStart[L.ParserLanguage].test(e)}(e.rawLine))return I("countDown",!1);var a;return Promise.resolve()}async function W(e){if(j.zoneID===e.zoneID)return Promise.resolve();j.zoneID=e.zoneID,j.zoneName=e.zoneName,j.zoneType=x.Default;const a=F[e.zoneID];return a&&a.contentType?(j.zoneName=a.name[L.ParserLanguage]??e.zoneName,j.zoneType=function(e){switch(e.contentType){case b.UltimateRaids:return x.UltimateOrRaidOrTrials;case b.Pvp:return x.Pvp;case b.DeepDungeons:case b.VCDungeonFinder:return x.VcOrDeepDungeons;case b.Trials:if(e.name.fr?.includes("(extrême)"))return x.UltimateOrRaidOrTrials;break;case b.Raids:if(e.name.en?.includes("(Savage)"))return x.UltimateOrRaidOrTrials}return x.Default}(a),Z(["changeZone"],{data:j,ev:e}),R.value.autoForZones.includes(a.contentType)?I("changeZone",!1):q("changeZone")):(Z(["changeZone"],{data:j,ev:e}),q("changeZone"))}const $=async e=>{if(!R.value.inCombatStart)return Promise.resolve();const a=j.inACTCombat;if(j.inACTCombat=e.detail.inACTCombat,Z(["InCombatChanged"],{now:e.detail.inACTCombat,prev:a,zoneName:j.zoneName,recording:S.recording}),await new Promise(e=>setTimeout(e,500)),!a&&e.detail.inACTCombat)return I("inCombat",!1);const t=F[j.zoneID],n=R.value.autoForZones.includes(t?.contentType??0);return!a||e.detail.inACTCombat||"inCombat"!==j.reason||n?Promise.resolve():q("inCombat")},G=e=>{j.partyLength=e.party?.length||1};function J(e){_.value="settings"!==e,k.value="settings"===e}return r(async()=>{O.on("ExitStarted",Y),O.on("ConnectionClosed",Y),O.on("ConnectionError",Y),O.on("RecordStateChanged",K),w.getUserConfigLocation("obs",L,()=>{C("LogLine",M),C("ChangeZone",W),C("onInCombatChangedEvent",$),C("PartyChanged",G)}),""!==V.value?await B(!0):v.modal.alert({content:"先锁定悬浮窗，再填写端口与密码",title:"初次使用",width:"80%",size:"mini"})}),(a,t)=>{const n=o("vxe-button"),r=o("vxe-form-item"),y=o("vxe-input"),P=o("vxe-switch"),D=o("vxe-checkbox"),C=o("vxe-checkbox-group"),x=o("vxe-form"),w=e;return s(),l(w,null,{default:i(()=>[c(u("header",null,[u("div",null,[c(u("i",{class:"vxe-icon-dot icon",style:m({color:p(S).recording?"red":"gray",textShadow:"0px  0px 3px black",margin:"1px"})},null,4),[[g,p(S).connected]]),c(d(n,{class:"btns",icon:"vxe-icon-caret-right",onClick:t[0]||(t[0]=e=>I("manual",!1,!0))},null,512),[[g,p(S).connected&&!p(S).recording]]),c(d(n,{class:"btns",icon:"vxe-icon-close",size:"mini",onClick:t[1]||(t[1]=e=>q("manual"))},null,512),[[g,p(S).connected&&p(S).recording]]),c(d(n,{class:"btns",icon:"vxe-icon-cut",size:"mini",onClick:t[2]||(t[2]=e=>I("manual",!0,!0))},null,512),[[g,p(S).connected&&p(S).recording]]),d(n,{class:"btns settings",icon:"vxe-icon-setting",size:"mini",onClick:t[3]||(t[3]=e=>J("settings"))})])],512),[[g,p(_)]]),c(u("main",null,[d(x,{data:p(R),"collapse-status":!p(U),"custom-layout":"",size:"mini"},{default:i(()=>[c(d(r,{span:"24","class-name":"hidePageBtn"},{default:i(()=>[d(n,{size:"mini",content:"隐藏页面",icon:"vxe-icon-eye-fill-close",onClick:t[4]||(t[4]=e=>J("header"))})]),_:1},512),[[g,p(k)]]),d(r,{span:"24",field:"host",title:"OBS服务器端口"},{default:i(()=>[d(y,{modelValue:p(R).host,"onUpdate:modelValue":t[5]||(t[5]=e=>p(R).host=e),type:"number",size:"small",style:{width:"70%","margin-right":"-5px"}},null,8,["modelValue"]),d(n,{content:"无法输入",size:"mini",icon:"vxe-icon-question",type:"text",status:"info",onClick:t[6]||(t[6]=e=>p(v).modal.message({content:"先点击ACT，再点击悬浮窗，即可正常输入"}))})]),_:1}),d(r,{span:"24",field:"password",title:"OBS服务器密码"},{default:i(()=>[d(y,{modelValue:p(V),"onUpdate:modelValue":t[7]||(t[7]=e=>f(V)?V.value=e:null),size:"small",placeholder:"密码",type:"password"},null,8,["modelValue"])]),_:1}),d(r,{span:"24",field:"inCombatStart",title:"进入战斗自动录制"},{default:i(()=>[d(P,{modelValue:p(R).inCombatStart,"onUpdate:modelValue":t[8]||(t[8]=e=>p(R).inCombatStart=e),"open-label":"是","close-label":"否"},null,8,["modelValue"])]),_:1}),d(r,{span:"24",field:"suffixByZone",title:"录像文件名添加副本名后缀"},{default:i(()=>[d(P,{modelValue:p(R).suffixByZone,"onUpdate:modelValue":t[9]||(t[9]=e=>p(R).suffixByZone=e),"open-label":"是","close-label":"否"},null,8,["modelValue"])]),_:1}),d(r,{span:"24",field:"greaterThan",title:"小队多于"},{default:i(()=>[d(y,{modelValue:p(R).greaterThan,"onUpdate:modelValue":t[10]||(t[10]=e=>p(R).greaterThan=e),size:"small",type:"integer",min:"0",max:"8",style:{width:"3rem"}},null,8,["modelValue"]),t[17]||(t[17]=h(" 人自动录制（8:永不自动） "))]),_:1,__:[17]}),d(r,{span:"24",field:"autoForZones",title:"进入区域自动录制","class-name":"zoneAuto",folding:"","title-overflow":""},{default:i(()=>[d(C,{modelValue:p(R).autoForZones,"onUpdate:modelValue":t[11]||(t[11]=e=>p(R).autoForZones=e)},{default:i(()=>[d(D,{label:p(b).UltimateRaids,content:"绝境战"},null,8,["label"]),d(D,{label:p(b).Raids,content:"大型Raid"},null,8,["label"]),d(D,{label:p(b).Trials,content:"讨伐战"},null,8,["label"]),d(D,{label:p(b).VCDungeonFinder,content:"异闻迷宫"},null,8,["label"]),d(D,{label:p(b).DeepDungeons,content:"深层迷宫"},null,8,["label"]),d(D,{label:p(b).Dungeons,content:"4人迷宫"},null,8,["label"]),d(D,{label:p(b).Pvp,content:"PVP"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),d(r,{span:"24",title:"录像目录（须保证目录存在，可留空）",folding:""}),d(r,{span:"24",title:"默认",folding:"","class-name":"recPaths"},{default:i(()=>[d(y,{modelValue:p(R).recFilePaths.default,"onUpdate:modelValue":t[12]||(t[12]=e=>p(R).recFilePaths.default=e),size:"small",placeholder:"留空则使用OBS录像目录",spellcheck:"false"},null,8,["modelValue"])]),_:1}),d(r,{span:"24",title:"高难",folding:"","class-name":"recPaths"},{default:i(()=>[d(y,{modelValue:p(R).recFilePaths.ultimateOrRaidOrTrials,"onUpdate:modelValue":t[13]||(t[13]=e=>p(R).recFilePaths.ultimateOrRaidOrTrials=e),size:"small",placeholder:"绝&零式&极神",spellcheck:"false"},null,8,["modelValue"])]),_:1}),d(r,{span:"24",title:"深层",folding:"","class-name":"recPaths"},{default:i(()=>[d(y,{modelValue:p(R).recFilePaths.vcOrDeepDungeons,"onUpdate:modelValue":t[14]||(t[14]=e=>p(R).recFilePaths.vcOrDeepDungeons=e),size:"small",placeholder:"深层&异闻迷宫",spellcheck:"false"},null,8,["modelValue"])]),_:1}),d(r,{span:"24",title:"PVP",folding:"","class-name":"recPaths"},{default:i(()=>[d(y,{modelValue:p(R).recFilePaths.pvp,"onUpdate:modelValue":t[15]||(t[15]=e=>p(R).recFilePaths.pvp=e),size:"small",placeholder:"玩家对战",spellcheck:"false"},null,8,["modelValue"])]),_:1}),d(r,{span:"24","collapse-node":""},{default:i(()=>[d(n,{size:"mini",status:"primary",icon:"vxe-icon-swap",content:"连接",onClick:t[16]||(t[16]=e=>B(!0))})]),_:1})]),_:1},8,["data","collapse-status"])],512),[[g,p(k)]])]),_:1})}}});export{R as default};
