import{az as j,s as B,X as oe,b as Q,o as b,e as N,x as i,a as n,w as o,F as se,M as le,u as e,c as L,a0 as re,ac as ie,a1 as ce,H as ue,I as de,d as pe,p as I,aA as me,A as d,$ as F,y as g,aB as V,aC as fe,K as _e,ag as he,C as ge,ak as be,O as we,am as ve,aD as Ce,at as ye,aE as Se,aF as Ee,ae as Ve,D as Te,af as De}from"./vendor-6ba522cf.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";import{C as m}from"./content_type-ecdd0c19.js";import{a as H,r as M,c as Re}from"./overlay_plugin_api-409cb9ea.js";import{N as W,c as Pe,l as Y}from"./netregexes-60f54b26.js";import{z as xe}from"./zoneInfo-f6341183.js";const Ne=T=>(ue("data-v-66d37cfa"),T=T(),de(),T),ke={class:"language-switcher"},Oe={class:"select-wrapper"},Ue=Ne(()=>i("svg",{class:"globe-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[i("circle",{cx:"12",cy:"12",r:"10"}),i("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),i("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})],-1)),Be={__name:"LanguageSwitcher",setup(T){const{locale:t,availableLocales:c}=j(),f={zhCn:"简体中文",en:"English",ja:"日本語"},w=B("user-locale",t.value);return oe(w,y=>{t.value=y}),Q(()=>{t.value=w.value}),(y,k)=>{const O=ie,U=ce;return b(),N("div",ke,[i("div",Oe,[Ue,n(U,{modelValue:e(w),"onUpdate:modelValue":k[0]||(k[0]=S=>re(w)?w.value=S:null),size:"small",class:"language-select"},{default:o(()=>[(b(!0),N(se,null,le(e(c),(S,E)=>(b(),L(O,{key:E,value:S,label:f[S]},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])])}}},Le=K(Be,[["__scopeId","data-v-66d37cfa"]]),Ae={class:"obs-container"},Ie={class:"card-header"},Fe={class:"act-not-ready-content"},$e={key:1},Ge={class:"card-header"},ze={key:1},qe={class:"card-header"},Ze={class:"status-info"},He={class:"button-container"},Me={class:"card-header"},We={class:"profile-info"},Ye={class:"file-path-explanation"},je={class:"file-name-explanation"},Qe={class:"card-header"},Ke=pe({__name:"obs2",setup(T){const{t}=j(),c=B("obs-user-config",{host:4455,password:"",path:"",fileName:""},localStorage,{writeDefaults:!0}),f=B("obs-user-content-setting",[]),w=B("obs-is-first-time",!0),y=I(!1),k=I(!1),O=I({});function U(){return new Promise(u=>{Re({call:"cactbotRequestState"}).then(()=>{y.value=!0,u()}),setTimeout(()=>{y.value||U()},3e3)})}const S={inCombat:W.inCombat(),countdown:W.countdown(),wipe:Pe.wipe},E=["Savage","Extreme","Ultimate","Dungeons","Raids","Trials","VCDungeonFinder","DeepDungeons","Guildhests","DisciplesOfTheLand","Eureka","GrandCompany","QuestBattles","TreasureHunt","Pvp","Default"],$={enter:!1,countdown:!0,combatStart:!1,combatEnd:!0,wipe:!0},G={enter:!1,countdown:!1,combatStart:!1,combatEnd:!1,wipe:!1};function X(){const u=["Savage","Extreme","Ultimate"];if(w.value)w.value=!1,f.value=[...u.map(a=>({type:a,...$})),...E.filter(a=>!u.includes(a)).map(a=>({type:a,...G}))];else{f.value=f.value.filter(s=>E.includes(s.type));const a=E.filter(s=>!f.value.some(p=>p.type===s)&&s!=="Default").map(s=>u.includes(s)?{type:s,...$}:{type:s,...G});f.value.push(...a)}f.value.sort((a,s)=>E.indexOf(a.type)-E.indexOf(s.type))}class J{constructor(){this.handleConnectionError=()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath="",V.modal.close(),V.modal.message({title:t("OBS Connection"),content:t("OBS Connection Error"),status:"warning",duration:2e3})},this.handleConnectionClosed=()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath="",V.modal.close(),V.modal.message({title:t("OBS Connection"),content:t("OBS Connection Closed"),status:"warning",duration:2e3})},this.ws=new fe,this.status=_e({connecting:!1,connected:!1,recording:!1,outputActive:!1,outputPath:""}),this.ws.on("ConnectionClosed",this.handleConnectionClosed),this.ws.on("ConnectionError",this.handleConnectionError),this.ws.on("RecordStateChanged",a=>{this.status.connected=!0,this.status.recording=a.outputState==="OBS_WEBSOCKET_OUTPUT_STARTED",this.status.outputActive=a.outputActive,this.status.outputPath=a.outputPath})}connect(a){c.value.host&&c.value.password&&(this.status.connecting=!0,this.ws.connect(`ws://127.0.0.1:${c.value.host}`,c.value.password).then(()=>{this.ws.call("GetRecordStatus").then(s=>{this.status.recording=s.outputActive,this.status.outputActive=s.outputActive}),this.status.connected=!0,V.modal.close(),V.modal.message({title:t("OBS Connection"),content:t("OBS Connection Opened"),status:"success",duration:2e3}),a&&a()}).finally(()=>{this.status.connecting=!1,c.value.path||this.ws.call("GetRecordDirectory").then(s=>{s.recordDirectory&&(c.value.path=s.recordDirectory)}),c.value.fileName||(c.value.fileName="%CCYY-%MM-%DD %hh-%mm-%ss")}))}disconnect(){this.ws.disconnect()}async startRecord(){await this.setProfileParameter(),this.ws.call("StartRecord")}stopRecord(){this.ws.call("StopRecord")}splitRecord(){this.ws.call("StopRecord").finally(()=>{setTimeout(()=>{this.ws.call("StartRecord")},1e3)})}async setProfileParameter(){const a=c.value.path,s=c.value.fileName,p=[];return p.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"AdvOut",parameterName:"RecFilePath",parameterValue:a}}),p.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"Output",parameterName:"FilenameFormatting",parameterValue:s}}),c.value.path=a,c.value.fileName=s,this.ws.callBatch(p)}}const l=new J,z=u=>{const a=u.zoneID,s=xe[a];O.value=s,D("enter")},q=u=>{const a=u.rawLine;for(const s in S)if(S[s].exec(a)){const v=a.split("|");switch(s){case"inCombat":{const _=v[Y.InCombat.fields.inACTCombat]==="1",P=v[Y.InCombat.fields.inGameCombat]==="1";if(_&&P){D("combatStart");return}if(!_&&!P){D("combatEnd");return}break}case"countdown":{D("countdown");break}case"wipe":{D("wipe");break}}}};function ee(u){var a,s;switch(u.contentType){case m.UltimateRaids:return"Ultimate";case m.Pvp:return"Pvp";case m.Dungeons:return"Dungeons";case m.DeepDungeons:return"DeepDungeons";case m.VCDungeonFinder:return"VCDungeonFinder";case m.Trials:return(a=u.name.fr)!=null&&a.includes("(extrême)")?"Extreme":"Trials";case m.Raids:return(s=u.name.en)!=null&&s.includes("(Savage)")?"Savage":"Raids";case m.DisciplesOfTheLand:return"DisciplesOfTheLand";case m.Eureka:return"Eureka";case m.GrandCompany:return"GrandCompany";case m.QuestBattles:return"QuestBattles";case m.TreasureHunt:return"TreasureHunt";default:return"Default"}}function D(u){const a=ee(O.value);if(!f.value.find(s=>s.type===a&&s[u])){u==="enter"&&l.stopRecord();return}switch(u){case"enter":case"countdown":case"combatStart":if(!l.status.connected){l.connect(()=>{l.startRecord()});return}if(l.status.recording===!1){l.startRecord();return}l.status.recording===!0&&u!=="combatStart"&&l.splitRecord();return;case"combatEnd":case"wipe":l.status.recording&&l.stopRecord()}}return Q(async()=>{await U(),l.connect(),H("ChangeZone",z),H("LogLine",q),X()}),me(()=>{l.disconnect(),M("ChangeZone",z),M("LogLine",q)}),(u,a)=>{const s=Le,p=he,R=ge,v=be,_=we,P=ve,te=Ce,A=ye,Z=Se,ae=Ee,C=Ve,x=Te,ne=De;return b(),N("div",Ae,[i("header",null,[i("h1",null,d(e(t)("OBS Auto Record V2")),1),n(s)]),e(y)?F("",!0):(b(),L(p,{key:0,class:"act-not-ready-card"},{header:o(()=>[i("div",Ie,[i("span",null,d(e(t)("ACT Not Ready")),1)])]),default:o(()=>[i("div",Fe,[i("p",null,d(e(t)("overlayTutorial")),1)])]),_:1})),e(y)?(b(),N("main",$e,[e(l).status.connected?(b(),N("div",ze,[n(A,{class:"instruction-alert",type:"info",description:e(t)("hideTutorial"),closable:!1,"show-icon":""},null,8,["description"]),e(k)?(b(),L(p,{key:0,class:"status-card"},{header:o(()=>[i("div",qe,[i("span",null,d(e(t)("Connection Status")),1),n(_,{type:"danger",size:"small",class:"disconnect-button",onClick:a[3]||(a[3]=r=>e(l).disconnect())},{default:o(()=>[g(d(e(t)("Disconnect")),1)]),_:1})])]),default:o(()=>[i("div",Ze,[n(ae,{direction:"vertical",column:1,border:""},{default:o(()=>[n(Z,{label:e(t)("Recording")},{default:o(()=>[g(d(e(l).status.recording?e(t)("Yes"):e(t)("No")),1)]),_:1},8,["label"]),n(Z,{label:e(t)("Output Path")},{default:o(()=>[g(d(e(l).status.outputPath||e(t)("None")),1)]),_:1},8,["label"])]),_:1})]),i("div",He,[n(_,{disabled:!e(l).status.connected||e(l).status.recording,type:"primary",onClick:a[4]||(a[4]=r=>e(l).startRecord())},{default:o(()=>[g(d(e(t)("Start Record")),1)]),_:1},8,["disabled"]),n(_,{disabled:!e(l).status.connected||!e(l).status.recording,type:"danger",onClick:a[5]||(a[5]=r=>e(l).stopRecord())},{default:o(()=>[g(d(e(t)("Stop Record")),1)]),_:1},8,["disabled"]),n(_,{disabled:!e(l).status.connected||!e(l).status.recording,type:"warning",onClick:a[6]||(a[6]=r=>e(l).splitRecord())},{default:o(()=>[g(d(e(t)("Split Record")),1)]),_:1},8,["disabled"]),n(_,{type:"primary",onClick:a[7]||(a[7]=r=>e(l).setProfileParameter())},{default:o(()=>[g(d(e(t)("Set Recording Name")),1)]),_:1})])]),_:1})):F("",!0),n(p,{class:"profile-card"},{header:o(()=>[i("div",Me,[i("span",null,d(e(t)("Recording Profile")),1)])]),default:o(()=>[i("div",We,[n(P,{"label-position":"top",class:"content-form"},{default:o(()=>[n(v,{label:e(t)("Record Path")},{default:o(()=>[n(R,{modelValue:e(c).path,"onUpdate:modelValue":a[8]||(a[8]=r=>e(c).path=r),placeholder:e(t)("recordPathPlaceholder")},null,8,["modelValue","placeholder"]),i("div",Ye,d(e(t)("filePathExplanation")),1)]),_:1},8,["label"]),n(v,{label:e(t)("Record File Name")},{default:o(()=>[n(R,{modelValue:e(c).fileName,"onUpdate:modelValue":a[9]||(a[9]=r=>e(c).fileName=r),placeholder:e(t)("recordFileNamePlaceholder")},null,8,["modelValue","placeholder"]),i("div",je,d(e(t)("fileNameExplanation")),1)]),_:1},8,["label"])]),_:1})])]),_:1}),n(p,{class:"table-card"},{header:o(()=>[i("div",Qe,[i("span",null,d(e(t)("User Content Settings")),1)])]),default:o(()=>[n(ne,{data:e(f),style:{width:"100%"},border:!0,stripe:""},{default:o(()=>[n(C,{prop:"type",label:e(t)("Type"),"min-width":"130",fixed:""},{default:o(r=>[i("span",null,d(e(t)(r.row.type)),1)]),_:1},8,["label"]),n(C,{label:e(t)("Start When"),align:"center"},{default:o(()=>[n(C,{prop:"enter",label:e(t)("Enter Zone"),align:"center","min-width":"95"},{default:o(r=>[n(x,{modelValue:r.row.enter,"onUpdate:modelValue":h=>r.row.enter=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),n(C,{prop:"countdown",label:e(t)("CountDown"),align:"center","min-width":"95"},{default:o(r=>[n(x,{modelValue:r.row.countdown,"onUpdate:modelValue":h=>r.row.countdown=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),n(C,{prop:"combatStart",label:e(t)("CombatStart"),align:"center","min-width":"95"},{default:o(r=>[n(x,{modelValue:r.row.combatStart,"onUpdate:modelValue":h=>r.row.combatStart=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),n(C,{label:e(t)("End When"),align:"center"},{default:o(()=>[n(C,{prop:"combatEnd",label:e(t)("CombatEnd"),align:"center","min-width":"95"},{default:o(r=>[n(x,{modelValue:r.row.combatEnd,"onUpdate:modelValue":h=>r.row.combatEnd=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),n(C,{prop:"wipe",label:e(t)("Wipe"),align:"center","min-width":"95"},{default:o(r=>[n(x,{modelValue:r.row.wipe,"onUpdate:modelValue":h=>r.row.wipe=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})])):(b(),L(p,{key:0,class:"connection-card"},{header:o(()=>[i("div",Ge,[i("span",null,d(e(t)("Connect to OBS")),1)])]),default:o(()=>[n(P,{"label-position":"top",class:"connection-form"},{default:o(()=>[n(v,{label:e(t)("Port")},{default:o(()=>[n(R,{modelValue:e(c).host,"onUpdate:modelValue":a[0]||(a[0]=r=>e(c).host=r),placeholder:e(t)("portPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(v,{label:e(t)("Password")},{default:o(()=>[n(R,{modelValue:e(c).password,"onUpdate:modelValue":a[1]||(a[1]=r=>e(c).password=r),placeholder:e(t)("passwordPlaceholder"),type:"password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(v,null,{default:o(()=>[n(_,{type:"primary",class:"connect-button",loading:e(l).status.connecting,disabled:e(l).status.connecting||!e(c).host||!e(c).password,onClick:a[2]||(a[2]=r=>e(l).connect())},{default:o(()=>[g(d(e(l).status.connecting?e(t)("Connecting"):e(t)("Connect")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),n(te,null,{default:o(()=>[g(d(e(t)("Instructions")),1)]),_:1}),n(A,{class:"instruction-alert",type:"info",description:e(t)("obsTutorial"),closable:!1,"show-icon":""},null,8,["description"]),n(A,{class:"instruction-alert",type:"info",description:e(t)("inputTutorial"),closable:!1,"show-icon":""},null,8,["description"])]),_:1}))])):F("",!0)])}}});const ot=K(Ke,[["__scopeId","data-v-ea1f6e0d"]]);export{ot as default};
