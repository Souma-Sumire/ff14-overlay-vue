import{U as e,f as t,x as s,J as a,O as o,y as n,a as l}from"./element-plus-901ad096.js";import{_ as r}from"./ThemeToggle-fb2e4d42.js";import{k as c,aX as u,r as i,l as p,q as d,G as _,x as f,B as m,y as h,o as v,D as b,E as g}from"./vue-49c48d91.js";import{_ as x}from"./_plugin-vue_export-helper-6a8c15be.js";import"./vendor-979eac9e.js";const y={class:"min-h-screen p-6"},D={style:{position:"absolute",top:"2em",right:"2em"}},w={class:"overflow-auto rounded bg-black p-3 text-xs text-green-400"},C=x(c({__name:"rsvDumper",setup(c){u();const x={SE2DC5B04_EE2DC5B04:"Action",S64755250_E64755250:"BNpcName",S74CFC3B0_E74CFC3B0:"Status",S13095D61_E13095D61:"InstanceContentTextData",SF15185AF_EF15185AF:"LogMessage",SCFE39641_ECFE39641:"NpcYell"},C=i([]),E=i(!1),k=i("");const S=async e=>{const t=e.raw,s=(await t.text()).split(/\r?\n/),a=new Set;C.value=[];for(const o of s){const e=o.split("|");if("252"!==e[0])continue;const t=F(e.slice(3,-2));if(!$(t,(new TextEncoder).encode("_rsv_")))continue;const s=j(t.slice(30)),n=s.str1.replace(/^(rsv_\d+)_[^_]+_[^_]+_[^_]+_[^_]+_([^_]{9}_[^_]+)$/,"$1_$2");if(a.has(n))continue;a.add(n);const l=x[n.slice(-19)]||"Unknown",r=Number(n.match(/_rsv_(\d+)_/)?.[1]);C.value.push({type:l,id:r,...s})}};function F(e){const t=[];for(const s of e){const e=Number.parseInt(s,16)>>>0;t.push(255&e,e>>8&255,e>>16&255,e>>24&255)}return new Uint8Array(t)}function $(e,t){const s=e.length-t.length;for(let a=0;a<=s;a++){let s=!0;for(let o=0;o<t.length;o++)if(e[a+o]!==t[o]){s=!1;break}if(s)return!0}return!1}function j(e){return{str1:B(e.slice(2)),str2:B(e.slice(50)),hexDump:U(e)}}function B(e){const t=e.indexOf(0),s=-1!==t?e.slice(0,t):e;return new TextDecoder("utf-8").decode(s)}function U(e,t=16){const s="0123456789ABCDEF",a=[];for(let o=0;o<e.length;o+=t){let n="",l="";for(let a=0;a<t;a++)if(o+a<e.length){const t=e[o+a];n+=`${s[t>>4]}${s[15&t]} `,l+=t>=32&&t<127?String.fromCharCode(t):"."}else n+="   ",l+=" ";a.push(`${n} ${l}`)}return a.join("\n")}function R(){if(0===C.value.length)return void l.error("请先上传日志文件");const e={};C.value.forEach(({type:t,id:s,str2:a})=>{e[t]||(e[t]=[]),e[t].push(`${s} ${a}`)});let t="";for(const[n,l]of Object.entries(e))t+=`=== ${n} ===\n${l.join("\n")}\n\n`;const s=new Blob([t],{type:"text/plain;charset=utf-8"}),a=URL.createObjectURL(s),o=document.createElement("a");o.href=a,o.download="rsv_results.txt",o.click(),URL.revokeObjectURL(a)}return(l,c)=>{const u=r,i=e,x=t,F=o,$=n,j=s,B=a;return v(),p("div",y,[c[4]||(c[4]=d("h1",{class:"mb-4 text-2xl font-bold"}," FFXIV RSV Dumper ",-1)),d("span",D,[_(u,{"storage-key":"rsv-dumper-theme"})]),_(i,{drag:"",action:"","auto-upload":!1,"show-file-list":!1,accept:".log,.txt",class:"upload-box",onChange:S},{default:h(()=>c[1]||(c[1]=[d("i",{class:"el-icon-upload"},null,-1),d("div",{class:"el-upload__text"},[b(" 拖拽日志文件到此处或 "),d("em",null,"点击上传")],-1)])),_:1,__:[1]}),C.value.length?(v(),f(x,{key:0,type:"success",class:"mb-4",disabled:0===C.value.length,onClick:R},{default:h(()=>c[2]||(c[2]=[b(" 保存结果到文件 ",-1)])),_:1,__:[2]},8,["disabled"])):m("",!0),C.value.length?(v(),f(j,{key:2,data:C.value,stripe:"",style:{width:"100%","margin-top":"20px"},border:""},{default:h(()=>[_($,{prop:"type",label:"Type"}),_($,{prop:"id",label:"ID"}),_($,{prop:"str1",label:"RSV Data 1",width:"400"}),_($,{prop:"str2",label:"RSV Data 2"}),_($,{label:"操作",width:"150"},{default:h(e=>[_(x,{size:"small",type:"primary",onClick:t=>{return s=e.row,k.value=s.hexDump,void(E.value=!0);var s}},{default:h(()=>c[3]||(c[3]=[b(" 查看 HexDump ",-1)])),_:2,__:[3]},1032,["onClick"])]),_:1})]),_:1},8,["data"])):(v(),f(F,{key:1,description:"请上传 act.log 文件",class:"mt-6"})),_(B,{modelValue:E.value,"onUpdate:modelValue":c[0]||(c[0]=e=>E.value=e),title:"HexDump 原始数据",width:"50%","append-to-body":!0},{default:h(()=>[d("pre",w,g(k.value),1)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-e16205ba"]]);export{C as default};
