import{i as e,Z as a,V as t,o as r}from"./shared-core-BgKcFmJF.js";import{M as s}from"./map-DW4z5uTS.js";import{o as n,B as o,A as l,t as i,H as u,L as v,X as c,R as p,am as m,M as f,Z as y,c as d,r as x,v as h,u as k}from"./vendor-vue-GqahCgpc.js";import{_ as M}from"./shared-common-D9V8nqTO.js";const z=["src"],g=M(n({__name:"MapCanvas",props:{mapId:{type:Number,required:!0},markers:{type:Array,required:!0},size:{type:Number,default:180},forceTerritoryType:{type:Number,default:void 0}},setup(n){const h=n,k=d(()=>{if(0===h.mapId&&!h.forceTerritoryType)return;const a=h.forceTerritoryType??e(h.mapId),t=s[a.toString()];return t?`https://v2.xivapi.com/api/asset/map/${t.id}`:void 0});function M(s){const n=h.forceTerritoryType??e(h.mapId),o=a[n]??{sizeFactor:100,offsetX:0,offsetY:0},l=new t(s.x,s.z),i=new t(o.offsetX,o.offsetY);return r(l,i,o.sizeFactor)}const g=x(0),b=x(0),w=x(.5),T=x(16),I=x(!1);let $=0,_=0;function D(e){e.preventDefault(),I.value=!0,$=e.clientX-g.value,_=e.clientY-b.value}function X(e){e.preventDefault(),I.value&&(g.value=e.clientX-$,b.value=e.clientY-_)}function Y(e){e.preventDefault(),I.value=!1}function j(e){e.preventDefault();const a=e.deltaY>0?.9:1.1;let t=w.value*a;t=Math.min(4,Math.max(.2,t));const r=e.currentTarget.getBoundingClientRect(),s=e.clientX-r.left,n=e.clientY-r.top;g.value=s-(s-g.value)*t/w.value,b.value=n-(n-b.value)*t/w.value,w.value=t}function A(e){const a=M(e),t=Math.max(1/w.value*T.value,T.value);return{"--left":`${a.x}px`,"--top":`${a.y}px`,"--font-size":`${t}px`}}const B=d(()=>({width:`${h.size}px`,height:`${h.size}px`,overflow:"hidden",position:"relative",cursor:I.value?"grabbing":"grab",userSelect:"none"})),C=d(()=>({transform:`translate(${g.value}px, ${b.value}px) scale(${w.value})`,transformOrigin:"top left",width:"2048px",height:"2048px",position:"absolute",left:0,top:0})),F=x(null),N=x(!1);return o(()=>{const e=new IntersectionObserver(a=>{a[0]?.isIntersecting&&(N.value=!0,e.disconnect())},{rootMargin:"200px"});F.value&&e.observe(F.value)}),l(()=>h.markers,()=>{const e=h.markers.filter(e=>e.active);if(0===e.length)return w.value=.5,g.value=h.size/2-1024*w.value,void(b.value=h.size/2-1024*w.value);const a=e.reduce((e,a)=>{const t=M(a);return e.x+=t.x,e.y+=t.y,e},{x:0,y:0});a.x/=e.length,a.y/=e.length;let t=1/0,r=-1/0,s=1/0,n=-1/0;for(const c of e){const e=M(c);t=Math.min(t,e.x),r=Math.max(r,e.x),s=Math.min(s,e.y),n=Math.max(n,e.y)}const o=r-t,l=n-s,i=h.size/o,u=h.size/l;let v=Math.min(i,u);v=Math.min(1,Math.max(.5,.5*v)),w.value=v,g.value=h.size/2-a.x*w.value,b.value=h.size/2-a.y*w.value},{immediate:!0,deep:!0}),(e,a)=>(i(),u("div",{ref_key:"containerRef",ref:F,class:"crop-custom",style:v(B.value),onMousedown:D,onMousemove:X,onMouseup:Y,onMouseleave:Y,onWheel:j},[N.value?(i(),u("div",{key:0,class:"crop-1024",style:v(C.value)},[k.value?(i(),u("img",{key:0,src:k.value,alt:""},null,8,z)):c("",!0),(i(!0),u(p,null,m(n.markers,e=>(i(),u("span",{key:e.key,class:f(`markIcon markIcon${e.key}`),style:v([A(e)])},y(e.active?e.label:""),7))),128))],4)):c("",!0)],36))}}),[["__scopeId","data-v-3859379f"]]),b=n({__name:"WaymarkDisplay",props:{waymark:{},size:{}},setup(e){const a=e,t=a.size??180,r=["A","B","C","D","1","2","3","4"],s=[1,2,4,8,16,32,64,128];const n=d(()=>["A","B","C","D","One","Two","Three","Four"].map((e,t)=>{const n=a.waymark[e];return{key:e,label:r[t]??"",x:n.x/1e3,z:n.z/1e3,active:(o=t,0!==((a.waymark?.enableFlag??0)&(s[o]??0)))};var o}));return(a,r)=>(i(),h(g,{"map-id":e.waymark.regionID,markers:n.value,size:k(t)},null,8,["map-id","markers","size"]))}});export{g as M,b as _};
