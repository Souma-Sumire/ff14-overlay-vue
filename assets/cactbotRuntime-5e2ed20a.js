import{_ as e}from"./ActWrapper-e786b171.js";import{u as a,_ as t}from"./DragJob-149fe793.js";import{d as r,r as o,o as n,g as l,j as s,n as i,f as u,i as p,e as m,B as c,u as d,$ as y,t as f,F as j,k as v,q as b}from"./index-69ca15d8.js";/* empty css               */import{b as g,E as h}from"./el-select-62c124de.js";import"./el-scrollbar-f2fc6745.js";import"./el-popper-91f3c7b9.js";import{E as k}from"./el-overlay-4a491ec3.js";import{u as x,e as P,a as _}from"./index-1b007194.js";import{u as w}from"./useDev-91a28710.js";import{U as E}from"./util-3591e9ca.js";import{a as C,c as J}from"./overlay_plugin_api-974cdd44.js";import{_ as T}from"./_plugin-vue_export-helper-6a8c15be.js";import"./el-card-71d081c7.js";import"./useDemo-c9dbd10f.js";import"./el-checkbox-ded0492c.js";import"./index-c422ab29.js";import"./use-form-common-props-c7fcd980.js";import"./isEqual-af956916.js";import"./index-42820bfa.js";import"./index-b982c1ac.js";import"./index-ab2cc9cb.js";import"./focus-trap-cb50c8bb.js";import"./scroll-62e52a12.js";import"./vnode-b73dd9bc.js";import"./index-8edd9263.js";import"./index-2fdf7aca.js";const D={class:"cactbot-runtime"},U={key:0,class:"you"},V={key:1,class:"players"},O={class:"job-name"},R={key:0,class:"player-name"},L={key:0,style:{position:"fixed",bottom:"0"}},N=T(r({__name:"cactbotRuntime",setup(r){const T=a(),N=o(!1);function S(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const q=o(!1),z=[{id:"10000001",name:"虚构暗骑",job:32,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构龙骑",job:22,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0},{id:"10000007",name:"虚构画家",job:42,inParty:!0}],F=x("cactbotRuntime-data",{party:[]}),G=x("cactbotRuntime-showTips",o(!0)),M=x("cactbotRuntime-roleSelectLength",{tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0}),A={tank:["MT","ST",...S("T",6,2)],healer:[...S("H",8)],dps:[...S("D",8)],crafter:[...S("C",8)],gatherer:[...S("G",8)],none:[...S("N",8)]};function B(e){const a=H(e);return A[a].filter((e,t)=>t<M.value[a])}const I=w(),K=o(I.value?z[2].name:"");function H(e){return[1,3,19,21,32,37].includes(e)?"tank":[6,24,28,33,40].includes(e)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39,41,42].includes(e)?"dps":E.isCraftingJob(E.jobEnumToJob(e))?"crafter":E.isGatheringJob(E.jobEnumToJob(e))?"gatherer":"none"}function W(e){return A[H(e.job)].find(e=>!F.value.party.find(a=>a.rp===e))??"unknown"}function $(){const e=[...A.tank,...A.healer,...A.dps,...A.crafter,...A.gatherer,...A.none];F.value.party.sort((a,t)=>e.indexOf(a.rp??"unknown")-e.indexOf(t.rp??"unknown")),J({call:"broadcast",source:"soumaRuntimeJS",msg:{party:F.value.party}})}function Q(){!function(){F.value.party.sort((e,a)=>T.arr.indexOf(e.job)-T.arr.indexOf(a.job));for(const e of F.value.party)e.rp=void 0;for(const e of F.value.party)e.rp=W(e)}(),function(){for(const e in M.value)Object.prototype.hasOwnProperty.call(M.value,e)&&(M.value[e]=F.value.party.reduce((a,t)=>H(t.job)===e?a+1:a,0))}(),$()}function X(){const e={party:z};G.value&&(q.value=!0),F.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),Q()}return n(()=>{const e=P({storageKey:"cactbot-runtime-theme"}),a=_(e);!1===e.value&&a(),document.body.addEventListener("mouseenter",()=>N.value=!0),document.body.addEventListener("mouseleave",()=>N.value=!1),$(),C("PartyChanged",e=>{G.value&&(q.value=!0),I.value&&0===e.party.length||(F.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),Q())}),C("ChangePrimaryPlayer",e=>{I.value||(K.value=e.charName)}),C("BroadcastMessage",e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&$()})}),(a,r)=>{const o=k,n=g,x=h,P=t,_=e;return i(),l(_,null,{default:s(()=>[u("div",D,[p(o,{modelValue:d(q),"onUpdate:modelValue":r[0]||(r[0]=e=>y(q)?q.value=e:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:r[1]||(r[1]=e=>{q.value=!1,G.value=!1})},{header:s(()=>r[3]||(r[3]=[u("span",null,"用法",-1)])),default:s(()=>r[4]||(r[4]=[u("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1),u("ul",null,[u("li",null,"临时：下拉选择框修改。"),u("li",null,"长期：用鼠标拖动职能顺序。")],-1)])),_:1},8,["modelValue"]),u("main",null,[d(N)?(i(),m("div",V,[(i(!0),m(j,null,v(d(F).party,(e,a)=>{return i(),m("section",{key:e.id,class:b(["player",{"is-you":e.name===d(K)}])},[p(x,{modelValue:e.rp,"onUpdate:modelValue":a=>e.rp=a,size:"small",class:"select","fit-input-width":"",placement:"right",offset:8,onChange:e=>function(e){const a=F.value.party.find(a=>a.rp===F.value.party[e].rp&&a.id!==F.value.party[e].id);a&&(a.rp=W(a)),$()}(a)},{default:s(()=>[(i(!0),m(j,null,v(B(e.job),(e,a)=>(i(),l(n,{key:a,value:e,label:e},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),u("span",O,f((t=e.job,E.jobToFullName(E.jobEnumToJob(t)).simple1)),1),d(N)?(i(),m("span",R,f(e.name),1)):c("",!0)],2);var t}),128)),d(N)?(i(),l(P,{key:0,class:"drag-job",party:d(F).party,"p-1":"",onUpdate:Q},null,8,["party"])):c("",!0)])):(i(),m("div",U,f(d(F).party.find(e=>e.name===d(K))?.rp??""),1))]),d(I)?(i(),m("div",L,[u("button",{onClick:r[2]||(r[2]=e=>{d(F).party=d(F).party.filter(e=>e.name===d(K)),Q()})}," 测试单人 "),u("button",{onClick:X}," 测试组队 ")])):c("",!0)])]),_:1})}}}),[["__scopeId","data-v-08d06ab6"]]);export{N as default};
