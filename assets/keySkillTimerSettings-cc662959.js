import{y as e,f as l,e as a,c as t,k as s,m as o,b as n,x as i,J as d,i as r,_ as u,I as c,D as m,n as p,$ as f,g as b,a as _}from"./element-plus-901ad096.js";import{_ as k}from"./ThemeToggle-fb2e4d42.js";import{al as h}from"./vendor-979eac9e.js";import{i as y,u as g,s as v,a as w}from"./keySkills-78bd60df.js";import{U as V}from"./util-3591e9ca.js";import{k as A,al as j,r as D,K as S,x as U,o as x,y as z,G as T,q as I,D as C,u as B,l as O,F as M,ae as E,V as L}from"./vue-49c48d91.js";import{_ as J}from"./_plugin-vue_export-helper-6a8c15be.js";import{a as N,b as F}from"./res-action-f84fe53b.js";import{c as $}from"./clipboard-e5e2548c.js";import"./useDemo-86956ef5.js";import"./useDev-861d544b.js";import"./chineseToIcon-e0fcd48d.js";import"./res-status-9bc9036c.js";import"./tts-30083447.js";import"./cactbot-49e370f3.js";const q={style:{display:"flex","justify-content":"center",gap:"0px"},class:"actions"},G=["src"],K=J(A({__name:"KeySkillTable",props:{data:{}},emits:["delete","move"],setup(d,{emit:r}){const u=d,c=r,m=Object.freeze(V.getBattleJobs()),p=j(m.map(e=>({value:V.jobToJobEnum(e),label:V.jobToFullName(e)?.cn??e}))),f=D(new Map),b={};return S(()=>u.data.map(e=>({key:e.key,id:e.id})),e=>{e.forEach(({key:e,id:l})=>{b[e]&&clearTimeout(b[e]),b[e]=window.setTimeout(()=>{f.value.set(e,y(l)),f.value=new Map(f.value)},1e3)})},{immediate:!0,deep:!0}),(d,r)=>{const m=l,b=a,_=e,k=t,h=o,g=s,v=n,w=i;return x(),U(w,{data:u.data,border:"",size:"small","row-key":e=>e.key,height:620},{default:z(()=>[T(_,{label:"操作",width:"80",align:"center"},{default:z(({row:e,$index:l})=>[I("div",q,[T(m,{link:"",size:"small",type:"primary",disabled:0===l,class:"arrow",onClick:e=>c("move",l,l-1)},{default:z(()=>r[0]||(r[0]=[C(" ↑ ",-1)])),_:2,__:[0]},1032,["disabled","onClick"]),T(m,{link:"",size:"small",type:"primary",disabled:l===u.data.length-1,class:"arrow",onClick:e=>c("move",l,l+1)},{default:z(()=>r[1]||(r[1]=[C(" ↓ ",-1)])),_:2,__:[1]},1032,["disabled","onClick"]),T(b,{title:"确定删除吗？此操作无法撤销",placement:"top-start",onConfirm:l=>c("delete",e.key)},{reference:z(()=>[T(m,{link:"",type:"danger",size:"small"},{default:z(()=>r[2]||(r[2]=[C(" 删除 ",-1)])),_:1,__:[2]})]),_:2},1032,["onConfirm"])])]),_:1}),T(_,{label:"预览",width:"50",align:"center"},{default:z(({row:e})=>[I("img",{src:B(f).get(e.key)??B(y)(e.id),class:"icon"},null,8,G)]),_:1}),T(_,{label:"ID(十进制)",width:"200"},{default:z(({row:e})=>[T(k,{modelValue:e.id,"onUpdate:modelValue":l=>e.id=l,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),T(_,{label:"TTS",width:"100"},{default:z(({row:e})=>[T(k,{modelValue:e.tts,"onUpdate:modelValue":l=>e.tts=l,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),T(_,{label:"持续时间(秒)",width:"180"},{default:z(({row:e})=>[T(k,{modelValue:e.duration,"onUpdate:modelValue":l=>e.duration=l,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),T(_,{label:"冷却时间 (秒)",width:"140"},{default:z(({row:e})=>[T(k,{modelValue:e.recast1000ms,"onUpdate:modelValue":l=>e.recast1000ms=l,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),T(_,{label:"适用职业","min-width":"100"},{default:z(({row:e})=>[T(g,{modelValue:e.job,"onUpdate:modelValue":l=>e.job=l,size:"small",multiple:""},{default:z(()=>[(x(!0),O(M,null,E(B(p),e=>(x(),U(h,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),T(_,{label:"最小习得等级",width:"90",align:"center"},{default:z(({row:e})=>[T(v,{modelValue:e.minLevel,"onUpdate:modelValue":l=>e.minLevel=l,min:1,max:100,size:"small","controls-position":"right",style:{width:"70px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),T(_,{label:"显示到第n行",width:"100",align:"center"},{default:z(({row:e})=>[T(v,{modelValue:e.line,"onUpdate:modelValue":l=>e.line=l,min:1,size:"small","controls-position":"right",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data","row-key"])}}}),[["__scopeId","data-v-13037c6b"]]),Q={class:"page-container"},H={style:{height:"300px","overflow-y":"auto"}},P=["data-src"],R=J(A({__name:"keySkillTimerSettings",setup(a){const s=g(),o=D("chinese"),n={chinese:"国服技能数据",global:"国际服技能数据"};function V(){b.confirm(`是否重置「${n[o.value]}」为默认技能数据？这将覆盖当前编辑的内容。`,"确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{"chinese"===o.value?s.keySkillsData.chinese=[...v]:s.keySkillsData.global=[...w],_.success(`已重置${n[o.value]}`)}).catch(()=>{})}function A(e,l){const a=s.keySkillsData[e],t=a.findIndex(e=>e.key===l);-1!==t&&a.splice(t,1)}function j(e,l,a){const t=s.keySkillsData[e];if(a<0||a>=t.length||l===a)return;const o=t[l];o&&(t.splice(l,1),t.splice(a,0,o))}function U(){const e=JSON.stringify(s.keySkillsData),l=h.compressToBase64(e);$(l).then(()=>_.success("已复制到剪贴板")).catch(()=>_.error("复制失败"))}function M(){b.prompt("请输入导入的技能数据，导入的数据将覆盖当前内容。","导入",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputValidator:e=>{try{const l=h.decompressFromBase64(e),a=JSON.parse(l);return"object"==typeof a&&null!==a||"数据格式错误"}catch(l){return`数据格式错误: ${l instanceof Error?l.message:String(l)}`}}}).then(({value:e})=>{if(e){const l=h.decompressFromBase64(e),a=JSON.parse(l);"object"==typeof a&&null!==a?(s.keySkillsData.chinese=a.chinese,s.keySkillsData.global=a.global,_.success("已导入数据")):_.error("导入数据格式错误")}}).catch(()=>{})}const E=D(!1),J=D(""),q=D([]);S(J,e=>{if(e){const l=[];for(const[a,t]of Object.entries(N))if(t.includes(e)){const e=Number(a);F(e)&&l.push({id:e,name:t})}q.value=l}});const G=new Map;function R(e){e&&e instanceof HTMLImageElement&&function(e){const l=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const a=e.target;a.src=a.dataset.src,l.unobserve(a)}})});l.observe(e),G.set(e,()=>l.unobserve(e))}(e)}return L(()=>{G.forEach(e=>e()),G.clear()}),(a,b)=>{const _=t,h=m,g=c,v=e,w=i,D=d,S=l,L=p,N=k,F=r,$=f,G=u;return x(),O("div",Q,[T(D,{modelValue:E.value,"onUpdate:modelValue":b[1]||(b[1]=e=>E.value=e),width:"500"},{default:z(()=>[T(g,{"label-width":"100px"},{default:z(()=>[T(h,{label:"技能名称"},{default:z(()=>[T(_,{modelValue:J.value,"onUpdate:modelValue":b[0]||(b[0]=e=>J.value=e),clearable:"",placeholder:"请输入技能名称"},null,8,["modelValue"])]),_:1})]),_:1}),I("div",H,[T(w,{data:q.value,style:{width:"100%"}},{default:z(()=>[T(v,{label:"预览",width:"60",align:"center"},{default:z(({row:e})=>[I("img",{ref:R,"data-src":B(y)(e.id),src:"data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwgAAACH5BAEAAAIALAAAAAAQABAAAAM6CLrc/jDKSau9OOvNu/9gKI5kaZ5oqub5bSqVefrb7r3rtf1B7n8fqw7GZ0cL+o8P8fAQA7",loading:"lazy",style:{width:"24px",height:"24px"},alt:""},null,8,P)]),_:1}),T(v,{prop:"id",label:"技能ID（十进制）"}),T(v,{prop:"name",label:"技能名称"})]),_:1},8,["data"])])]),_:1},8,["modelValue"]),T(F,{class:"header"},{default:z(()=>[T(S,{size:"small",type:"success",onClick:b[2]||(b[2]=e=>{return l=o.value,void s.keySkillsData[l].unshift({key:crypto.randomUUID(),id:0,tts:"",duration:0,recast1000ms:0,job:[],line:1,minLevel:1});var l})},{default:z(()=>b[11]||(b[11]=[C(" 新增技能 ",-1)])),_:1,__:[11]}),T(S,{size:"small",type:"info",onClick:b[3]||(b[3]=e=>E.value=!0)},{default:z(()=>b[12]||(b[12]=[C(" 搜索技能ID ",-1)])),_:1,__:[12]}),T(L,null,{default:z(()=>[T(S,{size:"small",onClick:U},{default:z(()=>b[13]||(b[13]=[C(" 导出 ",-1)])),_:1,__:[13]}),T(S,{size:"small",onClick:M},{default:z(()=>b[14]||(b[14]=[C(" 导入 ",-1)])),_:1,__:[14]})]),_:1}),T(S,{size:"small",type:"danger",onClick:V},{default:z(()=>b[15]||(b[15]=[C(" 恢复默认 ",-1)])),_:1,__:[15]}),T(N,{"storage-key":"key-skill-timer-2"})]),_:1}),T(G,{modelValue:o.value,"onUpdate:modelValue":b[10]||(b[10]=e=>o.value=e),"tab-position":"top",type:"border-card",class:"tabs"},{default:z(()=>[T($,{label:n.chinese,name:"chinese"},{default:z(()=>[T(K,{data:B(s).keySkillsData.chinese,"onUpdate:data":b[4]||(b[4]=e=>B(s).keySkillsData.chinese=e),onDelete:b[5]||(b[5]=e=>A("chinese",e)),onMove:b[6]||(b[6]=(e,l)=>j("chinese",e,l))},null,8,["data"])]),_:1},8,["label"]),T($,{label:n.global,name:"global"},{default:z(()=>[T(K,{data:B(s).keySkillsData.global,"onUpdate:data":b[7]||(b[7]=e=>B(s).keySkillsData.global=e),onDelete:b[8]||(b[8]=e=>A("global",e)),onMove:b[9]||(b[9]=(e,l)=>j("global",e,l))},null,8,["data"])]),_:1},8,["label"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-8dfe5c1e"]]);export{R as default};
