import{u as e}from"./useLang-BHFoJekE.js";import{E as t}from"./index-BxKb6PE7.js";import{U as r,h as a,bL as n,P as o,bM as l,ak as s,aJ as i,d as c,S as d,r as u,f as m,u as p,A as h,j as f,z as y,ad as g,bh as w,M as v,Q as b,ao as x,ab as R,bg as k,O as S,ah as C,B as I,X as T,a3 as E,b as H,aQ as F,i as D,ap as j,n as M,aF as L,aZ as N,F as A,bA as O,a2 as $,bN as W,V as K,T as z,ae as B,Y as P,bD as _,bO as G,bP as V,ax as q,a0 as U,bk as Y,c as Z,o as X,a as J,t as Q,x as ee,aH as te,k as re,w as ae,D as ne,e as oe,s as le,m as se,bj as ie,bQ as ce,q as de,E as ue,g as me,bR as pe,bc as he,y as fe,l as ye,v as ge,a5 as we,aU as ve,aT as be,aK as xe,bS as Re}from"./index-Cq59E5Z-.js";import{_ as ke}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{E as Se}from"./el-empty-B7b65Uog.js";import{B as Ce,d as Ie,c as Te}from"./el-tag-B9edM2Jl.js";import{c as Ee}from"./clipboard-BKuKuDeo.js";import{U as He}from"./util-BGyYb48-.js";import"./el-popper-BeFIGDj_.js";/* empty css                   */import{E as Fe}from"./el-divider-D2br3xwl.js";import{E as De}from"./index-DeUU-LgT.js";import{s as je,c as Me,a as Le}from"./status-DByfmrmu.js";import{h as Ne,g as Ae}from"./xivapi-a6oZXlzI.js";import{c as Oe,r as $e}from"./raf-CCaxaky_.js";import{c as We}from"./vnode-CkGlpno0.js";import{E as Ke,a as ze}from"./el-select-BySNDI6o.js";import{E as Be}from"./el-button-owkyET3i.js";import{u as Pe}from"./useDev-xe_bXPQu.js";import{g as _e}from"./actionChinese-zA7S_Xwp.js";import{l as Ge}from"./regexes-BKeG-dSP.js";import{N as Ve}from"./netregexes-RPvCCaeG.js";import{a as qe}from"./overlay_plugin_api-DHbPkDtN.js";import"./use-form-common-props-C7UKOXL9.js";import"./index-1YdC5zX4.js";import"./index-Xtb1OXrd.js";import"./index-nqBnh3XA.js";import"./index-qLPM1z_o.js";var Ue=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function Ye(e,t){return e===t||!(!Ue(e)||!Ue(t))}function Ze(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!Ye(e[r],t[r]))return!1;return!0}const Xe=()=>{const e=r().proxy.$props;return a(()=>{const t=(e,t,r)=>({});return e.perfMode?n(t):function(e,t){void 0===t&&(t=Ze);var r=null;function a(){for(var a=[],n=0;n<arguments.length;n++)a[n]=arguments[n];if(r&&r.lastThis===this&&t(a,r.lastArgs))return r.lastResult;var o=e.apply(this,a);return r={lastResult:o,lastArgs:a,lastThis:this},o}return a.clear=function(){r=null},a}(t)})},Je="itemRendered",Qe="scroll",et="forward",tt="backward",rt="auto",at="smart",nt="start",ot="center",lt="end",st="horizontal",it="vertical",ct="negative",dt="positive-ascending",ut="positive-descending",mt={[st]:"left",[it]:"top"},pt=l({type:s([Number,Function]),required:!0}),ht=l({type:Number}),ft=l({type:Number,default:2}),yt=l({type:String,values:["ltr","rtl"],default:"ltr"}),gt=l({type:Number,default:0}),wt=l({type:Number,required:!0}),vt=l({type:String,values:["horizontal","vertical"],default:it}),bt=o({className:{type:String,default:""},containerElement:{type:s([String,Object]),default:"div"},data:{type:s(Array),default:()=>i([])},direction:yt,height:{type:[String,Number],required:!0},innerElement:{type:[String,Object],default:"div"},innerProps:{type:s(Object),default:()=>({})},style:{type:s([Object,String,Array])},useIsScrolling:Boolean,width:{type:[Number,String],required:!1},perfMode:{type:Boolean,default:!0},scrollbarAlwaysOn:Boolean}),xt=o({cache:ft,estimatedItemSize:ht,layout:vt,initScrollOffset:gt,total:wt,itemSize:pt,...bt}),Rt={type:Number,default:6},kt={type:Number,default:0},St={type:Number,default:2},Ct=o({columnCache:ft,columnWidth:pt,estimatedColumnWidth:ht,estimatedRowHeight:ht,initScrollLeft:gt,initScrollTop:gt,itemKey:{type:s(Function),default:({columnIndex:e,rowIndex:t})=>`${t}:${e}`},rowCache:ft,rowHeight:pt,totalColumn:wt,totalRow:wt,hScrollbarSize:Rt,vScrollbarSize:Rt,scrollbarStartGap:kt,scrollbarEndGap:St,role:String,...bt}),It=o({alwaysOn:Boolean,class:String,layout:vt,total:wt,ratio:{type:Number,required:!0},clientSize:{type:Number,required:!0},scrollFrom:{type:Number,required:!0},scrollbarSize:Rt,startGap:kt,endGap:St,visible:Boolean}),Tt=(e,t)=>e<t?et:tt,Et=e=>"rtl"===e;let Ht=null;function Ft(e=!1){if(null===Ht||e){const e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",t.direction="rtl";const r=document.createElement("div"),a=r.style;return a.width="100px",a.height="100px",e.appendChild(r),document.body.appendChild(e),e.scrollLeft>0?Ht=ut:(e.scrollLeft=1,Ht=0===e.scrollLeft?ct:dt),document.body.removeChild(e),Ht}return Ht}const Dt=c({name:"ElVirtualScrollBar",props:It,emits:["scroll","start-move","stop-move"],setup(e,{emit:t}){const r=a(()=>e.startGap+e.endGap),n=d("virtual-scrollbar"),o=d("scrollbar"),l=u(),s=u();let i=null,c=null;const w=m({isDragging:!1,traveled:0}),v=a(()=>Ce[e.layout]),b=a(()=>e.clientSize-p(r)),x=a(()=>({position:"absolute",width:`${st===e.layout?b.value:e.scrollbarSize}px`,height:`${st===e.layout?e.scrollbarSize:b.value}px`,[mt[e.layout]]:"2px",right:"2px",bottom:"2px",borderRadius:"4px"})),R=a(()=>{const t=e.ratio;if(t>=100)return Number.POSITIVE_INFINITY;if(t>=50)return t*b.value/100;const r=b.value/3;return Math.floor(Math.min(Math.max(t*b.value/100,20),r))}),k=a(()=>{if(!Number.isFinite(R.value))return{display:"none"};const t=`${R.value}px`,r=function({move:e,size:t,bar:r},a){const n={},o=`translate${r.axis}(${e}px)`;return n[r.size]=t,n.transform=o,"horizontal"===a?n.height="100%":n.width="100%",n}({bar:v.value,size:t,move:w.traveled},e.layout);return r}),S=a(()=>Math.ceil(e.clientSize-R.value-p(r))),C=()=>{window.removeEventListener("mousemove",E),window.removeEventListener("mouseup",T),document.onselectstart=c,c=null;const e=p(s);e&&(e.removeEventListener("touchmove",E),e.removeEventListener("touchend",T))},I=e=>{e.stopImmediatePropagation(),e.ctrlKey||[1,2].includes(e.button)||(w.isDragging=!0,w[v.value.axis]=e.currentTarget[v.value.offset]-(e[v.value.client]-e.currentTarget.getBoundingClientRect()[v.value.direction]),t("start-move"),(()=>{window.addEventListener("mousemove",E),window.addEventListener("mouseup",T);const e=p(s);e&&(c=document.onselectstart,document.onselectstart=()=>!1,e.addEventListener("touchmove",E,{passive:!0}),e.addEventListener("touchend",T))})())},T=()=>{w.isDragging=!1,w[v.value.axis]=0,t("stop-move"),C()},E=e=>{const{isDragging:r}=w;if(!r)return;if(!s.value||!l.value)return;const a=w[v.value.axis];if(!a)return;Oe(i);const n=-1*(l.value.getBoundingClientRect()[v.value.direction]-e[v.value.client])-(s.value[v.value.offset]-a);i=$e(()=>{w.traveled=Math.max(0,Math.min(n,S.value)),t("scroll",n,S.value)})},H=e=>{const r=Math.abs(e.target.getBoundingClientRect()[v.value.direction]-e[v.value.client])-s.value[v.value.offset]/2;w.traveled=Math.max(0,Math.min(r,S.value)),t("scroll",r,S.value)};return h(()=>e.scrollFrom,e=>{w.isDragging||(w.traveled=Math.ceil(e*S.value))}),f(()=>{C()}),()=>y("div",{role:"presentation",ref:l,class:[n.b(),e.class,(e.alwaysOn||w.isDragging)&&"always-on"],style:x.value,onMousedown:g(H,["stop","prevent"]),onTouchstartPrevent:I},y("div",{ref:s,class:o.e("thumb"),style:k.value,onMousedown:I},[]))}});var jt=(e=>(e.ASC="asc",e.DESC="desc",e))(jt||{}),Mt=(e=>(e.LEFT="left",e.CENTER="center",e.RIGHT="right",e))(Mt||{}),Lt=(e=>(e.LEFT="left",e.RIGHT="right",e))(Lt||{});const Nt={asc:"desc",desc:"asc"},At=Symbol("placeholder");const Ot=(e,{mainTableRef:t,leftTableRef:n,rightTableRef:o,tableInstance:l,ns:s,isScrolling:i})=>{const c=r(),{emit:d}=c,m=v(!1),h=u(e.defaultExpandedRowKeys||[]),f=u(-1),y=v(null),g=u({}),w=u({}),R=v({}),k=v({}),S=v({}),C=a(()=>b(e.estimatedRowHeight));function I({hovered:e,rowKey:t}){if(i.value)return;l.vnode.el.querySelectorAll(`[rowkey="${String(t)}"]`).forEach(t=>{e?t.classList.add(s.is("hovered")):t.classList.remove(s.is("hovered"))})}const T=Ie(()=>{var e,r,a,l;m.value=!0,g.value={...p(g),...p(w)},E(p(y),!1),w.value={},y.value=null,null==(e=t.value)||e.forceUpdate(),null==(r=n.value)||r.forceUpdate(),null==(a=o.value)||a.forceUpdate(),null==(l=c.proxy)||l.$forceUpdate(),m.value=!1},0);function E(e,r=!1){p(C)&&[t,n,o].forEach(t=>{const a=p(t);a&&a.resetAfterRowIndex(e,r)})}return{expandedRowKeys:h,lastRenderedRowIndex:f,isDynamic:C,isResetting:m,rowHeights:g,resetAfterIndex:E,onRowExpanded:function({expanded:t,rowData:r,rowIndex:a,rowKey:n}){var o,i;const c=[...p(h)],u=c.indexOf(n);t?-1===u&&c.push(n):u>-1&&c.splice(u,1),h.value=c,d("update:expandedRowKeys",c),null==(o=e.onRowExpand)||o.call(e,{expanded:t,rowData:r,rowIndex:a,rowKey:n}),null==(i=e.onExpandedRowsChange)||i.call(e,c),l.vnode.el.querySelector(`.${s.is("hovered")}[rowkey="${String(n)}"]`)&&x(()=>I({hovered:!0,rowKey:n}))},onRowHovered:I,onRowsRendered:function(t){var r;null==(r=e.onRowsRendered)||r.call(e,t),t.rowCacheEnd>p(f)&&(f.value=t.rowCacheEnd)},onRowHeightChange:function({rowKey:e,height:t,rowIndex:r},a){a?a===Lt.RIGHT?S.value[e]=t:R.value[e]=t:k.value[e]=t;const n=Math.max(...[R,S,k].map(t=>t.value[e]||0));p(g)[e]!==n&&(!function(e,t,r){const a=p(y);(null===a||a>r)&&(y.value=r),w.value[e]=t}(e,n,r),T())}}},$t=(e,t)=>e+t,Wt=e=>R(e)?e.reduce($t,0):e,Kt=(e,t,r={})=>C(e)?e(t):null!=e?e:r,zt=e=>(["width","maxWidth","minWidth","height"].forEach(t=>{e[t]=k(e[t])}),e),Bt=e=>S(e)?t=>y(e,t):e;function Pt(e){const t=u(),n=u(),o=u(),{columns:l,columnsStyles:s,columnsTotalWidth:i,fixedColumnsOnLeft:c,fixedColumnsOnRight:m,hasFixedColumns:f,mainColumns:y,onColumnSorted:g}=function(e,t,r){const n=a(()=>p(t).map((e,t)=>{var r,a;return{...e,key:null!=(a=null!=(r=e.key)?r:e.dataKey)?a:t}})),o=a(()=>p(n).filter(e=>!e.hidden)),l=a(()=>p(o).filter(e=>"left"===e.fixed||!0===e.fixed)),s=a(()=>p(o).filter(e=>"right"===e.fixed)),i=a(()=>p(o).filter(e=>!e.fixed)),c=a(()=>{const e=[];return p(l).forEach(t=>{e.push({...t,placeholderSign:At})}),p(i).forEach(t=>{e.push(t)}),p(s).forEach(t=>{e.push({...t,placeholderSign:At})}),e}),d=a(()=>p(l).length||p(s).length),u=a(()=>p(n).reduce((t,a)=>(t[a.key]=((e,t,r)=>{var a;const n={flexGrow:0,flexShrink:0,...r?{}:{flexGrow:e.flexGrow||0,flexShrink:e.flexShrink||1}};r||(n.flexShrink=1);const o={...null!=(a=e.style)?a:{},...n,flexBasis:"auto",width:e.width};return t||(e.maxWidth&&(o.maxWidth=e.maxWidth),e.minWidth&&(o.minWidth=e.minWidth)),o})(a,p(r),e.fixed),t),{})),m=a(()=>p(o).reduce((e,t)=>e+t.width,0)),h=e=>p(n).find(t=>t.key===e);return{columns:n,columnsStyles:u,columnsTotalWidth:m,fixedColumnsOnLeft:l,fixedColumnsOnRight:s,hasFixedColumns:d,mainColumns:c,normalColumns:i,visibleColumns:o,getColumn:h,getColumnStyle:e=>p(u)[e],updateColumnWidth:(e,t)=>{e.width=t},onColumnSorted:function(t){var r;const{key:a}=t.currentTarget.dataset;if(!a)return;const{sortState:n,sortBy:o}=e;let l=jt.ASC;l=w(n)?Nt[n[a]]:Nt[o.order],null==(r=e.onColumnSort)||r.call(e,{column:h(a),key:a,order:l})}}}(e,I(e,"columns"),I(e,"fixed")),{scrollTo:x,scrollToLeft:S,scrollToTop:C,scrollToRow:T,onScroll:E,onVerticalScroll:H,scrollPos:F}=((e,{mainTableRef:t,leftTableRef:r,rightTableRef:a,onMaybeEndReached:n})=>{const o=u({scrollLeft:0,scrollTop:0});function l(e){var n,o,l;const{scrollTop:s}=e;null==(n=t.value)||n.scrollTo(e),null==(o=r.value)||o.scrollToTop(s),null==(l=a.value)||l.scrollToTop(s)}function s(e){o.value=e,l(e)}function i(e){o.value.scrollTop=e,l(p(o))}return h(()=>p(o).scrollTop,(e,t)=>{e>t&&n()}),{scrollPos:o,scrollTo:s,scrollToLeft:function(e){var r,a;o.value.scrollLeft=e,null==(a=null==(r=t.value)?void 0:r.scrollTo)||a.call(r,p(o))},scrollToTop:i,scrollToRow:function(e,r="auto"){var a;null==(a=t.value)||a.scrollToRow(e,r)},onScroll:function(t){var r;s(t),null==(r=e.onScroll)||r.call(e,t)},onVerticalScroll:function({scrollTop:e}){const{scrollTop:t}=p(o);e!==t&&i(e)}}})(e,{mainTableRef:t,leftTableRef:n,rightTableRef:o,onMaybeEndReached:function(){const{onEndReached:t}=e;if(!t)return;const{scrollTop:r}=p(F),a=p(V),n=p(J),o=a-(r+n)+e.hScrollbarSize;!oe.value&&p(N)>=0&&a<=r+p(Y)-p(re)?(oe.value=!0,t(o)):oe.value=!1}}),D=d("table-v2"),j=r(),M=v(!1),{expandedRowKeys:L,lastRenderedRowIndex:N,isDynamic:A,isResetting:O,rowHeights:$,resetAfterIndex:W,onRowExpanded:K,onRowHeightChange:z,onRowHovered:B,onRowsRendered:P}=Ot(e,{mainTableRef:t,leftTableRef:n,rightTableRef:o,tableInstance:j,ns:D,isScrolling:M}),{data:_,depthMap:G}=((e,{expandedRowKeys:t,lastRenderedRowIndex:r,resetAfterIndex:n})=>{const o=u({}),l=a(()=>{const r={},{data:a,rowKey:n}=e,l=p(t);if(!l||!l.length)return a;const s=[],i=new Set;l.forEach(e=>i.add(e));let c=a.slice();for(c.forEach(e=>r[e[n]]=0);c.length>0;){const e=c.shift();s.push(e),i.has(e[n])&&R(e.children)&&e.children.length>0&&(c=[...e.children,...c],e.children.forEach(t=>r[t[n]]=r[e[n]]+1))}return o.value=r,s}),s=a(()=>{const{data:t,expandColumnKey:r}=e;return r?p(l):t});return h(s,(e,t)=>{e!==t&&(r.value=-1,n(0,!0))}),{data:s,depthMap:o}})(e,{expandedRowKeys:L,lastRenderedRowIndex:N,resetAfterIndex:W}),V=a(()=>{const{estimatedRowHeight:t,rowHeight:r}=e,a=p(_);return b(t)?Object.values(p($)).reduce((e,t)=>e+t,0):a.length*r}),{bodyWidth:q,fixedTableHeight:U,mainTableHeight:Y,leftTableWidth:Z,rightTableWidth:X,windowHeight:J,footerHeight:Q,emptyStyle:ee,rootStyle:te,headerHeight:re}=((e,{columnsTotalWidth:t,rowsHeight:r,fixedColumnsOnLeft:n,fixedColumnsOnRight:o})=>{const l=a(()=>{const{fixed:r,width:a,vScrollbarSize:n}=e,o=a-n;return r?Math.max(Math.round(p(t)),o):o}),s=a(()=>{const{height:t=0,maxHeight:a=0,footerHeight:n,hScrollbarSize:o}=e;if(a>0){const e=p(h),t=p(r),l=p(m)+e+t+o;return Math.min(l,a-n)}return t-n}),i=a(()=>{const{maxHeight:t}=e,a=p(s);if(b(t)&&t>0)return a;const n=p(r)+p(m)+p(h);return Math.min(a,n)}),c=e=>e.width,d=a(()=>Wt(p(n).map(c))),u=a(()=>Wt(p(o).map(c))),m=a(()=>Wt(e.headerHeight)),h=a(()=>{var t;return((null==(t=e.fixedData)?void 0:t.length)||0)*e.rowHeight}),f=a(()=>p(s)-p(m)-p(h)),y=a(()=>{const{style:t={},height:r,width:a}=e;return zt({...t,height:r,width:a})}),g=a(()=>zt({height:e.footerHeight})),w=a(()=>({top:k(p(m)),bottom:k(e.footerHeight),width:k(e.width)}));return{bodyWidth:l,fixedTableHeight:i,mainTableHeight:s,leftTableWidth:d,rightTableWidth:u,windowHeight:f,footerHeight:g,emptyStyle:w,rootStyle:y,headerHeight:m}})(e,{columnsTotalWidth:i,fixedColumnsOnLeft:c,fixedColumnsOnRight:m,rowsHeight:V}),ae=u(),ne=a(()=>{const t=0===p(_).length;return R(e.fixedData)?0===e.fixedData.length&&t:t});const oe=u(!1);return h(()=>p(V),()=>oe.value=!1),h(()=>e.expandedRowKeys,e=>L.value=e,{deep:!0}),{columns:l,containerRef:ae,mainTableRef:t,leftTableRef:n,rightTableRef:o,isDynamic:A,isResetting:O,isScrolling:M,hasFixedColumns:f,columnsStyles:s,columnsTotalWidth:i,data:_,expandedRowKeys:L,depthMap:G,fixedColumnsOnLeft:c,fixedColumnsOnRight:m,mainColumns:y,bodyWidth:q,emptyStyle:ee,rootStyle:te,footerHeight:Q,mainTableHeight:Y,fixedTableHeight:U,leftTableWidth:Z,rightTableWidth:X,showEmpty:ne,getRowHeight:function(t){const{estimatedRowHeight:r,rowHeight:a,rowKey:n}=e;return r?p($)[p(_)[t][n]]||r:a},onColumnSorted:g,onRowHovered:B,onRowExpanded:K,onRowsRendered:P,onRowHeightChange:z,scrollTo:x,scrollToLeft:S,scrollToTop:C,scrollToRow:T,onScroll:E,onVerticalScroll:H}}const _t=Symbol("tableV2"),Gt="tableV2GridScrollLeft",Vt=String,qt={type:s(Array),required:!0},Ut={type:s(Array)},Yt={...Ut,required:!0},Zt=String,Xt={type:s(Array),default:()=>i([])},Jt={type:Number,required:!0},Qt={type:s([String,Number,Symbol]),default:"id"},er={type:s(Object)},tr=o({class:String,columns:qt,columnsStyles:{type:s(Object),required:!0},depth:Number,expandColumnKey:Zt,estimatedRowHeight:{...Ct.estimatedRowHeight,default:void 0},isScrolling:Boolean,onRowExpand:{type:s(Function)},onRowHover:{type:s(Function)},onRowHeightChange:{type:s(Function)},rowData:{type:s(Object),required:!0},rowEventHandlers:{type:s(Object)},rowIndex:{type:Number,required:!0},rowKey:Qt,style:{type:s(Object)}}),rr={type:Number,required:!0},ar=o({class:String,columns:qt,fixedHeaderData:{type:s(Array)},headerData:{type:s(Array),required:!0},headerHeight:{type:s([Number,Array]),default:50},rowWidth:rr,rowHeight:{type:Number,default:50},height:rr,width:rr}),nr=o({columns:qt,data:Yt,fixedData:Ut,estimatedRowHeight:tr.estimatedRowHeight,width:Jt,height:Jt,headerWidth:Jt,headerHeight:ar.headerHeight,bodyWidth:Jt,rowHeight:Jt,cache:xt.cache,useIsScrolling:Boolean,scrollbarAlwaysOn:Ct.scrollbarAlwaysOn,scrollbarStartGap:Ct.scrollbarStartGap,scrollbarEndGap:Ct.scrollbarEndGap,class:Vt,style:er,containerStyle:er,getRowHeight:{type:s(Function),required:!0},rowKey:tr.rowKey,onRowsRendered:{type:s(Function)},onScroll:{type:s(Function)}}),or=o({cache:nr.cache,estimatedRowHeight:tr.estimatedRowHeight,rowKey:Qt,headerClass:{type:s([String,Function])},headerProps:{type:s([Object,Function])},headerCellProps:{type:s([Object,Function])},headerHeight:ar.headerHeight,footerHeight:{type:Number,default:0},rowClass:{type:s([String,Function])},rowProps:{type:s([Object,Function])},rowHeight:{type:Number,default:50},cellProps:{type:s([Object,Function])},columns:qt,data:Yt,dataGetter:{type:s(Function)},fixedData:Ut,expandColumnKey:tr.expandColumnKey,expandedRowKeys:Xt,defaultExpandedRowKeys:Xt,class:Vt,fixed:Boolean,style:{type:s(Object)},width:Jt,height:Jt,maxHeight:Number,useIsScrolling:Boolean,indentSize:{type:Number,default:12},iconSize:{type:Number,default:12},hScrollbarSize:Ct.hScrollbarSize,vScrollbarSize:Ct.vScrollbarSize,scrollbarAlwaysOn:It.alwaysOn,sortBy:{type:s(Object),default:()=>({})},sortState:{type:s(Object),default:void 0},onColumnSort:{type:s(Function)},onExpandedRowsChange:{type:s(Function)},onEndReached:{type:s(Function)},onRowExpand:tr.onRowExpand,onScroll:nr.onScroll,onRowsRendered:nr.onRowsRendered,rowEventHandlers:tr.rowEventHandlers});var lr=c({name:"ElTableV2Header",props:ar,setup(e,{slots:t,expose:r}){const n=d("table-v2"),o=T(Gt),l=u(),s=a(()=>zt({width:e.width,height:e.height})),i=a(()=>zt({width:e.rowWidth,height:e.height})),c=a(()=>Te(p(e.headerHeight))),m=e=>{const t=p(l);x(()=>{(null==t?void 0:t.scroll)&&t.scroll({left:e})})},h=()=>{const r=n.e("fixed-header-row"),{columns:a,fixedHeaderData:o,rowHeight:l}=e;return null==o?void 0:o.map((e,n)=>{var o;const s=zt({height:l,width:"100%"});return null==(o=t.fixed)?void 0:o.call(t,{class:r,columns:a,rowData:e,rowIndex:-(n+1),style:s})})},f=()=>{const r=n.e("dynamic-header-row"),{columns:a}=e;return p(c).map((e,n)=>{var o;const l=zt({width:"100%",height:e});return null==(o=t.dynamic)?void 0:o.call(t,{class:r,columns:a,headerIndex:n,style:l})})};return E(()=>{(null==o?void 0:o.value)&&m(o.value)}),r({scrollToLeft:m}),()=>{if(!(e.height<=0))return H("div",{ref:l,class:e.class,style:p(s),role:"rowgroup"},[H("div",{style:p(i),class:n.e("header")},[f(),h()])])}}});const sr=({name:e,clearCache:t,getColumnPosition:n,getColumnStartIndexForOffset:o,getColumnStopIndexForStartIndex:l,getEstimatedTotalHeight:s,getEstimatedTotalWidth:i,getColumnOffset:m,getRowOffset:h,getRowPosition:f,getRowStartIndexForOffset:g,getRowStopIndexForStartIndex:w,initCache:v,injectToInstance:R,validateProps:k})=>c({name:null!=e?e:"ElVirtualList",props:Ct,emits:[Je,Qe],setup(e,{emit:c,expose:S,slots:C}){const I=d("vl");k(e);const T=r(),E=u(v(e,T));null==R||R(T,E);const H=u(),$=u(),W=u(),K=u(null),z=u({isScrolling:!1,scrollLeft:b(e.initScrollLeft)?e.initScrollLeft:0,scrollTop:b(e.initScrollTop)?e.initScrollTop:0,updateRequested:!1,xAxisScrollDir:et,yAxisScrollDir:et}),B=Xe(),P=a(()=>Number.parseInt(`${e.height}`,10)),_=a(()=>Number.parseInt(`${e.width}`,10)),G=a(()=>{const{totalColumn:t,totalRow:r,columnCache:a}=e,{isScrolling:n,xAxisScrollDir:s,scrollLeft:i}=p(z);if(0===t||0===r)return[0,0,0,0];const c=o(e,i,p(E)),d=l(e,c,i,p(E)),u=n&&s!==tt?1:Math.max(1,a),m=n&&s!==et?1:Math.max(1,a);return[Math.max(0,c-u),Math.max(0,Math.min(t-1,d+m)),c,d]}),V=a(()=>{const{totalColumn:t,totalRow:r,rowCache:a}=e,{isScrolling:n,yAxisScrollDir:o,scrollTop:l}=p(z);if(0===t||0===r)return[0,0,0,0];const s=g(e,l,p(E)),i=w(e,s,l,p(E)),c=n&&o!==tt?1:Math.max(1,a),d=n&&o!==et?1:Math.max(1,a);return[Math.max(0,s-c),Math.max(0,Math.min(r-1,i+d)),s,i]}),q=a(()=>s(e,p(E))),U=a(()=>i(e,p(E))),Y=a(()=>{var t;return[{position:"relative",overflow:"hidden",WebkitOverflowScrolling:"touch",willChange:"transform"},{direction:e.direction,height:b(e.height)?`${e.height}px`:e.height,width:b(e.width)?`${e.width}px`:e.width},null!=(t=e.style)?t:{}]}),Z=a(()=>{const e=`${p(U)}px`;return{height:`${p(q)}px`,pointerEvents:p(z).isScrolling?"none":void 0,width:e}}),X=()=>{const{totalColumn:t,totalRow:r}=e;if(t>0&&r>0){const[e,t,r,a]=p(G),[n,o,l,s]=p(V);c(Je,{columnCacheStart:e,columnCacheEnd:t,rowCacheStart:n,rowCacheEnd:o,columnVisibleStart:r,columnVisibleEnd:a,rowVisibleStart:l,rowVisibleEnd:s})}const{scrollLeft:a,scrollTop:n,updateRequested:o,xAxisScrollDir:l,yAxisScrollDir:s}=p(z);c(Qe,{xAxisScrollDir:l,scrollLeft:a,yAxisScrollDir:s,scrollTop:n,updateRequested:o})},J=t=>{const{clientHeight:r,clientWidth:a,scrollHeight:n,scrollLeft:o,scrollTop:l,scrollWidth:s}=t.currentTarget,i=p(z);if(i.scrollTop===l&&i.scrollLeft===o)return;let c=o;if(Et(e.direction))switch(Ft()){case ct:c=-o;break;case ut:c=s-a-o}z.value={...i,isScrolling:!0,scrollLeft:c,scrollTop:Math.max(0,Math.min(l,n-r)),updateRequested:!0,xAxisScrollDir:Tt(i.scrollLeft,c),yAxisScrollDir:Tt(i.scrollTop,l)},x(()=>ne()),oe(),X()},Q=(e,t)=>{const r=p(P),a=(q.value-r)/t*e;re({scrollTop:Math.min(q.value-r,a)})},ee=(e,t)=>{const r=p(_),a=(U.value-r)/t*e;re({scrollLeft:Math.min(U.value-r,a)})},{onWheel:te}=(({atXEndEdge:e,atXStartEdge:t,atYEndEdge:r,atYStartEdge:a},n)=>{let o=null,l=0,s=0;const i=(n,o)=>{const l=n<=0&&t.value||n>=0&&e.value,s=o<=0&&a.value||o>=0&&r.value;return l&&s};return{hasReachedEdge:i,onWheel:e=>{Oe(o);let t=e.deltaX,r=e.deltaY;Math.abs(t)>Math.abs(r)?r=0:t=0,e.shiftKey&&0!==r&&(t=r,r=0),i(l,s)&&i(l+t,s+r)||(l+=t,s+=r,e.preventDefault(),o=$e(()=>{n(l,s),l=0,s=0}))}}})({atXStartEdge:a(()=>z.value.scrollLeft<=0),atXEndEdge:a(()=>z.value.scrollLeft>=U.value-p(_)),atYStartEdge:a(()=>z.value.scrollTop<=0),atYEndEdge:a(()=>z.value.scrollTop>=q.value-p(P))},(e,t)=>{var r,a,n,o;null==(a=null==(r=$.value)?void 0:r.onMouseUp)||a.call(r),null==(o=null==(n=W.value)?void 0:n.onMouseUp)||o.call(n);const l=p(_),s=p(P);re({scrollLeft:Math.min(z.value.scrollLeft+e,U.value-l),scrollTop:Math.min(z.value.scrollTop+t,q.value-s)})});F(H,"wheel",te,{passive:!1});const re=({scrollLeft:e=z.value.scrollLeft,scrollTop:t=z.value.scrollTop})=>{e=Math.max(e,0),t=Math.max(t,0);const r=p(z);t===r.scrollTop&&e===r.scrollLeft||(z.value={...r,xAxisScrollDir:Tt(r.scrollLeft,e),yAxisScrollDir:Tt(r.scrollTop,t),scrollLeft:e,scrollTop:t,updateRequested:!0},x(()=>ne()),oe(),X())},ae=(r,a)=>{const{columnWidth:o,direction:l,rowHeight:s}=e,i=B.value(t&&o,t&&s,t&&l),c=`${r},${a}`;if(O(i,c))return i[c];{const[,t]=n(e,a,p(E)),o=p(E),s=Et(l),[d,u]=f(e,r,o),[m]=n(e,a,o);return i[c]={position:"absolute",left:s?void 0:`${t}px`,right:s?`${t}px`:void 0,top:`${u}px`,height:`${d}px`,width:`${m}px`},i[c]}},ne=()=>{z.value.isScrolling=!1,x(()=>{B.value(-1,null,null)})};D(()=>{if(!j)return;const{initScrollLeft:t,initScrollTop:r}=e,a=p(H);a&&(b(t)&&(a.scrollLeft=t),b(r)&&(a.scrollTop=r)),X()});const oe=()=>{const{direction:t}=e,{scrollLeft:r,scrollTop:a,updateRequested:n}=p(z),o=p(H);if(n&&o){if("rtl"===t)switch(Ft()){case ct:o.scrollLeft=-r;break;case dt:o.scrollLeft=r;break;default:{const{clientWidth:e,scrollWidth:t}=o;o.scrollLeft=t-e-r;break}}else o.scrollLeft=Math.max(0,r);o.scrollTop=Math.max(0,a)}},{resetAfterColumnIndex:le,resetAfterRowIndex:se,resetAfter:ie}=T.proxy;S({windowRef:H,innerRef:K,getItemStyleCache:B,scrollTo:re,scrollToItem:(t=0,r=0,a=rt)=>{const n=p(z);r=Math.max(0,Math.min(r,e.totalColumn-1)),t=Math.max(0,Math.min(t,e.totalRow-1));const o=We(I.namespace.value),l=p(E),c=s(e,l),d=i(e,l);re({scrollLeft:m(e,r,a,n.scrollLeft,l,d>e.width?o:0),scrollTop:h(e,t,a,n.scrollTop,l,c>e.height?o:0)})},states:z,resetAfterColumnIndex:le,resetAfterRowIndex:se,resetAfter:ie});const ce=()=>{const t=M(e.innerElement),r=(()=>{var t;const[r,a]=p(G),[n,o]=p(V),{data:l,totalColumn:s,totalRow:i,useIsScrolling:c,itemKey:d}=e,u=[];if(i>0&&s>0)for(let e=n;e<=o;e++)for(let n=r;n<=a;n++){const r=d({columnIndex:n,data:l,rowIndex:e});u.push(y(A,{key:r},null==(t=C.default)?void 0:t.call(C,{columnIndex:n,data:l,isScrolling:c?p(z).isScrolling:void 0,style:ae(e,n),rowIndex:e})))}return u})();return[y(t,N(e.innerProps,{style:p(Z),ref:K}),L(t)?r:{default:()=>r})]};return()=>{const t=M(e.containerElement),{horizontalScrollbar:r,verticalScrollbar:a}=(()=>{const{scrollbarAlwaysOn:t,scrollbarStartGap:r,scrollbarEndGap:a,totalColumn:n,totalRow:o}=e,l=p(_),s=p(P),i=p(U),c=p(q),{scrollLeft:d,scrollTop:u}=p(z);return{horizontalScrollbar:y(Dt,{ref:$,alwaysOn:t,startGap:r,endGap:a,class:I.e("horizontal"),clientSize:l,layout:"horizontal",onScroll:ee,ratio:100*l/i,scrollFrom:d/(i-l),total:o,visible:!0}),verticalScrollbar:y(Dt,{ref:W,alwaysOn:t,startGap:r,endGap:a,class:I.e("vertical"),clientSize:s,layout:"vertical",onScroll:Q,ratio:100*s/c,scrollFrom:u/(c-s),total:n,visible:!0})}})(),n=ce();return y("div",{key:0,class:I.e("wrapper"),role:e.role},[y(t,{class:e.className,style:p(Y),onScroll:J,ref:H},L(t)?n:{default:()=>n}),r,a])}}}),{max:ir,min:cr,floor:dr}=Math,ur={column:"columnWidth",row:"rowHeight"},mr={column:"lastVisitedColumnIndex",row:"lastVisitedRowIndex"},pr=(e,t,r,a)=>{const[n,o,l]=[r[a],e[ur[a]],r[mr[a]]];if(t>l){let e=0;if(l>=0){const t=n[l];e=t.offset+t.size}for(let r=l+1;r<=t;r++){const t=o(r);n[r]={offset:e,size:t},e+=t}r[mr[a]]=t}return n[t]},hr=(e,t,r,a,n,o)=>{for(;r<=a;){const l=r+dr((a-r)/2),s=pr(e,l,t,o).offset;if(s===n)return l;s<n?r=l+1:a=l-1}return ir(0,r-1)},fr=(e,t,r,a)=>{const[n,o]=[t[a],t[mr[a]]];return(o>0?n[o].offset:0)>=r?hr(e,t,0,o,r,a):((e,t,r,a,n)=>{const o="column"===n?e.totalColumn:e.totalRow;let l=1;for(;r<o&&pr(e,r,t,n).offset<a;)r+=l,l*=2;return hr(e,t,dr(r/2),cr(r,o-1),a,n)})(e,t,ir(0,o),r,a)},yr=({totalRow:e},{estimatedRowHeight:t,lastVisitedRowIndex:r,row:a})=>{let n=0;if(r>=e&&(r=e-1),r>=0){const e=a[r];n=e.offset+e.size}return n+(e-r-1)*t},gr=({totalColumn:e},{column:t,estimatedColumnWidth:r,lastVisitedColumnIndex:a})=>{let n=0;if(a>e&&(a=e-1),a>=0){const e=t[a];n=e.offset+e.size}return n+(e-a-1)*r},wr={column:gr,row:yr},vr=(e,t,r,a,n,o,l)=>{const[s,i]=["row"===o?e.height:e.width,wr[o]],c=pr(e,t,n,o),d=i(e,n),u=ir(0,cr(d-s,c.offset)),m=ir(0,c.offset-s+l+c.size);switch(r===at&&(r=a>=m-s&&a<=u+s?rt:ot),r){case nt:return u;case lt:return m;case ot:return Math.round(m+(u-m)/2);default:return a>=m&&a<=u?a:m>u||a<m?m:u}},br=sr({name:"ElDynamicSizeGrid",getColumnPosition:(e,t,r)=>{const a=pr(e,t,r,"column");return[a.size,a.offset]},getRowPosition:(e,t,r)=>{const a=pr(e,t,r,"row");return[a.size,a.offset]},getColumnOffset:(e,t,r,a,n,o)=>vr(e,t,r,a,n,"column",o),getRowOffset:(e,t,r,a,n,o)=>vr(e,t,r,a,n,"row",o),getColumnStartIndexForOffset:(e,t,r)=>fr(e,r,t,"column"),getColumnStopIndexForStartIndex:(e,t,r,a)=>{const n=pr(e,t,a,"column"),o=r+e.width;let l=n.offset+n.size,s=t;for(;s<e.totalColumn-1&&l<o;)s++,l+=pr(e,t,a,"column").size;return s},getEstimatedTotalHeight:yr,getEstimatedTotalWidth:gr,getRowStartIndexForOffset:(e,t,r)=>fr(e,r,t,"row"),getRowStopIndexForStartIndex:(e,t,r,a)=>{const{totalRow:n,height:o}=e,l=pr(e,t,a,"row"),s=r+o;let i=l.size+l.offset,c=t;for(;c<n-1&&i<s;)c++,i+=pr(e,c,a,"row").size;return c},injectToInstance:(e,t)=>{const r=({columnIndex:r,rowIndex:a},n)=>{var o,l;n=!!$(n)||n,b(r)&&(t.value.lastVisitedColumnIndex=Math.min(t.value.lastVisitedColumnIndex,r-1)),b(a)&&(t.value.lastVisitedRowIndex=Math.min(t.value.lastVisitedRowIndex,a-1)),null==(o=e.exposed)||o.getItemStyleCache.value(-1,null,null),n&&(null==(l=e.proxy)||l.$forceUpdate())};Object.assign(e.proxy,{resetAfterColumnIndex:(e,t)=>{r({columnIndex:e},t)},resetAfterRowIndex:(e,t)=>{r({rowIndex:e},t)},resetAfter:r})},initCache:({estimatedColumnWidth:e=50,estimatedRowHeight:t=50})=>({column:{},estimatedColumnWidth:e,estimatedRowHeight:t,lastVisitedColumnIndex:-1,lastVisitedRowIndex:-1,row:{}}),clearCache:!1,validateProps:({columnWidth:e,rowHeight:t})=>{}}),xr=sr({name:"ElFixedSizeGrid",getColumnPosition:({columnWidth:e},t)=>[e,t*e],getRowPosition:({rowHeight:e},t)=>[e,t*e],getEstimatedTotalHeight:({totalRow:e,rowHeight:t})=>t*e,getEstimatedTotalWidth:({totalColumn:e,columnWidth:t})=>t*e,getColumnOffset:({totalColumn:e,columnWidth:t,width:r},a,n,o,l,s)=>{r=Number(r);const i=Math.max(0,e*t-r),c=Math.min(i,a*t),d=Math.max(0,a*t-r+s+t);switch("smart"===n&&(n=o>=d-r&&o<=c+r?rt:ot),n){case nt:return c;case lt:return d;case ot:{const e=Math.round(d+(c-d)/2);return e<Math.ceil(r/2)?0:e>i+Math.floor(r/2)?i:e}default:return o>=d&&o<=c?o:d>c||o<d?d:c}},getRowOffset:({rowHeight:e,height:t,totalRow:r},a,n,o,l,s)=>{t=Number(t);const i=Math.max(0,r*e-t),c=Math.min(i,a*e),d=Math.max(0,a*e-t+s+e);switch(n===at&&(n=o>=d-t&&o<=c+t?rt:ot),n){case nt:return c;case lt:return d;case ot:{const e=Math.round(d+(c-d)/2);return e<Math.ceil(t/2)?0:e>i+Math.floor(t/2)?i:e}default:return o>=d&&o<=c?o:d>c||o<d?d:c}},getColumnStartIndexForOffset:({columnWidth:e,totalColumn:t},r)=>Math.max(0,Math.min(t-1,Math.floor(r/e))),getColumnStopIndexForStartIndex:({columnWidth:e,totalColumn:t,width:r},a,n)=>{const o=a*e,l=Math.ceil((r+n-o)/e);return Math.max(0,Math.min(t-1,a+l-1))},getRowStartIndexForOffset:({rowHeight:e,totalRow:t},r)=>Math.max(0,Math.min(t-1,Math.floor(r/e))),getRowStopIndexForStartIndex:({rowHeight:e,totalRow:t,height:r},a,n)=>{const o=a*e,l=Math.ceil((r+n-o)/e);return Math.max(0,Math.min(t-1,a+l-1))},initCache:()=>{},clearCache:!0,validateProps:({columnWidth:e,rowHeight:t})=>{}});var Rr=c({name:"ElTableV2Grid",props:nr,setup(e,{slots:t,expose:r}){const{ns:n}=T(_t),{bodyRef:o,fixedRowHeight:l,gridHeight:s,hasHeader:i,headerRef:c,headerHeight:d,totalHeight:m,forceUpdate:f,itemKey:y,onItemRendered:g,resetAfterRowIndex:v,scrollTo:R,scrollToTop:k,scrollToRow:S,scrollLeft:C}=(e=>{const t=u(),r=u(),n=u(0),o=a(()=>{const{data:t,rowHeight:r,estimatedRowHeight:a}=e;if(!a)return t.length*r}),l=a(()=>{const{fixedData:t,rowHeight:r}=e;return((null==t?void 0:t.length)||0)*r}),s=a(()=>Wt(e.headerHeight)),i=a(()=>{const{height:t}=e;return Math.max(0,t-p(s)-p(l))}),c=a(()=>p(s)+p(l)>0);return h(()=>e.bodyWidth,()=>{var t;b(e.estimatedRowHeight)&&(null==(t=r.value)||t.resetAfter({columnIndex:0},!1))}),{bodyRef:r,forceUpdate:function(){var e,a;null==(e=p(r))||e.$forceUpdate(),null==(a=p(t))||a.$forceUpdate()},fixedRowHeight:l,gridHeight:i,hasHeader:c,headerHeight:s,headerRef:t,totalHeight:o,itemKey:({data:t,rowIndex:r})=>t[r][e.rowKey],onItemRendered:function({rowCacheStart:t,rowCacheEnd:r,rowVisibleStart:a,rowVisibleEnd:n}){var o;null==(o=e.onRowsRendered)||o.call(e,{rowCacheStart:t,rowCacheEnd:r,rowVisibleStart:a,rowVisibleEnd:n})},resetAfterRowIndex:function(e,t){var a;null==(a=r.value)||a.resetAfterRowIndex(e,t)},scrollTo:function(e,a){const o=p(t),l=p(r);w(e)?(null==o||o.scrollToLeft(e.scrollLeft),n.value=e.scrollLeft,null==l||l.scrollTo(e)):(null==o||o.scrollToLeft(e),n.value=e,null==l||l.scrollTo({scrollLeft:e,scrollTop:a}))},scrollToTop:function(e){var t;null==(t=p(r))||t.scrollTo({scrollTop:e})},scrollToRow:function(e,t){var a;null==(a=p(r))||a.scrollToItem(e,1,t)},scrollLeft:n}})(e);K(Gt,C),W(async()=>{var e;await x();const t=null==(e=o.value)?void 0:e.states.scrollTop;t&&k(Math.round(t)+1)}),r({forceUpdate:f,totalHeight:m,scrollTo:R,scrollToTop:k,scrollToRow:S,resetAfterRowIndex:v});const I=()=>e.bodyWidth;return()=>{const{cache:r,columns:a,data:u,fixedData:m,useIsScrolling:h,scrollbarAlwaysOn:f,scrollbarEndGap:w,scrollbarStartGap:v,style:x,rowHeight:R,bodyWidth:k,estimatedRowHeight:S,headerWidth:C,height:T,width:E,getRowHeight:F,onScroll:D}=e,j=b(S),M=j?br:xr,L=p(d);return H("div",{role:"table",class:[n.e("table"),e.class],style:x},[H(M,{ref:o,data:u,useIsScrolling:h,itemKey:y,columnCache:0,columnWidth:j?I:k,totalColumn:1,totalRow:u.length,rowCache:r,rowHeight:j?F:R,width:E,height:p(s),class:n.e("body"),role:"rowgroup",scrollbarStartGap:v,scrollbarEndGap:w,scrollbarAlwaysOn:f,onScroll:D,onItemRendered:g,perfMode:!1},{default:e=>{var r;const n=u[e.rowIndex];return null==(r=t.row)?void 0:r.call(t,{...e,columns:a,rowData:n})}}),p(i)&&H(lr,{ref:c,class:n.e("header-wrapper"),columns:a,headerData:u,headerHeight:e.headerHeight,fixedHeaderData:m,rowWidth:C,rowHeight:R,width:E,height:Math.min(L+p(l),T)},{dynamic:t.header,fixed:t.row})])}}});var kr=(e,{slots:t})=>{const{mainTableRef:r,...a}=e;return H(Rr,N({ref:r},a),"function"==typeof(n=t)||"[object Object]"===Object.prototype.toString.call(n)&&!S(n)?t:{default:()=>[t]});var n};var Sr=(e,{slots:t})=>{if(!e.columns.length)return;const{leftTableRef:r,...a}=e;return H(Rr,N({ref:r},a),"function"==typeof(n=t)||"[object Object]"===Object.prototype.toString.call(n)&&!S(n)?t:{default:()=>[t]});var n};var Cr=(e,{slots:t})=>{if(!e.columns.length)return;const{rightTableRef:r,...a}=e;return H(Rr,N({ref:r},a),"function"==typeof(n=t)||"[object Object]"===Object.prototype.toString.call(n)&&!S(n)?t:{default:()=>[t]});var n};const Ir=e=>{const{isScrolling:t}=T(_t),r=u(!1),n=u(),o=a(()=>b(e.estimatedRowHeight)&&e.rowIndex>=0),l=a(()=>{const{rowData:t,rowIndex:r,rowKey:a,onRowHover:n}=e,o=e.rowEventHandlers||{},l={};return Object.entries(o).forEach(([e,n])=>{C(n)&&(l[e]=e=>{n({event:e,rowData:t,rowIndex:r,rowKey:a})})}),n&&[{name:"onMouseleave",hovered:!1},{name:"onMouseenter",hovered:!0}].forEach(({name:e,hovered:o})=>{const s=l[e];l[e]=e=>{n({event:e,hovered:o,rowData:t,rowIndex:r,rowKey:a}),null==s||s(e)}}),l});return D(()=>{p(o)&&((t=!1)=>{const a=p(n);if(!a)return;const{columns:o,onRowHeightChange:l,rowKey:s,rowIndex:i,style:c}=e,{height:d}=a.getBoundingClientRect();r.value=!0,x(()=>{if(t||d!==Number.parseInt(c.height)){const e=o[0],t=(null==e?void 0:e.placeholderSign)===At;null==l||l({rowKey:s,height:d,rowIndex:i},e&&!t&&e.fixed)}})})(!0)}),{isScrolling:t,measurable:o,measured:r,rowRef:n,eventHandlers:l,onExpand:t=>{const{onRowExpand:r,rowData:a,rowIndex:n,rowKey:o}=e;null==r||r({expanded:t,rowData:a,rowIndex:n,rowKey:o})}}};var Tr=c({name:"ElTableV2TableRow",props:tr,setup(e,{expose:t,slots:r,attrs:a}){const{eventHandlers:n,isScrolling:o,measurable:l,measured:s,rowRef:i,onExpand:c}=Ir(e);return t({onExpand:c}),()=>{const{columns:t,columnsStyles:d,expandColumnKey:u,depth:m,rowData:h,rowIndex:f,style:y}=e;let g=t.map((e,a)=>{const n=R(h.children)&&h.children.length>0&&e.key===u;return r.cell({column:e,columns:t,columnIndex:a,depth:m,style:d[e.key],rowData:h,rowIndex:f,isScrolling:p(o),expandIconProps:n?{rowData:h,rowIndex:f,onExpand:c}:void 0})});if(r.row&&(g=r.row({cells:g.map(e=>R(e)&&1===e.length?e[0]:e),style:y,columns:t,depth:m,rowData:h,rowIndex:f,isScrolling:p(o)})),p(l)){const{height:t,...r}=y||{},o=p(s);return H("div",N({ref:i,class:e.class,style:o?y:r,role:"row"},a,p(n)),[g])}return H("div",N(a,{ref:i,class:e.class,style:y,role:"row"},p(n)),[g])}}});var Er=(e,{slots:t})=>{const{columns:r,columnsStyles:a,depthMap:n,expandColumnKey:o,expandedRowKeys:l,estimatedRowHeight:s,hasFixedColumns:i,rowData:c,rowIndex:d,style:u,isScrolling:m,rowProps:p,rowClass:h,rowKey:f,rowEventHandlers:y,ns:g,onRowHovered:w,onRowExpanded:v}=e,b=Kt(h,{columns:r,rowData:c,rowIndex:d},""),x=Kt(p,{columns:r,rowData:c,rowIndex:d}),R=c[f],k=n[R]||0,C=Boolean(o),I=d<0,T=[g.e("row"),b,{[g.e(`row-depth-${k}`)]:C&&d>=0,[g.is("expanded")]:C&&l.includes(R),[g.is("fixed")]:!k&&I,[g.is("customized")]:Boolean(t.row)}],E=i?w:void 0,F={...x,columns:r,columnsStyles:a,class:T,depth:k,expandColumnKey:o,estimatedRowHeight:I?void 0:s,isScrolling:m,rowIndex:d,rowData:c,rowKey:R,rowEventHandlers:y,style:u};return H(Tr,N(F,{onRowExpand:v,onMouseenter:e=>{null==E||E({hovered:!0,rowKey:R,event:e,rowData:c,rowIndex:d})},onMouseleave:e=>{null==E||E({hovered:!1,rowKey:R,event:e,rowData:c,rowIndex:d})},rowkey:R}),"function"==typeof(D=t)||"[object Object]"===Object.prototype.toString.call(D)&&!S(D)?t:{default:()=>[t]});var D};const Hr=(e,{slots:t})=>{var r;const{cellData:a,style:n}=e,o=(null==(r=null==a?void 0:a.toString)?void 0:r.call(a))||"",l=z(t,"default",e,()=>[o]);return H("div",{class:e.class,title:o,style:n},[l])};Hr.displayName="ElTableV2Cell",Hr.inheritAttrs=!1;var Fr=Hr;var Dr=e=>{const{expanded:t,expandable:r,onExpand:a,style:n,size:o}=e,l={onClick:r?()=>a(!t):void 0,class:e.class};return H(P,N(l,{size:o,style:n}),{default:()=>[H(B,null,null)]})};const jr=({columns:e,column:t,columnIndex:r,depth:a,expandIconProps:n,isScrolling:o,rowData:l,rowIndex:s,style:i,expandedRowKeys:c,ns:d,cellProps:u,expandColumnKey:m,indentSize:p,iconSize:h,rowKey:f},{slots:y})=>{const g=zt(i);if(t.placeholderSign===At)return H("div",{class:d.em("row-cell","placeholder"),style:g},null);const{cellRenderer:v,dataKey:b,dataGetter:x}=t,R=C(x)?x({columns:e,column:t,columnIndex:r,rowData:l,rowIndex:s}):_(l,null!=b?b:""),k=Kt(u,{cellData:R,columns:e,column:t,columnIndex:r,rowIndex:s,rowData:l}),S={class:d.e("cell-text"),columns:e,column:t,columnIndex:r,cellData:R,isScrolling:o,rowData:l,rowIndex:s},I=Bt(v),T=I?I(S):z(y,"default",S,()=>[H(Fr,S,null)]),E=[d.e("row-cell"),t.class,t.align===Mt.CENTER&&d.is("align-center"),t.align===Mt.RIGHT&&d.is("align-right")],F=s>=0&&m&&t.key===m,D=s>=0&&c.includes(l[f]);let j;const M=`margin-inline-start: ${a*p}px;`;return F&&(j=w(n)?H(Dr,N(n,{class:[d.e("expand-icon"),d.is("expanded",D)],size:h,expanded:D,style:M,expandable:!0}),null):H("div",{style:[M,`width: ${h}px; height: ${h}px;`].join(" ")},null)),H("div",N({class:E,style:g},k,{role:"cell"}),[j,T])};jr.inheritAttrs=!1;var Mr=jr;const Lr=o({class:String,columns:qt,columnsStyles:{type:s(Object),required:!0},headerIndex:Number,style:{type:s(Object)}});var Nr=c({name:"ElTableV2HeaderRow",props:Lr,setup:(e,{slots:t})=>()=>{const{columns:r,columnsStyles:a,headerIndex:n,style:o}=e;let l=r.map((e,o)=>t.cell({columns:r,column:e,columnIndex:o,headerIndex:n,style:a[e.key]}));return t.header&&(l=t.header({cells:l.map(e=>R(e)&&1===e.length?e[0]:e),columns:r,headerIndex:n})),H("div",{class:e.class,style:o,role:"row"},[l])}});var Ar=({columns:e,columnsStyles:t,headerIndex:r,style:a,headerClass:n,headerProps:o,ns:l},{slots:s})=>{const i={columns:e,headerIndex:r},c=[l.e("header-row"),Kt(n,i,""),{[l.is("customized")]:Boolean(s.header)}],d={...Kt(o,i),columnsStyles:t,class:c,columns:e,headerIndex:r,style:a};return H(Nr,d,"function"==typeof(u=s)||"[object Object]"===Object.prototype.toString.call(u)&&!S(u)?s:{default:()=>[s]});var u};const Or=(e,{slots:t})=>z(t,"default",e,()=>{var t,r;return[H("div",{class:e.class,title:null==(t=e.column)?void 0:t.title},[null==(r=e.column)?void 0:r.title])]});Or.displayName="ElTableV2HeaderCell",Or.inheritAttrs=!1;var $r=Or;var Wr=e=>{const{sortOrder:t}=e;return H(P,{size:14,class:e.class},{default:()=>[t===jt.ASC?H(G,null,null):H(V,null,null)]})};var Kr=(e,{slots:t})=>{const{column:r,ns:a,style:n,onColumnSorted:o}=e,l=zt(n);if(r.placeholderSign===At)return H("div",{class:a.em("header-row-cell","placeholder"),style:l},null);const{headerCellRenderer:s,headerClass:i,sortable:c}=r,d={...e,class:a.e("header-cell-text")},u=Bt(s),m=u?u(d):z(t,"default",d,()=>[H($r,d,null)]),{sortBy:p,sortState:h,headerCellProps:f}=e;let y,g;if(h){const e=h[r.key];y=Boolean(Nt[e]),g=y?e:jt.ASC}else y=r.key===p.key,g=y?p.order:jt.ASC;const w=[a.e("header-cell"),Kt(i,e,""),r.align===Mt.CENTER&&a.is("align-center"),r.align===Mt.RIGHT&&a.is("align-right"),c&&a.is("sortable")],v={...Kt(f,e),onClick:r.sortable?o:void 0,class:w,style:l,"data-key":r.key};return H("div",N(v,{role:"columnheader"}),[m,c&&H(Wr,{class:[a.e("sort-icon"),y&&a.is("sorting")],sortOrder:g},null)])};const zr=(e,{slots:t})=>{var r;return H("div",{class:e.class,style:e.style},[null==(r=t.default)?void 0:r.call(t)])};zr.displayName="ElTableV2Footer";var Br=zr;const Pr=(e,{slots:t})=>{const r=z(t,"default",{},()=>[H(Se,null,null)]);return H("div",{class:e.class,style:e.style},[r])};Pr.displayName="ElTableV2Empty";var _r=Pr;const Gr=(e,{slots:t})=>{var r;return H("div",{class:e.class,style:e.style},[null==(r=t.default)?void 0:r.call(t)])};Gr.displayName="ElTableV2Overlay";var Vr=Gr;function qr(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!S(e)}var Ur=c({name:"ElTableV2",props:or,setup(e,{slots:t,expose:r}){const a=d("table-v2"),{columnsStyles:n,fixedColumnsOnLeft:o,fixedColumnsOnRight:l,mainColumns:s,mainTableHeight:i,fixedTableHeight:c,leftTableWidth:u,rightTableWidth:m,data:h,depthMap:f,expandedRowKeys:y,hasFixedColumns:g,mainTableRef:w,leftTableRef:v,rightTableRef:b,isDynamic:x,isResetting:R,isScrolling:k,bodyWidth:S,emptyStyle:C,rootStyle:I,footerHeight:T,showEmpty:E,scrollTo:F,scrollToLeft:D,scrollToTop:j,scrollToRow:M,getRowHeight:L,onColumnSorted:A,onRowHeightChange:O,onRowHovered:$,onRowExpanded:W,onRowsRendered:z,onScroll:B,onVerticalScroll:P}=Pt(e);return r({scrollTo:F,scrollToLeft:D,scrollToTop:j,scrollToRow:M}),K(_t,{ns:a,isResetting:R,isScrolling:k}),()=>{const{cache:r,cellProps:d,estimatedRowHeight:R,expandColumnKey:k,fixedData:F,headerHeight:D,headerClass:j,headerProps:M,headerCellProps:K,sortBy:_,sortState:G,rowHeight:V,rowClass:q,rowEventHandlers:U,rowKey:Y,rowProps:Z,scrollbarAlwaysOn:X,indentSize:J,iconSize:Q,useIsScrolling:ee,vScrollbarSize:te,width:re}=e,ae=p(h),ne={cache:r,class:a.e("main"),columns:p(s),data:ae,fixedData:F,estimatedRowHeight:R,bodyWidth:p(S),headerHeight:D,headerWidth:p(S),height:p(i),mainTableRef:w,rowKey:Y,rowHeight:V,scrollbarAlwaysOn:X,scrollbarStartGap:2,scrollbarEndGap:te,useIsScrolling:ee,width:re,getRowHeight:L,onRowsRendered:z,onScroll:B},oe=p(u),le=p(c),se={cache:r,class:a.e("left"),columns:p(o),data:ae,fixedData:F,estimatedRowHeight:R,leftTableRef:v,rowHeight:V,bodyWidth:oe,headerWidth:oe,headerHeight:D,height:le,rowKey:Y,scrollbarAlwaysOn:X,scrollbarStartGap:2,scrollbarEndGap:te,useIsScrolling:ee,width:oe,getRowHeight:L,onScroll:P},ie=p(m),ce={cache:r,class:a.e("right"),columns:p(l),data:ae,fixedData:F,estimatedRowHeight:R,rightTableRef:b,rowHeight:V,bodyWidth:ie,headerWidth:ie,headerHeight:D,height:le,rowKey:Y,scrollbarAlwaysOn:X,scrollbarStartGap:2,scrollbarEndGap:te,width:ie,style:`${a.cssVarName("table-scrollbar-size")}: ${te}px`,useIsScrolling:ee,getRowHeight:L,onScroll:P},de=p(n),ue={ns:a,depthMap:p(f),columnsStyles:de,expandColumnKey:k,expandedRowKeys:p(y),estimatedRowHeight:R,hasFixedColumns:p(g),rowProps:Z,rowClass:q,rowKey:Y,rowEventHandlers:U,onRowHovered:$,onRowExpanded:W,onRowHeightChange:O},me={cellProps:d,expandColumnKey:k,indentSize:J,iconSize:Q,rowKey:Y,expandedRowKeys:p(y),ns:a},pe={ns:a,headerClass:j,headerProps:M,columnsStyles:de},he={ns:a,sortBy:_,sortState:G,headerCellProps:K,onColumnSorted:A},fe={row:e=>H(Er,N(e,ue),{row:t.row,cell:e=>{let r;return t.cell?H(Mr,N(e,me,{style:de[e.column.key]}),qr(r=t.cell(e))?r:{default:()=>[r]}):H(Mr,N(e,me,{style:de[e.column.key]}),null)}}),header:e=>H(Ar,N(e,pe),{header:t.header,cell:e=>{let r;return t["header-cell"]?H(Kr,N(e,he,{style:de[e.column.key]}),qr(r=t["header-cell"](e))?r:{default:()=>[r]}):H(Kr,N(e,he,{style:de[e.column.key]}),null)}})},ye=[e.class,a.b(),a.e("root"),{[a.is("dynamic")]:p(x)}],ge={class:a.e("footer"),style:p(T)};return H("div",{class:ye,style:p(I)},[H(kr,ne,qr(fe)?fe:{default:()=>[fe]}),H(Sr,se,qr(fe)?fe:{default:()=>[fe]}),H(Cr,ce,qr(fe)?fe:{default:()=>[fe]}),t.footer&&H(Br,ge,{default:t.footer}),p(E)&&H(_r,{class:a.e("empty"),style:p(C)},{default:t.empty}),t.overlay&&H(Vr,{class:a.e("overlay")},{default:t.overlay})])}}});const Yr=o({disableWidth:Boolean,disableHeight:Boolean,onResize:{type:s(Function)}});var Zr=c({name:"ElAutoResizer",props:Yr,setup(e,{slots:t}){const r=d("auto-resizer"),{height:a,width:n,sizer:o}=(e=>{const t=u(),r=u(0),a=u(0);let n;return D(()=>{n=q(t,([e])=>{const{width:t,height:n}=e.contentRect,{paddingLeft:o,paddingRight:l,paddingTop:s,paddingBottom:i}=getComputedStyle(e.target),c=Number.parseInt(o)||0,d=Number.parseInt(l)||0,u=Number.parseInt(s)||0,m=Number.parseInt(i)||0;r.value=t-c-d,a.value=n-u-m}).stop}),f(()=>{null==n||n()}),h([r,a],([t,r])=>{var a;null==(a=e.onResize)||a.call(e,{width:t,height:r})}),{sizer:t,width:r,height:a}})(e),l={width:"100%",height:"100%"};return()=>{var e;return H("div",{ref:o,class:r.b(),style:l},[null==(e=t.default)?void 0:e.call(t,{height:a.value,width:n.value})])}}});const Xr=U(Ur),Jr=U(Zr),Qr={class:"upload select"},ea={class:"upload text"},ta=ke(c({__name:"TestLog",emits:["handleLine","beforeHandle","afterHandle"],setup(r,{emit:a}){const{t:n}=e(),o=a,l=u(null),s=u(null);async function i(e){s.value?.classList.remove("drag");const r=e.target.files;if(!r||0===r.length)return;o("beforeHandle");const a=t.service({fullscreen:!0,text:n("testLog.loading"),lock:!0,spinner:'<div style="width:0;height:0"></div>'});for(let t=0;t<r.length;t++){const e=r[t],a=await e.text();for(const t of a.split("\n"))o("handleLine",t)}a.close(),o("afterHandle"),s.value?.classList.remove("drag")}function c(e){e.preventDefault(),s.value?.classList.add("drag")}function d(e){e.preventDefault(),s.value?.classList.remove("drag")}return D(()=>{l.value?.addEventListener("change",i),s.value?.addEventListener("dragover",c),s.value?.addEventListener("dragleave",d)}),Y(()=>{l.value?.removeEventListener("change",i),s.value?.removeEventListener("dragover",c),s.value?.removeEventListener("dragleave",d)}),(e,t)=>(X(),Z("div",Qr,[J("div",{ref_key:"select",ref:s,class:"upload-select"},[J("div",ea,[t[0]||(t[0]=J("span",null,"+",-1)),J("p",null,Q(e.$t("testLog.upload")),1)]),J("input",{ref_key:"input",ref:l,type:"file"},null,512)],512)]))}}),[["__scopeId","data-v-36beaa21"]]),ra=te("hash"),aa=ee("keigennRecord2",{state:()=>({userOptions:{scale:a(()=>na(ra.scale,1)),opacity:a(()=>na(ra.opacity,.9)),targetType:a(()=>na(ra.targetType,"icon")),iconType:a(()=>na(ra.iconType,2)),parseAA:a(()=>na(ra.parseAA,!0)),parseDoT:a(()=>na(ra.parseDoT,!1)),minimize:a(()=>na(ra.minimize,!1)),actionCN:a(()=>na(ra.actionCN,!0)),statusCN:a(()=>na(ra.statusCN,!0))},isBrowser:!1}),getters:{icon4k:e=>e.userOptions.scale>=2||window.devicePixelRatio>=2?"_hr1":""},actions:{checkIsBrowser(){this.isBrowser=!window.OverlayPluginApi&&!ra.OVERLAY_WS&&!ra.HOST_PORT,this.isBrowser&&setTimeout(()=>this.checkIsBrowser(),1e3)},formatterName(e){const t=/^([A-Z])\S+ ([A-Z])\S+/;return t.test(e)?e.replace(t,"$1.$2"):`${e.at(0)}.${e.at(-1)}`}}});function na(e,t){return"boolean"==typeof t?"0"!==e&&"false"!==e?.toLocaleLowerCase()&&("1"===e||"true"===e?.toLocaleLowerCase()||t):"number"==typeof t?Number.isNaN(+e)?t:+e:"string"==typeof t?e:t}const oa=[Number(409).toString(16).toUpperCase(),Number(810).toString(16).toUpperCase(),Number(811).toString(16).toUpperCase(),Number(1836).toString(16).toUpperCase()];function la(e){return e.currentHp-e.amount<0&&!e.keigenns.find(e=>oa.includes(e.effectId))}const sa={class:"amount"},ia={class:"row-info"},ca=ke(c({__name:"Amount",props:{row:{}},setup(e){const t=e,{amount:r,maxHp:n,currentHp:o,shield:l,source:s,type:i}=t.row,c=Math.round(n*+l/100),d=Math.round(o/n*100),u=t.row.reduction,m=(r&&Math.round((r+c)/(1-u))||0).toLocaleString(),h=a(()=>r>999999?`${(r/1e4).toFixed(0)}万`:r.toLocaleString()),f=i,y=la(t.row);return(e,t)=>{const r=Fe,a=De;return X(),re(a,{"append-to":".wrapper",trigger:"hover",enterable:!1,"hide-after":0,width:180},{reference:ae(()=>[J("span",sa,[J("span",{class:le(p(f))},[J("span",{class:le({lethal:p(y)})},Q(p(h)),3)],2)])]),default:ae(()=>[J("ul",ia,[J("li",null,Q(e.$t("keigennRecord.source"))+": "+Q(p(s)),1),J("li",null,Q(e.$t("keigennRecord.playerShield"))+": "+Q(p(l))+"%",1),J("li",null,Q(e.$t("keigennRecord.playerHp"))+": "+Q(p(d))+"%",1),p(u)<1&&"dot"!==p(i)?(X(),Z(A,{key:0},[H(r),J("li",null,Q(e.$t("keigennRecord.reductionRate"))+": "+Q((100*p(u)).toFixed(3))+"% ",1),J("li",null,[oe(Q(e.$t("keigennRecord.originalDamage"))+": ",1),J("span",{class:le(p(f))},Q(p(m)),3)])],64)):ne("",!0)])]),_:1})}}}),[["__scopeId","data-v-43628410"]]),da=[{name:"铁壁",id:1191,type:"multiplier",performance:{physics:.8,magic:.8,darkness:1},isFriendly:!0},{name:"盾阵",id:1856,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"干预",id:1174,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"预警",id:74,type:"multiplier",performance:{physics:.7,magic:.7,darkness:1},isFriendly:!0},{name:"武装",id:1176,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"神圣领域",id:82,type:"multiplier",performance:{physics:0,magic:0,darkness:0},isFriendly:!0},{name:"圣光幕帘",id:1362,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣盾阵",id:2674,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"骑士的坚守",id:2675,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"壁垒",id:77,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"极致防御",id:3829,type:"multiplier",performance:{physics:.6,magic:.6,darkness:1},isFriendly:!0},{name:"极致护盾",id:3830,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的直觉",id:735,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"原初的勇猛",id:1857,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"原初的武猛",id:1858,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"战栗",id:87,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"复仇",id:89,type:"multiplier",performance:{physics:.7,magic:.7,darkness:1},isFriendly:!0},{name:"摆脱",id:1457,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死斗",id:409,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血气",id:2678,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"原初的血潮",id:2679,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"原初的血烟",id:2680,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"戮罪",id:3832,type:"multiplier",performance:{physics:.6,magic:.6,darkness:1},isFriendly:!0},{name:"至黑之夜",id:1178,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"弃明投暗",id:746,type:"multiplier",performance:{physics:.9,magic:.8,darkness:1},isFriendly:!0},{name:"暗影墙",id:747,type:"multiplier",performance:{physics:.7,magic:.7,darkness:1},isFriendly:!0},{name:"暗黑布道",id:1894,type:"multiplier",performance:{physics:.95,magic:.9,darkness:1},isFriendly:!0},{name:"暗影卫",id:3835,type:"multiplier",performance:{physics:.6,magic:.6,darkness:1},isFriendly:!0},{name:"行尸走肉",id:810,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死而不僵",id:811,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"出死入生",id:3255,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"献奉",id:2682,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"石之心",id:1840,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"残暴弹",id:1898,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"伪装",id:1832,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"星云",id:1834,type:"multiplier",performance:{physics:.7,magic:.7,darkness:1},isFriendly:!0},{name:"光之心",id:1839,type:"multiplier",performance:{physics:.95,magic:.85,darkness:1},isFriendly:!0},{name:"超火流星",id:1836,type:"multiplier",performance:{physics:0,magic:0,darkness:0},isFriendly:!0},{name:"刚玉之心",id:2683,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"刚玉之清",id:2684,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"神祝祷",id:1218,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"节制",id:1873,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"水流幕",id:2708,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"鼓舞",id:297,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"激励",id:1918,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"炽天的幕帘",id:1917,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"野战治疗阵",id:299,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"异想的幻光",id:317,type:"multiplier",performance:{physics:1,magic:.95,darkness:1},isFriendly:!0},{name:"炽天的幻光",id:1875,type:"multiplier",performance:{physics:1,magic:.95,darkness:1},isFriendly:!0},{name:"生命回生法",id:2710,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"怒涛之计",id:2711,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"命运之轮",id:849,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"天星交错",id:1889,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"擢升",id:2717,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"中间学派",id:1921,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡诊断",id:2607,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"齐衡诊断",id:2608,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡预后",id:2609,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚角清汁",id:2618,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"白牛清汁",id:2619,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"整体论",id:3003,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"整体盾",id:3365,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"输血",id:2612,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"泛输血",id:2613,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"心眼",id:1232,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"金刚极意",id:1179,type:"multiplier",performance:{physics:.8,magic:.8,darkness:1},isFriendly:!0},{name:"行吟",id:1934,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"策动",id:1951,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"防守之桑巴",id:1826,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"即兴表演结束",id:2697,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残影",id:488,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"魔罩",id:168,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护之光",id:2702,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护纹",id:2597,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"抗死",id:2707,type:"multiplier",performance:{physics:1,magic:.9,darkness:1},isFriendly:!0},{name:"雪仇",id:1193,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!1},{name:"牵制",id:1195,type:"multiplier",performance:{physics:.9,magic:.95,darkness:1},isFriendly:!1},{name:"昏乱",id:1203,type:"multiplier",performance:{physics:.95,magic:.9,darkness:1},isFriendly:!1},{name:"武装解除",id:860,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!1},{name:"减速",id:9,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"体力增加",id:2120,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"腐臭",id:1715,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!1},{name:"智力精神降低",id:2115,type:"multiplier",performance:{physics:1,magic:.9,darkness:1},isFriendly:!1},{name:"龙之力",id:2500,type:"multiplier",performance:{physics:.6,magic:.6,darkness:1},isFriendly:!0},{name:"超硬化",id:1722,type:"multiplier",performance:{physics:.1,magic:.1,darkness:1},isFriendly:!0},{name:"玄结界",id:2496,type:"multiplier",performance:{physics:.8,magic:.8,darkness:1},isFriendly:!0},{name:"仙人盾",id:2119,type:"multiplier",performance:{physics:.95,magic:.95,darkness:1},isFriendly:!0},{name:"强力守护",id:1719,type:"multiplier",performance:{physics:.6,magic:.6,darkness:1},isFriendly:!0},{name:"哥布防御",id:2114,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"铜墙铁盾",id:194,type:"multiplier",performance:{physics:.8,magic:.8,darkness:1},isFriendly:!0},{name:"坚守要塞",id:195,type:"multiplier",performance:{physics:.6,magic:.6,darkness:1},isFriendly:!0},{name:"终极堡垒",id:196,type:"multiplier",performance:{physics:.2,magic:.2,darkness:1},isFriendly:!0},{name:"原初大地",id:863,type:"multiplier",performance:{physics:.2,magic:.2,darkness:1},isFriendly:!0},{name:"暗黑之力",id:864,type:"multiplier",performance:{physics:.2,magic:.2,darkness:1},isFriendly:!0},{name:"灵魂之青",id:1931,type:"multiplier",performance:{physics:.2,magic:.2,darkness:1},isFriendly:!0},{name:"坦培拉涂层",id:3686,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"油性坦培拉涂层",id:3687,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"世界树之干",id:3890,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"建筑神之塔",id:3892,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"太阳星座",id:3896,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"神爱抚",id:3903,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0}],ua=new Map;for(const mn of da){const e=je[mn.id][1];mn.fullIcon=Me(e),ua.set(mn.id.toString(16).toUpperCase().padStart(2,"0"),mn)}function ma(e){return ua.get(e)}function pa(e,t){if("absorbed"===e.type)return"useful";if("dot"===t||"darkness"===t)return"unuseful";if(0===e.performance.darkness&&0===e.performance.magic&&0===e.performance.physics||1===e.performance.darkness&&1===e.performance.magic&&1===e.performance.physics)return"useful";const r="physics"===t?"magic":"physics";return 2*(100-100*e.performance[t])===100-100*e.performance[r]?"half-useful":1===e.performance[t]?"unuseful":"useful"}function ha(e,t){return Object.entries(je).reduce((r,[a,[n,o]])=>(e.test(n)&&r.set(a,{name:n,icon:o,isFriendly:t}),r),new Map)}const fa=ha(/(?:耐性|防御力)(?:大幅)?(?:降低|提升|低下|下降)|受伤(?:加重|减轻)|体力(?:增加|衰减|减少)|伤害屏障/,!0),ya=ha(/(?:精神|力量|灵巧|智力){1,2}(?:大幅)?降低/,!1),ga={key:0},wa={key:1,class:"status-container"},va=["title","data-duration","data-sourcePov"],ba=["src","alt"],xa={class:"flags"},Ra=ke(c({__name:"StatusShow",props:{row:{type:Object,required:!0}},setup(e){const t=e,r=aa(),a=r.userOptions,n=r.icon4k;return(e,r)=>"dot"===t.row.type?(X(),Z("div",ga,Q(e.$t("keigennRecord.noSupport")),1)):(X(),Z("div",wa,[(X(!0),Z(A,null,se(t.row.keigenns,(e,o)=>(X(),Z("span",{key:o},[J("span",{class:"status",title:`${p(a).statusCN?e.name:e.effect}(${e.source})`,"data-duration":e.remainingDuration,"data-sourcePov":e.isPov},[J("img",{class:le(`statusIcon ${p(pa)(e,t.row.type)}`),src:p(Ae)(`/i/${e.fullIcon}${p(n)}.png`),alt:e.effect,loading:"lazy",onError:r[0]||(r[0]=(...e)=>p(Ne)&&p(Ne)(...e))},null,42,ba)],8,va)]))),128)),J("span",xa,Q("damage done"===t.row.effect?"":e.$t(`keigennRecord.${t.row.effect}`)),1)]))}}),[["__scopeId","data-v-e479f52a"]]),ka={class:"target"},Sa=["src","alt"],Ca={key:1,class:"alt-text"},Ia={key:3,class:"has-duplicate"},Ta=ke(c({__name:"Target",props:{row:{type:Object,required:!0}},setup(e){const t=e,r=aa(),n=u(!1);function o(e){n.value=!0;e.target.style.display="none"}const l=a(()=>!n.value&&"icon"===(r.userOptions.targetType??"icon")),s=a(()=>la(t.row));return(e,a)=>{return X(),Z("div",ka,[p(l)?(X(),Z("img",{key:0,class:le(`${p(r).isBrowser?"browser":"act"} jobIcon cj${p(r).userOptions.iconType} ${p(s)?"lethal-icon":""}`),src:(n=t.row.jobIcon,i=p(r).userOptions.iconType,`https://souma.diemoe.net/resources/img/cj${i}/${n.replaceAll(/([A-Z])/g," $1").trim()}.png`),alt:t.row.jobIcon,onError:o},null,42,Sa)):(X(),Z("span",Ca,Q(t.row.job),1)),p(s)?(X(),Z("span",{key:2,class:le(`lethal-emoji ${p(r).isBrowser?"browser":"act"} emoji-cj${p(r).userOptions.iconType}`)}," 💀 ",2)):ne("",!0),t.row.hasDuplicate?(X(),Z("span",Ia,Q(p(r).formatterName(t.row.target)),1)):ne("",!0)]);var n,i}}}),[["__scopeId","data-v-c1476431"]]),Ea=ke(c({__name:"Table",props:{rows:{},actionKey:{}},setup(t){const{t:r}=e(),n=t,o=aa().userOptions,l=ie("contextMenu"),s=u(""),i=u("");h(()=>n.rows,e=>{0===e.length&&(s.value="",i.value="")},{immediate:!0});const c=u(!1),d=u(0),m=u(0),f=u(null);ce(l,()=>{c.value=!1});const g=r("keigennRecord.cancelFilter"),w=a(()=>{const e=Array.from(new Set(n.rows.map(e=>e[n.actionKey])));return[{label:g,value:""},...e.map(e=>({label:e,value:e}))]}),v=a(()=>{const e=Array.from(new Map(n.rows.map(e=>[e.target,e])).values());return[{label:g,value:"",job:-1},...e.map(e=>({label:`${e.job}(${e.target})`,value:e.target,job:e.jobEnum}))].sort((e,t)=>He.enumSortMethod(e.job,t.job))});function b(){if(f.value){const e=f.value[n.actionKey];s.value===e?s.value="":s.value=e,c.value=!1}}function x(){if(f.value){const e=f.value.target;i.value===e?i.value="":i.value=e,c.value=!1}}const R=a(()=>n.rows.filter(e=>{const t=!s.value||s.value===g||e[n.actionKey]===s.value,r=!i.value||i.value===g||e.target===i.value;return t&&r}));function k(e){const t=[88,88,88],r=[50,250,200],a=Math.min(1,e/.5),n=Math.min(9,Math.floor(10*a))/9,o=Math.pow(n,.8),l=t[0]+(r[0]-t[0])*o,s=t[1]+(r[1]-t[1])*o,i=t[2]+(r[2]-t[2])*o;return`rgba(${Math.round(l)}, ${Math.round(s)}, ${Math.round(i)}, 1)`}const S=a(()=>[{key:"time",title:r("keigennRecord.time"),dataKey:"time",width:40,align:"center",class:"col-time",headerCellRenderer:()=>y("div",{class:"header-time"},r("keigennRecord.time"))},{key:"action",title:r("keigennRecord.action"),dataKey:n.actionKey,width:64,align:"center",class:"col-action",headerCellRenderer:()=>y("div",{class:"header-filter"},[y(Ke,{size:"small",modelValue:s.value,placeholder:r("keigennRecord.action"),clearable:!1,style:"width:4.5em",teleported:!1,onChange:e=>s.value=e===g?"":e},()=>w.value.map(e=>y(ze,{key:e.value,label:e.label,value:e.value})))]),cellRenderer:({rowData:e})=>y("span",e[n.actionKey]??"")},{key:"target",title:r("keigennRecord.target"),dataKey:"target",width:34,align:"center",class:"col-target",headerCellRenderer:()=>y("div",{class:"header-filter"},[y(Ke,{size:"small",modelValue:i.value,placeholder:r("keigennRecord.target"),clearable:!1,style:"width:4.7em;text-overflow:clip;white-space:nowrap",class:"col-target-select",teleported:!1,onChange:e=>{i.value=e===g?"":e}},()=>v.value.map(e=>y(ze,{key:e.value,label:e.label,value:e.value})))]),cellRenderer:({rowData:e})=>y(Ta,{row:e})},{key:"amount",title:r("keigennRecord.amount"),dataKey:"amount",width:52,align:"right",class:"col-amount",cellRenderer:({rowData:e})=>y(ca,{row:e})},{key:"reduction",title:r("keigennRecord.reduction"),dataKey:"reduction",width:35,align:"right",class:"col-reduction",headerCellRenderer:()=>y("div",{class:"header-reduction"},r("keigennRecord.reduction")),cellRenderer:({rowData:e})=>y("span",{class:"col-reduction-number",style:{color:k(e.reduction)}},`${(100*e.reduction).toFixed(0)}`)},{key:"keigenns",title:r("keigennRecord.keigenns"),dataKey:"keigenns",width:100,align:"left",flexGrow:1,class:"col-keigenns",cellRenderer:({rowData:e})=>y(Ra,{row:e})}]);let C=null;const I=a(()=>({onClick:({rowData:e})=>{const{actionCN:t,amount:a,job:n,keigenns:l,time:s,type:i,effect:c,currentHp:d,maxHp:u,shield:m,reduction:p}=e,h="damage done"===c?"":`,${r(`keigennRecord.${c}`)}`,f=`${s} ${n} ${t} ${a.toLocaleString()}(${r(`keigennRecord.${i}`)}) ${r("keigennRecord.reduction")}(${(100*p).toFixed(0)}%):${0===l.length&&""===h?r("keigennRecord.none"):l.map(e=>o.statusCN?e.name:e.effect).join(",")+h} ${r("keigennRecord.hp")}}:${d}/${u}(${Math.round(d/u*100)}%)+${r("keigennRecord.shield")}:${Math.round(u*+m/100)}(${m}%)`;Ee(f).then(()=>{C?.close(),C=ue.success({message:r("keigennRecord.copySuccess"),duration:800})}).catch(()=>ue.error(r("keigennRecord.copyFailed")))},onContextmenu:({rowData:e,event:t})=>{const r=t;f.value=e,d.value=r.clientX,m.value=r.clientY,c.value=!0}}));return(e,a)=>{const n=Xr,o=Jr;return X(),re(o,{style:{height:"100%",width:"100%"}},{default:ae(({height:e,width:a})=>[H(n,{"header-class":"keigenn-table-header",class:"keigenn-table",columns:S.value,data:R.value,width:a,height:e,"row-height":28,"header-height":24,"row-key":"key","scrollbar-always-on":"","row-event-handlers":I.value},null,8,["columns","data","width","height","row-event-handlers"]),p(c)?(X(),Z("div",{key:0,ref_key:"contextMenu",ref:l,class:"context-menu",style:de({top:`${p(m)}px`,left:`${p(d)}px`})},[J("ul",null,[J("li",{onClick:b},Q(p(s)===(p(f)?.[t.actionKey]??"")?p(r)("keigennRecord.filter.action_cancel",{actionName:p(f)?.[t.actionKey]??p(r)("keigennRecord.this_skill")}):p(r)("keigennRecord.filter.action_only",{actionName:p(f)?.[t.actionKey]??p(r)("keigennRecord.this_skill")})),1),J("li",{onClick:x},Q(p(i)===p(f)?.target?p(r)("keigennRecord.filter.target_cancel",{jobName:p(f)?.job??p(r)("keigennRecord.this_job")}):p(r)("keigennRecord.filter.target_only",{jobName:p(f)?.job??p(r)("keigennRecord.this_job")})),1)])],4)):ne("",!0)]),_:1})}}}),[["__scopeId","data-v-33baeda1"]]),Ha=(e,t)=>t.some(t=>e instanceof t);let Fa,Da;const ja=new WeakMap,Ma=new WeakMap,La=new WeakMap;let Na={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return ja.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Wa(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Aa(e){Na=e(Na)}function Oa(e){return(Da||(Da=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Ka(this),t),Wa(this.request)}:function(...t){return Wa(e.apply(Ka(this),t))}}function $a(e){return"function"==typeof e?Oa(e):(e instanceof IDBTransaction&&function(e){if(ja.has(e))return;const t=new Promise((t,r)=>{const a=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",o),e.removeEventListener("abort",o)},n=()=>{t(),a()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",n),e.addEventListener("error",o),e.addEventListener("abort",o)});ja.set(e,t)}(e),Ha(e,Fa||(Fa=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Na):e)}function Wa(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,r)=>{const a=()=>{e.removeEventListener("success",n),e.removeEventListener("error",o)},n=()=>{t(Wa(e.result)),a()},o=()=>{r(e.error),a()};e.addEventListener("success",n),e.addEventListener("error",o)});return La.set(t,e),t}(e);if(Ma.has(e))return Ma.get(e);const t=$a(e);return t!==e&&(Ma.set(e,t),La.set(t,e)),t}const Ka=e=>La.get(e);const za=["get","getKey","getAll","getAllKeys","count"],Ba=["put","add","delete","clear"],Pa=new Map;function _a(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Pa.get(t))return Pa.get(t);const r=t.replace(/FromIndex$/,""),a=t!==r,n=Ba.includes(r);if(!(r in(a?IDBIndex:IDBObjectStore).prototype)||!n&&!za.includes(r))return;const o=async function(e,...t){const o=this.transaction(e,n?"readwrite":"readonly");let l=o.store;return a&&(l=l.index(t.shift())),(await Promise.all([l[r](...t),n&&o.done]))[0]};return Pa.set(t,o),o}Aa(e=>({...e,get:(t,r,a)=>_a(t,r)||e.get(t,r,a),has:(t,r)=>!!_a(t,r)||e.has(t,r)}));const Ga=["continue","continuePrimaryKey","advance"],Va={},qa=new WeakMap,Ua=new WeakMap,Ya={get(e,t){if(!Ga.includes(t))return e[t];let r=Va[t];return r||(r=Va[t]=function(...e){qa.set(this,Ua.get(this)[t](...e))}),r}};async function*Za(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const r=new Proxy(t,Ya);for(Ua.set(r,t),La.set(r,Ka(t));t;)yield r,t=await(qa.get(r)||t.continue()),qa.delete(r)}function Xa(e,t){return t===Symbol.asyncIterator&&Ha(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&Ha(e,[IDBIndex,IDBObjectStore])}Aa(e=>({...e,get:(t,r,a)=>Xa(t,r)?Za:e.get(t,r,a),has:(t,r)=>Xa(t,r)||e.has(t,r)}));let Ja=null;async function Qa(e){return Ja||(Ja=function(e,t,{blocked:r,upgrade:a,blocking:n,terminated:o}={}){const l=indexedDB.open(e,t),s=Wa(l);return a&&l.addEventListener("upgradeneeded",e=>{a(Wa(l.result),e.oldVersion,e.newVersion,Wa(l.transaction),e)}),r&&l.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),s.then(e=>{o&&e.addEventListener("close",()=>o()),n&&e.addEventListener("versionchange",e=>n(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}("souma",1,{upgrade(t){t.objectStoreNames.contains(e)||t.createObjectStore(e,{keyPath:"key"})}})),Ja}const en="function"==typeof structuredClone?structuredClone:e=>{if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e.source,e.flags);if(Array.isArray(e))return e.map(e=>en(e));if(Object.getPrototypeOf(e)===Object.prototype){const t={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=en(e[r]));return t}return e};function tn(e){const t=function(e){switch(!0){case e.endsWith("33"):return"instant death";case/2\w{4}4$/.test(e):return"crit heal";case e.endsWith("1"):return"dodge";case e.endsWith("3"):return"damage done";case e.endsWith("4"):return"heal";case e.endsWith("5"):return"blocked damage";case e.endsWith("6"):return"parried damage";default:throw new Error(`Unknown effect flag ${e}`)}}(e),r=function(e){switch(!0){case/2\w{3}$/.test(e):return"crit damage";case/4\w{3}$/.test(e):return"direct hit damage";case/6\w{3}$/.test(e):return"crit direct hit damage";default:return"damage"}}(e),a=function(e){switch(!0){case/7?[1-4]\w{3}[35]$/.test(e):case/[16]$/.test(e):return"physics";case/^E$/.test(e):case/5\w{4}$/.test(e):return"magic";case/^(?:\d0)?3$/.test(e):case/6\w{4}$/.test(e):return"darkness";default:return"physics"}}(e);return{effect:t,properties:r,type:a}}const rn=["3E","113","213","313"],an=["A10","E"],nn=["04"],on=["01","03","05","06","36"];function ln(e){let t=0,r=e[8]??"",a=e[9]??"";rn.includes(r)&&(t+=2,r=e[8+t]??r,a=e[8+t+1]??a),an.includes(r)&&(t+=2,r=e[8+t]??r,a=e[8+t+1]??a);const n=function(e){if(void 0===e)return 0;const t=e.length;if(t<=4)return 0;let r=Number.parseInt(e.slice(0,t-4),16);if("4"===e[t-4]){const a=Number.parseInt(e.slice(t-2,t),16);r=r-a+(a<<16)}return r}(a),o=`00${r}`.slice(-2);return{amount:n,lowByte:o,flags:r,isHeal:nn.includes(o),isAttack:on.includes(o)}}const sn={class:"header-select"},cn={style:{height:"100%"}},dn={key:0,class:"testLog"},un=ke(c({__name:"keigennRecord2",setup(e){const t=Pe(),r=aa(),n=r.userOptions;r.checkIsBrowser();const o=u(n.minimize),l=a(()=>n.actionCN?"actionCN":"action"),s=u(!1),i=me("keigenn-record-2-pov-id",""),c=me("keigenn-record-2-party-list",[]),d=me("keigenn-record-2-job-map",{}),m=me("keigenn-record-2-party-event-party",[]),h=u(0),f=u([{zoneName:"",duration:"00:00",table:pe([]),key:"init",timestamp:-1}]),y={rsv:/^262\|(?<timestamp>[^|]*)\|[^|]*\|[^|]*\|_rsv_(?<id>\d+)_[^|]+\|(?<real>[^|]*)\|/i,ability:Ve.ability(),statusEffectExplicit:Ve.statusEffectExplicit(),gainsEffect:Ve.gainsEffect(),losesEffect:Ve.losesEffect(),inCombat:/^260\|(?<timestamp>[^|]*)\|(?<inACTCombat>[^|]*)\|(?<inGameCombat>[^|]*)\|/,changeZone:Ve.changeZone(),partyList:/^11\|(?<timestamp>[^|]*)\|(?<partyCount>\d*)\|(?<list>(?:\w{8}\|)*)\w{16}/,primaryPlayer:/^02\|(?<timestamp>[^|]*)\|(?<id>[^|]*)\|(?<name>[^|]*)/,addCombatant:Ve.addedCombatant(),removingCombatant:Ve.removingCombatant(),networkDoT:Ve.networkDoT()},w=u(0),v=me("souma-keigenn-record-2-zone-name",""),b=me("souma-keigenn-record-2-rsv-data",{}),x={},R={friendly:{},enemy:{}},k=function(e){const t=async t=>t(await Qa(e));return{getAll:()=>t(t=>t.getAll(e)),get:r=>t(t=>t.get(e,r)),set:r=>t(t=>t.put(e,r)),bulkSet:r=>t(async t=>{const a=t.transaction(e,"readwrite");for(const e of r)a.store.put(e);await a.done}),remove:r=>t(t=>t.delete(e,r)),clear:()=>t(t=>t.clear(e))}}("keigenn-record-2");function S(){s.value=!0,w.value=0,h.value=0,f.value.length=0,f.value.push({zoneName:"",duration:"00:00",table:pe([]),key:"init",timestamp:-1})}function C(){s.value=!1,j()}function I(e){for(const t in y){const r=y[t].exec(e);if(r){const a=e.split("|");switch(t){case"statusEffectExplicit":r.groups?.targetId.startsWith("1")&&(x[r.groups.targetId]=r.groups.currentShield);break;case"gainsEffect":{const e=a[Ge.GainsEffect.fields.effectId],t=a[Ge.GainsEffect.fields.effect],r=a[Ge.GainsEffect.fields.target],n=a[Ge.GainsEffect.fields.targetId],o=Number.parseInt(a[Ge.GainsEffect.fields.count],16);let l=ma(e);if(!l){const t=n.startsWith("1")&&fa.get(Number.parseInt(e,16).toString())||n.startsWith("4")&&ya.get(Number.parseInt(e,16).toString());if(!t)return;const r=Me(t.icon),a=o>1?Le(r,o):r;l={type:"multiplier",performance:{physics:1,magic:1,darkness:1},id:Number.parseInt(e,16),fullIcon:a,name:t.name,isFriendly:t.isFriendly}}const s=a[Ge.GainsEffect.fields.duration],c=a[Ge.GainsEffect.fields.source],d=a[Ge.GainsEffect.fields.sourceId],u=new Date(a[Ge.GainsEffect.fields.timestamp]).getTime()+1e3*Number.parseFloat(s),m={name:l.name,type:l.type,count:o,effect:t,effectId:e,source:c,sourceId:d,target:r,targetId:n,expirationTimestamp:u,performance:l.performance,fullIcon:l.fullIcon,isPov:i.value===d};n.startsWith("1")&&l.isFriendly?(void 0===R.friendly[n]&&(R.friendly[n]={}),R.friendly[n][e]=m):n.startsWith("4")&&!l.isFriendly&&(void 0===R.enemy[r]&&(R.enemy[r]={}),R.enemy[r][e]=m)}break;case"losesEffect":{const e=a[Ge.LosesEffect.fields.target],t=a[Ge.LosesEffect.fields.targetId],r=a[Ge.LosesEffect.fields.effectId];t.startsWith("1")?R.friendly[t]&&Reflect.deleteProperty(R.friendly[t],r):R.enemy[e]&&Reflect.deleteProperty(R.enemy[e],r)}break;case"addCombatant":if("00"!==a[Ge.AddedCombatant.fields.job]){const e=a[Ge.AddedCombatant.fields.job],t=new Date(a[Ge.AddedCombatant.fields.timestamp]).getTime();d.value[a[Ge.AddedCombatant.fields.id]]={job:Number.parseInt(e,16),timestamp:t}}break;case"removingCombatant":Reflect.deleteProperty(d.value,a[Ge.RemovedCombatant.fields.id]);break;case"primaryPlayer":i.value=a[Ge.ChangedPlayer.fields.id];break;case"partyList":c.value=(r.groups?.list?.split("|")??[]).filter(Boolean);break;case"changeZone":v.value=a[Ge.ChangeZone.fields.name],F(new Date(a[Ge.ChangeZone.fields.timestamp]).getTime());break;case"inCombat":{const e="1"===a[Ge.InCombat.fields.inACTCombat],t="1"===a[Ge.InCombat.fields.inGameCombat],r=new Date(a[Ge.InCombat.fields.timestamp]).getTime();if(e||t){if(w.value>0)return;"placeholder"===f.value[0].key&&f.value.splice(0,1);const e=a[Ge.InCombat.fields.timestamp];return 0!==f.value[0].table.length&&f.value.unshift({zoneName:"",duration:"00:00",table:pe([]),key:e,timestamp:r}),w.value=r,f.value[0].zoneName=v.value,f.value[0].timestamp=r,f.value[0].key=e,void(h.value=0)}if(!e&&!t)return void F(r)}break;case"rsv":{const e=Number(r.groups?.id),t=a[Ge.RSVData.fields.value];e&&t&&(b.value[Number(e)]=t)}break;case"networkDoT":if(!n.parseDoT)return;{const e=a[Ge.NetworkDoT.fields.which],t=a[Ge.NetworkDoT.fields.id];if("DoT"!==e||t.startsWith("4")||t!==i.value&&!c.value.includes(t)&&!m.value.find(e=>e.id===t))return;const r=a[Ge.NetworkDoT.fields.name],n=a[Ge.NetworkDoT.fields.damage],o=Number.parseInt(n,16),l=new Date(a[Ge.Ability.fields.timestamp]??"???").getTime(),s=Number(a[Ge.NetworkDoT.fields.currentHp]),d=Number(a[Ge.NetworkDoT.fields.maxHp]),u=M(0===w.value?0:l-w.value),{job:p,hasDuplicate:h}=T(t),y=He.jobToFullName(He.jobEnumToJob(p)).simple2,g=p,v=He.jobEnumToIcon(g);E({key:f.value[0].table.length.toString(),time:u,id:void 0,action:e,actionCN:e,source:"",target:r,targetId:t,job:y,jobIcon:v,jobEnum:g,hasDuplicate:h,amount:o,keigenns:[],currentHp:s,maxHp:d,effect:"damage done",type:"dot",shield:x[t]??"0",povId:i.value,reduction:0})}break;case"ability":if(0===w.value)return;{const e=ln(a);if(e.isAttack&&e.amount>=0){const t=a[Ge.Ability.fields.sourceId]??"???",o=a[Ge.Ability.fields.targetId]??"???";if(!t.startsWith("4")||!o.startsWith("1"))return;if(o!==i.value&&!c.value.includes(o)&&!m.value.find(e=>e.id===o))return;const l=new Date(a[Ge.Ability.fields.timestamp]??"???").getTime(),s=a[Ge.Ability.fields.ability],d=s.match(/^_rsv_(?<id>\d+)_/),u=a[Ge.Ability.fields.id]??"???";let p=s;if(d){const e=Number(d.groups?.id);p=b.value[e]??s.match(/^_(?<id>rsv_\d+)_/)?.groups?.id}else if(p=p.replace(/unknown_.*/,"攻击"),!1===n.parseAA&&/^攻击|攻撃|[Aa]ttack$/.test(p))return;const h=_e(Number.parseInt(u,16)),y=h&&""!==h?h:p,g=Number(a[Ge.Ability.fields.targetCurrentHp]),v=Number(a[Ge.Ability.fields.targetMaxHp]),k=a[Ge.Ability.fields.source]??"???",S=a[Ge.Ability.fields.target]??"???",{effect:C,type:I}=tn(e.flags),H=M(0===w.value?0:l-w.value),{job:F,hasDuplicate:D}=T(o),j=He.jobToFullName(He.jobEnumToJob(F)).simple2,L=F,N=He.jobEnumToIcon(L),A=en(Object.values(R.friendly[o]??[]).concat(Object.values(R.enemy[k]??[])).filter(e=>{const t=Math.max(0,(e.expirationTimestamp-l)/1e3);return e.remainingDuration=t>=999?"":t.toFixed(t>.05&&t<.95?1:0),Number(e.remainingDuration)>-3})),O=x[r.groups.targetId]??"0",$=e.amount;let W=0;if("instant death"!==C&&"dodge"!==C){let e=1;"blocked damage"===C?e=.8:"parried damage"===C&&(e=.85);let t=1;for(const r of A)"absorbed"!==r.type&&(t*=r.performance[I]??1);W=1-t*e}E({key:f.value[0].table.length.toString(),time:H,id:u,action:p,actionCN:y,source:k,target:S,targetId:o,job:j,jobIcon:N,jobEnum:L,hasDuplicate:D,amount:$,keigenns:A,currentHp:g,maxHp:v,effect:C,type:I,shield:O,povId:i.value,reduction:W}),f.value[0].duration=M(new Date(a[Ge.Ability.fields.timestamp]).getTime()-w.value)}}}}}}function T(e){const t=d.value[e],r=m.value.find(t=>t.id===e)??{job:0,timestamp:0},a=(t?.timestamp??0)>r.timestamp?t:r,n=a===t?Object.entries(d.value).some(([t,r])=>t!==e&&r.job===a?.job&&c.value.includes(t)):m.value.some(t=>t.id!==e&&t.job===a?.job);return{job:a?.job??0,hasDuplicate:n}}function E(e){f.value[0].table.unshift(e)}function F(e){0!==w.value&&(f.value[0].duration=M(e-w.value),f.value[0]=xe(f.value[0]),w.value=0,R.friendly={},R.enemy={},j())}async function j(){if(s.value)return;const e=f.value.filter(e=>"placeholder"!==e.key&&e.timestamp>0).map(e=>{const t=Array.isArray(e.table)?Re(e.table):[];return{...Re(e),table:t}});await k.clear(),await k.bulkSet(e)}function M(e){const t=Math.max(Math.floor(e/6e4),0),r=Math.max(Math.floor((e-6e4*t)/1e3),0);return`${t<10?"0":""}${t}:${r<10?"0":""}${r}`}function L(){o.value=!o.value}function N(){f.value.unshift({zoneName:"",duration:"00:00",table:pe([]),key:"test",timestamp:Date.now()}),h.value=0}return D(()=>{const e=he({storageKey:"keigenn-record-2-theme"}),t=fe(e);!1===e.value&&t();for(const r in d.value){const e=d.value[r];Date.now()-e.timestamp>864e5&&Reflect.deleteProperty(d.value,r)}!async function(){try{const e=await k.getAll();e.length&&(f.value.length=0,f.value.push(...e.reverse()))}catch(e){throw f.value.length=0,e}}(),qe("LogLine",e=>{I(e.rawLine)}),qe("PartyChanged",e=>{m.value=e.party.map(e=>({...e,timestamp:Date.now()}))}),qe("ChangePrimaryPlayer",e=>{i.value=Number(e.charID).toString(16).toUpperCase()})}),(e,a)=>{const s=ze,i=Ke,c=Be,d=Ea,u=ta;return X(),Z(A,null,[J("div",{class:"wrapper",style:de({"--scale":p(n).scale,"--opacity":p(n).opacity}),onContextmenu:a[1]||(a[1]=g(()=>{},["prevent"]))},[J("header",null,[J("div",sn,[ye(H(i,{modelValue:p(h),"onUpdate:modelValue":a[0]||(a[0]=e=>we(h)?h.value=e:null),size:"small",class:le(["combat-select",p(r).isBrowser?"browser":"act"]),"popup-class-name":"combat-select-popup",offset:0,"show-arrow":!1},{default:ae(()=>[(X(!0),Z(A,null,se(p(f).length,e=>(X(),re(s,{key:`${p(f)[e-1].key}-${p(f)[e-1].duration}-${p(f)[e-1].zoneName}`,value:e-1,label:`${p(f)[e-1].duration} ${p(f)[e-1].zoneName}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue","class"]),[[ge,!p(o)]])]),p(r).isBrowser?ne("",!0):(X(),re(c,{key:0,class:le(["minimize",p(o)?"in-minimize":"not-minimize"]),icon:p(o)?p(ve):p(be),circle:"",style:de({opacity:p(o)?.5:1}),onClick:L},null,8,["class","icon","style"]))]),ye(J("main",cn,[H(d,{rows:p(f)[p(h)].table,"action-key":p(l)},null,8,["rows","action-key"])],512),[[ge,!p(o)]])],36),p(r).isBrowser||p(t)?(X(),Z("div",dn,[p(t)?(X(),re(c,{key:0,onClick:N},{default:ae(()=>[...a[2]||(a[2]=[oe(" 测试 ",-1)])]),_:1})):ne("",!0),H(u,{"m-1":"",onBeforeHandle:S,onAfterHandle:C,onHandleLine:I})])):ne("",!0)],64)}}}),[["__scopeId","data-v-3e2930e4"]]);export{un as default};
