import{P as e,ar as t,_ as n,d as l,s as i,V as a,c as s,o,I as r,b as c,u as d,q as u,J as p,U as m,a4 as f,r as y,x as g,h as w,g as b,i as h,z as v,a as S,p as x,j as _,w as j,m as T,E as F,B as P,as as V,t as $,e as O,at as I,a0 as k,au as D,M as N,av as C,a6 as A,f as M,a9 as R,D as z,F as B,l as E,aw as J,ak as U,ax as L,k as K,v as G,ai as W,aj as H}from"./index-DSRZjGPU.js";/* empty css                  */import{E as q,a as Q,b as X}from"./el-header-Cc-tXZRA.js";/* empty css                */import{u as Y,_ as Z,p as ee}from"./TimelineShow-N5zei4mk.js";import{E as te,a as ne}from"./el-slider-C3Ej7P9H.js";/* empty css                 */import{E as le}from"./el-input-number-BxYE4iaB.js";/* empty css                   */import{b as ie}from"./el-popper-RinbjFy3.js";import{E as ae}from"./el-link-CuNIgzYX.js";import{E as se}from"./el-col-DQHol8_I.js";import{E as oe,a as re}from"./el-form-DsHTTwW6.js";import{E as ce}from"./el-empty-Dl7zTkdM.js";import{E as de}from"./el-card-Dn2OSM7v.js";import{E as ue}from"./el-checkbox-CqHbiJ1_.js";/* empty css               */import{E as pe,a as me}from"./el-select-BmPWLDtg.js";import"./el-scrollbar-D5rG_JOO.js";import{a as fe,E as ye}from"./el-table-column-DSnCGbvR.js";import{E as ge}from"./el-switch-kNEMaHjW.js";/* empty css                  */import{g as we}from"./actionChinese-DgBhjTbn.js";import{U as be}from"./util-BOtaAWHW.js";import{h as he,g as ve}from"./xivapi-a6oZXlzI.js";import{E as Se,a as xe}from"./index-IaqZO1Zw.js";import{C as _e}from"./index-BS9K9DHM.js";import{u as je}from"./index-DbjFMir4.js";import{E as Te}from"./validator-Cef8smZc.js";import{E as Fe}from"./index-BglxcZf4.js";import{_ as Pe}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{E as Ve,u as $e}from"./useWebSocket-o3DZaKnL.js";import{_ as Oe}from"./ThemeToggle-CNb_j0rl.js";import{E as Ie}from"./el-space-Cg5sMKGM.js";/* empty css                        */import{E as ke}from"./el-overlay-CS6y6NLO.js";import{l as De}from"./lz-string-BbEI1aOt.js";import{h as Ne}from"./moment-CBOc1lqT.js";import{Z as Ce}from"./zoneInfo-7Z04Y0Eq.js";import{c as Ae}from"./clipboard-BKuKuDeo.js";import{a as Me,c as Re}from"./overlay_plugin_api-DHbPkDtN.js";import{b as ze,c as Be}from"./index-CosBB3C4.js";import{c as Ee}from"./use-form-common-props-BXQEs0Nk.js";import{E as Je}from"./index-6IYuErIC.js";import"./status-VujwLG_3.js";import"./regexes-BKeG-dSP.js";import"./chineseToIcon-xFdmTerz.js";import"./debounce-C33GXFI_.js";import"./index-COCPTi9V.js";import"./index-CCbFNXrW.js";import"./focus-trap-DbWDWOEs.js";import"./index-BKWBNf59.js";import"./_baseClone-rPXliiXZ.js";import"./index-BqmRLER5.js";import"./index-Cl_fV40w.js";import"./scroll-DvMapQw9.js";import"./vnode-DJebjIyX.js";import"./raf-B45nAamc.js";import"./index-wQF8-v2s.js";import"./index-BbnrBwcb.js";import"./_commonjsHelpers-CLPN-Npl.js";import"./zone_info-BK1oa_54.js";const Ue=e({space:{type:[Number,String],default:""},active:{type:Number,default:0},direction:{type:String,default:"horizontal",values:["horizontal","vertical"]},alignCenter:{type:Boolean},simple:{type:Boolean},finishStatus:{type:String,values:["wait","process","finish","error","success"],default:"finish"},processStatus:{type:String,values:["wait","process","finish","error","success"],default:"process"}}),Le={[_e]:(e,n)=>[e,n].every(t)},Ke="ElSteps",Ge=l({name:"ElSteps"});var We=n(l({...Ge,props:Ue,emits:Le,setup(e,{emit:t}){const n=e,l=i("steps"),{children:f,addChild:y,removeChild:g,ChildrenSorter:w}=je(p(),"ElStep");return a(f,()=>{f.value.forEach((e,t)=>{e.setIndex(t)})}),m(Ke,{props:n,steps:f,addStep:y,removeStep:g}),a(()=>n.active,(e,n)=>{t(_e,e,n)}),(e,t)=>(o(),s("div",{class:u([d(l).b(),d(l).m(e.simple?"simple":e.direction)])},[r(e.$slots,"default"),c(d(w))],2))}}),[["__file","steps.vue"]]);const He=e({title:{type:String,default:""},icon:{type:f},description:{type:String,default:""},status:{type:String,values:["","wait","process","finish","error","success"],default:""}}),qe=l({name:"ElStep"});var Qe=n(l({...qe,props:He,setup(e){const n=e,l=i("step"),m=y(-1),f=y({}),I=y(""),k=g(Ke),D=p();w(()=>{a([()=>k.props.active,()=>k.props.processStatus,()=>k.props.finishStatus],([e])=>{L(e)},{immediate:!0})});const N=b(()=>n.status||I.value),C=b(()=>{const e=k.steps.value[m.value-1];return e?e.internalStatus.value:"wait"}),A=b(()=>k.props.alignCenter),M=b(()=>"vertical"===k.props.direction),R=b(()=>k.props.simple),z=b(()=>k.steps.value.length),B=b(()=>{var e;return(null==(e=k.steps.value[z.value-1])?void 0:e.uid)===D.uid}),E=b(()=>R.value?"":k.props.space),J=b(()=>[l.b(),l.is(R.value?"simple":k.props.direction),l.is("flex",B.value&&!E.value&&!A.value),l.is("center",A.value&&!M.value&&!R.value)]),U=b(()=>{const e={flexBasis:t(E.value)?`${E.value}px`:E.value?E.value:100/(z.value-(A.value?0:1))+"%"};return M.value||B.value&&(e.maxWidth=100/z.value+"%"),e}),L=e=>{e>m.value?I.value=k.props.finishStatus:e===m.value&&"error"!==C.value?I.value=k.props.processStatus:I.value="wait";const t=k.steps.value[m.value-1];t&&t.calcProgress(I.value)},K={uid:D.uid,getVnode:()=>D.vnode,currentStatus:N,internalStatus:I,setIndex:e=>{m.value=e},calcProgress:e=>{const t="wait"===e,n={transitionDelay:`${t?"-":""}${150*m.value}ms`},l=e===k.props.processStatus||t?0:100;n.borderWidth=l&&!R.value?"1px":0,n["vertical"===k.props.direction?"height":"width"]=`${l}%`,f.value=n}};return k.addStep(K),h(()=>{k.removeStep(K)}),(e,t)=>(o(),s("div",{style:x(d(U)),class:u(d(J))},[v(" icon & line "),S("div",{class:u([d(l).e("head"),d(l).is(d(N))])},[d(R)?v("v-if",!0):(o(),s("div",{key:0,class:u(d(l).e("line"))},[S("i",{class:u(d(l).e("line-inner")),style:x(f.value)},null,6)],2)),S("div",{class:u([d(l).e("icon"),d(l).is(e.icon||e.$slots.icon?"icon":"text")])},[r(e.$slots,"icon",{},()=>[e.icon?(o(),_(d(F),{key:0,class:u(d(l).e("icon-inner"))},{default:j(()=>[(o(),_(T(e.icon)))]),_:1},8,["class"])):"success"===d(N)?(o(),_(d(F),{key:1,class:u([d(l).e("icon-inner"),d(l).is("status")])},{default:j(()=>[c(d(P))]),_:1},8,["class"])):"error"===d(N)?(o(),_(d(F),{key:2,class:u([d(l).e("icon-inner"),d(l).is("status")])},{default:j(()=>[c(d(V))]),_:1},8,["class"])):d(R)?v("v-if",!0):(o(),s("div",{key:3,class:u(d(l).e("icon-inner"))},$(m.value+1),3))])],2)],2),v(" title & description "),S("div",{class:u(d(l).e("main"))},[S("div",{class:u([d(l).e("title"),d(l).is(d(N))])},[r(e.$slots,"title",{},()=>[O($(e.title),1)])],2),d(R)?(o(),s("div",{key:0,class:u(d(l).e("arrow"))},null,2)):(o(),s("div",{key:1,class:u([d(l).e("description"),d(l).is(d(N))])},[r(e.$slots,"description",{},()=>[O($(e.description),1)])],2))],2)],6))}}),[["__file","item.vue"]]);const Xe=k(We,{Step:Qe}),Ye=I(Qe),Ze=e({type:{type:String,values:["primary","success","info","warning","danger",""],default:""},size:{type:String,values:D,default:""},truncated:Boolean,lineClamp:{type:[String,Number]},tag:{type:String,default:"span"}}),et=l({name:"ElText"});const tt=k(n(l({...et,props:Ze,setup(e){const t=e,n=y(),l=Ee(),a=i("text"),s=b(()=>[a.b(),a.m(t.type),a.m(l.value),a.is("truncated",t.truncated),a.is("line-clamp",!N(t.lineClamp))]),c=()=>{var e,l,i,a,s,o,r;if(A().title)return;let c=!1;const d=(null==(e=n.value)?void 0:e.textContent)||"";if(t.truncated){const e=null==(l=n.value)?void 0:l.offsetWidth,t=null==(i=n.value)?void 0:i.scrollWidth;e&&t&&t>e&&(c=!0)}else if(!N(t.lineClamp)){const e=null==(a=n.value)?void 0:a.offsetHeight,t=null==(s=n.value)?void 0:s.scrollHeight;e&&t&&t>e&&(c=!0)}c?null==(o=n.value)||o.setAttribute("title",d):null==(r=n.value)||r.removeAttribute("title")};return w(c),C(c),(e,t)=>(o(),_(T(e.tag),{ref_key:"textRef",ref:n,class:u(d(s)),style:x({"-webkit-line-clamp":e.lineClamp})},{default:j(()=>[r(e.$slots,"default")]),_:3},8,["class","style"]))}}),[["__file","text.vue"]])),nt=new Map;nt.set(26155,{type:"cast",window:[999,999],battleOnce:!0}),nt.set(28027,{type:"cast",window:[999,999],battleOnce:!0}),nt.set(26340,{type:"cast",window:[999,999],battleOnce:!0}),nt.set(25533,{type:"begincast",window:[60,60]}),nt.set(26376,{type:"cast",window:[999,999],battleOnce:!0}),nt.set(26814,{type:"begincast",window:[999,999],battleOnce:!0}),nt.set(25313,{type:"begincast",window:[200,200]}),nt.set(27526,{type:"begincast",window:[999,999],battleOnce:!0}),nt.set(26215,{type:"cast",window:[500,30],battleOnce:!0}),nt.set(29050,{type:"begincast",window:[200,30],battleOnce:!0}),nt.set(29156,{type:"cast",window:[20,20]}),nt.set(27973,{type:"cast",window:[20,20]}),nt.set(27937,{type:"begincast",window:[20,20]}),nt.set(28059,{type:"begincast",window:[20,20]}),nt.set(28060,{type:"begincast",window:[20,20]}),nt.set(28061,{type:"begincast",window:[20,20]}),nt.set(27956,{type:"begincast",window:[20,20]}),nt.set(27957,{type:"begincast",window:[20,20]}),nt.set(27952,{type:"begincast",window:[30,30]}),nt.set(27969,{type:"begincast",window:[20,20]}),nt.set(27971,{type:"begincast",window:[20,20]}),nt.set(27939,{type:"begincast",window:[20,20]}),nt.set(27966,{type:"begincast",window:[20,20]}),nt.set(25316,{type:"begincast",window:[999,999],battleOnce:!0}),nt.set(25544,{type:"begincast",window:[10,10]}),nt.set(26379,{type:"begincast",window:[10,10]}),nt.set(31552,{type:"begincast",window:[30,30]}),nt.set(31573,{type:"begincast",window:[30,30]}),nt.set(31573,{type:"begincast",window:[30,30]}),nt.set(31617,{type:"begincast",window:[8,8]}),nt.set(31624,{type:"begincast",window:[30,30]}),nt.set(31649,{type:"begincast",window:[30,30]}),nt.set(18864,{type:"cast",window:[10,2.5],syncOnce:!0}),nt.set(18480,{type:"cast",window:[200,60],syncOnce:!0,battleOnce:!0}),nt.set(18516,{type:"cast",window:[250,65],syncOnce:!0,battleOnce:!0}),nt.set(18522,{type:"begincast",window:[500,500],syncOnce:!0,battleOnce:!0}),nt.set(18552,{type:"begincast",window:[67,67],syncOnce:!0}),nt.set(18553,{type:"cast",window:[67,67],syncOnce:!0}),nt.set(19083,{type:"cast",window:[900,200],syncOnce:!0,battleOnce:!0}),nt.set(40191,{type:"begincast",window:[200,20],syncOnce:!0}),nt.set(40265,{type:"begincast",window:[500,20],syncOnce:!0,battleOnce:!0}),nt.set(40246,{type:"begincast",window:[999,30],syncOnce:!0,battleOnce:!0}),nt.set(40306,{type:"begincast",window:[30,30],syncOnce:!0}),nt.set(11103,{type:"begincast",window:[310,30],syncOnce:!0,battleOnce:!0}),nt.set(11517,{type:"begincast",window:[600,30],syncOnce:!0,battleOnce:!0}),nt.set(11122,{type:"begincast",window:[100,30],syncOnce:!0,battleOnce:!0}),nt.set(11143,{type:"begincast",window:[60,60],syncOnce:!0}),nt.set(11126,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),nt.set(11596,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),nt.set(11597,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),nt.set(42785,{type:"begincast",window:[9.6,2],syncOnce:!0}),nt.set(42838,{type:"cast",window:[77.2,30],syncOnce:!0,battleOnce:!0}),nt.set(42863,{type:"cast",window:[30,30],syncOnce:!1}),nt.set(42787,{type:"cast",window:[30,30],syncOnce:!1}),nt.set(42864,{type:"cast",window:[30,30],syncOnce:!1}),nt.set(41946,{type:"begincast",window:[10,10],syncOnce:!1}),nt.set(41936,{type:"begincast",window:[20,30],syncOnce:!0}),nt.set(41939,{type:"begincast",window:[20,20],syncOnce:!0}),nt.set(42825,{type:"begincast",window:[60,60],syncOnce:!0,battleOnce:!0}),nt.set(41969,{type:"begincast",window:[20,20],syncOnce:!0}),nt.set(41871,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0}),nt.set(43053,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0});class lt{storageKey;maxSize;cleanupRatio;constructor(e){this.storageKey=e?.key??"cache:all",this.maxSize=e?.maxSize??2097152,this.cleanupRatio=e?.cleanupRatio??.25}loadAll(){try{const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):{}}catch{return{}}}saveAll(e){try{localStorage.setItem(this.storageKey,JSON.stringify(e))}catch{this.cleanupOldEntries(e);try{localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(t){}}}getTotalSize(e){return new Blob([JSON.stringify(e)]).size}cleanupOldEntries(e){const t=Object.entries(e),n=t.map(([e,t])=>({key:e,expire:t?.expire??0}));n.sort((e,t)=>e.expire-t.expire);const l=Math.ceil(t.length*this.cleanupRatio);for(let i=0;i<l;i++)delete e[n[i].key]}set(e,t,n=2592e5){const l=this.loadAll();l[e]={data:t,expire:Date.now()+n},this.getTotalSize(l)>this.maxSize&&this.cleanupOldEntries(l),this.saveAll(l)}get(e){const t=this.loadAll(),n=t[e];return n?n.expire<Date.now()?(delete t[e],this.saveAll(t),null):n.data:null}clearExpired(){const e=this.loadAll(),t=Date.now();let n=!1;for(const l in e)(!e[l].expire||e[l].expire<t)&&(delete e[l],n=!0);n&&this.saveAll(e)}clearAll(){localStorage.removeItem(this.storageKey)}}const it={class:"query-results"},at={class:"ability-filter-container"},st={key:0,class:"loading-abilities"},ot=["src","alt","onerror"],rt=Pe(l({__name:"FflogsImport",props:{filters:{}},emits:["showFFlogsToggle","editTimeline"],setup(e,{emit:t}){const n=e,l=t,i=new RegExp("(?<=^|\\/)(?<code>(?:a:)?\\w{16,})[#?]fight=(?<fight>\\d+|last)"),a=y("查询"),r=y(""),u=y(!1),p=y(!1),m=y(0),f=y(!1),g=M({});D();const b=Y(),h=new lt({key:"souma-fflogs-cache",maxSize:2097152,cleanupRatio:.25});function T(e){const t=h.get(e);if(!t)return null;try{return JSON.parse(t)}catch{return null}}function P(e,t,n=2592e5){const l={data:t,expire:Date.now()+n};h.set(e,JSON.stringify(l),n)}function V(e){return e&&e.expire>Date.now()}async function I(e){p.value=!0,m.value=2,g.player=e;try{await async function(){f.value=!1;const e=[];async function t(n){try{const l=`events:friendly:${g.code}:${n}:${g.player?.id}`,i=T(l);let a;i&&V(i)?a=i.data:(a=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${g.code}?start=${n}&end=${g.end}&hostility=0&sourceid=${g.player?.id}&api_key=${b.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),P(l,a)),e.push(...a.events),a.nextPageTimestamp&&a.nextPageTimestamp>0&&a.nextPageTimestamp<g.end&&await t(a.nextPageTimestamp)}catch(l){Fe.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${l}`,"获取友方技能数据失败",{confirmButtonText:"确定",type:"error"})}}async function l(t,n){if(n>=0)try{const i=`events:enemy:${g.code}:${t}:${g.bossIDs[n]}`,a=T(i);let s;a&&V(a)?s=a.data:(s=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${g.code}?start=${t}&end=${g.end}&hostility=1&sourceid=${g.bossIDs[n]}&api_key=${b.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),P(i,s)),e.push(...s.events),s.nextPageTimestamp&&s.nextPageTimestamp>0&&s.nextPageTimestamp<g.end&&await l(s.nextPageTimestamp,n),n<g.bossIDs.length-1&&await l(t,n+1)}catch(i){Fe.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${i}`,"获取敌方技能数据失败",{confirmButtonText:"确定",type:"error"})}}g.abilityFilterEvents.length=0,await Promise.all([t(g.start),l(g.start,0)]);for(const n of e)"begincast"===n.type&&n.sourceIsFriendly||g.abilityFilterEvents.push({time:Number(((n.timestamp-g.start)/1e3).toFixed(1)),type:n.type,actionName:we(n.ability.guid)??n.ability.name,actionId:n.ability.guid,sourceIsFriendly:n.sourceIsFriendly,url:n?.ability?.abilityIcon.replace("-","/").replace(".png","")??"000000/000405",window:void 0,sourceID:n.sourceID});g.player?.icon&&n.filters[g.player.icon]&&(g.abilityFilterSelected=n.filters[g.player.icon]);f.value=!0}(),g.abilityFilterCandidate=g.abilityFilterEvents.reduce((e,t)=>(t.sourceIsFriendly&&!e.find(e=>e.actionId===t.actionId)&&e.push(t),e),[]),p.value=!1}catch(t){Fe.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${t}`,"获取玩家技能数据失败",{confirmButtonText:"确定",type:"error"}),p.value=!1}}function k(){p.value=!0,m.value=3,g.player?.icon&&b.updateFilters(g.player?.icon,JSON.parse(JSON.stringify(g.abilityFilterSelected))),g.abilityFilterEvents=g.abilityFilterEvents.filter(e=>e.sourceIsFriendly&&g.abilityFilterSelected.includes(e.actionId)||!e.sourceIsFriendly).sort((e,t)=>e.time-t.time),g.abilityFilterEvents=function(e){for(const t of e){const e=nt.get(t.actionId);e?.type===t.type&&(t.window=e?.window,t.syncOnce=Boolean(e?.syncOnce),t.battleOnce=Boolean(e?.battleOnce))}return e}(g.abilityFilterEvents),g.abilityFilterEventsAfterFilterRawTimeline=g.abilityFilterEvents.map(e=>{const{time:t,actionName:n,actionId:l,type:i,sourceID:a,window:s,sourceIsFriendly:o,syncOnce:r,battleOnce:c}=e;if(o)return`${t} "<${n}>~"${u.value?` tts "${n}"`:""}`;if(/^(?:攻击|attack|攻撃)$/i.test(n)&&!s||"cast"===i&&!s||g.battleSyncedIDs.includes(l))return`# ${t} "${n}"`;const d=g.enemies.find(e=>e.id===a);if(("NPC"===d?.type||/unknown/.test(n))&&!s)return null;const p=`${t} "${n}" ${"begincast"===i?"StartsUsing":"Ability"} { id: "${l.toString(16).toUpperCase()}" }`;return c&&s&&g.battleSyncedIDs.push(l),s?`${p} window ${s.join(",")} ${r?"once":""}`:`# ${p}`}).filter(e=>null!==e).join("\n");const e=b.newTimeline(`导入${g.player?.name}`,{zoneId:g.zoneID.toString(),jobs:[g.player?.icon??"NONE"]},g.abilityFilterEventsAfterFilterRawTimeline,`${g.code}#fight=${g.fightIndex+1}`);D(),l("showFFlogsToggle"),l("editTimeline",b.allTimelines[e]),setTimeout(()=>{m.value=0},500),p.value=!1}function D(){g.code="",g.fightIndex=0,g.start=0,g.end=0,g.friendlies=[],g.abilityFilterEvents=[],g.abilityFilterCandidate=[],g.abilityFilterSelected=[],g.abilityFilterEventsAfterFilterRawTimeline="",g.player=void 0,g.zoneID=0,g.bossIDs=[],g.enemies=[],g.battleSyncedIDs=[]}function N(){window.open("https://cn.fflogs.com/profile","_blank")}return w(()=>{h.clearExpired()}),(e,t)=>{const n=Se,l=Ye,y=Xe,w=Te,h=oe,C=ie,A=ge,M=F,J=re,U=de,L=fe,K=ye,G=me,W=pe;return o(),s(B,null,[c(n,{style:x(d(m)>0?{}:{visibility:"hidden",pointerEvent:"none"}),type:"primary",text:"","position-absolute":"","z-999":"",class:"guide",onClick:t[0]||(t[0]=e=>m.value--)},{default:j(()=>[...t[6]||(t[6]=[O(" 上一步 ",-1)])]),_:1},8,["style"]),c(y,{active:d(m),class:"steps-guide","align-center":""},{default:j(()=>[c(l,{title:"输入链接"}),c(l,{title:"选择玩家"}),c(l,{title:"过滤技能"})]),_:1},8,["active"]),0===d(m)?(o(),_(U,{key:0,class:"input-section"},{default:j(()=>[c(J,{"label-width":"150px",class:"fflogs-form"},{default:j(()=>[c(h,{label:"FF Logs 战斗链接"},{default:j(()=>[c(w,{modelValue:d(r),"onUpdate:modelValue":t[1]||(t[1]=e=>R(r)?r.value=e:null),placeholder:"https://www.fflogs.com/reports/AAAaAaAAaa1aA1aA?fight=1",autocomplete:"on"},null,8,["modelValue"])]),_:1}),c(h,{label:"FF logs V1 Key"},{default:j(()=>[c(w,{modelValue:d(b).settings.api,"onUpdate:modelValue":t[2]||(t[2]=e=>d(b).settings.api=e),placeholder:"在 FF Logs 个人设置页面获取 V1 API Key",type:"password","show-password":""},{append:j(()=>[c(C,{content:"点击前往 FF Logs 个人设置页面，在最下方填写 V1客户名称 并点击确认后，再获取你的 V1 客户端密钥",placement:"top",effect:"light"},{default:j(()=>[c(n,{type:"primary",link:"",onClick:N},{default:j(()=>[...t[7]||(t[7]=[O(" 如何获取 ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),c(h,{label:"使用 TTS"},{default:j(()=>[c(A,{modelValue:d(u),"onUpdate:modelValue":t[3]||(t[3]=e=>R(u)?u.value=e:null)},null,8,["modelValue"])]),_:1}),c(h,null,{default:j(()=>[c(n,{disabled:"正在查询..."===d(a),type:"primary",onClick:t[4]||(t[4]=e=>async function(e){p.value=!0,D(),a.value="正在查询...";const t=e.match(i);if(!b.settings.api)return Fe.alert("请在FF Logs个人设置页面获取V1 API Key","FF logs API Key 未填写",{confirmButtonText:"确定",type:"error",dangerouslyUseHTMLString:!0,message:'<a href="https://cn.fflogs.com/profile">点击这里，在最下方<strong>填写 V1 客户名称并点击确认</strong>后，获取你的 V1 客户端密钥</a>'}),a.value="查询",void(p.value=!1);if(!t)return Fe.alert("请正确填写FF Logs链接","FF Logs链接格式错误",{confirmButtonText:"确定",type:"error"}),a.value="查询",void(p.value=!1);g.code=t.groups?.code??"";try{const e=`fights:${g.code}`,n=T(e);let l;n&&V(n)?l=n.data:(l=await fetch(`https://cn.fflogs.com/v1/report/fights/${g.code}?api_key=${b.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),P(e,l)),g.bossIDs=l.enemies.filter(e=>["Boss","NPC"].includes(e.type)).map(e=>e.id),g.enemies=l.enemies.slice(),g.fightIndex=("last"===t?.groups?.fight?l.fights.length:Number.parseInt(t?.groups?.fight??"0"))-1;const i=l.fights[g.fightIndex];g.zoneID=i.zoneID,g.start=i.start_time,g.end=i.end_time,g.friendlies=l.friendlies.filter(e=>"LimitBreak"!==e.icon&&e.fights.find(e=>e.id===g.fightIndex+1)),a.value="查询",g.abilityFilterEvents.length=0,g.abilityFilterCandidate.length=0,p.value=!1,m.value=1}catch(n){Fe.alert(`\n  <h3 style="margin-bottom: 10px;">可能的原因：</h3>\n  <ul style="padding-left: 20px; margin-bottom: 10px;">\n    <li> <strong>90%概率</strong>：你没有<strong style="color: red;">先起名</strong>再获取 V1 客户端密钥</li>\n    <li> <strong>5%概率</strong>：该战斗记录是私人或匿名模式</li>\n    <li> <strong>5%概率</strong>：网络异常</li>\n  </ul>\n<p class="error-details"><strong>错误：</strong>${n}</p>\n`,"请求失败",{confirmButtonText:"确定",type:"error",dangerouslyUseHTMLString:!0}),a.value="查询",p.value=!1}}(d(r)))},{default:j(()=>[d(p)?(o(),_(M,{key:0,class:"is-loading"},{default:j(()=>[c(d(z))]),_:1})):v("",!0),O(" "+$(d(a)),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})):v("",!0),S("div",it,[1===d(m)?(o(),_(U,{key:0,class:"player-selection"},{default:j(()=>[c(K,{data:d(g).friendlies.filter(e=>!["NPC"].includes(e.icon)),stripe:"",border:"",class:"friendlies-table"},{default:j(()=>[c(L,{prop:"name",label:"玩家名称"}),c(L,{label:"职业"},{default:j(({row:e})=>[O($(d(be).jobToFullName(d(be).jobEnumToJob(d(be).iconToJobEnum(e.icon))).cn),1)]),_:1}),c(L,{label:"选定",width:"100",align:"center"},{default:j(e=>[c(n,{type:"primary",size:"small",onClick:t=>I(e.row)},{default:j(()=>[...t[8]||(t[8]=[O(" 选择 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):v("",!0),2===d(m)?(o(),_(U,{key:1,class:"ability-filter"},{default:j(()=>[S("div",at,[d(f)?v("",!0):(o(),s("div",st,[c(M,{class:"is-loading"},{default:j(()=>[c(d(z))]),_:1}),t[9]||(t[9]=S("span",null,"正在加载技能列表...",-1))])),d(f)?(o(),_(W,{key:1,modelValue:d(g).abilityFilterSelected,"onUpdate:modelValue":t[5]||(t[5]=e=>d(g).abilityFilterSelected=e),multiple:"",placeholder:"选择需要导入的技能","fit-input-width":!0,class:"ability-filter-select"},{default:j(()=>[(o(!0),s(B,null,E(d(g).abilityFilterCandidate,e=>(o(),_(G,{key:e.actionId,value:e.actionId,label:e.actionName,class:"ability-filter-option"},{default:j(()=>[S("img",{src:d(ve)(`/i/${e.url}.png`),class:"ability-filter-icon",alt:e.actionName,onerror:d(he)},null,8,ot),S("span",null,$(e.actionName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])):v("",!0),d(f)?(o(),_(n,{key:2,type:"success",class:"filter-confirm-btn",disabled:!d(f),onClick:k},{default:j(()=>[...t[10]||(t[10]=[O($("生成时间轴"),-1)])]),_:1},8,["disabled"])):v("",!0)])]),_:1})):v("",!0)])],64)}}}),[["__scopeId","data-v-7863b3d0"]]),ct=Pe(l({__name:"SettingsDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,l=t,i=Y();J(()=>{i.saveTimelineSettings()});const a=b({get:()=>n.modelValue,set:e=>l("update:modelValue",e)}),r=y(-15),u=y([{time:-15,action:"<圣光幕帘>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:-2,action:"<圣灵>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:0,action:"战斗开始！",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:3,action:"<挑衅>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:5,action:"<神圣领域>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1}]);return(e,t)=>{const n=le,l=oe,p=se,m=Ve,f=te,y=Z,g=re,w=ke;return o(),_(w,{modelValue:d(a),"onUpdate:modelValue":t[1]||(t[1]=e=>R(a)?a.value=e:null),modal:!0,overflow:"","close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"timeline-dialog",width:"600px","append-to-body":!0,draggable:!0},{header:j(()=>[...t[2]||(t[2]=[S("h3",{style:{margin:"0",padding:"10px","background-color":"#f5f7fa",cursor:"move"}}," 设置 ",-1)])]),default:j(()=>[c(g,{"label-position":"right","label-width":"120px",class:"timeline-form"},{default:j(()=>[t[3]||(t[3]=S("h3",{class:"form-section-title"}," 参数 ",-1)),c(m,{gutter:20},{default:j(()=>[(o(!0),s(B,null,E(d(i).configValues,(e,t,a)=>(o(),_(p,{key:a,span:12},{default:j(()=>[c(l,{label:d(i).configTranslate[t]},{default:j(()=>[c(n,{modelValue:d(i).configValues[t],"onUpdate:modelValue":e=>d(i).configValues[t]=e,min:0,step:.1,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),t[4]||(t[4]=S("h3",{class:"form-section-title"}," 样式 ",-1)),c(m,{gutter:20},{default:j(()=>[(o(!0),s(B,null,E(d(i).showStyle,(e,t,a)=>(o(),_(p,{key:a,span:12},{default:j(()=>[c(l,{label:d(i).showStyleTranslate[t]},{default:j(()=>[c(n,{modelValue:d(i).showStyle[t],"onUpdate:modelValue":e=>d(i).showStyle[t]=e,min:0,step:.01,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),t[5]||(t[5]=S("h3",{class:"form-section-title"}," 测试用例 ",-1)),c(m,{gutter:20},{default:j(()=>[c(f,{modelValue:d(r),"onUpdate:modelValue":t[0]||(t[0]=e=>R(r)?r.value=e:null),min:-15,max:5,step:.1,"show-input":""},null,8,["modelValue"]),c(y,{config:d(i).configValues,lines:d(u),runtime:d(r),"show-style":d(i).showStyle},null,8,["config","lines","runtime","show-style"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-fcf4e153"]]),dt=JSON.parse('[{"name":"SPJP(mmw/xivstrat) M5S D1","condition":{"zoneId":"1257","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"01:02 \\"<牵制>~\\"\\n03:57 \\"<牵制>~\\"\\n05:54 \\"<牵制>~\\"\\n09:18 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M5S D2","condition":{"zoneId":"1257","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"00:55 \\"<牵制>~\\"\\n02:33 \\"<牵制>~\\"\\n04:38 \\"<牵制>~\\"\\n06:22 \\"<牵制>~\\"\\n09:09 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M5S D3","condition":{"zoneId":"1257","jobs":["BRD","DNC","MCH"]},"timeline":"01:02 \\"<行吟>~\\"\\n03:57 \\"<行吟>~\\"\\n05:54 \\"<行吟>~\\"\\n09:18 \\"<行吟>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M5S D4","condition":{"zoneId":"1257","jobs":["RDM","BLM","SMN","PCT"]},"timeline":"01:02 \\"<昏乱>~\\"\\n03:57 \\"<昏乱>~\\"\\n05:54 \\"<昏乱>~\\"\\n09:18 \\"<昏乱>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M5S MT","condition":{"zoneId":"1257","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"01:02 \\"<雪仇>~\\"\\n02:05 \\"<雪仇>~\\"\\n04:38 \\"<雪仇>~\\"\\n05:54 \\"<雪仇>~\\"\\n07:57 \\"<雪仇>~\\"\\n09:18 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:33:41"},{"name":"SPJP(mmw/xivstrat) M5S ST","condition":{"zoneId":"1257","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"00:55 \\"<雪仇>~\\"\\n01:58 \\"<雪仇>~\\"\\n03:57 \\"<雪仇>~\\"\\n05:12 \\"<雪仇>~\\"\\n06:22 \\"<雪仇>~\\"\\n08:49 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:14"},{"name":"SPJP(mmw/xivstrat) M6S D1","condition":{"zoneId":"1259","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"00:05 \\"<牵制>~\\"\\n03:08 \\"<牵制>~\\"\\n05:02 \\"<牵制>~\\"\\n06:49 \\"<牵制>~\\"\\n09:56 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M6S D2","condition":{"zoneId":"1259","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"00:52 \\"<牵制>~\\"\\n02:25 \\"<牵制>~\\"\\n04:56 \\"<牵制>~\\"\\n06:27 \\"<牵制>~\\"\\n08:34 \\"<牵制>~\\"\\n10:08 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M6S D3","condition":{"zoneId":"1259","jobs":["BRD","DNC","MCH"]},"timeline":"00:52 \\"<行吟>~\\"\\n02:25 \\"<行吟>~\\"\\n04:56 \\"<行吟>~\\"\\n06:27 \\"<行吟>~\\"\\n08:34 \\"<行吟>~\\"\\n10:08 \\"<行吟>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M6S D4","condition":{"zoneId":"1259","jobs":["RDM","BLM","SMN","PCT"]},"timeline":"00:05 \\"<昏乱>~\\"\\n03:08 \\"<昏乱>~\\"\\n05:02 \\"<昏乱>~\\"\\n06:49 \\"<昏乱>~\\"\\n09:56 \\"<昏乱>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M6S MT","condition":{"zoneId":"1259","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"00:05 \\"<雪仇>~\\"\\n01:06 \\"<雪仇>~\\"\\n02:07 \\"<雪仇>~\\"\\n03:08 \\"<雪仇>~\\"\\n05:02 \\"<雪仇>~\\"\\n06:25 \\"<雪仇>~\\"\\n07:29 \\"<雪仇>~\\"\\n08:34 \\"<雪仇>~\\"\\n09:56 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:33:41"},{"name":"SPJP(mmw/xivstrat) M6S ST","condition":{"zoneId":"1259","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"00:52 \\"<雪仇>~\\"\\n02:25 \\"<雪仇>~\\"\\n06:49 \\"<雪仇>~\\"\\n09:07 \\"<雪仇>~\\"\\n10:08 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:14"},{"name":"SPJP(mmw/xivstrat) M7S D1","condition":{"zoneId":"1261","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"0:05 \\"<牵制>~\\"\\n2:23 \\"<牵制>~\\"\\n4:38 \\"<牵制>~\\"\\n6:17 \\"<牵制>~\\"\\n9:07 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M7S D2","condition":{"zoneId":"1261","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"0:52 \\"<牵制>~\\"\\n3:04 \\"<牵制>~\\"\\n5:30 \\"<牵制>~\\"\\n7:18 \\"<牵制>~\\"\\n8:56 \\"<牵制>~\\"\\n10:35 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M7S D3","condition":{"zoneId":"1261","jobs":["BRD","DNC","MCH"]},"timeline":"0:05 \\"<行吟>~\\"\\n1:36 \\"<行吟>~\\"\\n3:29 \\"<行吟>~\\"\\n5:38 \\"<行吟>~\\"\\n7:18 \\"<行吟>~\\"\\n8:56 \\"<行吟>~\\"\\n10:35 \\"<行吟>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M7S D4","condition":{"zoneId":"1261","jobs":["RDM","BLM","SMN","PCT"]},"timeline":"0:05 \\"<昏乱>~\\"\\n1:36 \\"<昏乱>~\\"\\n3:07 \\"<昏乱>~\\"\\n4:38 \\"<昏乱>~\\"\\n6:17 \\"<昏乱>~\\"\\n9:07 \\"<昏乱>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M7S MT","condition":{"zoneId":"1261","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"0:05 \\"<雪仇>~\\"\\n2:01 \\"<雪仇>~\\"\\n3:04 \\"<雪仇>~\\"\\n4:06 \\"<雪仇>~\\"\\n5:07 \\"<雪仇>~\\"\\n6:17 \\"<雪仇>~\\"\\n7:18 \\"<雪仇>~\\"\\n9:07 \\"<雪仇>~\\"\\n10:35 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:33:41"},{"name":"SPJP(mmw/xivstrat) M7S ST","condition":{"zoneId":"1261","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"0:52 \\"<雪仇>~\\"\\n2:23 \\"<雪仇>~\\"\\n3:29 \\"<雪仇>~\\"\\n4:30 \\"<雪仇>~\\"\\n5:38 \\"<雪仇>~\\"\\n6:42 \\"<雪仇>~\\"\\n8:56 \\"<雪仇>~\\"\\n10:08 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:14"},{"name":"SPJP(mmw/xivstrat) M8S D1","condition":{"zoneId":"1263","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"00:40.0 \\"<牵制>~\\"\\n02:42.0 \\"<牵制>~\\"\\n04:13.0 \\"<牵制>~\\"\\n06:18.0 \\"<牵制>~\\"\\n06:49.2 \\"--sync--\\" Ability { id: \\"A82D\\" } window 60,60 once\\n08:29.0 \\"<牵制>~\\"\\n10:40.0 \\"<牵制>~\\"\\n12:20.0 \\"<牵制>~\\"\\n13:50.0 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M8S D2","condition":{"zoneId":"1263","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"00:03.0 \\"<牵制>~\\"\\n01:41.0 \\"<牵制>~\\"\\n05:01.0 \\"<牵制>~\\"\\n06:49.2 \\"--sync--\\" Ability { id: \\"A82D\\" } window 60,60 once\\n07:44.0 \\"<牵制>~\\"\\n09:30.0 \\"<牵制>~\\"\\n13:41.0 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M8S D3","condition":{"zoneId":"1263","jobs":["BRD","DNC","MCH"]},"timeline":"00:03.0 \\"<行吟>~\\"\\n01:41.0 \\"<行吟>~\\"\\n03:18.0 \\"<行吟>~\\"\\n06:18.0 \\"<行吟>~\\"\\n06:49.2 \\"--sync--\\" Ability { id: \\"A82D\\" } window 60,60 once\\n08:29.0 \\"<行吟>~\\"\\n10:40.0 \\"<行吟>~\\"\\n13:41.0 \\"<行吟>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M8S D4","condition":{"zoneId":"1263","jobs":["RDM","BLM","SMN","PCT"]},"timeline":"00:40.0 \\"<昏乱>~\\"\\n02:42.0 \\"<昏乱>~\\"\\n04:13.0 \\"<昏乱>~\\"\\n06:18.0 \\"<昏乱>~\\"\\n06:49.2 \\"--sync--\\" Ability { id: \\"A82D\\" } window 60,60 once\\n08:29.0 \\"<昏乱>~\\"\\n10:40.0 \\"<昏乱>~\\"\\n12:20.0 \\"<昏乱>~\\"\\n13:50.0 \\"<昏乱>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M8S MT","condition":{"zoneId":"1263","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"00:03.0 \\"<雪仇>~\\"\\n01:04.0 \\"<雪仇>~\\"\\n02:16.0 \\"<雪仇>~\\"\\n04:09.0 \\"<雪仇>~\\"\\n05:57.0 \\"<雪仇>~\\"\\n06:49.2 \\"--sync--\\" Ability { id: \\"A82D\\" } window 60,60 once\\n07:44.0 \\"<雪仇>~\\"\\n09:00.0 \\"<雪仇>~\\"\\n10:40.0 \\"<雪仇>~\\"\\n12:22.0 \\"<雪仇>~\\"\\n13:42.0 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:33:41"},{"name":"SPJP(mmw/xivstrat) M8S ST","condition":{"zoneId":"1263","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"00:15.0 \\"<雪仇>~\\"\\n01:41.0 \\"<雪仇>~\\"\\n02:42.0 \\"<雪仇>~\\"\\n05:01.0 \\"<雪仇>~\\"\\n06:18.0 \\"<雪仇>~\\"\\n06:49.2 \\"--sync--\\" Ability { id: \\"A82D\\" } window 60,60 once\\n08:29.0 \\"<雪仇>~\\"\\n09:30.0 \\"<雪仇>~\\"\\n10:58.0 \\"<雪仇>~\\"\\n12:05.0 \\"<雪仇>~\\"\\n13:23.0 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:14"}]'),ut={class:"batch-operations",style:{"margin-bottom":"15px",display:"flex","flex-wrap":"wrap","justify-content":"space-between",gap:"10px"}},pt={style:{display:"flex",gap:"10px","flex-wrap":"wrap"}},mt={class:"editor-dialog-content"},ft=["value"],yt={class:"slider-demo-block"},gt={class:"time-display",style:{width:"80px","text-align":"center"}},wt={class:"time-display-text"},bt={class:"time-display-text"},ht={style:{"margin-top":"1em"}},vt=Pe(l({__name:"timelineSettings",setup(e){const t=L(),{wsConnected:n}=$e({allowClose:!0,addWsParam:!0}),l=Y(),i=U(l,"allTimelines"),r=U(l,"filters"),u=y(0),p=y([]),m=y(!1),f=y(!1),g=y(!1),h=y(!1),v=y(!1);let T,F;const P=ze("timelineCurrentlyEditing",{name:"空",condition:{zoneId:"0",jobs:["NONE"]},timeline:"空",codeFight:"空",create:"空"}),V=y([]),I=[{id:"0",name:"任意"}];let k=null,D=!1;const N=y(""),C=y(""),A=y("");let M;const z=b(()=>i.value.filter(e=>{const t=e.name.toLowerCase().includes(N.value.toLowerCase()),n=!C.value||e.condition.zoneId===C.value,l=!A.value||e.condition.jobs.includes(A.value);return t&&n&&l})),J=b(()=>{const e=u.value,t=e<0,n=Math.abs(Math.floor(e)),l=Math.floor(n/60),i=n%60;return`${t?"-":""}${String(l).padStart(2,"0")}:${String(i).padStart(2,"0")}`}),le=y(0);function ie(e){P.value=e,f.value=!0,we()}function re(){f.value=!1}function ge(){ie(l.allTimelines[l.newTimeline()])}function we(){V.value=[{time:0,action:"正在加载...",show:!0,windowBefore:0,windowAfter:0,alertAlready:!0}],ee(P.value.timeline).then(e=>{V.value=e;const t=Math.max(...V.value.map(e=>e.time),550);le.value=t+30,u.value=-l.configValues.preBattle})}function he(){if(0===p.value.length)return void W.warning("请选择要删除的时间轴");const e=p.value.map(e=>`「${e.name}」`).join("<br/>");Fe.confirm(`确定要删除选中的 ${p.value.length} 个时间轴吗？<br>${e}`,"批量删除时间轴",{confirmButtonText:"确认删除",cancelButtonText:"取消",dangerouslyUseHTMLString:!0,type:"warning"}).then(()=>{W.success(`成功删除 ${p.value.length} 个时间轴`),i.value=i.value.filter(e=>!p.value.includes(e)),p.value=[],m.value=!1}).catch(()=>{})}function ve(){m.value=!m.value,p.value=m.value?[...i.value]:[]}function _e(){0!==p.value.length?je(p.value):W.warning("请选择要导出的时间轴")}function je(e){const t=JSON.stringify(e),n=JSON.parse(t);for(const c of n)c.timeline=c.timeline.replace(/^#.*(?:\n|$)/gm,"");const l=JSON.stringify(n),i=De.compressToBase64(t),a=De.compressToBase64(l),s=i.length,o=a.length;if(s===o)return void Qe(i,"数据复制成功，已写入剪切板。","复制失败，请手动复制！");const r=((s-o)/s*100).toFixed(2);Fe.confirm(`\n     1. 完整版本（包含注释）<br>\n     &nbsp;&nbsp;&nbsp;- 大小：${s} 字节<br>\n     &nbsp;&nbsp;&nbsp;- 包含所有时间轴信息和注释<br><br>\n     2. 优化版本（不含注释）<br>\n     &nbsp;&nbsp;&nbsp;- 大小：${o} 字节<br>\n     &nbsp;&nbsp;&nbsp;- 节省 ${r}% 的空间<br>\n     &nbsp;&nbsp;&nbsp;- 仅包含必要的时间轴数据`,"请选择导出版本：",{confirmButtonText:"导出优化版本",cancelButtonText:"导出完整版本",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnPressEscape:!1,dangerouslyUseHTMLString:!0,showClose:!0,type:"info",callback:e=>{if("cancel"===e||"confirm"===e){Qe("confirm"===e?a:i,"数据复制成功，已写入剪切板。","复制失败，请手动复制！")}}})}function Pe(){Fe.prompt("请输入导出的字符串（支持多行导入）","导入时间轴",{confirmButtonText:"解析",cancelButtonText:"取消",inputType:"textarea",inputValidator:e=>{if(!e)return"请输入导出的字符串";const t=e.split("\n").filter(e=>""!==e.trim());let n=[];for(const l of t){let e;try{e=JSON.parse(l)}catch{try{const t=De.decompressFromBase64(l);e=JSON.parse(t)}catch{return`无法解析输入的数据：${l}，请确保每行都是正确的JSON或压缩后的字符串。`}}if(!Array.isArray(e))return`导入的数据格式不正确：${l}`;n=n.concat(e)}return 0!==n.length||"导入的数据不包含任何时间轴。"},inputErrorMessage:"无效的输入"}).then(({value:e})=>{const t=e.split("\n").filter(e=>""!==e.trim());let n=[];for(const a of t){let e;try{e=JSON.parse(a)}catch{const t=De.decompressFromBase64(a);e=JSON.parse(t)}n=n.concat(e)}const l=n.length,i=n.map(e=>`「${e.name}」`).join(", ");Fe({title:"确认",message:`导入 ${l} 个时间轴：\n${i}\n？`,showCancelButton:!0,showConfirmButton:!0,confirmButtonText:"追加",cancelButtonText:"覆盖",distinguishCancelAndClose:!0,type:"warning",callback:e=>{"cancel"===e?Fe.prompt('覆盖操作将删除所有现有的时间轴。请输入"我确认"以继续。',"二次确认",{confirmButtonText:"确定覆盖",cancelButtonText:"取消",inputPattern:/^我确认$/,inputErrorMessage:'请输入"我确认"以确认覆盖操作',type:"warning"}).then(({value:e})=>{"我确认"===e&&Ee(n,!0)}).catch(()=>{}):"confirm"===e&&Ee(n,!1)}})}).catch(()=>{})}function Ee(e,t){t&&(l.allTimelines.length=0),l.allTimelines.push(...e),l.sortTimelines();for(const s of l.allTimelines)void 0===s.condition.jobs&&(s.condition.jobs=[s.condition?.job??"NONE"]);if(t)return void W({type:"success",message:"覆盖成功！",duration:2e3});const n=[],i=new Set;for(const s of l.allTimelines){const e=JSON.stringify({name:s.name,condition:s.condition,timeline:s.timeline,codeFight:s.codeFight,create:s.create});i.has(e)||(i.add(e),n.push(s))}const a=l.allTimelines.length-n.length;l.allTimelines=n,W({message:`追加成功！共导入 ${e.length} 个时间轴${a>0?`，但其中 ${a} 个重复，已自动移除。`:""}`,type:"success",duration:3e3})}function Ue(e,t={}){Re({call:"broadcast",source:"soumaTimelineSettings",msg:{type:e,data:t}})}function Le(){const e=t.resolve({path:"/timeline"}),n=`${window.location.protocol}//${window.location.host}/ff14-overlay-vue/${e.href}`;D=!0,k=Je.service({lock:!0,text:`正在请求数据，请确保 ACT 中已添加并启用此悬浮窗：${n}`,background:"rgba(0, 0, 0, 0.7)"}),Ue("get"),setTimeout(()=>{D&&(W.info("重新尝试获取数据..."),Le())},5e3)}const Ke=e=>{if("soumaTimeline"===e.source)if("post"===e.msg.type){D=!1,k.close();const t=e.msg.data;for(const e of t.allTimelines)void 0===e.condition.jobs&&(e.condition.jobs=[e.condition.job]),e.condition.jobs.sort((e,t)=>l.jobList.indexOf(e)-l.jobList.indexOf(t)),Reflect.deleteProperty(e.condition,"job");l.allTimelines=t.allTimelines,l.configValues=t.configValues,l.showStyle=t.showStyle,W.closeAll(),W({message:"数据获取成功",type:"success",duration:3e3})}else"success"===e.msg.type?(T&&(clearTimeout(T),T=void 0),F&&(F.close(),F=void 0),ne.closeAll(),ne({message:"数据同步成功",type:"success",duration:1e3,position:"bottom-left",icon:"el-icon-success",zIndex:1,showClose:!1})):"hello"===e.msg.type&&F&&et()};function Ge(){window.open("https://docs.qq.com/sheet/DTWxKT3lFbmpDV3Fm?tab=5ovrc8","_blank")}function We(){const e=t.resolve({path:"/timelineHelp"}).href;window.open(e,"_blank")}function He(){g.value=!0}function qe(e){l.configValues=e.configValues,l.showStyle=e.showStyle}function Qe(e,t="复制成功",n="复制失败"){Ae(e).then(()=>W.success(t)).catch(()=>W.error(n))}function Xe({row:e}){return e===P.value?"editing-row":""}function Ye(){v.value=!0}function Ze(){Ee(dt,!1)}function et(){Ue("post",l.$state),clearTimeout(T),T=window.setTimeout(()=>{const e=t.resolve({path:"/timeline"}),n=`${window.location.protocol}//${window.location.host}/ff14-overlay-vue/${e.href}`;F?.close(),F=ne({title:"同步数据失败",message:H("div",{style:"color:#f00"},[H("div",["请确保你已正确启用了 ",H("a",{href:n,target:"_blank",style:"color:#f00; text-decoration: underline;"},"此悬浮窗"),"。"])]),showClose:!1,duration:0,position:"bottom-left"})},500)}return w(()=>{Me("BroadcastMessage",Ke);const e=a(n,t=>{t&&(0===l.allTimelines.length&&Le(),e(),M&&(M.close(),et()))});l.allTimelines.forEach(e=>e.timeline=e.timeline.replaceAll(/^(?<a>.+), once: true(?<b>.+)$/gm,"$<a>$<b> once"));const t=Be(()=>{n.value?et():(M?.close(),M=ne({title:"你修改了时间轴，但",message:H("i",{style:"color: #f00"},"改动未应用，直到你成功连接到 WebSocket。"),showClose:!1,duration:0,position:"bottom-left"}))},500);a(()=>l.$state,t,{deep:!0})}),function(){for(const e in Ce)if(Object.prototype.hasOwnProperty.call(Ce,e)){const t=Ce[e];switch(t.contentType){case 4:case 5:case 28:I.push({id:e,name:t.name?.cn??t.name?.ja??e})}}l.loadTimelineSettings(),l.sortTimelines()}(),(e,t)=>{const n=fe,a=ye,y=ke,w=ct,b=Se,T=xe,F=Ie,k=Oe,D=Ve,M=Q,U=rt,L=Te,H=me,Y=pe,ee=tt,ne=ue,$e=de,De=ce,Ce=X,Ae=oe,Me=se,Re=ae,ze=te,Be=Z,Ee=q;return o(),_(Ee,{class:"container"},{default:j(()=>[c(y,{modelValue:d(v),"onUpdate:modelValue":t[0]||(t[0]=e=>R(v)?v.value=e:null),title:"时间轴解析结果","align-center":"",center:"",draggable:"",width:"80%"},{default:j(()=>[c(a,{data:d(V)},{default:j(()=>[c(n,{property:"time",label:"time","min-width":"60"}),c(n,{property:"action",label:"action",width:"150"},{default:j(({row:e})=>[O($(e.action.replaceAll(/(^['"“”]|['"“”]$)/g,"")),1)]),_:1}),c(n,{property:"sync",label:"sync","min-width":"200"},{default:j(({row:e})=>[O($(e.sync?e.sync:"-"),1)]),_:1}),c(n,{property:"syncOnce",label:"once","min-width":"100"},{default:j(({row:e})=>[O($(e.syncOnce?"✅":"-"),1)]),_:1}),c(n,{label:"window","min-width":"100"},{default:j(({row:e})=>[O($(e.sync?`${e.windowBefore},${e.windowAfter}`:"-"),1)]),_:1}),c(n,{property:"jump",label:"jump","min-width":"100"},{default:j(({row:e})=>[O($(e.jump?e.jump:"-"),1)]),_:1}),c(n,{property:"tts",label:"tts","min-width":"150"},{default:j(({row:e})=>[O($(e.tts?e.tts:"-"),1)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),c(w,{modelValue:d(h),"onUpdate:modelValue":t[1]||(t[1]=e=>R(h)?h.value=e:null),onSave:qe},null,8,["modelValue"]),c(M,{class:"flex-header"},{default:j(()=>[c(D,{justify:"space-between",align:"middle"},{default:j(()=>[c(F,null,{default:j(()=>[c(T,null,{default:j(()=>[c(b,{type:"primary",size:"small",onClick:He},{default:j(()=>[...t[21]||(t[21]=[O(" 从 FFlogs 生成 ",-1)])]),_:1}),c(b,{type:"primary",size:"small",onClick:Ge},{default:j(()=>[...t[22]||(t[22]=[O(" 从 在线文档 获取 ",-1)])]),_:1}),c(b,{type:"primary",size:"small",onClick:ge},{default:j(()=>[...t[23]||(t[23]=[O(" 手动编写 ",-1)])]),_:1})]),_:1}),c(b,{color:"#543d6c",size:"small",onClick:Ze},{default:j(()=>[...t[24]||(t[24]=[O(" 导入 SPJP M5S~M8S 时间轴 ",-1)])]),_:1}),c(T,null,{default:j(()=>[c(b,{size:"small",onClick:Pe},{default:j(()=>[...t[25]||(t[25]=[O(" 导入字符串 ",-1)])]),_:1}),c(b,{size:"small",class:"export",onClick:t[2]||(t[2]=e=>je(d(i)))},{default:j(()=>[...t[26]||(t[26]=[O(" 导出全部 ",-1)])]),_:1})]),_:1})]),_:1}),c(F,null,{default:j(()=>[c(k,{"storage-key":"timeline-settings-theme"}),c(b,{color:"#626aef",style:{color:"white"},size:"small",onClick:t[3]||(t[3]=e=>h.value=!0)},{default:j(()=>[...t[27]||(t[27]=[O(" 参数设置 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),c(Ce,null,{default:j(()=>[c(y,{modelValue:d(g),"onUpdate:modelValue":t[5]||(t[5]=e=>R(g)?g.value=e:null),title:"从 FFlogs 生成时间轴",width:"80%","before-close":()=>g.value=!1,"close-on-press-escape":!1},{default:j(()=>[c(U,{filters:d(r),onShowFFlogsToggle:t[4]||(t[4]=()=>g.value=!1),onEditTimeline:ie},null,8,["filters"])]),_:1},8,["modelValue","before-close"]),d(i).length>0?(o(),_($e,{key:0},{default:j(()=>[S("div",ut,[S("div",pt,[c(L,{modelValue:d(N),"onUpdate:modelValue":t[6]||(t[6]=e=>R(N)?N.value=e:null),placeholder:"搜索名称...",clearable:"",size:"small",style:{width:"180px"}},null,8,["modelValue"]),c(Y,{modelValue:d(C),"onUpdate:modelValue":t[7]||(t[7]=e=>R(C)?C.value=e:null),placeholder:"筛选地图",clearable:"",size:"small",style:{width:"180px"}},{default:j(()=>[c(H,{label:"全部地图",value:""}),(o(),s(B,null,E(I,e=>c(H,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),c(Y,{modelValue:d(A),"onUpdate:modelValue":t[8]||(t[8]=e=>R(A)?A.value=e:null),placeholder:"筛选职业",clearable:"",size:"small",style:{width:"180px"}},{default:j(()=>[c(H,{label:"全部职业",value:""}),(o(!0),s(B,null,E(d(l).jobList,e=>(o(),_(H,{key:e,label:(d(be).jobToFullName(e)?.cn??e).replace("冒险者","全部职业"),value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),K(S("div",null,[c(ee,{type:"info"},{default:j(()=>[O(" 筛选结果：共 "+$(d(z).length)+" 个时间轴 ",1)]),_:1})],512),[[G,d(N)||d(C)||d(A)]]),S("div",null,[c(b,{type:"primary",size:"small",disabled:0===d(p).length,onClick:_e},{default:j(()=>[O(" 批量导出 ("+$(d(p).length)+") ",1)]),_:1},8,["disabled"]),c(b,{type:"danger",size:"small",disabled:0===d(p).length,style:{"margin-left":"10px"},onClick:he},{default:j(()=>[O(" 批量删除 ("+$(d(p).length)+") ",1)]),_:1},8,["disabled"])])]),c(a,{data:d(z),"row-class-name":Xe,style:{width:"100%"},stripe:"","default-sort":{prop:"condition",order:"ascending"},onSelectionChange:t[10]||(t[10]=e=>{p.value=e,m.value=e.length===d(i).length})},{default:j(()=>[c(n,{type:"selection",width:"55",align:"center"},{header:j(()=>[c(ne,{modelValue:d(m),"onUpdate:modelValue":t[9]||(t[9]=e=>R(m)?m.value=e:null),onChange:ve},null,8,["modelValue"])]),_:1}),c(n,{prop:"name",label:"名称"}),c(n,{prop:"condition",label:"地图",sortable:""},{default:j(e=>[O($(I.find(t=>t.id===e.row.condition.zoneId)?.name),1)]),_:1}),c(n,{prop:"condition",label:"职业"},{default:j(e=>[O($(e.row.condition.jobs.map(e=>d(be).jobToFullName(e.toUpperCase())?.cn??e).join("、").replace("冒险者","全部职业")),1)]),_:1}),c(n,{label:"操作",width:"150"},{default:j(e=>[c(b,{type:"primary",size:"small",onClick:t=>ie(e.row)},{default:j(()=>[...t[28]||(t[28]=[O(" 编辑 ",-1)])]),_:1},8,["onClick"]),c(b,{type:"danger",size:"small",onClick:t=>{return n=e.row,void Fe.confirm(`确定要删除「${n.name}」吗？`,"删除时间轴",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning"}).then(()=>{i.value.splice(i.value.findIndex(e=>e===n),1)}).catch(()=>{});var n}},{default:j(()=>[...t[29]||(t[29]=[O(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):(o(),_($e,{key:1},{default:j(()=>[c(De,{description:"点击上方新建或导入一个时间轴吧~"})]),_:1}))]),_:1}),c(y,{modelValue:d(f),"onUpdate:modelValue":t[20]||(t[20]=e=>R(f)?f.value=e:null),title:"编辑时间轴",top:"5vh","before-close":re,class:"timeline-dialog",width:"65%",style:{"min-width":"550px","max-width":"1000px"},"close-on-click-modal":!1,"close-on-press-escape":!1},{default:j(()=>[S("div",mt,[c(D,{class:"timeline-header",gutter:10},{default:j(()=>[c(Me,{span:14},{default:j(()=>[c(Ae,{label:"名称"},{default:j(()=>[c(L,{modelValue:d(P).name,"onUpdate:modelValue":t[11]||(t[11]=e=>d(P).name=e)},null,8,["modelValue"])]),_:1})]),_:1}),c(Me,{span:8},{default:j(()=>[c(Ae,{label:"来源"},{default:j(()=>["用户创建"!==d(P).codeFight?(o(),_(Re,{key:0,href:`https://cn.fflogs.com/reports/${d(P).codeFight.replace("#","?")}&type=damage-done`,target:"_blank"},{default:j(()=>[t[30]||(t[30]=S("img",{class:"site-logo",src:"https://assets.rpglogs.cn/img/ff/favicon.png?v=4",alt:"FF Logs",style:{width:"34px",height:"33.4688px"}},null,-1)),O($(d(P).codeFight),1)]),_:1},8,["href"])):(o(),s("input",{key:1,type:"text",value:`${d(P).codeFight}（${d(P).create}）`,"w-80":"","p-1.3":"",disabled:""},null,8,ft))]),_:1})]),_:1}),c(Me,{span:22},{default:j(()=>[c(Ae,{label:"地图"},{default:j(()=>[c(Y,{modelValue:d(P).condition.zoneId,"onUpdate:modelValue":t[12]||(t[12]=e=>d(P).condition.zoneId=e),filterable:"",style:{width:"100%"}},{default:j(()=>[(o(),s(B,null,E(I,e=>c(H,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),c(Me,{span:22},{default:j(()=>[c(Ae,{label:"职业"},{default:j(()=>[c(Y,{modelValue:d(P).condition.jobs,"onUpdate:modelValue":t[13]||(t[13]=e=>d(P).condition.jobs=e),multiple:""},{default:j(()=>[(o(!0),s(B,null,E(d(l).jobList,e=>(o(),_(H,{key:e,label:(d(be).jobToFullName(e)?.cn??e).replace("冒险者","全部职业"),value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),S("div",yt,[c(ze,{modelValue:d(u),"onUpdate:modelValue":t[14]||(t[14]=e=>R(u)?u.value=e:null),min:-d(l).configValues.preBattle,max:d(le),step:.1},null,8,["modelValue","min","max"]),S("div",gt,[S("p",wt,$(d(J)),1),S("p",bt,"("+$(d(u))+"s)",1)])]),c(D,{class:"timeline-editor-body",gutter:10},{default:j(()=>[c(Me,null,{default:j(()=>[c(L,{modelValue:d(P).timeline,"onUpdate:modelValue":t[15]||(t[15]=e=>d(P).timeline=e),style:x({width:`calc(100% - ${d(l).showStyle["--timeline-width"]}px)`}),type:"textarea",autosize:{minRows:10,maxRows:20},wrap:"off",placeholder:"请键入时间轴文本",onChange:t[16]||(t[16]=e=>we())},null,8,["modelValue","style"])]),_:1}),c(Be,{style:{position:"absolute",right:0,top:0},config:d(l).configValues,lines:d(V),runtime:d(u),"show-style":d(l).showStyle},null,8,["config","lines","runtime","show-style"])]),_:1}),S("div",ht,[c(F,null,{default:j(()=>[c(b,{onClick:t[17]||(t[17]=e=>je([d(P)]))},{default:j(()=>[...t[31]||(t[31]=[O(" 导出 ",-1)])]),_:1}),c(b,{onClick:t[18]||(t[18]=e=>{P.value.timeline=P.value.timeline.replaceAll(new RegExp("(?<=^|#\\s*)(\\d+:\\d+(?:\\.\\d{1,2})?|\\d+(?:\\.\\d+)?)","gm"),e=>e.includes(":")?Ne.duration(`00:${e}`).as("seconds").toString():Ne.utc(1e3*Number(e)).format("mm:ss.S"))})},{default:j(()=>[...t[32]||(t[32]=[O(" 切换时间格式 ",-1)])]),_:1}),c(b,{onClick:We},{default:j(()=>[...t[33]||(t[33]=[O(" 时间轴语法 ",-1)])]),_:1}),c(b,{onClick:t[19]||(t[19]=e=>{Fe.confirm("要删除所有的注释行，仅保留必要的时间轴数据吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{P.value.timeline=P.value.timeline.replace(/^#.*(?:\n|$)/gm,""),W.success("完成")}).catch(()=>{})})},{default:j(()=>[...t[34]||(t[34]=[O(" 去除注释行 ",-1)])]),_:1}),c(b,{onClick:Ye},{default:j(()=>[...t[35]||(t[35]=[O(" 展示调试信息 ",-1)])]),_:1})]),_:1})])])]),_:1},8,["modelValue"])]),_:1})}}}),[["__scopeId","data-v-d35eefe3"]]);export{vt as default};
