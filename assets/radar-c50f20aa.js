import{_ as e}from"./ActWrapper-82461ca1.js";import"./index-cb6d85bc.js";/* empty css                 */import{t as a,r as t,aB as l,c as n,f as i,P as o,D as s,x as r,E as u,A as v,H as c,F as d,u as f,v as h,K as m,S as p,O as g}from"./vue-vendor-e9f6d682.js";import{u as y}from"./useZone-63bc3fbf.js";import{N as w}from"./netregexes-ed180b06.js";import{a as P,r as b,c as x}from"./overlay_plugin_api-974cdd44.js";import{W as M}from"./element-plus-31eb5454.js";import{_ as T}from"./_plugin-vue_export-helper-6a8c15be.js";/* empty css                */import"./useDevMode-c2e16311.js";import"./index-bc46afe1.js";import"./zoneInfo-40d5d60a.js";import"./zone_info-e69ac441.js";import"./content_type-e6dd7239.js";import"./regexes-da03e94d.js";const j={class:"radar-container"},k={class:"radar-wrapper"},_=["disabled"],L=["disabled"],S={class:"target-header"},I={class:"target-name"},C={class:"radar-canvas-container"},E=["width","height"],N=T(a({__name:"radar",setup(a){const T=t(""),N=t([]),W=t(0),z=t(""),H=t([]),A={echo:w.echo({line:"find\\s*(?<target>.+)"})},O=l("canvas");let R=null;const F=t(window.devicePixelRatio||1),X=t(Math.min(window.innerWidth,window.innerHeight)-80),$=n(()=>X.value/2-20),B=t("flex"===document.getElementById("unlocked")?.style?.display),{zoneType:D}=y(),U="#0f0",Y="#060",q="#0f0",G="#ff0",K="#f00",V="#fff",Z=18,J=3,Q=2,ee=6,ae="10px Arial",te=n(()=>X.value/2),le=n(()=>X.value/2);async function ne(){const e=await x({call:"getCombatants"});H.value=e.combatants??[]}async function ie(){await ne(),"Pvp"!==D.value&&T.value&&z.value?(!function(){if(!R)return;const e=N.value[W.value],a=H.value.find(e=>e.Name===z.value);if(!e)return R.clearRect(0,0,X.value,X.value),R.fillStyle="#fff",R.font="20px Arial",void R.fillText("找不到目标",te.value-100,le.value-50);if(!a)return;R.clearRect(0,0,X.value,X.value),R.strokeStyle=U,R.lineWidth=1,R.beginPath(),R.arc(te.value,le.value,$.value,0,2*Math.PI),R.stroke(),R.strokeStyle=Y,R.beginPath(),R.moveTo(te.value-$.value,le.value),R.lineTo(te.value+$.value,le.value),R.moveTo(te.value,le.value-$.value),R.lineTo(te.value,le.value+$.value),R.stroke();const t=e.PosX-a.PosX,l=e.PosY-a.PosY,n=Math.sqrt(t*t+l*l);let i=te.value+t/.1,o=le.value+l/.1;const s=Math.hypot(i-te.value,o-le.value);if(s>$.value){const e=$.value/s;i=te.value+(i-te.value)*e,o=le.value+(o-le.value)*e}R.strokeStyle=K,R.lineWidth=Q,R.beginPath(),R.moveTo(te.value,le.value),R.lineTo(i,o),R.stroke(),R.fillStyle=G,R.beginPath(),R.arc(i,o,J,0,2*Math.PI),R.fill();const r=-(a.Heading??0)+Math.PI;R.save(),R.translate(te.value,le.value),R.rotate(r),R.fillStyle=q;const u=Z,v=u/3,c=-.2*u;R.beginPath(),R.moveTo(0,-u/2+c),R.lineTo(-v,u/2+c),R.lineTo(v,u/2+c),R.closePath(),R.fill(),R.restore();const d=Math.atan2(o-le.value,i-te.value);R.fillStyle=K,R.beginPath(),R.moveTo(i,o),R.lineTo(i-ee*Math.cos(d-Math.PI/6),o-ee*Math.sin(d-Math.PI/6)),R.lineTo(i-ee*Math.cos(d+Math.PI/6),o-ee*Math.sin(d+Math.PI/6)),R.closePath(),R.fill(),R.fillStyle=V,R.font=ae,R.fillText(`${n.toFixed(1)}y`,i+5,o-5)}(),setTimeout(ie,100)):T.value=""}const oe=e=>{if("00"===e.line[0]){const a=A.echo.exec(e.rawLine);a?.groups?.target&&(T.value=a.groups.target,ne().then(()=>{!function(){if(!T.value)return N.value=[],void(W.value=0);const e=H.value.filter(e=>e.Name&&e.Name.includes(T.value));N.value=e,W.value=0}(),ie()}))}},se=e=>{z.value=e.charName};function re(){X.value=Math.min(window.innerWidth,window.innerHeight)-80,F.value=window.devicePixelRatio||1,R&&(R.setTransform(1,0,0,1,0,0),R.scale(F.value,F.value))}function ue(e){B.value=!1===e?.detail?.isLocked}return i(()=>{R=O.value?.getContext("2d")??null,R&&R.scale(F.value,F.value),P("LogLine",oe),P("ChangePrimaryPlayer",se),window.addEventListener("resize",re),document.addEventListener("onOverlayStateUpdate",ue)}),o(()=>{b("LogLine",oe),b("ChangePrimaryPlayer",se),window.removeEventListener("resize",re),document.removeEventListener("onOverlayStateUpdate",ue)}),(a,t)=>{const l=M,n=e;return r(),s(n,null,{default:u(()=>[v("div",j,[f(B)?(r(),s(l,{key:0,class:"el-alert-info",type:"info",closable:!1,"show-icon":"",title:"宏命令：/e find 目标名称",description:"名称允许部分匹配"})):c("",!0),d(v("div",k,[f(N).length>1?(r(),h("button",{key:0,class:"nav-arrow left-arrow",disabled:f(N).length<=1,"aria-label":"上一目标",onClick:t[0]||(t[0]=e=>W.value=(f(W)-1+f(N).length)%f(N).length)}," ← ",8,_)):c("",!0),f(N).length>1?(r(),h("button",{key:1,class:"nav-arrow right-arrow",disabled:f(N).length<=1,"aria-label":"下一目标",onClick:t[1]||(t[1]=e=>W.value=(f(W)+1)%f(N).length)}," → ",8,L)):c("",!0),v("div",S,[v("span",I,m(f(N)[f(W)]?.Name??""),1),v("button",{class:"cancel-btn",onClick:t[2]||(t[2]=e=>{T.value="",N.value=[]})}," 取消 ")]),v("div",C,[v("canvas",{ref_key:"canvas",ref:O,class:"radar-canvas",width:f(X)*f(F),height:f(X)*f(F),style:p({width:`${f(X)}px`,height:`${f(X)}px`})},null,12,E)])],512),[[g,f(T)]])])]),_:1})}}}),[["__scopeId","data-v-82fe7bde"]]);export{N as default};
