import{c as e,_ as a}from"./shared-common-epuQhnIK.js";import{o as n,A as t,B as i,a5 as s,v as o,J as c,t as l,u as r,Y as T,Z as u,X as m,V as h,K as p,H as d,R as v,am as L,_ as f,c as b,ac as C,r as g}from"./vendor-vue-GqahCgpc.js";import{F as y,b as k,h as D}from"./shared-core-C_PmX05s.js";import{a as w,r as F}from"./cactbot-CmNinDrW.js";import{n as _}from"./vendor-element-plus-DIlhOlLn.js";const E={class:"lb-container"},j={id:"percent"},x={id:"bonusTotal"},A={id:"extra"},B=3e4,I=a(n({__name:"lbTick",setup(a){const{zoneType:n}=y(),I=D(),Z=k(),$=b(()=>"Pvp"!==n.value),U=g(),z=C({prev:0,ratio:0,bonusTotal:0,chain:0,chainList:[]});function H(){z.prev=0,z.ratio=0,z.chain=0,z.chainList=[],z.bonusTotal=0}const J=e=>{if($.value)if("36"===e.line[0]){const a=Number.parseInt(e.line[2],16),n=a-z.prev;if(z.prev=a,z.ratio=a/B,0===a||n<-.1)z.chain=0,z.chainList=[];else if(n>220){z.chain+=n,z.bonusTotal+=n;const a=z.chainList[z.chainList.length-1];a&&a.timestamp+1e3>new Date(e.line[1]).getTime()&&(a.num===z.chain-300||a.num===z.chain-60)?z.chainList[z.chainList.length-1].num=z.chain:z.chainList.push({key:crypto.randomUUID(),num:z.chain,timestamp:new Date(e.line[1]).getTime()})}else z.chain=0}else"33"===e.line[0]&&["40000010","4000000F"].includes(e.line[3])&&H()};function K(){U.value?.(),U.value=function(e,a=2){const n=[];return function(t){let i=0;e({line:t[0],type:"LogLine",rawLine:""});for(let s=1;s<t.length;s++){const o=new Date(t[s][1]),c=new Date(t[s-1][1]);i+=o.getTime()-c.getTime();const l=window.setTimeout(()=>{e({line:t[s],type:"LogLine",rawLine:""})},i/a);n.push(l)}}([["36","2021-12-28T21:38:30.3580000+08:00","0000"],["36","2021-12-28T21:38:33.3580000+08:00","00DC"],["36","2021-12-28T21:38:34.8290000+08:00","0208"],["36","2021-12-28T21:38:36.3460000+08:00","02E4"],["36","2021-12-28T21:38:37.8630000+08:00","0410"],["36","2021-12-28T21:38:39.3360000+08:00","04EC"],["36","2021-12-28T21:38:42.3720000+08:00","05C8"],["36","2021-12-28T21:38:45.3620000+08:00","06A4"],["36","2021-12-28T21:38:47.8140000+08:00","07D0"],["36","2021-12-28T21:38:47.8140000+08:00","08FC"],["36","2021-12-28T21:38:47.8140000+08:00","0A28"],["36","2021-12-28T21:38:47.8140000+08:00","0B54"],["36","2021-12-28T21:38:47.8140000+08:00","0C80"],["36","2021-12-28T21:38:48.3510000+08:00","0D5C"],["36","2021-12-28T21:38:50.6220000+08:00","0E88"],["36","2021-12-28T21:38:50.8900000+08:00","0FB4"],["36","2021-12-28T21:38:51.0230000+08:00","10E0"],["36","2021-12-28T21:38:51.1570000+08:00","120C"],["36","2021-12-28T21:38:51.3360000+08:00","12E8"],["36","2021-12-28T21:38:54.3690000+08:00","13C4"],["36","2021-12-28T21:38:57.3570000+08:00","14A0"],["36","2021-12-28T21:38:58.3360000+08:00","15CC"],["36","2021-12-28T21:38:58.3360000+08:00","16F8"],["36","2021-12-28T21:38:58.3360000+08:00","1824"],["36","2021-12-28T21:38:58.3360000+08:00","1950"],["36","2021-12-28T21:38:58.3360000+08:00","1A7C"],["36","2021-12-28T21:39:00.3410000+08:00","1B58"],["36","2021-12-28T21:39:03.3690000+08:00","1C34"],["36","2021-12-28T21:39:04.2630000+08:00","1D60"],["36","2021-12-28T21:39:06.3600000+08:00","1E3C"]]),()=>{n.forEach(clearTimeout),n.length=0}}(J,1)}return t(()=>[Z.value,I.value],()=>{U.value?.(),H()}),i(()=>{w("ChangeZone",H),w("LogLine",J)}),s(()=>{F("ChangeZone",H),F("LogLine",J)}),(a,n)=>{const t=_,i=e;return l(),o(i,null,{default:c(()=>[r(I)||r(Z)?(l(),o(t,{key:0,type:"primary",class:"test-btn",onClick:K},{default:c(()=>[T(u(a.$t("lbTick.test")),1)]),_:1})):m("",!0),h(p("div",E,[p("p",j,u(a.$t("lbTick.lb"))+u((100*r(z).ratio).toFixed(2))+"% ",1),p("p",x,u(a.$t("lbTick.bonus"))+":"+u((r(z).bonusTotal/B*100).toFixed(0))+"% ",1),p("div",A,[(l(!0),d(v,null,L(r(z).chainList,e=>(l(),d("p",{key:e.key,class:"anime"}," +"+u((e.num/B*100).toFixed(0))+"% ",1))),128))])],512),[[f,r($)]])]),_:1})}}}),[["__scopeId","data-v-22b5d616"]]);export{I as default};
