import{_ as e}from"./ActWrapper-fdd654fb.js";import{u as a,l as t,_ as r}from"./DragJob-bfa8bff9.js";import{d as o,r as s,a as l,o as n,y as i,aW as p,g as d,j as u,n as m,f as c,e as y,B as f,k as v,F as b,u as g,w as h,v as j,t as k,i as S}from"./index-bfe82241.js";import{E as x}from"./el-divider-73f3d28d.js";import{u as _}from"./useDev-9388fa49.js";import{R as E}from"./demoParty-b4a6cc19.js";import{U as J}from"./util-12a91873.js";import{a as C,r as P,c as w}from"./overlay_plugin_api-974cdd44.js";import{_ as T}from"./_plugin-vue_export-helper-6a8c15be.js";import"./el-card-8a5879f0.js";import"./useDemo-77ed4871.js";import"./el-checkbox-6c031058.js";import"./index-3405a87f.js";import"./use-form-common-props-8ac8e3f9.js";import"./isEqual-3efb6670.js";import"./index-cc6a9cde.js";import"./index-cbf1dbe7.js";const U={class:"cactbot-runtime-container"},D={class:"players",flex:"~ nowrap gap-1"},L={class:"fixed-rp"},M={class:"fixed-player"},R={class:"drag-job"},V={key:0,style:{position:"fixed",bottom:"0"}},B=T(o({__name:"cactbotRuntime",setup(o){const T=["tank","healer","dps"],B=a(),q=s(!1),A=_(),F=new E,H=F.party,I=l({party:A.value?H.value.slice():[],partySorted:{tank:[],healer:[],dps:[]}});function N(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const O={tank:["MT","ST",...N("T",22,2)],healer:[...N("H",24)],dps:[...N("D",24)]},W=s(A.value?H.value[0].name:"");function $(){const e=[...O.tank.slice(0,I.partySorted.tank.length),...O.healer.slice(0,I.partySorted.healer.length),...O.dps.slice(0,I.partySorted.dps.length)],a=[...I.partySorted.tank,...I.partySorted.healer,...I.partySorted.dps].map((a,t)=>({...a,rp:e[t]}));w({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a}})}function z(){const e=I.party.slice().sort((e,a)=>B.arr.indexOf(J.baseJobEnumConverted(e.job))-B.arr.indexOf(J.baseJobEnumConverted(a.job)));I.partySorted.tank=e.filter(e=>J.isTankJob(J.jobEnumToJob(e.job))),I.partySorted.healer=e.filter(e=>J.isHealerJob(J.jobEnumToJob(e.job))),I.partySorted.dps=e.filter(e=>J.isDpsJob(J.jobEnumToJob(e.job))),$()}function G(){z()}function K(){$()}const Q=()=>{q.value=!0},X=()=>{q.value=!1},Y=e=>{A.value&&0===e.party.length||(I.party=e.party.filter(e=>e.inParty))},Z=e=>{A.value&&(W.value=e.charName)},ee=e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&$()};function ae(){W.value=H.value[0].name,I.party.length=0,I.party.push(H.value.find(e=>e.name===W.value))}function te(){W.value=H.value[0].name,I.party.length=0,I.party.push(...H.value)}function re(){F.shuffle({dps:4,healer:2,tank:2,crafter:3,gatherer:3,none:3}),te()}return n(()=>{document.body.addEventListener("mouseenter",Q),document.body.addEventListener("mouseleave",X),C("PartyChanged",Y),C("ChangePrimaryPlayer",Z),C("BroadcastMessage",ee),i(I.party,()=>{z()},{immediate:!0})}),p(()=>{document.body.removeEventListener("mouseenter",Q),document.body.removeEventListener("mouseleave",X),P("PartyChanged",Y),P("ChangePrimaryPlayer",Z),P("BroadcastMessage",ee)}),(a,o)=>{const s=x,l=r,n=e;return m(),d(n,null,{readme:u(()=>o[0]||(o[0]=[c("span",{class:"demo-text"},[c("p",null,"使悬浮窗的位置分配对应游戏内的实际位置"),c("ul",null,[c("li",null,"每次小队变化时，会按规则进行排序"),c("li",null,"你可以上下拖拽玩家名称，临时调整")])],-1)])),default:u(()=>[c("div",U,[c("main",null,[c("div",D,[c("div",L,[(m(),y(b,null,v(T,(e,a)=>c("div",{key:`fixed-rp-${e}`,class:"player-role"},[(m(!0),y(b,null,v(g(I).partySorted[e],(a,t)=>(m(),y("div",{key:t,style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},[h(c("span",null,k(O[e][t]),513),[[j,g(q)||a.name===g(W)]])]))),128)),g(I).partySorted[e].length>0&&a<2&&g(q)?(m(),d(s,{key:0})):f("",!0)])),64))]),c("div",M,[(m(),y(b,null,v(T,(e,a)=>S(g(t),{key:`fixed-player-${e}`,modelValue:g(I).partySorted[e],"onUpdate:modelValue":a=>g(I).partySorted[e]=a,animation:200,"ghost-class":"ghost","force-fallback":!0,filter:".no-draggable",onUpdate:K},{default:u(()=>[(m(!0),y(b,null,v(g(I).partySorted[e],e=>h((m(),y("div",{key:e.id,class:"player-line"},[c("span",null,k(e.name),1)])),[[j,g(q)]])),128)),g(I).partySorted[e].length>0&&a<2&&g(q)?(m(),d(s,{key:0,class:"no-draggable"})):f("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])),64))])]),c("div",R,[g(q)?(m(),d(l,{key:0,party:g(I).party,onUpdate:G},null,8,["party"])):f("",!0)])]),g(A)?(m(),y("div",V,[c("button",{onClick:ae}," 测试单人 "),c("button",{onClick:te}," 测试组队 "),c("button",{onClick:re}," 测试随机组队 ")])):f("",!0)])]),_:1})}}}),[["__scopeId","data-v-cb26e557"]]);export{B as default};
