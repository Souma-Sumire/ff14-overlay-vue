import{y as e,f as l,e as a,c as t,k as s,m as o,b as n,x as i,q as d,i as r,_ as u,I as c,D as m,n as p,$ as f,g as b,a as y}from"./element-plus-901ad096.js";import{_ as h}from"./ThemeToggle-fb2e4d42.js";import{al as _}from"./vendor-979eac9e.js";import{i as k,u as g,s as v,a as w}from"./keySkills-78bd60df.js";import{U as V}from"./util-3591e9ca.js";import{k as x,al as A,r as j,K as D,x as S,o as U,y as z,G as T,q as I,D as C,u as B,l as M,F as E,ae as L,V as O,B as $,U as q}from"./vue-49c48d91.js";import{_ as N}from"./_plugin-vue_export-helper-6a8c15be.js";import{a as F,b as J}from"./res-action-f84fe53b.js";import{c as G}from"./clipboard-e5e2548c.js";import"./useDemo-86956ef5.js";import"./useDev-861d544b.js";import"./chineseToIcon-e0fcd48d.js";import"./res-status-9bc9036c.js";import"./tts-30083447.js";import"./cactbot-49e370f3.js";const K={style:{display:"flex","justify-content":"center",gap:"0px"},class:"actions"},Q=["src"],H=N(x({__name:"KeySkillTable",props:{data:{}},emits:["delete","move"],setup(d,{emit:r}){const u=d,c=r,m=Object.freeze(V.getBattleJobs()),p=A(m.map(e=>({value:V.jobToJobEnum(e),label:V.jobToFullName(e)?.cn??e}))),f=j(new Map),b={};return D(()=>u.data.map(e=>({key:e.key,id:e.id})),e=>{e.forEach(({key:e,id:l})=>{b[e]&&clearTimeout(b[e]),b[e]=window.setTimeout(()=>{f.value.set(e,k(l)),f.value=new Map(f.value)},1e3)})},{immediate:!0,deep:!0}),(d,r)=>{const m=l,b=a,y=e,h=t,_=o,g=s,v=n,w=i;return U(),S(w,{data:u.data,border:"",size:"small","row-key":e=>e.key,height:620},{default:z(()=>[T(y,{label:"操作",width:"80",align:"center"},{default:z(({row:e,$index:l})=>[I("div",K,[T(m,{link:"",size:"small",type:"primary",disabled:0===l,class:"arrow",onClick:e=>c("move",l,l-1)},{default:z(()=>r[0]||(r[0]=[C(" ↑ ",-1)])),_:2,__:[0]},1032,["disabled","onClick"]),T(m,{link:"",size:"small",type:"primary",disabled:l===u.data.length-1,class:"arrow",onClick:e=>c("move",l,l+1)},{default:z(()=>r[1]||(r[1]=[C(" ↓ ",-1)])),_:2,__:[1]},1032,["disabled","onClick"]),T(b,{title:"确定删除吗？此操作无法撤销",placement:"top-start",onConfirm:l=>c("delete",e.key)},{reference:z(()=>[T(m,{link:"",type:"danger",size:"small"},{default:z(()=>r[2]||(r[2]=[C(" 删除 ",-1)])),_:1,__:[2]})]),_:2},1032,["onConfirm"])])]),_:1}),T(y,{label:"预览",width:"50",align:"center"},{default:z(({row:e})=>[I("img",{src:B(f).get(e.key)??B(k)(e.id),class:"icon"},null,8,Q)]),_:1}),T(y,{label:"ID(十进制)",width:"200"},{default:z(({row:e})=>[T(h,{modelValue:e.id,"onUpdate:modelValue":l=>e.id=l,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),T(y,{label:"TTS",width:"100"},{default:z(({row:e})=>[T(h,{modelValue:e.tts,"onUpdate:modelValue":l=>e.tts=l,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),T(y,{label:"持续时间(秒)",width:"180"},{default:z(({row:e})=>[T(h,{modelValue:e.duration,"onUpdate:modelValue":l=>e.duration=l,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),T(y,{label:"冷却时间 (秒)",width:"180"},{default:z(({row:e})=>[T(h,{modelValue:e.recast1000ms,"onUpdate:modelValue":l=>e.recast1000ms=l,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),T(y,{label:"适用职业","min-width":"100"},{default:z(({row:e})=>[T(g,{modelValue:e.job,"onUpdate:modelValue":l=>e.job=l,size:"small",multiple:""},{default:z(()=>[(U(!0),M(E,null,L(B(p),e=>(U(),S(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),T(y,{label:"最小习得等级",width:"90",align:"center"},{default:z(({row:e})=>[T(v,{modelValue:e.minLevel,"onUpdate:modelValue":l=>e.minLevel=l,min:1,max:100,size:"small","controls-position":"right",style:{width:"70px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),T(y,{label:"显示到第n行",width:"100",align:"center"},{default:z(({row:e})=>[T(v,{modelValue:e.line,"onUpdate:modelValue":l=>e.line=l,min:1,size:"small","controls-position":"right",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data","row-key"])}}}),[["__scopeId","data-v-4bfd1277"]]),P={class:"page-container"},R={class:"search-dialog-header",style:{display:"flex","justify-content":"space-between","align-items":"center"}},X={style:{height:"300px","overflow-y":"auto"}},Y=["data-src"],Z=N(x({__name:"keySkillTimerSettings",setup(a){const s=g(),o=j("chinese"),n={chinese:"国服技能数据",global:"国际服技能数据"};function V(){b.confirm(`是否重置「${n[o.value]}」为默认技能数据？这将覆盖当前编辑的内容。`,"确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{"chinese"===o.value?s.keySkillsData.chinese=[...v]:s.keySkillsData.global=[...w],y.success(`已重置${n[o.value]}`)}).catch(()=>{})}function x(e,l){const a=s.keySkillsData[e],t=a.findIndex(e=>e.key===l);-1!==t&&a.splice(t,1)}function A(e,l,a){const t=s.keySkillsData[e];if(a<0||a>=t.length||l===a)return;const o=t[l];o&&(t.splice(l,1),t.splice(a,0,o))}function E(){const e=JSON.stringify(s.keySkillsData),l=_.compressToBase64(e);G(l).then(()=>y.success("已复制到剪贴板")).catch(()=>y.error("复制失败"))}function L(){b.prompt("请输入导入的技能数据，导入的数据将覆盖当前内容。","导入",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputValidator:e=>{try{const l=_.decompressFromBase64(e),a=JSON.parse(l);return"object"==typeof a&&null!==a||"数据格式错误"}catch(l){return`数据格式错误: ${l instanceof Error?l.message:String(l)}`}}}).then(({value:e})=>{if(e){const l=_.decompressFromBase64(e),a=JSON.parse(l);"object"==typeof a&&null!==a?(s.keySkillsData.chinese=a.chinese,s.keySkillsData.global=a.global,y.success("已导入数据")):y.error("导入数据格式错误")}}).catch(()=>{})}const N=j(!1),K=j(""),Q=j([]);D(K,e=>{if(e){const l=[];for(const[a,t]of Object.entries(F))if(t.includes(e)){const e=Number(a);J(e)&&l.push({id:e,name:t})}Q.value=l}});const Z=new Map;function W(e){e&&e instanceof HTMLImageElement&&function(e){const l=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const a=e.target;a.src=a.dataset.src,l.unobserve(a)}})});l.observe(e),Z.set(e,()=>l.unobserve(e))}(e)}O(()=>{Z.forEach(e=>e()),Z.clear()});const ee=j({position:"fixed",top:"50px",left:"50px",width:"400px",height:"400px",zIndex:"1000"});let le=0,ae=0,te=0,se=0,oe=!1,ne=null;function ie(e){e.preventDefault();const l=document.querySelector(".search-dialog");if(!l)return;ne=l;const a=l.getBoundingClientRect();le=e.clientX,ae=e.clientY,te=a.left,se=a.top,oe=!0,window.addEventListener("mousemove",de),window.addEventListener("mouseup",re,{once:!0})}function de(e){if(!oe||!ne)return;const l=e.clientX-le,a=e.clientY-ae,t=Math.max(0,te+l),s=Math.max(0,se+a);ne.style.left=`${t}px`,ne.style.top=`${s}px`}function re(){oe=!1,ne=null,window.removeEventListener("mousemove",de)}return(a,b)=>{const y=l,_=t,g=m,v=c,w=e,j=i,D=d,O=p,F=h,J=r,G=f,Z=u;return U(),M("div",P,[N.value?(U(),S(D,{key:0,class:"search-dialog",style:q(ee.value),"body-style":"padding: 0.5em 1em"},{default:z(()=>[I("div",R,[I("h4",{class:"dialog-drag-handle",onMousedown:ie}," 拖动这里可以移动 ",32),T(y,{size:"small",onClick:b[0]||(b[0]=e=>N.value=!1)},{default:z(()=>b[11]||(b[11]=[C(" 关闭 ",-1)])),_:1,__:[11]})]),T(v,{"label-width":"5em"},{default:z(()=>[T(g,{label:"技能名称"},{default:z(()=>[T(_,{modelValue:K.value,"onUpdate:modelValue":b[1]||(b[1]=e=>K.value=e),clearable:"",placeholder:"请输入技能名称"},null,8,["modelValue"])]),_:1})]),_:1}),I("div",X,[T(j,{data:Q.value,style:{width:"100%"}},{default:z(()=>[T(w,{label:"预览",width:"60",align:"center"},{default:z(({row:e})=>[I("img",{ref:W,"data-src":B(k)(e.id),src:"data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwgAAACH5BAEAAAIALAAAAAAQABAAAAM6CLrc/jDKSau9OOvNu/9gKI5kaZ5oqub5bSqVefrb7r3rtf1B7n8fqw7GZ0cL+o8P8fAQA7",loading:"lazy",style:{width:"24px",height:"24px"},alt:""},null,8,Y)]),_:1}),T(w,{prop:"id",label:"技能ID（十进制）"}),T(w,{prop:"name",label:"技能名称"})]),_:1},8,["data"])])]),_:1},8,["style"])):$("",!0),T(J,{class:"header"},{default:z(()=>[T(y,{size:"small",type:"success",onClick:b[2]||(b[2]=e=>{return l=o.value,void s.keySkillsData[l].unshift({key:crypto.randomUUID(),id:0,tts:"",duration:0,recast1000ms:0,job:[],line:1,minLevel:1});var l})},{default:z(()=>b[12]||(b[12]=[C(" 新增技能 ",-1)])),_:1,__:[12]}),T(y,{size:"small",type:"info",onClick:b[3]||(b[3]=e=>N.value=!0)},{default:z(()=>b[13]||(b[13]=[C(" 搜索技能ID ",-1)])),_:1,__:[13]}),T(O,null,{default:z(()=>[T(y,{size:"small",onClick:E},{default:z(()=>b[14]||(b[14]=[C(" 导出 ",-1)])),_:1,__:[14]}),T(y,{size:"small",onClick:L},{default:z(()=>b[15]||(b[15]=[C(" 导入 ",-1)])),_:1,__:[15]})]),_:1}),T(y,{size:"small",type:"danger",onClick:V},{default:z(()=>b[16]||(b[16]=[C(" 恢复默认 ",-1)])),_:1,__:[16]}),T(F,{"storage-key":"key-skill-timer-2"})]),_:1}),T(Z,{modelValue:o.value,"onUpdate:modelValue":b[10]||(b[10]=e=>o.value=e),"tab-position":"top",type:"border-card",class:"tabs"},{default:z(()=>[T(G,{label:n.chinese,name:"chinese"},{default:z(()=>[T(H,{data:B(s).keySkillsData.chinese,"onUpdate:data":b[4]||(b[4]=e=>B(s).keySkillsData.chinese=e),onDelete:b[5]||(b[5]=e=>x("chinese",e)),onMove:b[6]||(b[6]=(e,l)=>A("chinese",e,l))},null,8,["data"])]),_:1},8,["label"]),T(G,{label:n.global,name:"global"},{default:z(()=>[T(H,{data:B(s).keySkillsData.global,"onUpdate:data":b[7]||(b[7]=e=>B(s).keySkillsData.global=e),onDelete:b[8]||(b[8]=e=>x("global",e)),onMove:b[9]||(b[9]=(e,l)=>A("global",e,l))},null,8,["data"])]),_:1},8,["label"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-f887944c"]]);export{Z as default};
