var e=Object.defineProperty,t=(t,a,n)=>((t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n)(t,"symbol"!=typeof a?a+"":a,n);import"./index-fgvUMWOU.js";/* empty css                        *//* empty css                   *//* empty css                  *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                     *//* empty css                  *//* empty css                */import{aw as a,w as n,f as l,v as o,x as s,A as r,M as c,E as i,L as u,a9 as d,u as p,D as m,h,t as f,r as w,P as g,H as b,K as v,J as y,V as C}from"./vue-vendor-wZ_5aAzA.js";import{u as V,b as _}from"./index-CKUOrbjt.js";import{_ as S}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{n as P,m as R,J as D,F as T,e as E,h as U,R as x,S as j,T as O,U as k,r as L,y as N,z as A,d as B,f as z}from"./element-plus-8--zztY3.js";import{j as F}from"./obs-CtYjjizy.js";import{z as G}from"./zoneInfo-VeakL-Q8.js";import{d as I}from"./content_type-lMHx3DqW.js";import{N as Q,c as q,l as M}from"./netregexes-r2K2MLa5.js";import{a as W,r as H,c as Z}from"./overlay_plugin_api-DU1DlPio.js";const J={class:"language-switcher"},Y={class:"select-wrapper"},K=S({__name:"LanguageSwitcher",setup(e){const{locale:t,availableLocales:f}=a(),w={zhCn:"简体中文",en:"English",ja:"日本語"},g=V("user-locale",t.value);return n(g,(e=>{t.value=e})),l((()=>{t.value=g.value})),(e,t)=>{const a=P,n=R;return s(),o("div",J,[r("div",Y,[t[1]||(t[1]=r("svg",{class:"globe-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[r("circle",{cx:"12",cy:"12",r:"10"}),r("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),r("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})],-1)),c(n,{modelValue:p(g),"onUpdate:modelValue":t[0]||(t[0]=e=>h(g)?g.value=e:null),size:"small",class:"language-select"},{default:i((()=>[(s(!0),o(u,null,d(p(f),((e,t)=>(s(),m(a,{key:t,value:e,label:w[e]},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-66d37cfa"]]),$={class:"obs-container"},X={class:"card-header"},ee={class:"act-not-ready-content"},te={key:1},ae={class:"card-header"},ne={key:1},le={class:"card-header"},oe={class:"status-info"},se={class:"button-container"},re={class:"card-header"},ce={class:"profile-info"},ie={class:"file-path-explanation"},ue={class:"file-name-explanation"},de={class:"card-header"},pe=S(f({__name:"obs2",setup(e){const{t:n}=a(),u=V("obs-user-config",{host:4455,password:"",path:"",fileName:""},localStorage,{writeDefaults:!0}),d=V("obs-user-content-setting",[]),h=V("obs-is-first-time",!0),f=w(!1),S="1"===_("hash").dev,P=w({zone:{},partyLength:1});function R(){return S?Promise.resolve():new Promise((e=>{Z({call:"cactbotRequestState"}).then((()=>{f.value=!0,e()})),setTimeout((()=>{f.value||R()}),3e3)}))}const J={inCombat:Q.inCombat(),countdown:Q.countdown(),countdownCancel:Q.countdownCancel(),wipe:q.wipe},Y=["Savage","Extreme","Chaotic","Ultimate","OccultCrescent","Dungeons","Raids","Trials","VCDungeonFinder","DeepDungeons","Guildhests","DisciplesOfTheLand","Eureka","SocietyQuests","GrandCompany","QuestBattles","TreasureHunt","Pvp","Default"],pe={enter:!1,countdown:!0,countdownCancel:!0,combatStart:!0,combatEnd:!0,wipe:!0,partyLength:4},me={enter:!1,countdown:!1,countdownCancel:!1,combatStart:!1,combatEnd:!1,wipe:!1,partyLength:1};const he=new class{constructor(){t(this,"ws"),t(this,"status"),t(this,"handleConnectionError",(()=>{ge("OBS connection error"),this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath=""})),t(this,"handleConnectionClosed",(()=>{ge("OBS connection closed"),this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath=""})),t(this,"handleRecordStateChanged",(e=>{this.status.connected=!0,this.status.recording="OBS_WEBSOCKET_OUTPUT_STARTED"===e.outputState,this.status.outputActive=e.outputActive,this.status.outputPath=e.outputPath||""})),this.ws=new F,this.status=C({connecting:!1,connected:!1,recording:!1,outputActive:!1,outputPath:""}),this.ws.on("ConnectionClosed",this.handleConnectionClosed),this.ws.on("ConnectionError",this.handleConnectionError),this.ws.on("RecordStateChanged",this.handleRecordStateChanged)}connect(e){ge("Attempting to connect to OBS"),u.value.host&&u.value.password&&(this.status.connecting||(this.status.connecting=!0,this.ws.connect(`ws://127.0.0.1:${u.value.host}`,u.value.password).then((()=>{this.ws.call("GetRecordStatus").then((e=>{this.status.recording=e.outputActive,this.status.outputActive=e.outputActive})),this.status.connected=!0,e&&e()})).finally((()=>{this.status.connecting=!1,!u.value.path&&this.status.connected&&this.ws.call("GetRecordDirectory").then((e=>{e.recordDirectory&&(u.value.path=e.recordDirectory)})),u.value.fileName||(u.value.fileName="%CCYY-%MM-%DD %hh-%mm-%ss")}))))}disconnect(){ge("Disconnecting from OBS"),this.ws.disconnect()}async startRecord(){ge("Starting recording"),await this.setProfileParameter(),this.ws.call("StartRecord")}stopRecord(){ge("Stopping recording"),this.ws.call("StopRecord")}splitRecord(){ge("Splitting recording"),this.ws.call("StopRecord").finally((()=>{setTimeout((()=>{this.ws.call("StartRecord")}),1e3)}))}async setProfileParameter(){const e=u.value.path,t=u.value.fileName,a=[];return a.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"AdvOut",parameterName:"RecFilePath",parameterValue:e}}),a.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"Output",parameterName:"FilenameFormatting",parameterValue:t}}),u.value.path=e,u.value.fileName=t,this.ws.callBatch(a)}},fe=e=>{ge("Zone changed:",e);const t=e.zoneID,a=G[t];void 0!==a&&(P.value.zone=a,be("enter"))},we=e=>{const t=e.rawLine;for(const a in J){if(J[a].exec(t)){const e=t.split("|");switch(a){case"inCombat":{const t="1"===e[M.InCombat.fields.inACTCombat],a="1"===e[M.InCombat.fields.inGameCombat];if(t&&a)return void be("combatStart");if(!t&&!a)return void be("combatEnd");break}case"countdown":be("countdown");break;case"countdownCancel":be("countdownCancel");break;case"wipe":be("wipe")}}}};function ge(...e){}function be(e){const t=function(e){var t,a;const n=e.contentType,l=null==(t=e.name)?void 0:t.fr,o=null==(a=e.name)?void 0:a.en;switch(n){case I.ChaoticAllianceRaid:return"Chaotic";case I.UltimateRaids:return"Ultimate";case I.Pvp:return"Pvp";case I.Dungeons:return"Dungeons";case I.DeepDungeons:return"DeepDungeons";case I.VCDungeonFinder:return"VCDungeonFinder";case I.Trials:return(null==l?void 0:l.includes("(extrême)"))?"Extreme":"Trials";case I.Raids:return(null==o?void 0:o.includes("(Savage)"))?"Savage":"Raids";case I.DisciplesOfTheLand:return"DisciplesOfTheLand";case I.Eureka:return"Eureka";case I.GrandCompany:return"GrandCompany";case I.QuestBattles:return"QuestBattles";case I.TreasureHunt:return"TreasureHunt";case I.SocietyQuests:return"SocietyQuests";case I.OccultCrescent:return"OccultCrescent";default:return"Default"}}(P.value.zone),a=d.value.find((e=>e.type===t));if(a&&a[e])if(!1===a.enter&&"enter"===e&&he.status.recording)he.stopRecord();else switch(e){case"enter":case"countdown":case"combatStart":if(P.value.partyLength<a.partyLength)return;return he.status.connected?!1===he.status.recording?void he.startRecord():void(!0===he.status.recording&&"combatStart"!==e&&he.splitRecord()):void he.connect((()=>{he.startRecord()}));case"countdownCancel":case"combatEnd":case"wipe":he.status.recording&&he.stopRecord()}}const ve=e=>{var t;P.value.partyLength=(null==(t=e.party.map((e=>e.inParty)))?void 0:t.length)||1};return l((async()=>{await R(),he.connect(),W("ChangeZone",fe),W("LogLine",we),W("PartyChanged",ve),function(){const e=["Savage","Extreme","Ultimate","Chaotic","OccultCrescent","Default"];if(h.value)h.value=!1,d.value=[...e.map((e=>({type:e,...pe}))),...Y.filter((t=>!e.includes(t))).map((e=>({type:e,...me})))];else{d.value=d.value.filter((e=>Y.includes(e.type)));const t=Y.filter((e=>!d.value.some((t=>t.type===e))&&"Default"!==e)).map((t=>e.includes(t)?{type:t,...pe}:{type:t,...me}));d.value.push(...t)}d.value.sort(((e,t)=>Y.indexOf(e.type)-Y.indexOf(t.type))),d.value=d.value.map((t=>({...e.includes(t.type)?pe:me,...t})))}()})),g((()=>{he.disconnect(),H("ChangeZone",fe),H("LogLine",we)})),(e,t)=>{const a=K,l=L,h=E,w=T,g=U,C=D,V=x,_=j,P=k,R=O,F=A,G=B,I=z,Q=N;return s(),o("div",$,[r("header",null,[r("h1",null,v(p(n)("OBS Auto Record V2")),1),c(a)]),!p(f)||S?(s(),m(l,{key:0,class:"act-not-ready-card"},{header:i((()=>[r("div",X,[r("span",null,v(p(n)("ACT Not Ready")),1)])])),default:i((()=>[r("div",ee,[r("p",null,v(p(n)("overlayTutorial")),1)])])),_:1})):b("",!0),p(f)||S?(s(),o("main",te,[p(he).status.connected||S?(s(),o("div",ne,[c(_,{class:"instruction-alert",type:"info",description:p(n)("hideTutorial"),closable:!1,"show-icon":""},null,8,["description"]),S?(s(),m(l,{key:0,class:"status-card"},{header:i((()=>[r("div",le,[r("span",null,v(p(n)("Connection Status")),1),c(g,{type:"danger",size:"small",class:"disconnect-button",onClick:t[3]||(t[3]=e=>p(he).disconnect())},{default:i((()=>[y(v(p(n)("Disconnect")),1)])),_:1})])])),default:i((()=>[r("div",oe,[c(R,{direction:"vertical",column:1,border:""},{default:i((()=>[c(P,{label:p(n)("Recording")},{default:i((()=>[y(v(p(he).status.recording?p(n)("Yes"):p(n)("No")),1)])),_:1},8,["label"]),c(P,{label:p(n)("Output Path")},{default:i((()=>[y(v(p(he).status.outputPath||p(n)("None")),1)])),_:1},8,["label"])])),_:1})]),r("div",se,[c(g,{disabled:!p(he).status.connected||p(he).status.recording,type:"primary",onClick:t[4]||(t[4]=e=>p(he).startRecord())},{default:i((()=>[y(v(p(n)("Start Record")),1)])),_:1},8,["disabled"]),c(g,{disabled:!p(he).status.connected||!p(he).status.recording,type:"danger",onClick:t[5]||(t[5]=e=>p(he).stopRecord())},{default:i((()=>[y(v(p(n)("Stop Record")),1)])),_:1},8,["disabled"]),c(g,{disabled:!p(he).status.connected||!p(he).status.recording,type:"warning",onClick:t[6]||(t[6]=e=>p(he).splitRecord())},{default:i((()=>[y(v(p(n)("Split Record")),1)])),_:1},8,["disabled"]),c(g,{type:"primary",onClick:t[7]||(t[7]=e=>p(he).setProfileParameter())},{default:i((()=>[y(v(p(n)("Set Recording Name")),1)])),_:1})])])),_:1})):b("",!0),c(l,{class:"profile-card"},{header:i((()=>[r("div",re,[r("span",null,v(p(n)("Recording Profile")),1)])])),default:i((()=>[r("div",ce,[c(C,{"label-position":"top",class:"content-form"},{default:i((()=>[c(w,{label:p(n)("Record Path")},{default:i((()=>[c(h,{modelValue:p(u).path,"onUpdate:modelValue":t[8]||(t[8]=e=>p(u).path=e),placeholder:p(n)("recordPathPlaceholder")},null,8,["modelValue","placeholder"]),r("div",ie,v(p(n)("filePathExplanation")),1)])),_:1},8,["label"]),c(w,{label:p(n)("Record File Name")},{default:i((()=>[c(h,{modelValue:p(u).fileName,"onUpdate:modelValue":t[9]||(t[9]=e=>p(u).fileName=e),placeholder:p(n)("recordFileNamePlaceholder")},null,8,["modelValue","placeholder"]),r("div",ue,v(p(n)("fileNameExplanation")),1)])),_:1},8,["label"])])),_:1})])])),_:1}),c(l,{class:"table-card"},{header:i((()=>[r("div",de,[r("span",null,v(p(n)("User Content Settings")),1)])])),default:i((()=>[c(Q,{data:p(d),style:{width:"100%"},border:!0,stripe:""},{default:i((()=>[c(F,{prop:"type",label:p(n)("Type"),"min-width":"120",fixed:""},{default:i((e=>[r("span",null,v(p(n)(e.row.type)),1)])),_:1},8,["label"]),c(F,{label:p(n)("Start When"),align:"center"},{default:i((()=>[c(F,{label:p(n)("When Party"),align:"center","min-width":"110"},{default:i((e=>[c(G,{modelValue:e.row.partyLength,"onUpdate:modelValue":t=>e.row.partyLength=t,min:1,max:8,style:{width:"85px"},size:"small",class:"party-length-input"},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),c(F,{prop:"enter",label:p(n)("Enter Zone"),align:"center","min-width":"95"},{default:i((e=>[c(I,{modelValue:e.row.enter,"onUpdate:modelValue":t=>e.row.enter=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),c(F,{prop:"countdown",label:p(n)("CountDown"),align:"center","min-width":"95"},{default:i((e=>[c(I,{modelValue:e.row.countdown,"onUpdate:modelValue":t=>e.row.countdown=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),c(F,{prop:"combatStart",label:p(n)("CombatStart"),align:"center","min-width":"95"},{default:i((e=>[c(I,{modelValue:e.row.combatStart,"onUpdate:modelValue":t=>e.row.combatStart=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"])])),_:1},8,["label"]),c(F,{label:p(n)("End When"),align:"center"},{default:i((()=>[c(F,{prop:"combatEnd",label:p(n)("CombatEnd"),align:"center","min-width":"95"},{default:i((e=>[c(I,{modelValue:e.row.combatEnd,"onUpdate:modelValue":t=>e.row.combatEnd=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),c(F,{prop:"wipe",label:p(n)("Wipe"),align:"center","min-width":"95"},{default:i((e=>[c(I,{modelValue:e.row.wipe,"onUpdate:modelValue":t=>e.row.wipe=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),c(F,{prop:"countdown",label:p(n)("CountDownCancel"),align:"center","min-width":"95"},{default:i((e=>[c(I,{modelValue:e.row.countdownCancel,"onUpdate:modelValue":t=>e.row.countdownCancel=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"])])),_:1},8,["label"])])),_:1},8,["data"])])),_:1})])):(s(),m(l,{key:0,class:"connection-card"},{header:i((()=>[r("div",ae,[r("span",null,v(p(n)("Connect to OBS")),1)])])),default:i((()=>[c(C,{"label-position":"top",class:"connection-form"},{default:i((()=>[c(w,{label:p(n)("Port")},{default:i((()=>[c(h,{modelValue:p(u).host,"onUpdate:modelValue":t[0]||(t[0]=e=>p(u).host=e),placeholder:p(n)("portPlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),c(w,{label:p(n)("Password")},{default:i((()=>[c(h,{modelValue:p(u).password,"onUpdate:modelValue":t[1]||(t[1]=e=>p(u).password=e),placeholder:p(n)("passwordPlaceholder"),type:"password"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),c(w,null,{default:i((()=>[c(g,{type:"primary",class:"connect-button",loading:p(he).status.connecting,disabled:p(he).status.connecting||!p(u).host,onClick:t[2]||(t[2]=e=>p(he).connect())},{default:i((()=>[y(v(p(he).status.connecting?p(n)("Connecting"):p(n)("Connect")),1)])),_:1},8,["loading","disabled"])])),_:1})])),_:1}),c(V,null,{default:i((()=>[y(v(p(n)("Instructions")),1)])),_:1}),c(_,{class:"instruction-alert",type:"info",description:p(n)("obsTutorial"),closable:!1,"show-icon":""},null,8,["description"]),c(_,{class:"instruction-alert",type:"info",description:p(n)("inputTutorial"),closable:!1,"show-icon":""},null,8,["description"]),c(_,{class:"instruction-alert",type:"info",description:p(n)("firewallTutorial"),closable:!1,"show-icon":""},null,8,["description"])])),_:1}))])):b("",!0)])}}}),[["__scopeId","data-v-dd759977"]]);export{pe as default};
