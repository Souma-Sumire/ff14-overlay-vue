import{h as e,i as t,r as n,Y as o,Z as r,$ as s,_ as a,d as u,I as d,V as c,u as i,a$ as l,X as f,az as v,U as p}from"./index-CLlbZJTe.js";const m=e=>"undefined"!=typeof Element&&e instanceof Element,E=e=>Array.from(e.querySelectorAll('a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])')).filter(e=>b(e)&&(e=>"fixed"!==getComputedStyle(e).position&&null!==e.offsetParent)(e)),b=e=>{if(e.tabIndex>0||0===e.tabIndex&&null!==e.getAttribute("tabIndex"))return!0;if(e.tabIndex<0||e.hasAttribute("disabled")||"true"===e.getAttribute("aria-disabled"))return!1;switch(e.nodeName){case"A":return!!e.href&&"ignore"!==e.rel;case"INPUT":return!("hidden"===e.type||"file"===e.type);case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},y=e=>!e.getAttribute("aria-owns"),h=(e,t,n)=>{const{parentNode:o}=e;if(!o)return null;const r=o.querySelectorAll(n);return r[Array.prototype.indexOf.call(r,e)+t]||null},w=(e,t)=>{if(!e||!e.focus)return;let n=!1;!m(e)||b(e)||e.getAttribute("tabindex")||(e.setAttribute("tabindex","-1"),n=!0),e.focus(t),m(e)&&n&&e.removeAttribute("tabindex")},L=e=>{e&&(w(e),!y(e)&&e.click())},T="focus-trap.focus-after-trapped",A="focus-trap.focus-after-released",g={cancelable:!0,bubbles:!1},x={cancelable:!0,bubbles:!1},I="focusAfterTrapped",N="focusAfterReleased",S=Symbol("elFocusTrap"),R=n(),F=n(0),P=n(0);let k=0;const K=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},C=(e,t)=>{for(const n of e)if(!_(n,t))return n},_=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1},O=(e,t)=>{if(e){const n=document.activeElement;w(e,{preventScroll:!0}),P.value=window.performance.now(),e!==n&&(e=>e instanceof HTMLInputElement&&"select"in e)(e)&&t&&e.select()}};function U(e,t){const n=[...e],o=e.indexOf(t);return-1!==o&&n.splice(o,1),n}const q=(()=>{let e=[];return{push:t=>{const n=e[0];n&&t!==n&&n.pause(),e=U(e,t),e.unshift(t)},remove:t=>{var n,o;e=U(e,t),null==(o=null==(n=e[0])?void 0:n.resume)||o.call(n)}}})(),j=()=>{R.value="pointer",F.value=window.performance.now()},B=()=>{R.value="keyboard",F.value=window.performance.now()},D=e=>new CustomEvent("focus-trap.focusout-prevented",{...x,detail:e});let $=[];const H=e=>{r(e)===s.esc&&$.forEach(t=>t(e))};var M=a(u({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[I,N,"focusin","focusout","focusout-prevented","release-requested"],setup(a,{emit:u}){const d=n();let m,E;const{focusReason:b}=(e(()=>{0===k&&(document.addEventListener("mousedown",j),document.addEventListener("touchstart",j),document.addEventListener("keydown",B)),k++}),t(()=>{k--,k<=0&&(document.removeEventListener("mousedown",j),document.removeEventListener("touchstart",j),document.removeEventListener("keydown",B))}),{focusReason:R,lastUserFocusTimestamp:F,lastAutomatedFocusTimestamp:P});var y;y=e=>{a.trapped&&!h.paused&&u("release-requested",e)},e(()=>{0===$.length&&document.addEventListener("keydown",H),o&&$.push(y)}),t(()=>{$=$.filter(e=>e!==y),0===$.length&&o&&document.removeEventListener("keydown",H)});const h={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},w=e=>{if(!a.loop&&!a.trapped)return;if(h.paused)return;const{altKey:t,ctrlKey:n,metaKey:o,currentTarget:d,shiftKey:c}=e,{loop:i}=a,l=r(e)===s.tab&&!t&&!n&&!o,f=document.activeElement;if(l&&f){const t=d,[n,o]=(e=>{const t=K(e);return[C(t,e),C(t.reverse(),e)]})(t);if(n&&o)if(c||f!==o){if(c&&[n,t].includes(f)){const t=D({focusReason:b.value});u("focusout-prevented",t),t.defaultPrevented||(e.preventDefault(),i&&O(o,!0))}}else{const t=D({focusReason:b.value});u("focusout-prevented",t),t.defaultPrevented||(e.preventDefault(),i&&O(n,!0))}else if(f===t){const t=D({focusReason:b.value});u("focusout-prevented",t),t.defaultPrevented||e.preventDefault()}}};p(S,{focusTrapRef:d,onKeydown:w}),c(()=>a.focusTrapEl,e=>{e&&(d.value=e)},{immediate:!0}),c([d],([e],[t])=>{e&&(e.addEventListener("keydown",w),e.addEventListener("focusin",_),e.addEventListener("focusout",U)),t&&(t.removeEventListener("keydown",w),t.removeEventListener("focusin",_),t.removeEventListener("focusout",U))});const L=e=>{u(I,e)},x=e=>u(N,e),_=e=>{const t=i(d);if(!t)return;const n=e.target,o=e.relatedTarget,r=n&&t.contains(n);if(!a.trapped){o&&t.contains(o)||(m=o)}r&&u("focusin",e),h.paused||a.trapped&&(r?E=n:O(E,!0))},U=e=>{const t=i(d);if(!h.paused&&t)if(a.trapped){const n=e.relatedTarget;l(n)||t.contains(n)||setTimeout(()=>{if(!h.paused&&a.trapped){const e=D({focusReason:b.value});u("focusout-prevented",e),e.defaultPrevented||O(E,!0)}},0)}else{const n=e.target;n&&t.contains(n)||u("focusout",e)}};async function M(){await f();const e=i(d);if(e){q.push(h);const t=e.contains(document.activeElement)?m:document.activeElement;m=t;if(!e.contains(t)){const n=new Event(T,g);e.addEventListener(T,L),e.dispatchEvent(n),n.defaultPrevented||f(()=>{let n=a.focusStartEl;v(n)||(O(n),document.activeElement!==n&&(n="first")),"first"===n&&((e,t=!1)=>{const n=document.activeElement;for(const o of e)if(O(o,t),document.activeElement!==n)return})(K(e),!0),document.activeElement!==t&&"container"!==n||O(e)})}}}function W(){const e=i(d);if(e){e.removeEventListener(T,L);const t=new CustomEvent(A,{...g,detail:{focusReason:b.value}});e.addEventListener(A,x),e.dispatchEvent(t),t.defaultPrevented||"keyboard"!=b.value&&F.value>P.value&&!e.contains(document.activeElement)||O(null!=m?m:document.body),e.removeEventListener(A,x),q.remove(h),m=null,E=null}}return e(()=>{a.trapped&&M(),c(()=>a.trapped,e=>{e?M():W()})}),t(()=>{a.trapped&&W(),d.value&&(d.value.removeEventListener("keydown",w),d.value.removeEventListener("focusin",_),d.value.removeEventListener("focusout",U),d.value=void 0)}),{onKeydown:w}}}),[["render",function(e,t,n,o,r,s){return d(e.$slots,"default",{handleKeydown:e.onKeydown})}],["__file","focus-trap.vue"]]);export{M as E,S as F,b as a,w as b,L as f,h as g,y as i,E as o};
