import{_ as a}from"./DragJob-8c46d6c3.js";import{t as e,r as t,f as n,ae as o,v as r,x as l,F as s,M as i,A as u,H as p,O as m,u as c,E as d,h as f,L as y,a9 as v,S as b,D as h,K as j,ab as g}from"./vue-vendor-db4de8ea.js";import{V as _}from"./index-d195d6c8.js";import"./style-1f970b29.js";import{U as x}from"./util-c5e2dd68.js";import{a as k,c as w}from"./overlay_plugin_api-974cdd44.js";/* empty css                */import{u as P}from"./index-de57c9c1.js";import{_ as C}from"./_plugin-vue_export-helper-6a8c15be.js";import"./element-plus-2ee4efb4.js";const T={class:"text-white text-shadow-sm text-shadow-color-black"},J={class:"players"},O={class:"name"},V={key:0,style:{position:"fixed",bottom:"0"}},R=C(e({__name:"cactbotRuntime",setup(e){function C(a,e,t=0){return Array.from({length:e},()=>a).map((a,e)=>a+(+e+1+t))}_.setTheme("dark");const R=t(!1),D=P("cactbotRuntime-sortArr",[]),S=[{id:"10000001",name:"虚构暗骑",job:32,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构龙骑",job:22,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0},{id:"10000007",name:"虚构画家",job:42,inParty:!0}],U=P("cactbotRuntime-data",{party:[]}),E=P("cactbotRuntime-showTips",t(!0)),M=P("cactbotRuntime-roleSelectLength",{tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0}),A={tank:["MT","ST",...C("T",6,2)],healer:[...C("H",8)],dps:[...C("D",8)],crafter:[...C("C",8)],gatherer:[...C("G",8)],none:[...C("N",8)]};function L(a){const e=z(a);return A[e].filter((a,t)=>t<M.value[e])}const F=location.href.includes("localhost"),G=t(!1),N=t(F?S[2].name:"");function z(a){return[1,3,19,21,32,37].includes(a)?"tank":[6,24,28,33,40].includes(a)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39,41,42].includes(a)?"dps":x.isCraftingJob(x.jobEnumToJob(a))?"crafter":x.isGatheringJob(x.jobEnumToJob(a))?"gatherer":"none"}function H(a){return A[z(a.job)].find(a=>!U.value.party.find(e=>e.rp===a))??"unknown"}function I(){const a=[...A.tank,...A.healer,...A.dps,...A.crafter,...A.gatherer,...A.none];U.value.party.sort((e,t)=>a.indexOf(e.rp??"unknown")-a.indexOf(t.rp??"unknown")),w({call:"broadcast",source:"soumaRuntimeJS",msg:{party:U.value.party}})}function q(){G.value=!0}function B(){G.value=!1}function K(a){D.value=a,Q()}function Q(){!function(){U.value.party.sort((a,e)=>D.value.indexOf(a.job)-D.value.indexOf(e.job));for(const a of U.value.party)a.rp=void 0;for(const a of U.value.party)a.rp=H(a)}(),function(){for(const a in M.value)Object.prototype.hasOwnProperty.call(M.value,a)&&(M.value[a]=U.value.party.reduce((e,t)=>z(t.job)===a?e+1:e,0))}(),I()}function W(){const a={party:S};E.value&&(R.value=!0),U.value.party=a.party.filter(a=>a.inParty).map(a=>({...a,rp:"unknown"})),Q()}return n(()=>{I(),k("PartyChanged",a=>{E.value&&(R.value=!0),F&&0===a.party.length||(U.value.party=a.party.filter(a=>a.inParty).map(a=>({...a,rp:"unknown"})),Q())}),k("ChangePrimaryPlayer",a=>{F||(N.value=a.charName)}),k("BroadcastMessage",a=>{"soumaUserJS"===a.source&&"object"==typeof a.msg&&null!==a.msg&&"requestData"===Reflect.get(a.msg,"text")&&I()})}),(e,t)=>{const n=o("vxe-modal"),_=o("vxe-option"),k=o("vxe-select"),w=a;return l(),r("div",{onMouseenter:q,onMouseleave:B},[s(u("span",T,"...",512),[[m,c(U).party.length<=1]]),i(n,{modelValue:c(R),"onUpdate:modelValue":t[0]||(t[0]=a=>f(R)?R.value=a:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:t[1]||(t[1]=a=>{R.value=!1,E.value=!1})},{title:d(()=>t[3]||(t[3]=[u("span",null,"用法",-1)])),default:d(()=>t[4]||(t[4]=[u("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1),u("ul",null,[u("li",null,"临时：下拉选择框修改。"),u("li",null,"长期：用鼠标拖动职能顺序。")],-1)])),_:1},8,["modelValue"]),u("main",{style:b({width:c(G)?+(c(U).party.find(a=>36===a.job)?1:0)+18+"em":"4em"})},[u("div",J,[i(g,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:d(()=>[(l(!0),r(y,null,v(c(U).party,(a,e)=>{return s((l(),r("section",{key:a.id,flex:"~ nowrap",style:b({opacity:c(G)?1:.5}),class:"player"},[i(k,{modelValue:a.rp,"onUpdate:modelValue":e=>a.rp=e,size:"mini","class-name":"select",onChange:a=>function(a){const e=U.value.party.find(e=>e.rp===U.value.party[a].rp&&e.id!==U.value.party[a].id);e&&(e.rp=H(e)),I()}(e)},{default:d(()=>[(l(!0),r(y,null,v(L(a.job),(a,e)=>(l(),h(_,{key:e,value:a,label:a},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),u("span",O,j((t=a.job,x.nameToFullName(x.jobEnumToJob(t)).simple1))+" "+j(c(G)?a.name:""),1)],4)),[[m,c(U).party.length>1&&(c(G)||a.name===c(N))]]);var t}),128))]),_:1})]),s(i(w,{party:c(U).party,"m-b-1":"","p-1":"",onUpdateSortArr:K},null,8,["party"]),[[m,c(G)]])],4),c(F)?(l(),r("div",V,[u("button",{onClick:t[2]||(t[2]=a=>{c(U).party=c(U).party.filter(a=>a.name===c(N)),Q()})}," 测试单人 "),u("button",{onClick:W}," 测试组队 ")])):p("",!0)],32)}}}),[["__scopeId","data-v-6265d712"]]);export{R as default};
