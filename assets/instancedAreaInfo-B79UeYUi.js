import{c as a,_ as e}from"./shared-common-1fsdULpF.js";import{a as t,r as n,c as s}from"./cactbot-Bq2Gp82n.js";import{o,B as c,a5 as i,v as r,J as m,t as l,u as d,H as u,Z as p,X as f,ac as I}from"./vendor-vue-iK2zA9mI.js";import"./shared-core-DqyA8e41.js";import"./vendor-element-plus-Crd81rYT.js";const h={key:0},D={key:1},b=e(o({__name:"instancedAreaInfo",setup(e){const o=I({islandId:0,instanceNum:""}),b=[732,763,795,827,920,975,1252],g=Object.fromEntries(b.map(a=>[a,new Map])),N=async a=>{if(!b.includes(a.zoneID))return void(o.islandId=0);const e=(await s({call:"getCombatants"})).combatants.filter(a=>541===a.BNpcNameID&&a.ID).sort((a,e)=>a.ID-e.ID)[0];if(!e)return;const t=e.ID-1073741824,n=Date.now(),c=g[a.zoneID],i=c.get(t);if(o.islandId=t,i){const a=n-i.timestamp,e=`这个岛${a<6e4?`${Math.floor(a/1e3)}秒`:`${Math.floor(a/6e4)}分钟`}前来过，是第${i.count}个遇到的岛`;i.timestamp=n,s({call:"cactbotSay",text:e})}else{c.set(t,{timestamp:n,count:c.size+1});const a=`这个岛第一次来，现在总共遇到了${c.size}个岛`;s({call:"cactbotSay",text:a})}},j={"":"①","":"②","":"③","":"④","":"⑤","":"⑥","":"⑦","":"⑧","":"⑨"},v=a=>{if("00"===a.line[0]&&"0039"===a.line[2]){const e=a.line[4].match(/当前所在副本区为“([^”]+)(?<instance>[])”/)??a.line[4].match(/You are now in the instanced area (.+?)(?<instance>[])”/)??a.line[4].match(/インスタンスエリア「(.+?)(?<instance>[])」/);e&&(o.instanceNum=j[e.groups?.instance])}else"01"===a.line[0]&&(o.instanceNum="")};return c(()=>{t("LogLine",v),t("ChangeZone",N)}),i(()=>{n("LogLine",v),n("ChangeZone",N)}),(e,t)=>{const n=a;return l(),r(n,null,{default:m(()=>[d(o).instanceNum?(l(),u("p",h,p(d(o).instanceNum),1)):f("",!0),d(o).islandId?(l(),u("p",D,p(d(o).islandId)+"号岛 ",1)):f("",!0)]),_:1})}}}),[["__scopeId","data-v-db42191a"]]);export{b as default};
