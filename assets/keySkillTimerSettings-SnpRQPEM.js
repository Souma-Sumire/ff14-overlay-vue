import{c as e,d as l,n as t,e as a,aE as i,K as s,G as n,H as o,aF as r,aG as d,l as c,F as u,aD as m,j as k,k as p,b as S,aH as f,an as y,Y as g,ak as b,au as h,a9 as v,aA as T,O as _,N as V,E as w,a as x}from"./vendor-element-plus-CV7wbfUG.js";import{a8 as $,a9 as z,u as U,U as j,aa as C,ab as B,ac as D,q as J,ad as N,v as F,y as I}from"./shared-core-C8XTA4sN.js";import{o as E,A as O,t as L,H as M,r as A,v as H,J as G,K,I as Y,R as q,am as P,u as R,Z,c as Q,B as W,V as X,Y as ee,dv as le,O as te}from"./vendor-vue-iK2zA9mI.js";import{_ as ae,a as ie,b as se}from"./shared-common-KP-Ht8Vy.js";import"./cactbot-DRs0Yy4Y.js";const ne={class:"action-icon-wrapper"},oe=["src"],re={key:1,class:"action-icon-placeholder"},de=ae(E({__name:"ActionIcon",props:{id:{}},setup(e){const l=e,t=A("");return O([()=>l.id,z],([e])=>{t.value=$(e)},{immediate:!0}),(e,l)=>(L(),M("div",ne,[t.value?(L(),M("img",{key:0,src:t.value,class:"action-icon",alt:""},null,8,oe)):(L(),M("div",re))]))}}),[["__scopeId","data-v-8bcec3d8"]]),ce={class:"btn-text"},ue={class:"job-selector-content"},me=ae(E({__name:"JobSelector",props:{modelValue:{}},emits:["update:modelValue"],setup(n,{emit:o}){const r=n,d=o,{t:c,locale:u}=U(),m=Object.freeze(j.getBattleJobs()),k=Q(()=>{const e=C(u.value);return m.map(l=>{const t=j.jobToFullName(l);return{value:j.jobToJobEnum(l),label:t[e]??t.en}})}),p=Q(()=>r.modelValue&&0!==r.modelValue.length?r.modelValue.length===m.length?c("keySkillTimerSettings.col.allJobs"):c("keySkillTimerSettings.col.jobsCount",{count:r.modelValue.length}):c("keySkillTimerSettings.col.allJobs"));function S(e){d("update:modelValue",e)}return(o,r)=>{const d=a,c=t,u=l,m=e,f=s;return L(),H(f,{placement:"bottom",width:280,trigger:"click","popper-class":"job-selector-popper"},{reference:G(()=>[Y(c,{size:"small",class:"job-popover-btn"},{default:G(()=>[Y(d,null,{default:G(()=>[Y(R(i))]),_:1}),K("span",ce,Z(p.value),1)]),_:1})]),default:G(()=>[K("div",ue,[Y(m,{"model-value":n.modelValue,multiple:"",filterable:"",placeholder:"Select Jobs",size:"default",class:"full-width","collapse-tags":"","collapse-tags-tooltip":"","onUpdate:modelValue":S},{default:G(()=>[(L(!0),M(q,null,P(k.value,e=>(L(),H(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"])])]),_:1})}}}),[["__scopeId","data-v-a8044493"]]),ke={class:"settings-table-wrapper"},pe={class:"action-buttons"},Se={style:{display:"flex","align-items":"center",gap:"8px"}},fe={style:{color:"var(--el-text-color-secondary)","font-size":"12px"}},ye={class:"tts-header"},ge=ae(E({__name:"SettingsTable",emits:["delete","move"],setup(e,{emit:l}){const i=l,s=B(),f=Q(()=>s.keySkillsData.chinese);function y(e,l){if(e){l(D(e,50).map(e=>({value:e.id.toString(),label:e.name,id:e.id})))}else l([])}return(e,l)=>{const g=a,b=t,h=c,v=o,T=m,_=p,V=k,w=S,x=n;return L(),M("div",ke,[Y(x,{data:f.value,border:"",size:"small","row-key":e=>e.key,height:"100%",class:"custom-table","header-row-class-name":"table-header"},{default:G(()=>[Y(v,{label:e.$t("keySkillTimerSettings.col.action"),width:"90",fixed:"left",align:"center"},{default:G(({row:l,$index:t})=>[K("div",pe,[Y(b,{link:"",size:"small",disabled:0===t,onClick:e=>i("move",t,t-1)},{default:G(()=>[Y(g,null,{default:G(()=>[Y(R(r))]),_:1})]),_:1},8,["disabled","onClick"]),Y(b,{link:"",size:"small",disabled:t===f.value.length-1,onClick:e=>i("move",t,t+1)},{default:G(()=>[Y(g,null,{default:G(()=>[Y(R(d))]),_:1})]),_:1},8,["disabled","onClick"]),Y(h,{title:e.$t("keySkillTimerSettings.deleteConfirmTitle"),onConfirm:e=>i("delete",l.key)},{reference:G(()=>[Y(b,{link:"",size:"small",type:"danger"},{default:G(()=>[Y(g,null,{default:G(()=>[Y(R(u))]),_:1})]),_:1})]),_:1},8,["title","onConfirm"])])]),_:1},8,["label"]),Y(v,{label:e.$t("keySkillTimerSettings.col.preview"),width:"50",align:"center"},{default:G(({row:e})=>[(L(),H(de,{id:e.id,key:e.id},null,8,["id"]))]),_:1},8,["label"]),Y(v,{label:e.$t("keySkillTimerSettings.col.id"),"min-width":"200"},{default:G(({row:e})=>[Y(T,{modelValue:e.id,"onUpdate:modelValue":l=>e.id=l,"fetch-suggestions":y,placeholder:"...",size:"small",style:{width:"100%"},clearable:"","trigger-on-focus":!1},{default:G(({item:e})=>[K("div",Se,[(L(),H(de,{id:e.id,key:e.id,size:20},null,8,["id"])),K("span",null,Z(e.label),1),K("span",fe,"("+Z(e.value)+")",1)])]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),Y(v,{width:"130"},{header:G(()=>[K("div",ye,[l[1]||(l[1]=K("span",null,"TTS",-1)),Y(_,{modelValue:R(s).enableTts.chinese,"onUpdate:modelValue":l[0]||(l[0]=e=>R(s).enableTts.chinese=e),size:"small"},null,8,["modelValue"])])]),default:G(({row:e})=>[Y(V,{modelValue:e.tts,"onUpdate:modelValue":l=>e.tts=l,size:"small",disabled:!R(s).enableTts.chinese},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),Y(v,{label:e.$t("keySkillTimerSettings.col.duration"),"min-width":"180",align:"left"},{default:G(({row:e})=>[Y(V,{modelValue:e.duration,"onUpdate:modelValue":l=>e.duration=l,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),Y(v,{label:e.$t("keySkillTimerSettings.col.recast"),"min-width":"220",align:"left"},{default:G(({row:e})=>[Y(V,{modelValue:e.recast1000ms,"onUpdate:modelValue":l=>e.recast1000ms=l,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),Y(v,{label:e.$t("keySkillTimerSettings.col.job"),width:"100",align:"center"},{default:G(({row:e})=>[Y(me,{modelValue:e.job,"onUpdate:modelValue":l=>e.job=l},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),Y(v,{label:e.$t("keySkillTimerSettings.col.minLevel"),width:"110",align:"center"},{default:G(({row:e})=>[Y(w,{modelValue:e.minLevel,"onUpdate:modelValue":l=>e.minLevel=l,min:1,max:100,size:"small",controls:!1,class:"level-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),Y(v,{label:e.$t("keySkillTimerSettings.col.line"),width:"110",align:"center"},{default:G(({row:e})=>[Y(w,{modelValue:e.line,"onUpdate:modelValue":l=>e.line=l,min:1,max:10,size:"small",controls:!1,class:"line-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["data","row-key"])])}}}),[["__scopeId","data-v-9afbe668"]]),be={class:"page-container"},he={class:"header-toolbar"},ve={class:"left-tools"},Te={class:"preset-list",style:{height:"400px","overflow-y":"auto"}},_e={class:"preset-info"},Ve={class:"name"},we={class:"search-drawer-content",style:{height:"450px",padding:"12px"}},xe={class:"center-tools"},$e={class:"right-tools"},ze={class:"page-content"},Ue=ae(E({__name:"keySkillTimerSettings",setup(e){const{t:l}=U(),i=B(),r=A(!1);function d(){w.confirm(l("keySkillTimerSettings.resetConfirmMsg"),l("keySkillTimerSettings.confirmTitle"),{confirmButtonText:l("keySkillTimerSettings.confirmBtn"),cancelButtonText:l("keySkillTimerSettings.cancelBtn"),type:"warning"}).then(()=>{i.keySkillsData.chinese=[...N],x.success(l("keySkillTimerSettings.resetSuccessMsg"))}).catch(()=>{})}function c(e,t){i.keySkillsData.chinese.unshift({key:crypto.randomUUID(),id:e,tts:t||"",duration:0,recast1000ms:0,job:[],line:1,minLevel:1}),x.success(`${l("keySkillTimerSettings.addSkill")}: ${t||e}`)}function u(){const e=JSON.stringify(i.keySkillsData),t=le.compressToBase64(e);I(t).then(()=>x.success(l("keySkillTimerSettings.copySuccess"))).catch(()=>x.error(l("keySkillTimerSettings.copyFailed")))}function m(){w.prompt(l("keySkillTimerSettings.importPromptMsg"),l("keySkillTimerSettings.importTitle"),{confirmButtonText:l("keySkillTimerSettings.confirmBtn"),cancelButtonText:l("keySkillTimerSettings.cancelBtn"),inputType:"textarea",inputValidator:e=>{try{const t=le.decompressFromBase64(e),a=JSON.parse(t);return"object"==typeof a&&null!==a||l("keySkillTimerSettings.dataFormatError")}catch(t){const e=t instanceof Error?t.message:String(t);return`${l("keySkillTimerSettings.dataFormatError")}: ${e}`}}}).then(e=>{const{value:t}=e;if(t){const e=le.decompressFromBase64(t),a=JSON.parse(e);"object"==typeof a&&null!==a?(i.keySkillsData.chinese=a.chinese,x.success(l("keySkillTimerSettings.importSuccess"))):x.error(l("keySkillTimerSettings.importFormatError"))}}).catch(()=>{})}W(async()=>{try{await J()}catch(e){}finally{r.value=!0}});const p=A(""),S=te([]);let $;return O(p,e=>{$&&clearTimeout($),$=window.setTimeout(()=>{S.value=D(e)},300)}),(e,l)=>{const w=t,x=a,$=h,z=k,U=o,j=n,C=b,B=s,D=g,J=ie,I=se,E=ge,O=f;return X((L(),M("div",be,[K("div",he,[K("div",ve,[Y(B,{placement:"bottom-start",width:550,trigger:"click","popper-class":"skill-library-popover"},{reference:G(()=>[Y(w,{type:"primary",icon:R(T),loading:!r.value},{default:G(()=>[ee(Z(e.$t("keySkillTimerSettings.searchSkill")),1)]),_:1},8,["icon","loading"])]),default:G(()=>[Y(C,{type:"border-card",class:"search-tabs"},{default:G(()=>[Y($,{label:e.$t("keySkillTimerSettings.presets")},{default:G(()=>[K("div",Te,[(L(!0),M(q,null,P(R(N),l=>(L(),M("div",{key:l.key,class:"preset-item"},[K("div",_e,[Y(de,{id:l.id,size:24},null,8,["id"]),K("span",Ve,Z(R(F)(Number(l.id))||l.tts||e.$t("keySkillTimerSettings.unknownSkill")),1)]),Y(w,{link:"",type:"primary",onClick:e=>c(Number(l.id),R(F)(Number(l.id))||l.tts)},{default:G(()=>[Y(x,null,{default:G(()=>[Y(R(v))]),_:1})]),_:1},8,["onClick"])]))),128))])]),_:1},8,["label"]),Y($,{label:e.$t("keySkillTimerSettings.searchTab")},{default:G(()=>[K("div",we,[Y(z,{modelValue:p.value,"onUpdate:modelValue":l[0]||(l[0]=e=>p.value=e),clearable:"",placeholder:e.$t("keySkillTimerSettings.skillName"),"prefix-icon":R(T),style:{"margin-bottom":"12px"},size:"default"},null,8,["modelValue","placeholder","prefix-icon"]),Y(j,{data:S.value,style:{width:"100%"},height:"390px",size:"default"},{default:G(()=>[Y(U,{width:"40",align:"center"},{default:G(({row:e})=>[Y(de,{id:e.id,size:20},null,8,["id"])]),_:1}),Y(U,{prop:"id",label:e.$t("keySkillTimerSettings.col.shortId"),width:"80"},null,8,["label"]),Y(U,{prop:"name",label:e.$t("keySkillTimerSettings.skillName")},null,8,["label"]),Y(U,{width:"50",align:"center"},{default:G(({row:e})=>[Y(w,{link:"",type:"primary",onClick:l=>c(e.id,e.name)},{default:G(()=>[Y(x,null,{default:G(()=>[Y(R(v))]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1},8,["label"])]),_:1})]),_:1})]),K("div",xe,[Y(D,null,{default:G(()=>[Y(w,{icon:R(_),onClick:u},{default:G(()=>[ee(Z(e.$t("keySkillTimerSettings.export")),1)]),_:1},8,["icon"]),Y(w,{icon:R(V),onClick:m},{default:G(()=>[ee(Z(e.$t("keySkillTimerSettings.import")),1)]),_:1},8,["icon"])]),_:1}),Y(w,{type:"danger",icon:R(y),onClick:d},{default:G(()=>[ee(Z(e.$t("keySkillTimerSettings.restoreDefault")),1)]),_:1},8,["icon"])]),K("div",$e,[Y(J,{"storage-key":"key-skill-timer-2"}),Y(I,{teleported:!1})])]),K("main",ze,[Y(E,{onDelete:l[1]||(l[1]=e=>function(e){const l=i.keySkillsData.chinese,t=l.findIndex(l=>l.key===e);-1!==t&&l.splice(t,1)}(e)),onMove:l[2]||(l[2]=(e,l)=>function(e,l){const t=i.keySkillsData.chinese;if(l<0||l>=t.length||e===l)return;const a=t[e];a&&(t.splice(e,1),t.splice(l,0,a))}(e,l))})])])),[[O,!r.value,void 0,{fullscreen:!0,lock:!0}]])}}}),[["__scopeId","data-v-95579d14"]]);export{Ue as default};
