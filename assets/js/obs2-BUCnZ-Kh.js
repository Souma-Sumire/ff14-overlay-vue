var e=Object.defineProperty,t=(t,a,l)=>((t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l)(t,"symbol"!=typeof a?a+"":a,l);import"./index-CDlaAoCi.js";/* empty css                        *//* empty css                   *//* empty css                  *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                */import{aw as a,w as l,f as s,v as o,x as n,A as r,L as i,D as c,K as u,a9 as d,C as p,u as m,h,t as f,r as b,P as w,J as v,H as g,V as y,I as C}from"./vue-vendor-Bbuz3Kwb.js";import{u as _}from"./index-bbahPALZ.js";import{_ as V}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{t as R,u as S,A as P,N as D,f as T,F as E,j,H as x,R as U,S as k,T as N,y as A,h as O,z as L}from"./element-plus-QcyfhpSy.js";import{z as B}from"./zoneInfo-CpeDcA4t.js";import{j as z}from"./obs-CG5AdCID.js";import{d as F}from"./content_type-BMPUC1EI.js";import{N as I,c as G,l as q}from"./netregexes-BW5Clp4J.js";import{a as H,r as Q,c as W}from"./overlay_plugin_api-C1Kk3pZW.js";const M={class:"language-switcher"},Y={class:"select-wrapper"},Z=V({__name:"LanguageSwitcher",setup(e){const{locale:t,availableLocales:f}=a(),b={zhCn:"简体中文",en:"English",ja:"日本語"},w=_("user-locale",t.value);return l(w,(e=>{t.value=e})),s((()=>{t.value=w.value})),(e,t)=>{const a=R,l=S;return o(),n("div",M,[r("div",Y,[t[1]||(t[1]=r("svg",{class:"globe-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[r("circle",{cx:"12",cy:"12",r:"10"}),r("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),r("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})],-1)),i(l,{modelValue:m(w),"onUpdate:modelValue":t[0]||(t[0]=e=>h(w)?w.value=e:null),size:"small",class:"language-select"},{default:c((()=>[(o(!0),n(u,null,d(m(f),((e,t)=>(o(),p(a,{key:t,value:e,label:b[e]},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-66d37cfa"]]),K={class:"obs-container"},J={class:"card-header"},X={class:"act-not-ready-content"},$={key:1},ee={class:"card-header"},te={key:1},ae={class:"card-header"},le={class:"status-info"},se={class:"button-container"},oe={class:"card-header"},ne={class:"profile-info"},re={class:"file-path-explanation"},ie={class:"file-name-explanation"},ce={class:"card-header"},ue=V(f({__name:"obs2",setup(e){const{t:l}=a(),u=_("obs-user-config",{host:4455,password:"",path:"",fileName:""},localStorage,{writeDefaults:!0}),d=_("obs-user-content-setting",[]),h=_("obs-is-first-time",!0),f=b(!1),V=b(!1),R=b({});function S(){return new Promise((e=>{W({call:"cactbotRequestState"}).then((()=>{f.value=!0,e()})),setTimeout((()=>{f.value||S()}),3e3)}))}const M={inCombat:I.inCombat(),countdown:I.countdown(),wipe:G.wipe},Y=["Savage","Extreme","Chaotic","Ultimate","Dungeons","Raids","Trials","VCDungeonFinder","DeepDungeons","Guildhests","DisciplesOfTheLand","Eureka","GrandCompany","QuestBattles","TreasureHunt","Pvp","Default"],ue={enter:!1,countdown:!0,combatStart:!0,combatEnd:!0,wipe:!0},de={enter:!1,countdown:!1,combatStart:!1,combatEnd:!1,wipe:!1};const pe=new class{constructor(){t(this,"ws"),t(this,"status"),t(this,"handleConnectionError",(()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath=""})),t(this,"handleConnectionClosed",(()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath=""})),this.ws=new z,this.status=y({connecting:!1,connected:!1,recording:!1,outputActive:!1,outputPath:""}),this.ws.on("ConnectionClosed",this.handleConnectionClosed),this.ws.on("ConnectionError",this.handleConnectionError),this.ws.on("RecordStateChanged",(e=>{this.status.connected=!0,this.status.recording="OBS_WEBSOCKET_OUTPUT_STARTED"===e.outputState,this.status.outputActive=e.outputActive,this.status.outputPath=e.outputPath}))}connect(e){u.value.host&&u.value.password&&(this.status.connecting||(this.status.connecting=!0,this.ws.connect(`ws://127.0.0.1:${u.value.host}`,u.value.password).then((()=>{this.ws.call("GetRecordStatus").then((e=>{this.status.recording=e.outputActive,this.status.outputActive=e.outputActive})),this.status.connected=!0,e&&e()})).finally((()=>{this.status.connecting=!1,!u.value.path&&this.status.connected&&this.ws.call("GetRecordDirectory").then((e=>{e.recordDirectory&&(u.value.path=e.recordDirectory)})),u.value.fileName||(u.value.fileName="%CCYY-%MM-%DD %hh-%mm-%ss")}))))}disconnect(){this.ws.disconnect()}async startRecord(){await this.setProfileParameter(),this.ws.call("StartRecord")}stopRecord(){this.ws.call("StopRecord")}splitRecord(){this.ws.call("StopRecord").finally((()=>{setTimeout((()=>{this.ws.call("StartRecord")}),1e3)}))}async setProfileParameter(){const e=u.value.path,t=u.value.fileName,a=[];return a.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"AdvOut",parameterName:"RecFilePath",parameterValue:e}}),a.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"Output",parameterName:"FilenameFormatting",parameterValue:t}}),u.value.path=e,u.value.fileName=t,this.ws.callBatch(a)}},me=e=>{const t=e.zoneID,a=B[t];R.value=a,fe("enter")},he=e=>{const t=e.rawLine;for(const a in M){if(M[a].exec(t)){const e=t.split("|");switch(a){case"inCombat":{const t="1"===e[q.InCombat.fields.inACTCombat],a="1"===e[q.InCombat.fields.inGameCombat];if(t&&a)return void fe("combatStart");if(!t&&!a)return void fe("combatEnd");break}case"countdown":fe("countdown");break;case"wipe":fe("wipe")}}}};function fe(e){const t=function(e){var t,a;switch(e.contentType){case F.ChaoticAllianceRaid:return"Chaotic";case F.UltimateRaids:return"Ultimate";case F.Pvp:return"Pvp";case F.Dungeons:return"Dungeons";case F.DeepDungeons:return"DeepDungeons";case F.VCDungeonFinder:return"VCDungeonFinder";case F.Trials:return(null==(t=e.name.fr)?void 0:t.includes("(extrême)"))?"Extreme":"Trials";case F.Raids:return(null==(a=e.name.en)?void 0:a.includes("(Savage)"))?"Savage":"Raids";case F.DisciplesOfTheLand:return"DisciplesOfTheLand";case F.Eureka:return"Eureka";case F.GrandCompany:return"GrandCompany";case F.QuestBattles:return"QuestBattles";case F.TreasureHunt:return"TreasureHunt";default:return"Default"}}(R.value);if(d.value.find((a=>a.type===t&&a[e])))switch(e){case"enter":case"countdown":case"combatStart":return pe.status.connected?!1===pe.status.recording?void pe.startRecord():void(!0===pe.status.recording&&"combatStart"!==e&&pe.splitRecord()):void pe.connect((()=>{pe.startRecord()}));case"combatEnd":case"wipe":pe.status.recording&&pe.stopRecord()}else"enter"===e&&pe.status.recording&&pe.stopRecord()}return s((async()=>{await S(),pe.connect(),H("ChangeZone",me),H("LogLine",he),function(){const e=["Savage","Extreme","Ultimate","Chaotic","Default"];if(h.value)h.value=!1,d.value=[...e.map((e=>({type:e,...ue}))),...Y.filter((t=>!e.includes(t))).map((e=>({type:e,...de})))];else{d.value=d.value.filter((e=>Y.includes(e.type)));const t=Y.filter((e=>!d.value.some((t=>t.type===e))&&"Default"!==e)).map((t=>e.includes(t)?{type:t,...ue}:{type:t,...de}));d.value.push(...t)}d.value.sort(((e,t)=>Y.indexOf(e.type)-Y.indexOf(t.type)))}()})),w((()=>{pe.disconnect(),Q("ChangeZone",me),Q("LogLine",he)})),(e,t)=>{const a=Z,s=P,h=T,b=E,w=j,y=x,_=U,R=D,S=k,B=N,z=A,F=O,I=L;return o(),n("div",K,[r("header",null,[r("h1",null,v(m(l)("OBS Auto Record V2")),1),i(a)]),m(f)?g("",!0):(o(),p(s,{key:0,class:"act-not-ready-card"},{header:c((()=>[r("div",J,[r("span",null,v(m(l)("ACT Not Ready")),1)])])),default:c((()=>[r("div",X,[r("p",null,v(m(l)("overlayTutorial")),1)])])),_:1})),m(f)?(o(),n("main",$,[m(pe).status.connected?(o(),n("div",te,[i(R,{class:"instruction-alert",type:"info",description:m(l)("hideTutorial"),closable:!1,"show-icon":""},null,8,["description"]),m(V)?(o(),p(s,{key:0,class:"status-card"},{header:c((()=>[r("div",ae,[r("span",null,v(m(l)("Connection Status")),1),i(w,{type:"danger",size:"small",class:"disconnect-button",onClick:t[3]||(t[3]=e=>m(pe).disconnect())},{default:c((()=>[C(v(m(l)("Disconnect")),1)])),_:1})])])),default:c((()=>[r("div",le,[i(B,{direction:"vertical",column:1,border:""},{default:c((()=>[i(S,{label:m(l)("Recording")},{default:c((()=>[C(v(m(pe).status.recording?m(l)("Yes"):m(l)("No")),1)])),_:1},8,["label"]),i(S,{label:m(l)("Output Path")},{default:c((()=>[C(v(m(pe).status.outputPath||m(l)("None")),1)])),_:1},8,["label"])])),_:1})]),r("div",se,[i(w,{disabled:!m(pe).status.connected||m(pe).status.recording,type:"primary",onClick:t[4]||(t[4]=e=>m(pe).startRecord())},{default:c((()=>[C(v(m(l)("Start Record")),1)])),_:1},8,["disabled"]),i(w,{disabled:!m(pe).status.connected||!m(pe).status.recording,type:"danger",onClick:t[5]||(t[5]=e=>m(pe).stopRecord())},{default:c((()=>[C(v(m(l)("Stop Record")),1)])),_:1},8,["disabled"]),i(w,{disabled:!m(pe).status.connected||!m(pe).status.recording,type:"warning",onClick:t[6]||(t[6]=e=>m(pe).splitRecord())},{default:c((()=>[C(v(m(l)("Split Record")),1)])),_:1},8,["disabled"]),i(w,{type:"primary",onClick:t[7]||(t[7]=e=>m(pe).setProfileParameter())},{default:c((()=>[C(v(m(l)("Set Recording Name")),1)])),_:1})])])),_:1})):g("",!0),i(s,{class:"profile-card"},{header:c((()=>[r("div",oe,[r("span",null,v(m(l)("Recording Profile")),1)])])),default:c((()=>[r("div",ne,[i(y,{"label-position":"top",class:"content-form"},{default:c((()=>[i(b,{label:m(l)("Record Path")},{default:c((()=>[i(h,{modelValue:m(u).path,"onUpdate:modelValue":t[8]||(t[8]=e=>m(u).path=e),placeholder:m(l)("recordPathPlaceholder")},null,8,["modelValue","placeholder"]),r("div",re,v(m(l)("filePathExplanation")),1)])),_:1},8,["label"]),i(b,{label:m(l)("Record File Name")},{default:c((()=>[i(h,{modelValue:m(u).fileName,"onUpdate:modelValue":t[9]||(t[9]=e=>m(u).fileName=e),placeholder:m(l)("recordFileNamePlaceholder")},null,8,["modelValue","placeholder"]),r("div",ie,v(m(l)("fileNameExplanation")),1)])),_:1},8,["label"])])),_:1})])])),_:1}),i(s,{class:"table-card"},{header:c((()=>[r("div",ce,[r("span",null,v(m(l)("User Content Settings")),1)])])),default:c((()=>[i(I,{data:m(d),style:{width:"100%"},border:!0,stripe:""},{default:c((()=>[i(z,{prop:"type",label:m(l)("Type"),"min-width":"130",fixed:""},{default:c((e=>[r("span",null,v(m(l)(e.row.type)),1)])),_:1},8,["label"]),i(z,{label:m(l)("Start When"),align:"center"},{default:c((()=>[i(z,{prop:"enter",label:m(l)("Enter Zone"),align:"center","min-width":"95"},{default:c((e=>[i(F,{modelValue:e.row.enter,"onUpdate:modelValue":t=>e.row.enter=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),i(z,{prop:"countdown",label:m(l)("CountDown"),align:"center","min-width":"95"},{default:c((e=>[i(F,{modelValue:e.row.countdown,"onUpdate:modelValue":t=>e.row.countdown=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),i(z,{prop:"combatStart",label:m(l)("CombatStart"),align:"center","min-width":"95"},{default:c((e=>[i(F,{modelValue:e.row.combatStart,"onUpdate:modelValue":t=>e.row.combatStart=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"])])),_:1},8,["label"]),i(z,{label:m(l)("End When"),align:"center"},{default:c((()=>[i(z,{prop:"combatEnd",label:m(l)("CombatEnd"),align:"center","min-width":"95"},{default:c((e=>[i(F,{modelValue:e.row.combatEnd,"onUpdate:modelValue":t=>e.row.combatEnd=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),i(z,{prop:"wipe",label:m(l)("Wipe"),align:"center","min-width":"95"},{default:c((e=>[i(F,{modelValue:e.row.wipe,"onUpdate:modelValue":t=>e.row.wipe=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"])])),_:1},8,["label"])])),_:1},8,["data"])])),_:1})])):(o(),p(s,{key:0,class:"connection-card"},{header:c((()=>[r("div",ee,[r("span",null,v(m(l)("Connect to OBS")),1)])])),default:c((()=>[i(y,{"label-position":"top",class:"connection-form"},{default:c((()=>[i(b,{label:m(l)("Port")},{default:c((()=>[i(h,{modelValue:m(u).host,"onUpdate:modelValue":t[0]||(t[0]=e=>m(u).host=e),placeholder:m(l)("portPlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),i(b,{label:m(l)("Password")},{default:c((()=>[i(h,{modelValue:m(u).password,"onUpdate:modelValue":t[1]||(t[1]=e=>m(u).password=e),placeholder:m(l)("passwordPlaceholder"),type:"password"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),i(b,null,{default:c((()=>[i(w,{type:"primary",class:"connect-button",loading:m(pe).status.connecting,disabled:m(pe).status.connecting||!m(u).host||!m(u).password,onClick:t[2]||(t[2]=e=>m(pe).connect())},{default:c((()=>[C(v(m(pe).status.connecting?m(l)("Connecting"):m(l)("Connect")),1)])),_:1},8,["loading","disabled"])])),_:1})])),_:1}),i(_,null,{default:c((()=>[C(v(m(l)("Instructions")),1)])),_:1}),i(R,{class:"instruction-alert",type:"info",description:m(l)("obsTutorial"),closable:!1,"show-icon":""},null,8,["description"]),i(R,{class:"instruction-alert",type:"info",description:m(l)("inputTutorial"),closable:!1,"show-icon":""},null,8,["description"]),i(R,{class:"instruction-alert",type:"info",description:m(l)("firewallTutorial"),closable:!1,"show-icon":""},null,8,["description"])])),_:1}))])):g("",!0)])}}}),[["__scopeId","data-v-162d151a"]]);export{ue as default};
