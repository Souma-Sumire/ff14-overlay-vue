var o=Object.defineProperty,n=(n,e,i)=>((n,e,i)=>e in n?o(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i)(n,"symbol"!=typeof e?e+"":e,i);import{au as e,t as i,V as t,v as s,x as l,K as a,a9 as r,S as c,H as m,E as u,M as d,F as p,A as g,J as v}from"./vue-vendor-Bbuz3Kwb.js";import{U as h}from"./util-DL4pAhxD.js";/* empty css                    */import{b}from"./element-plus-QcyfhpSy.js";import{a as f,b as w}from"./xivapi-BtnvNd5O.js";import{_ as j}from"./_plugin-vue_export-helper-BCo6x5W8.js";var A=(o=>(o["显示范围"]="displayDuration",o["变色时间"]="discoloration",o["零后持续"]="hold",o["战前准备"]="preBattle",o["TTS提前量"]="ttsAdvance",o))(A||{});class y{constructor(o,e,i,t){n(this,"name"),n(this,"condition"),n(this,"timeline"),n(this,"codeFight"),n(this,"create"),h.iconToJobEnum(e.jobs[0])&&(e.jobs[0]=h.jobEnumToJob(h.iconToJobEnum(e.jobs[0]))),this.name=o,this.condition=e,this.timeline=i,this.codeFight=t,this.create=(new Date).toLocaleString()}}const T={[A.显示范围]:"显示范围（秒）",[A.变色时间]:"提前变色（秒）",[A.零后持续]:"后续保持（秒）",[A.战前准备]:"倒计时量（秒）",[A.TTS提前量]:"TTS预备（秒）"},O={[A.显示范围]:120,[A.变色时间]:2.75,[A.零后持续]:.5,[A.战前准备]:30,[A.TTS提前量]:1},E={"--timeline-width":"时间轴宽度","--font-size":"字体大小","--normal-scale":"等待缩放","--up-coming-scale":"来临缩放","--opacity":"等待不透明度","--tras-duration":"动画时间"},M={"--timeline-width":200,"--font-size":16,"--opacity":.5,"--normal-scale":.66,"--up-coming-scale":1,"--tras-duration":1},Y=e("timeline",{state:()=>({allTimelines:[],configValues:O,configTranslate:T,settings:{api:""},filters:{},showStyle:M,showStyleTranslate:E,jobList:[...h.getBattleJobs3(),"NONE"]}),getters:{},actions:{newTimeline(o="Demo",n={zoneId:"0",jobs:["NONE"]},e='# 注释的内容不会被解析\n# "<技能名>"会被解析为图片 紧接着一个波浪线可快捷重复技能名\n-20 "<中间学派>~刷盾"\n0 "战斗开始" tts "冲呀"\n# 当sync在window的范围内被满足时将进行时间同步\n30 "一运" sync / 14:4.{7}:[^:]*:AAAA:/ window 2.5,2.5\n# 当存在jump时会进跳转至jump时间\n50 "变异化型:蛇" sync / 14:4.{7}:[^:]*:BBBB:/ window 2.5,2.5 jump 1000\n50 "变异化型:兽" sync / 14:4.{7}:[^:]*:CCCC:/ window 2.5,2.5 jump 2000\n1000 "蛇轴"\n2000 "兽轴"\n',i="用户创建"){this.allTimelines.push(new y(o,n,e,i)),this.sortTimelines(),b.success("新建时间轴成功");return this.allTimelines.findIndex((t=>t.timeline===e&&t.name===o&&JSON.stringify(t.condition)===JSON.stringify(n)&&t.codeFight===i))},getTimeline(o){return this.allTimelines.filter((n=>("0"===n.condition.zoneId||n.condition.zoneId===o.zoneId)&&(n.condition.jobs.includes("NONE")||n.condition.jobs.includes(o.jobs[0]))))},saveTimelineSettings(){localStorage.setItem("timelines",JSON.stringify({allTimelines:this.allTimelines,configValues:this.configValues,settings:this.settings,showStyle:this.showStyle,filters:this.filters}))},loadTimelineSettings(){const o=localStorage.getItem("timelines");o&&(Object.assign(this,JSON.parse(o)),this.sortTimelines());for(const n of this.allTimelines)void 0===n.condition.jobs&&(n.condition.jobs=[n.condition.job]),n.condition.jobs.sort(((o,n)=>this.jobList.indexOf(o)-this.jobList.indexOf(n))),h.iconToJobEnum(n.condition.jobs[0])&&(n.condition.jobs[0]=h.jobEnumToJob(h.iconToJobEnum(n.condition.jobs[0])))},sortTimelines(){for(const o of this.allTimelines)void 0===o.condition.jobs&&(o.condition.jobs=[o.condition.job]),o.condition.jobs.sort(((o,n)=>this.jobList.indexOf(o)-this.jobList.indexOf(n))),Reflect.deleteProperty(o.condition,"job");this.allTimelines.sort(((o,n)=>{const e=Number(o.condition.zoneId)-Number(n.condition.zoneId);if(0!==e)return e;const i=o.name.localeCompare(n.name);if(0!==i)return i;const t=h.jobToJobEnum(o.condition.jobs[0])-h.jobToJobEnum(n.condition.jobs[0]);return 0!==t?t:o.create.localeCompare(n.create)}))},updateFilters(o,n){this.filters[o]=n}}});function N(o){var n,e,i;const t=o.match(/^(?<negative>-)?(?<mm>[^:：]+):(?<ss>[^:：]+)$/);return t?60*Number.parseFloat((null==(n=t.groups)?void 0:n.mm)??"0")+Number.parseFloat((null==(e=t.groups)?void 0:e.ss)??"0")*((null==(i=t.groups)?void 0:i.negative)?-1:1):Number.parseFloat(o)}function S(o){return o.matchAll(/<(?<name>[^<>]*?)!?>(?<repeat>~)?/g)}async function I(o){var n,e,i,t,s,l,a,r,c,m,u,d;const p=[],g=[...o.matchAll(/^\s*(?<time>[-:：\d.]+)\s+(?<action>(?:--|["'“”])[^"'\n]+?(?:--|["'“”])).*$/gm)];for(let v=0;v<g.length;v++){const o=g[v],h=null==(n=o[0].match(new RegExp("(?<=jump ?)[-:：\\d.]+")))?void 0:n[0],b=null==(e=o[0].match(new RegExp("(?<=sync(?:\\.once)? ?\\/).+(?=\\/)")))?void 0:e[0],f=/sync\.once/.test(o[0]),w=null==(i=o[0].match(new RegExp("(?<=window ?)[-:：\\d.]+")))?void 0:i[0],j=null==(t=o[0].match(new RegExp("(?<=window ?[-:：\\d.]+,)[-:：\\d.]+")))?void 0:t[0],A=null==(l=null==(s=o[0].match(/ tts ?["'“”](?<tts>[^"'“”]+)["'“”]/))?void 0:s.groups)?void 0:l.tts,y=/ tts(?: |$)/.test(o[0])?null==(m=null==(c=null==(r=Array.from(S((null==(a=o.groups)?void 0:a.action)??"")))?void 0:r[0])?void 0:c.groups)?void 0:m.name:void 0;p.push({time:N((null==(u=o.groups)?void 0:u.time)??"0"),action:(null==(d=o.groups)?void 0:d.action)||"",alertAlready:!1,sync:b?new RegExp(b):void 0,syncOnce:f,syncAlready:!1,show:!b,windowBefore:Number.parseFloat(w||j||"2.5"),windowAfter:Number.parseFloat(j||w||"2.5"),jump:h?Number.parseFloat(h):void 0,tts:A||y})}return p.sort(((o,n)=>o.time-n.time)),p}const J=["innerHTML"],R={class:"countdown"},x="data:image/png;base64,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",F=j(i({__name:"TimelineShow",props:{config:{},lines:{},runtime:{},showStyle:{}},setup(o){const n=o,e=t({});function i(o){var n,e,i,t;let s=o.replaceAll(/^["'“”]|["'“”]$/g,"");const l=S(s);if(!l)return s;for(const a of l)if(null==(n=a.groups)?void 0:n.name){const o=h(null==(e=a.groups)?void 0:e.name);s=s.replace(a[0],`${o?`<div class="skill_icon"><img src="${o}" style="background-image: url('${x}')" loading="auto"/></div>`:""}<span>${(null==(i=a.groups)?void 0:i.repeat)?null==(t=a.groups)?void 0:t.name:""}</span>`)}return s}function h(o){return"string"==typeof e[o]?e[o]:(void 0===e[o]&&(e[o]=f(o).then((n=>{(null==n?void 0:n.Icon)&&w(n.Icon).then((n=>{(function(o){return new Promise(((n,e)=>{const i=new Image;i.onload=()=>n(),i.onerror=()=>e(new Error("Failed to load image")),i.src=o}))})(n).then((()=>{e[o]=n})).catch((()=>{e[o]=x}))}))}))),x)}return(o,e)=>o.lines.length?(s(),l("ul",{key:0,class:"loadedTimelines",style:c(o.showStyle)},[(s(!0),l(a,null,r(n.lines,((n,e)=>u((s(),l("li",{key:e,class:p({upcoming:n.time-o.runtime<=o.config.discoloration,fade:n.time-o.runtime<=0-o.config.hold,passed:n.time-o.runtime<=0})},[g("aside",{style:c({right:100*Math.max((n.time-o.runtime)/o.config.displayDuration,0)+"%"})},null,4),g("section",null,[g("span",{innerHTML:i(n.action)},null,8,J),g("span",R,v((n.time-o.runtime).toFixed(1)),1)])],2)),[[d,n.show&&n.time-o.runtime>0-o.config.hold-o.showStyle["--tras-duration"]&&n.time-o.runtime<=o.config.displayDuration]]))),128))],4)):m("",!0)}}),[["__scopeId","data-v-b34a30f2"]]);export{F as _,I as p,Y as u};
