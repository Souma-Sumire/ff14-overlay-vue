import{_ as a}from"./DragJob-C98HUPLo.js";import{t as e,r as t,f as n,ae as o,v as r,x as l,E as s,L as i,A as u,G as p,M as m,u as c,D as d,h as f,K as y,a9 as v,S as b,C as h,J as j,ab as g}from"./vue-vendor-Bz5Jh0Fv.js";import{a as _}from"./index-DKBdsBqj.js";import"./style-l0sNRNKZ.js";import{U as x,j as k}from"./util-DL4pAhxD.js";import{a as w,c as P}from"./overlay_plugin_api-DU1DlPio.js";/* empty css                */import{u as C}from"./index-BQ4hghqY.js";import{_ as J}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./element-plus-im0ZkkqX.js";const T={class:"text-white text-shadow-sm text-shadow-color-black"},D={class:"players"},O={class:"name"},R={key:0,style:{position:"fixed",bottom:"0"}},V=J(e({__name:"cactbotRuntime",setup(e){function J(a,e,t=0){return Array.from({length:e},(()=>a)).map(((a,e)=>a+(+e+1+t)))}_.setTheme("dark");const V=t(!1),S=C("cactbotRuntime-sortArr",k),U=[{id:"10000001",name:"虚构战士",job:21,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构武士",job:34,inParty:!0},{id:"10000008",name:"虚构诗人",job:23,inParty:!0},{id:"10000007",name:"虚构召唤",job:27,inParty:!0}],E=C("cactbotRuntime-data",{party:[]}),M=C("cactbotRuntime-showTips",t(!0)),A=C("cactbotRuntime-roleSelectLength",{tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0}),L={tank:["MT","ST",...J("T",6,2)],healer:[...J("H",8)],dps:[...J("D",8)],crafter:[...J("C",8)],gatherer:[...J("G",8)],none:[...J("N",8)]};function G(a){const e=I(a);return L[e].filter(((a,t)=>t<A.value[e]))}const N=location.href.includes("localhost"),z=t(!1),F=t(N?U[2].name:"");function I(a){return[1,3,19,21,32,37].includes(a)?"tank":[6,24,28,33,40].includes(a)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39,41,42].includes(a)?"dps":x.isCraftingJob(x.jobEnumToJob(a))?"crafter":x.isGatheringJob(x.jobEnumToJob(a))?"gatherer":"none"}function q(a){return L[I(a.job)].find((a=>!E.value.party.find((e=>e.rp===a))))??"unknown"}function B(){const a=[...L.tank,...L.healer,...L.dps,...L.crafter,...L.gatherer,...L.none];E.value.party.sort(((e,t)=>a.indexOf(e.rp??"unknown")-a.indexOf(t.rp??"unknown"))),P({call:"broadcast",source:"soumaRuntimeJS",msg:{party:E.value.party}})}function H(){z.value=!0}function K(){z.value=!1}function W(a){S.value=a,Q()}function Q(){!function(){E.value.party.sort(((a,e)=>S.value.indexOf(a.job)-S.value.indexOf(e.job)));for(const a of E.value.party)a.rp=void 0;for(const a of E.value.party)a.rp=q(a)}(),function(){for(const a in A.value)Object.prototype.hasOwnProperty.call(A.value,a)&&(A.value[a]=E.value.party.reduce(((e,t)=>I(t.job)===a?e+1:e),0))}(),B()}function X(){const a={party:U};M.value&&(V.value=!0),E.value.party=a.party.filter((a=>a.inParty)).map((a=>({...a,rp:"unknown"}))),Q()}return n((()=>{B(),w("PartyChanged",(a=>{M.value&&(V.value=!0),N&&0===a.party.length||(E.value.party=a.party.filter((a=>a.inParty)).map((a=>({...a,rp:"unknown"}))),Q())})),w("ChangePrimaryPlayer",(a=>{N||(F.value=a.charName)})),w("BroadcastMessage",(a=>{"soumaUserJS"===a.source&&"object"==typeof a.msg&&null!==a.msg&&"requestData"===Reflect.get(a.msg,"text")&&B()}))})),(e,t)=>{const n=o("vxe-modal"),_=o("vxe-option"),k=o("vxe-select"),w=a;return l(),r("div",{onMouseenter:H,onMouseleave:K},[s(u("span",T,"...",512),[[m,c(E).party.length<=1]]),i(n,{modelValue:c(V),"onUpdate:modelValue":t[0]||(t[0]=a=>f(V)?V.value=a:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:t[1]||(t[1]=a=>{V.value=!1,M.value=!1})},{title:d((()=>t[3]||(t[3]=[u("span",null,"用法",-1)]))),default:d((()=>t[4]||(t[4]=[u("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1),u("ul",null,[u("li",null,"临时：下拉选择框修改。"),u("li",null,"长期：用鼠标拖动职能顺序。")],-1)]))),_:1},8,["modelValue"]),u("main",{style:b({width:c(z)?+(c(E).party.find((a=>36===a.job))?1:0)+18+"em":"4em"})},[u("div",D,[i(g,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:d((()=>[(l(!0),r(y,null,v(c(E).party,((a,e)=>{return s((l(),r("section",{key:a.id,flex:"~ nowrap",style:b({opacity:c(z)?1:.5}),class:"player"},[i(k,{modelValue:a.rp,"onUpdate:modelValue":e=>a.rp=e,size:"mini","class-name":"select",onChange:a=>function(a){const e=E.value.party.find((e=>e.rp===E.value.party[a].rp&&e.id!==E.value.party[a].id));e&&(e.rp=q(e)),B()}(e)},{default:d((()=>[(l(!0),r(y,null,v(G(a.job),((a,e)=>(l(),h(_,{key:e,value:a,label:a},null,8,["value","label"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),u("span",O,j((t=a.job,x.nameToFullName(x.jobEnumToJob(t)).simple1))+" "+j(c(z)?a.name:""),1)],4)),[[m,c(E).party.length>1&&(c(z)||a.name===c(F))]]);var t})),128))])),_:1})]),s(i(w,{party:c(E).party,"m-b-1":"","p-1":"",onUpdateSortArr:W},null,8,["party"]),[[m,c(z)]])],4),c(N)?(l(),r("div",R,[u("button",{onClick:t[2]||(t[2]=a=>{c(E).party=c(E).party.filter((a=>a.name===c(F))),Q()})}," 测试单人 "),u("button",{onClick:X}," 测试组队 ")])):p("",!0)],32)}}}),[["__scopeId","data-v-c3639ba5"]]);export{V as default};
