import{c as e}from"./overlay_plugin_api-DHbPkDtN.js";import{j as o}from"./element-plus-BPeHK5i2.js";import{r as t,f as n,w as l}from"./vue-vendor-Bp7_Yb1I.js";function s(s={allowClose:!1,addWsParam:!0}){const a=t(void 0),r=t(!1),c=t("overlay");let i=null;function u(){Promise.race([e({call:"cactbotRequestState"}),new Promise((e,o)=>{setTimeout(()=>{o(new Error("Timeout"))},1e3)})]).then(()=>{i&&clearTimeout(i),window.location.href.includes("OVERLAY_WS")&&(a.value=!0,c.value="websocket")}).catch(()=>{a.value=!1,c.value="overlay"})}return window.location.href.includes("OVERLAY_WS")&&(i=setInterval(()=>{u()},3e3)),n(()=>{!function(){const e=window.navigator.userAgent,o=e.includes("MSIE "),t=e.includes("Trident/");return o||t}()?(l(a,e=>{e?o.close():r.value||o.alert("请按照下图设置<img src='/ff14-overlay-vue/assets/actWS-Dxp7wU0T.webp' style='width:100%'>",s.allowClose?"未连接到 ACT":"未连接到 ACT，无法使用",{dangerouslyUseHTMLString:!0,closeOnClickModal:!1,showClose:!1,closeOnPressEscape:!1,closeOnHashChange:!1,showCancelButton:s.allowClose,showConfirmButton:!1,cancelButtonText:"用不了也要看",buttonSize:"small"}).catch(()=>{r.value=!0})}),!window.location.href.includes("OVERLAY_WS")&&s.addWsParam&&function(){const e=window.location.href,[o,t=""]=e.split("#"),[n,l=""]=t.split("?"),s=new URLSearchParams(l);let a="";s.forEach((e,o)=>{"OVERLAY_WS"!==o&&(a+=`${o}=${encodeURIComponent(e)}&`)}),a+="OVERLAY_WS=ws://127.0.0.1:10501/ws";let r=o;n&&(r+=`#${n}`,a&&(r+=`?${a}`)),window.location.href=r,location.reload()}(),u()):o.alert("不支持 IE 浏览器，请使用 Chrome、Firefox、Edge 等现代浏览器访问。","提示",{type:"error",showConfirmButton:!1,showClose:!1})}),{wsConnected:a,useType:c}}export{s as u};
