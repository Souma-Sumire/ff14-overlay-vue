import{_ as e}from"./ActWrapper-41baf87f.js";import{u as a,_ as t}from"./DragJob-aecceb23.js";import"./index-b29e6689.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                   */import{u as n,e as r,a as o}from"./index-c9f4301b.js";import{u as l}from"./useDev-cab88d81.js";import{U as s}from"./util-3591e9ca.js";import{a as u,c as i}from"./overlay_plugin_api-974cdd44.js";/* empty css                */import{L as p,q as m,n as c}from"./element-plus-cb4c922a.js";import{t as d,r as y,e as f,D as v,E as b,x as j,A as h,M as g,v as k,H as P,u as _,h as x,K as w,L as C,aa as J,G as D}from"./vue-vendor-6f37fd53.js";import{_ as T}from"./_plugin-vue_export-helper-6a8c15be.js";/* empty css                */import"./useDemo-dea69d31.js";/* empty css                    */const V={class:"cactbot-runtime"},E={key:0,class:"you"},L={key:1,class:"players"},O={class:"job-name"},R={key:0,class:"player-name"},U={key:0,style:{position:"fixed",bottom:"0"}},S=T(d({__name:"cactbotRuntime",setup(d){const T=a(),S=y(!1);function A(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const G=y(!1),K=[{id:"10000001",name:"虚构暗骑",job:32,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构龙骑",job:22,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0},{id:"10000007",name:"虚构画家",job:42,inParty:!0}],M=n("cactbotRuntime-data",{party:[]}),N=n("cactbotRuntime-showTips",y(!0)),q=n("cactbotRuntime-roleSelectLength",{tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0}),z={tank:["MT","ST",...A("T",6,2)],healer:[...A("H",8)],dps:[...A("D",8)],crafter:[...A("C",8)],gatherer:[...A("G",8)],none:[...A("N",8)]};function H(e){const a=F(e);return z[a].filter((e,t)=>t<q.value[a])}const I=l(),B=y(I.value?K[2].name:"");function F(e){return[1,3,19,21,32,37].includes(e)?"tank":[6,24,28,33,40].includes(e)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39,41,42].includes(e)?"dps":s.isCraftingJob(s.jobEnumToJob(e))?"crafter":s.isGatheringJob(s.jobEnumToJob(e))?"gatherer":"none"}function Q(e){return z[F(e.job)].find(e=>!M.value.party.find(a=>a.rp===e))??"unknown"}function W(){const e=[...z.tank,...z.healer,...z.dps,...z.crafter,...z.gatherer,...z.none];M.value.party.sort((a,t)=>e.indexOf(a.rp??"unknown")-e.indexOf(t.rp??"unknown")),i({call:"broadcast",source:"soumaRuntimeJS",msg:{party:M.value.party}})}function X(){!function(){M.value.party.sort((e,a)=>T.arr.indexOf(e.job)-T.arr.indexOf(a.job));for(const e of M.value.party)e.rp=void 0;for(const e of M.value.party)e.rp=Q(e)}(),function(){for(const e in q.value)Object.prototype.hasOwnProperty.call(q.value,e)&&(q.value[e]=M.value.party.reduce((a,t)=>F(t.job)===e?a+1:a,0))}(),W()}function Y(){const e={party:K};N.value&&(G.value=!0),M.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),X()}return f(()=>{const e=r({storageKey:"cactbot-runtime-theme"}),a=o(e);!1===e.value&&a(),document.body.addEventListener("mouseenter",()=>S.value=!0),document.body.addEventListener("mouseleave",()=>S.value=!1),W(),u("PartyChanged",e=>{N.value&&(G.value=!0),I.value&&0===e.party.length||(M.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),X())}),u("ChangePrimaryPlayer",e=>{I.value||(B.value=e.charName)}),u("BroadcastMessage",e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&W()})}),(a,n)=>{const r=p,o=m,l=c,u=t,i=e;return j(),v(i,null,{default:b(()=>[h("div",V,[g(r,{modelValue:_(G),"onUpdate:modelValue":n[0]||(n[0]=e=>x(G)?G.value=e:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:n[1]||(n[1]=e=>{G.value=!1,N.value=!1})},{header:b(()=>n[3]||(n[3]=[h("span",null,"用法",-1)])),default:b(()=>n[4]||(n[4]=[h("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1),h("ul",null,[h("li",null,"临时：下拉选择框修改。"),h("li",null,"长期：用鼠标拖动职能顺序。")],-1)])),_:1},8,["modelValue"]),h("main",null,[_(S)?(j(),k("div",L,[(j(!0),k(C,null,J(_(M).party,(e,a)=>{return j(),k("section",{key:e.id,class:D(["player",{"is-you":e.name===_(B)}])},[g(l,{modelValue:e.rp,"onUpdate:modelValue":a=>e.rp=a,size:"small",class:"select","fit-input-width":"",placement:"right",offset:8,onChange:e=>function(e){const a=M.value.party.find(a=>a.rp===M.value.party[e].rp&&a.id!==M.value.party[e].id);a&&(a.rp=Q(a)),W()}(a)},{default:b(()=>[(j(!0),k(C,null,J(H(e.job),(e,a)=>(j(),v(o,{key:a,value:e,label:e},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),h("span",O,w((t=e.job,s.jobToFullName(s.jobEnumToJob(t)).simple1)),1),_(S)?(j(),k("span",R,w(e.name),1)):P("",!0)],2);var t}),128)),_(S)?(j(),v(u,{key:0,class:"drag-job",party:_(M).party,"p-1":"",onUpdate:X},null,8,["party"])):P("",!0)])):(j(),k("div",E,w(_(M).party.find(e=>e.name===_(B))?.rp??""),1))]),_(I)?(j(),k("div",U,[h("button",{onClick:n[2]||(n[2]=e=>{_(M).party=_(M).party.filter(e=>e.name===_(B)),X()})}," 测试单人 "),h("button",{onClick:Y}," 测试组队 ")])):P("",!0)])]),_:1})}}}),[["__scopeId","data-v-eb522f4e"]]);export{S as default};
