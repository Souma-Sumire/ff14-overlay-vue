import{_ as e}from"./ActWrapper-DCJHy4g0.js";import{u as a,l as t,_ as r}from"./DragJob--cyRY1eX.js";import{d as o,r as s,f as n,i as l,aG as i,k as p,w as u,o as d,a as m,c,G as y,m as f,F as b,u as v,l as g,v as h,t as j,b as k}from"./index-B7NsSc6e.js";import{u as S}from"./useDev-D6Xildmb.js";import{R as x}from"./demoParty-BaPqu81r.js";import{U as _}from"./util-BSI8OlRX.js";import{a as J,r as C,c as E}from"./overlay_plugin_api-DHbPkDtN.js";import{E as P}from"./index-B6qwDLLd.js";import{_ as R}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./useDemo-MIPwthTT.js";import"./index-CGoJNA9G.js";import"./index-BSBa9wYS.js";import"./index-9JEBcZRo.js";import"./use-form-common-props-CjZLsMwk.js";import"./index-D-si_ViN.js";import"./_baseClone-DJw_yRfT.js";const $={class:"demo-text"},w={class:"cactbot-runtime-container"},D={class:"players",flex:"~ nowrap gap-1"},L={class:"fixed-rp"},T={class:"fixed-player"},U={class:"drag-job"},V={key:0,style:{position:"fixed",bottom:"0"}},B=R(o({__name:"cactbotRuntime",setup(o){const R=["tank","healer","dps"],B=a(),M=s(!1),A=S(),G=new x,H=n({party:[],partySorted:{tank:[],healer:[],dps:[]}});function O(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const Q={tank:["MT","ST",...O("T",22,2)],healer:[...O("H",24)],dps:[...O("D",24)]},q=s("");function F(){const e=[...Q.tank.slice(0,H.partySorted.tank.length),...Q.healer.slice(0,H.partySorted.healer.length),...Q.dps.slice(0,H.partySorted.dps.length)],a=[...H.partySorted.tank,...H.partySorted.healer,...H.partySorted.dps].map((a,t)=>({...a,rp:e[t]}));E({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a}})}function I(){const e=H.party.slice().sort((e,a)=>B.arr.indexOf(_.baseJobEnumConverted(e.job))-B.arr.indexOf(_.baseJobEnumConverted(a.job)));H.partySorted.tank=e.filter(e=>_.isTankJob(_.jobEnumToJob(e.job))),H.partySorted.healer=e.filter(e=>_.isHealerJob(_.jobEnumToJob(e.job))),H.partySorted.dps=e.filter(e=>_.isDpsJob(_.jobEnumToJob(e.job))),F()}function K(){I()}function N(){F()}const W=()=>{M.value=!0},Z=()=>{M.value=!1},z=e=>{A.value&&0===e.party.length||(H.party=e.party.filter(e=>e.inParty),I())},X=e=>{A.value||(q.value=e.charName)},Y=e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&F()};function ee(){q.value=G.party.value[0].name,H.party=G.party.value.filter(e=>e.name===q.value),I()}function ae(){q.value=G.party.value[0].name,H.party=G.party.value,I()}function te(){G.shuffle({dps:4,healer:2,tank:2,crafter:3,gatherer:3,none:3}),ae()}return l(()=>{document.body.addEventListener("mouseenter",W),document.body.addEventListener("mouseleave",Z),J("ChangePrimaryPlayer",X),J("PartyChanged",z),J("BroadcastMessage",Y)}),i(()=>{document.body.removeEventListener("mouseenter",W),document.body.removeEventListener("mouseleave",Z),C("PartyChanged",z),C("ChangePrimaryPlayer",X),C("BroadcastMessage",Y)}),(a,o)=>{const s=P,n=r,l=e;return d(),p(l,null,{readme:u(()=>[m("span",$,[m("p",null,j(a.$t("cactbotRuntime.usageLine1")),1),m("ul",null,[m("li",null,j(a.$t("cactbotRuntime.usageLine2")),1),m("li",null,j(a.$t("cactbotRuntime.usageLine3")),1)])])]),default:u(()=>[m("div",w,[m("main",null,[m("div",D,[m("div",L,[(d(),c(b,null,f(R,(e,a)=>m("div",{key:`fixed-rp-${e}`,class:"player-role"},[(d(!0),c(b,null,f(v(H).partySorted[e],(a,t)=>(d(),c("div",{key:t,style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},[g(m("span",null,j(Q[e][t]),513),[[h,v(M)||a.name===v(q)]])]))),128)),v(H).partySorted[e].length>0&&a<2&&v(M)?(d(),p(s,{key:0})):y("",!0)])),64))]),m("div",T,[(d(),c(b,null,f(R,(e,a)=>k(v(t),{key:`fixed-player-${e}`,modelValue:v(H).partySorted[e],"onUpdate:modelValue":a=>v(H).partySorted[e]=a,animation:200,"ghost-class":"ghost","force-fallback":!0,filter:".no-draggable",onUpdate:N},{default:u(()=>[(d(!0),c(b,null,f(v(H).partySorted[e],e=>g((d(),c("div",{key:e.id,class:"player-line"},[m("span",null,j(e.name),1)])),[[h,v(M)]])),128)),v(H).partySorted[e].length>0&&a<2&&v(M)?(d(),p(s,{key:0,class:"no-draggable"})):y("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])),64))])]),m("div",U,[v(M)?(d(),p(n,{key:0,party:v(H).party,onUpdate:K},null,8,["party"])):y("",!0)])]),v(A)?(d(),c("div",V,[m("button",{onClick:ee},j(a.$t("cactbotRuntime.testSolo")),1),m("button",{onClick:ae},j(a.$t("cactbotRuntime.testParty")),1),m("button",{onClick:te},j(a.$t("cactbotRuntime.testShuffleParty")),1)])):y("",!0)])]),_:1})}}}),[["__scopeId","data-v-e7558aa3"]]);export{B as default};
