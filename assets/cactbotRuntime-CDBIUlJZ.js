import{_ as e}from"./ActWrapper-UDafzLxa.js";import{u as a,l as t,_ as r}from"./DragJob-CV-r8Ran.js";import{d as o,r as s,f as l,h as n,aX as p,j as i,w as d,o as u,a as m,c,B as y,l as f,F as v,u as b,k as g,v as h,t as j,b as k}from"./index-DtRnTB31.js";import{E as S}from"./el-divider-DSEo1Rn5.js";import{u as x}from"./useDev-DsYpLybs.js";import{R as _}from"./demoParty-ByoDKsXJ.js";import{U as E}from"./util-BOtaAWHW.js";import{a as J,r as P,c as C}from"./overlay_plugin_api-DHbPkDtN.js";import{_ as w}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-card-BCG1h_HK.js";import"./useDemo-DdiBJ_CJ.js";import"./el-checkbox-0yGfRGsS.js";import"./index-BGXr5xLJ.js";import"./use-form-common-props-DU0Ex9rX.js";import"./isEqual-CSBA_F7Y.js";import"./index-BPiL1AwD.js";import"./index-DfBPki2T.js";const D={class:"cactbot-runtime-container"},T={class:"players",flex:"~ nowrap gap-1"},U={class:"fixed-rp"},L={class:"fixed-player"},R={class:"drag-job"},V={key:0,style:{position:"fixed",bottom:"0"}},B=w(o({__name:"cactbotRuntime",setup(o){const w=["tank","healer","dps"],B=a(),H=s(!1),I=x(),M=new _,O=l({party:[],partySorted:{tank:[],healer:[],dps:[]}});function q(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const A={tank:["MT","ST",...q("T",22,2)],healer:[...q("H",24)],dps:[...q("D",24)]},N=s("");function W(){const e=[...A.tank.slice(0,O.partySorted.tank.length),...A.healer.slice(0,O.partySorted.healer.length),...A.dps.slice(0,O.partySorted.dps.length)],a=[...O.partySorted.tank,...O.partySorted.healer,...O.partySorted.dps].map((a,t)=>({...a,rp:e[t]}));C({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a}})}function $(){const e=O.party.slice().sort((e,a)=>B.arr.indexOf(E.baseJobEnumConverted(e.job))-B.arr.indexOf(E.baseJobEnumConverted(a.job)));O.partySorted.tank=e.filter(e=>E.isTankJob(E.jobEnumToJob(e.job))),O.partySorted.healer=e.filter(e=>E.isHealerJob(E.jobEnumToJob(e.job))),O.partySorted.dps=e.filter(e=>E.isDpsJob(E.jobEnumToJob(e.job))),W()}function F(){$()}function G(){W()}const K=()=>{H.value=!0},X=()=>{H.value=!1},z=e=>{I.value&&0===e.party.length||(O.party=e.party.filter(e=>e.inParty),$())},Q=e=>{I.value||(N.value=e.charName)},Y=e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&W()};function Z(){N.value=M.party.value[0].name,O.party=M.party.value.filter(e=>e.name===N.value),$()}function ee(){N.value=M.party.value[0].name,O.party=M.party.value,$()}function ae(){M.shuffle({dps:4,healer:2,tank:2,crafter:3,gatherer:3,none:3}),ee()}return n(()=>{document.body.addEventListener("mouseenter",K),document.body.addEventListener("mouseleave",X),J("ChangePrimaryPlayer",Q),J("PartyChanged",z),J("BroadcastMessage",Y)}),p(()=>{document.body.removeEventListener("mouseenter",K),document.body.removeEventListener("mouseleave",X),P("PartyChanged",z),P("ChangePrimaryPlayer",Q),P("BroadcastMessage",Y)}),(a,o)=>{const s=S,l=r,n=e;return u(),i(n,null,{readme:d(()=>o[0]||(o[0]=[m("span",{class:"demo-text"},[m("p",null,"使悬浮窗的位置分配对应游戏内的实际位置"),m("ul",null,[m("li",null,"每次小队变化时，会按规则进行排序"),m("li",null,"你可以上下拖拽玩家名称，临时调整")])],-1)])),default:d(()=>[m("div",D,[m("main",null,[m("div",T,[m("div",U,[(u(),c(v,null,f(w,(e,a)=>m("div",{key:`fixed-rp-${e}`,class:"player-role"},[(u(!0),c(v,null,f(b(O).partySorted[e],(a,t)=>(u(),c("div",{key:t,style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},[g(m("span",null,j(A[e][t]),513),[[h,b(H)||a.name===b(N)]])]))),128)),b(O).partySorted[e].length>0&&a<2&&b(H)?(u(),i(s,{key:0})):y("",!0)])),64))]),m("div",L,[(u(),c(v,null,f(w,(e,a)=>k(b(t),{key:`fixed-player-${e}`,modelValue:b(O).partySorted[e],"onUpdate:modelValue":a=>b(O).partySorted[e]=a,animation:200,"ghost-class":"ghost","force-fallback":!0,filter:".no-draggable",onUpdate:G},{default:d(()=>[(u(!0),c(v,null,f(b(O).partySorted[e],e=>g((u(),c("div",{key:e.id,class:"player-line"},[m("span",null,j(e.name),1)])),[[h,b(H)]])),128)),b(O).partySorted[e].length>0&&a<2&&b(H)?(u(),i(s,{key:0,class:"no-draggable"})):y("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])),64))])]),m("div",R,[b(H)?(u(),i(l,{key:0,party:b(O).party,onUpdate:F},null,8,["party"])):y("",!0)])]),b(I)?(u(),c("div",V,[m("button",{onClick:Z}," 测试单人 "),m("button",{onClick:ee}," 测试组队 "),m("button",{onClick:ae}," 测试随机组队 ")])):y("",!0)])]),_:1})}}}),[["__scopeId","data-v-55e26db6"]]);export{B as default};
