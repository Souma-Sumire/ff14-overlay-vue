import{_ as e}from"./TimelineShow-gc8zrAQJ.js";import{_ as t}from"./zoneSelecter-BS3tLxhm.js";import{n as l,R as a,S as n,f as i,T as s,j as o,q as c,e as r,U as d,V as u,H as p,G as m,d as f,c as y,k as w,E as g,J as b,W as h,X as v,Y as _,a as x,o as T,p as F,y as $,w as V,Z as S,K as k,_ as O,v as A,$ as z,g as I,x as C,a0 as B,a1 as E,a2 as N,a3 as j,h as D}from"./vendor-element-plus-Crd81rYT.js";import{C as U,q as J,r as P,s as L,t as M,U as R,v as H,S as Z,T as K,f as q,w as W,y as G,z as X,Z as Y}from"./shared-core-DqyA8e41.js";import{o as Q,B as ee,t as te,H as le,I as ae,J as ne,Y as ie,L as se,u as oe,v as ce,a as re,X as de,Z as ue,K as pe,R as me,am as fe,r as ye,ac as we,G as ge,c as be,dt as he,A as ve,dj as _e,M as xe,V as Te,_ as Fe,a6 as $e,du as Ve,dv as Se,dw as ke}from"./vendor-vue-iK2zA9mI.js";import{_ as Oe,a as Ae}from"./shared-common-1fsdULpF.js";import{a as ze,c as Ie}from"./cactbot-Bq2Gp82n.js";const Ce=new Map;Ce.set(26155,{type:"cast",window:[999,999],battleOnce:!0}),Ce.set(28027,{type:"cast",window:[999,999],battleOnce:!0}),Ce.set(26340,{type:"cast",window:[999,999],battleOnce:!0}),Ce.set(25533,{type:"begincast",window:[60,60]}),Ce.set(26376,{type:"cast",window:[999,999],battleOnce:!0}),Ce.set(26814,{type:"begincast",window:[999,999],battleOnce:!0}),Ce.set(25313,{type:"begincast",window:[200,200]}),Ce.set(27526,{type:"begincast",window:[999,999],battleOnce:!0}),Ce.set(26215,{type:"cast",window:[500,30],battleOnce:!0}),Ce.set(29050,{type:"begincast",window:[200,30],battleOnce:!0}),Ce.set(29156,{type:"cast",window:[20,20]}),Ce.set(27973,{type:"cast",window:[20,20]}),Ce.set(27937,{type:"begincast",window:[20,20]}),Ce.set(28059,{type:"begincast",window:[20,20]}),Ce.set(28060,{type:"begincast",window:[20,20]}),Ce.set(28061,{type:"begincast",window:[20,20]}),Ce.set(27956,{type:"begincast",window:[20,20]}),Ce.set(27957,{type:"begincast",window:[20,20]}),Ce.set(27952,{type:"begincast",window:[30,30]}),Ce.set(27969,{type:"begincast",window:[20,20]}),Ce.set(27971,{type:"begincast",window:[20,20]}),Ce.set(27939,{type:"begincast",window:[20,20]}),Ce.set(27966,{type:"begincast",window:[20,20]}),Ce.set(25316,{type:"begincast",window:[999,999],battleOnce:!0}),Ce.set(25544,{type:"begincast",window:[10,10]}),Ce.set(26379,{type:"begincast",window:[10,10]}),Ce.set(31552,{type:"begincast",window:[30,30]}),Ce.set(31573,{type:"begincast",window:[30,30]}),Ce.set(31573,{type:"begincast",window:[30,30]}),Ce.set(31617,{type:"begincast",window:[8,8]}),Ce.set(31624,{type:"begincast",window:[30,30]}),Ce.set(31649,{type:"begincast",window:[30,30]}),Ce.set(18864,{type:"cast",window:[10,2.5],syncOnce:!0}),Ce.set(18480,{type:"cast",window:[200,60],syncOnce:!0,battleOnce:!0}),Ce.set(18516,{type:"cast",window:[250,65],syncOnce:!0,battleOnce:!0}),Ce.set(18522,{type:"begincast",window:[500,500],syncOnce:!0,battleOnce:!0}),Ce.set(18552,{type:"begincast",window:[67,67],syncOnce:!0}),Ce.set(18553,{type:"cast",window:[67,67],syncOnce:!0}),Ce.set(19083,{type:"cast",window:[900,200],syncOnce:!0,battleOnce:!0}),Ce.set(40191,{type:"begincast",window:[200,20],syncOnce:!0}),Ce.set(40265,{type:"begincast",window:[500,20],syncOnce:!0,battleOnce:!0}),Ce.set(40246,{type:"begincast",window:[999,30],syncOnce:!0,battleOnce:!0}),Ce.set(40306,{type:"begincast",window:[30,30],syncOnce:!0}),Ce.set(11103,{type:"begincast",window:[310,30],syncOnce:!0,battleOnce:!0}),Ce.set(11517,{type:"begincast",window:[600,30],syncOnce:!0,battleOnce:!0}),Ce.set(11122,{type:"begincast",window:[100,30],syncOnce:!0,battleOnce:!0}),Ce.set(11143,{type:"begincast",window:[60,60],syncOnce:!0}),Ce.set(11126,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),Ce.set(11596,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),Ce.set(11597,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),Ce.set(42785,{type:"begincast",window:[9.6,2],syncOnce:!0}),Ce.set(42838,{type:"cast",window:[77.2,30],syncOnce:!0,battleOnce:!0}),Ce.set(42863,{type:"cast",window:[30,30],syncOnce:!1}),Ce.set(42787,{type:"cast",window:[30,30],syncOnce:!1}),Ce.set(42864,{type:"cast",window:[30,30],syncOnce:!1}),Ce.set(41946,{type:"begincast",window:[10,10],syncOnce:!1}),Ce.set(41936,{type:"begincast",window:[20,30],syncOnce:!0}),Ce.set(41939,{type:"begincast",window:[20,20],syncOnce:!0}),Ce.set(42825,{type:"begincast",window:[60,60],syncOnce:!0,battleOnce:!0}),Ce.set(41969,{type:"begincast",window:[20,20],syncOnce:!0}),Ce.set(41871,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0}),Ce.set(43053,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0}),Ce.set(45645,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0});const Be={class:"query-results"},Ee={flex:"~","m-t-10":""},Ne={class:"ability-filter-container"},je={key:0,class:"loading-abilities"},De=["src","alt","onerror"],Ue=Oe(Q({__name:"FflogsImport",props:{filters:{}},emits:["showFFlogsToggle","editTimeline"],setup(e,{emit:t}){const b=e,h=t,v=new U({key:"souma-fflogs-cache",maxSize:2097152,cleanupRatio:.25});function _(e){const t=v.get(e);if(!t)return null;try{return JSON.parse(t)}catch{return null}}function x(e,t,l=2592e5){const a={data:t,expire:Date.now()+l};v.set(e,JSON.stringify(a),l)}function T(e){return e&&e.expire>Date.now()}ee(()=>{v.clearExpired(),J()});const F=new RegExp("(?<=^|\\/)(?<code>(?:a:)?\\w{16,})[#?]fight=(?<fight>\\d+|last)"),$=ye("查询"),V=ye(""),S=ye(!1),k=ye(!1),O=ye(0),A=ye(!1),z=we({});j();const I=P();async function C(e){k.value=!0,O.value=2,z.player=e,z.type="friendies",z.abilityFilterEvents.length=0,z.abilityFilterCandidate.length=0,z.enemiesAbilityFilterSelected.length=0;try{await async function(){A.value=!1;const e=[];async function t(l){try{const a=`events:friendly:${z.code}:${l}:${z.player?.id}`,n=_(a);let i;n&&T(n)?i=n.data:(i=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${z.code}?start=${l}&end=${z.end}&hostility=0&sourceid=${z.player?.id}&api_key=${I.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),x(a,i)),e.push(...i.events),i.nextPageTimestamp&&i.nextPageTimestamp>0&&i.nextPageTimestamp<z.end&&await t(i.nextPageTimestamp)}catch(a){g.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${a}`,"获取友方技能数据失败",{confirmButtonText:"确定",type:"error"})}}async function l(t,a){if(a>=0)try{const n=`events:enemy:${z.code}:${t}:${z.bossIDs[a]}`,i=_(n);let s;i&&T(i)?s=i.data:(s=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${z.code}?start=${t}&end=${z.end}&hostility=1&sourceid=${z.bossIDs[a]}&api_key=${I.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),x(n,s)),e.push(...s.events),s.nextPageTimestamp&&s.nextPageTimestamp>0&&s.nextPageTimestamp<z.end&&await l(s.nextPageTimestamp,a),a<z.bossIDs.length-1&&await l(t,a+1)}catch(n){g.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${n}`,"获取敌方技能数据失败",{confirmButtonText:"确定",type:"error"})}}z.abilityFilterEvents.length=0,z.enemiesAbilityFilterSelected.length=0,await Promise.all([t(z.start),l(z.start,0)]);for(const a of e)"begincast"===a.type&&a.sourceIsFriendly||z.abilityFilterEvents.push({time:Number(((a.timestamp-z.start)/1e3).toFixed(1)),type:a.type,actionName:H(a.ability.guid)??a.ability.name,actionId:a.ability.guid,sourceIsFriendly:a.sourceIsFriendly,url:a?.ability?.abilityIcon.replace("-","/").replace(".png","")??"000000/000405",window:void 0,sourceID:a.sourceID});A.value=!0}(),z.abilityFilterCandidate=z.abilityFilterEvents.reduce((e,t)=>(t.sourceIsFriendly&&!e.find(e=>e.actionId===t.actionId)&&e.push(t),e),[]).sort((e,t)=>e.time-t.time),z.player?.icon&&b.filters[z.player.icon]&&(z.abilityFilterSelected=b.filters[z.player.icon]),z.abilityFilterSelected=z.abilityFilterSelected.filter(e=>z.abilityFilterCandidate.find(t=>t.actionId===e)),k.value=!1}catch(t){g.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${t}`,"获取玩家技能数据失败",{confirmButtonText:"确定",type:"error"}),k.value=!1}}function B(){k.value=!0,O.value=3,z.player?.icon&&I.updateFilters(z.player?.icon,JSON.parse(JSON.stringify(z.abilityFilterSelected))),z.abilityFilterEvents=z.abilityFilterEvents.filter(e=>e.sourceIsFriendly&&z.abilityFilterSelected.includes(e.actionId)||!e.sourceIsFriendly).sort((e,t)=>e.time-t.time),z.abilityFilterEvents=function(e){for(const t of e){const e=Ce.get(t.actionId);e?.type===t.type&&(t.window=e?.window,t.syncOnce=Boolean(e?.syncOnce),t.battleOnce=Boolean(e?.battleOnce))}return e}(z.abilityFilterEvents),z.abilityFilterEventsAfterFilterRawTimeline=z.abilityFilterEvents.map(e=>{const{time:t,actionName:l,actionId:a,type:n,sourceID:i,window:s,sourceIsFriendly:o,syncOnce:c,battleOnce:r}=e;if(o)return`${t} "<${l}>~"${S.value?` tts "${l}"`:""}`;if(/^(?:攻击|attack|攻撃)$/i.test(l)&&!s||"cast"===n&&!s||z.battleSyncedIDs.includes(a))return`# ${t} "${l}"`;const d=z.enemies.find(e=>e.id===i);if(("NPC"===d?.type||/unknown/.test(l))&&!s)return null;const u=`${t} "${l}" ${"begincast"===n?"StartsUsing":"Ability"} { id: "${a.toString(16).toUpperCase()}" }`;return r&&s&&z.battleSyncedIDs.push(a),s?`${u} window ${s.join(",")} ${c?"once":""}`:`# ${u}`}).filter(e=>null!==e).join("\n");const e=I.newTimeline(`导入${z.player?.name}`,{zoneID:z.zoneID.toString(),jobs:[z.player?.icon??"NONE"],phase:void 0},z.abilityFilterEventsAfterFilterRawTimeline,`${z.code}#fight=${z.fightIndex+1}`);j(),h("showFFlogsToggle"),h("editTimeline",I.allTimelines[e]),setTimeout(()=>{O.value=0},500),k.value=!1}async function E(){k.value=!0,O.value=2,z.type="enemies",z.abilityFilterEvents.length=0,z.abilityFilterCandidate.length=0;try{await async function(){A.value=!1;const e=[];async function t(l,a){if(a>=0)try{const n=`events:enemy:${z.code}:${l}:${z.bossIDs[a]}`,i=_(n);let s;i&&T(i)?s=i.data:(s=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${z.code}?start=${l}&end=${z.end}&hostility=1&sourceid=${z.bossIDs[a]}&api_key=${I.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),x(n,s)),e.push(...s.events),s.nextPageTimestamp&&s.nextPageTimestamp>0&&s.nextPageTimestamp<z.end&&await t(s.nextPageTimestamp,a),a<z.bossIDs.length-1&&await t(l,a+1)}catch(n){g.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${n}`,"获取敌方技能数据失败",{confirmButtonText:"确定",type:"error"})}}z.abilityFilterEvents.length=0,z.enemiesAbilityFilterSelected.length=0,await Promise.all([t(z.start,0)]);for(const a of e)z.abilityFilterEvents.push({time:Number(((a.timestamp-z.start)/1e3).toFixed(1)),type:a.type,actionName:H(a.ability.guid)??a.ability.name,actionId:a.ability.guid,sourceIsFriendly:!1,url:"",window:void 0,sourceID:a.sourceID});A.value=!0,z.enemiesAbilityFilterSelected.length=0;const l=Array.from(new Set(z.abilityFilterEvents.map(e=>e.actionName)));z.enemiesAbilityFilterSelected.push(...l)}(),z.abilityFilterCandidate=z.abilityFilterEvents.reduce((e,t)=>(!1!==t.sourceIsFriendly||e.find(e=>e.actionName===t.actionName)||e.push(t),e),[]).sort((e,t)=>e.time-t.time),z.enemiesAbilityFilterSelected=z.enemiesAbilityFilterSelected.filter(e=>z.abilityFilterCandidate.find(t=>t.actionName===e)),k.value=!1}catch(e){g.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${e}`,"获取敌人技能数据失败",{confirmButtonText:"确定",type:"error"}),k.value=!1}}function N(){O.value=3,z.abilityFilterEvents=z.abilityFilterEvents.filter(e=>z.enemiesAbilityFilterSelected.includes(e.actionName)).sort((e,t)=>e.time-t.time),z.abilityFilterEventsAfterFilterRawTimeline=z.abilityFilterEvents.map(e=>{const{time:t,actionName:l,actionId:a,type:n}=e,i="begincast"===n?"StartsUsing":"Ability",s=a.toString(16).toUpperCase(),o=z.enemies.find(t=>t.id===e.sourceID),c="Boss"===o?.type?"Boss":"分身";return`${t} "${l}" ${i} { id: "${s}" } #${o?.name??"未知"}（${c}）`}).join("\n");const e=I.newTimeline("BOSS时间轴（使用前请删除非必要的正则）",{zoneID:z.zoneID.toString(),jobs:[],phase:void 0},z.abilityFilterEventsAfterFilterRawTimeline,`${z.code}#fight=${z.fightIndex+1}`);j(),h("showFFlogsToggle"),h("editTimeline",I.allTimelines[e]),setTimeout(()=>{O.value=0},500)}function j(){z.type="friendies",z.code="",z.fightIndex=0,z.start=0,z.end=0,z.friendlies=[],z.abilityFilterEvents=[],z.abilityFilterCandidate=[],z.abilityFilterSelected=[],z.enemiesAbilityFilterSelected=[],z.abilityFilterEventsAfterFilterRawTimeline="",z.player=void 0,z.zoneID=0,z.bossIDs=[],z.enemies=[],z.battleSyncedIDs=[]}function D(){window.open("https://cn.fflogs.com/profile","_blank")}return(e,t)=>{const b=l,h=a,v=n,U=o,J=s,P=c,H=r,Z=u,K=i,q=p,W=m,G=f,X=y,Y=w;return te(),le(me,null,[ae(b,{style:se(oe(O)>0?{}:{visibility:"hidden",pointerEvent:"none"}),type:"primary",text:"","position-absolute":"","z-999":"",class:"guide",onClick:t[0]||(t[0]=e=>O.value--)},{default:ne(()=>[...t[8]||(t[8]=[ie(" 上一步 ",-1)])]),_:1},8,["style"]),ae(v,{active:oe(O),class:"steps-guide","align-center":""},{default:ne(()=>[ae(h,{title:"导入战斗"}),ae(h,{title:"选择目标"}),ae(h,{title:"过滤技能"})]),_:1},8,["active"]),0===oe(O)?(te(),ce(K,{key:0,class:"input-section"},{default:ne(()=>[ae(Z,{"label-width":"150px",class:"fflogs-form"},{default:ne(()=>[ae(J,{label:"FF Logs 战斗链接"},{default:ne(()=>[ae(U,{modelValue:oe(V),"onUpdate:modelValue":t[1]||(t[1]=e=>re(V)?V.value=e:null),placeholder:"https://www.fflogs.com/reports/AAAaAaAAaa1aA1aA?fight=1",autocomplete:"on"},null,8,["modelValue"])]),_:1}),ae(J,{label:"FF logs V1 Key"},{default:ne(()=>[ae(U,{modelValue:oe(I).settings.api,"onUpdate:modelValue":t[2]||(t[2]=e=>oe(I).settings.api=e),placeholder:"在 FF Logs 个人设置页面获取 V1 API Key",type:"password","show-password":""},{append:ne(()=>[ae(P,{content:"点击前往 FF Logs 个人设置页面，在最下方填写 V1客户名称 并点击确认后，再获取你的 V1 客户端密钥",placement:"top",effect:"light"},{default:ne(()=>[ae(b,{type:"primary",link:"",onClick:D},{default:ne(()=>[...t[9]||(t[9]=[ie(" 如何获取 ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),ae(J,null,{default:ne(()=>[ae(b,{disabled:"正在查询..."===oe($),type:"primary",onClick:t[3]||(t[3]=e=>async function(e){k.value=!0,j(),$.value="正在查询...";const t=e.match(F);if(!I.settings.api)return g.alert("请在FF Logs个人设置页面获取V1 API Key","FF logs API Key 未填写",{confirmButtonText:"确定",type:"error",dangerouslyUseHTMLString:!0,message:'<a href="https://cn.fflogs.com/profile">点击这里，在最下方<strong>填写 V1 客户名称并点击确认</strong>后，获取你的 V1 客户端密钥</a>'}),$.value="查询",void(k.value=!1);if(!t)return g.alert("请正确填写FF Logs链接","FF Logs链接格式错误",{confirmButtonText:"确定",type:"error"}),$.value="查询",void(k.value=!1);z.code=t.groups?.code??"";try{const e=`fights:${z.code}`,l=_(e);let a;l&&T(l)?a=l.data:(a=await fetch(`https://cn.fflogs.com/v1/report/fights/${z.code}?api_key=${I.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),x(e,a)),z.bossIDs=a.enemies.filter(e=>["Boss","NPC"].includes(e.type)).map(e=>e.id),z.enemies=a.enemies.slice(),z.fightIndex=("last"===t?.groups?.fight?a.fights.length:Number.parseInt(t?.groups?.fight??"0"))-1;const n=a.fights[z.fightIndex];z.zoneID=n.zoneID,z.start=n.start_time,z.end=n.end_time,z.friendlies=a.friendlies.filter(e=>"LimitBreak"!==e.icon&&e.fights.find(e=>e.id===z.fightIndex+1)),z.friendlies.sort((e,t)=>{const l=R.iconToJobEnum(e.icon),a=R.iconToJobEnum(t.icon);return R.enumSortMethod(l,a)}),$.value="查询",z.abilityFilterEvents.length=0,z.abilityFilterCandidate.length=0,k.value=!1,O.value=1}catch(l){g.alert(`\n  <h3 style="margin-bottom: 10px;">可能的原因：</h3>\n  <ul style="padding-left: 20px; margin-bottom: 10px;">\n    <li> <strong>90%概率</strong>：你没有<strong style="color: red;">先起名</strong>再获取 V1 客户端密钥</li>\n    <li> <strong>5%概率</strong>：该战斗记录是私人或匿名模式</li>\n    <li> <strong>5%概率</strong>：网络异常</li>\n  </ul>\n<p class="error-details"><strong>错误：</strong>${l}</p>\n`,"请求失败",{confirmButtonText:"确定",type:"error",dangerouslyUseHTMLString:!0}),$.value="查询",k.value=!1}}(oe(V)))},{default:ne(()=>[oe(k)?(te(),ce(H,{key:0,class:"is-loading"},{default:ne(()=>[ae(oe(d))]),_:1})):de("",!0),ie(" "+ue(oe($)),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})):de("",!0),pe("div",Be,[1===oe(O)?(te(),ce(K,{key:0,class:"player-selection"},{default:ne(()=>[ae(W,{data:oe(z).friendlies.filter(e=>!["NPC"].includes(e.icon)),stripe:"",border:"",class:"friendlies-table"},{default:ne(()=>[ae(q,{prop:"name",label:"玩家名称"}),ae(q,{label:"职业"},{default:ne(({row:e})=>{return[ie(ue((t=e.icon,R.jobToFullName(R.jobEnumToJob(R.iconToJobEnum(t))).cn)),1)];var t}),_:1}),ae(q,{label:"选定",width:"100",align:"center"},{default:ne(e=>[ae(b,{type:"primary",size:"small",onClick:t=>C(e.row)},{default:ne(()=>[...t[10]||(t[10]=[ie(" 选择 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),pe("div",Ee,[ae(b,{type:"info",onClick:t[4]||(t[4]=e=>E())},{default:ne(()=>[...t[11]||(t[11]=[ie(" 不选择玩家，而是生成BOSS时间轴 ",-1)])]),_:1})])]),_:1})):de("",!0),2===oe(O)?(te(),ce(K,{key:1,class:"ability-filter"},{default:ne(()=>[pe("div",Ne,[oe(A)?de("",!0):(te(),le("div",je,[ae(H,{class:"is-loading"},{default:ne(()=>[ae(oe(d))]),_:1}),t[12]||(t[12]=pe("span",null,"正在加载技能列表...",-1))])),oe(A)&&"friendies"===oe(z).type?(te(),le(me,{key:1},[ae(X,{modelValue:oe(z).abilityFilterSelected,"onUpdate:modelValue":t[5]||(t[5]=e=>oe(z).abilityFilterSelected=e),multiple:"",placeholder:"选择需要导入的技能","fit-input-width":!0,class:"ability-filter-select",filterable:""},{default:ne(()=>[(te(!0),le(me,null,fe(oe(z).abilityFilterCandidate,e=>(te(),ce(G,{key:e.actionId,value:e.actionId,label:e.actionName,class:"ability-filter-option"},{default:ne(()=>[pe("img",{src:oe(M)(`/i/${e.url}.png`),class:"ability-filter-icon",alt:e.actionName,onerror:oe(L)},null,8,De),pe("span",null,ue(e.actionName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"]),ae(J,{label:"添加 TTS 语法","m-t-3":"","w-60":""},{default:ne(()=>[ae(Y,{modelValue:oe(S),"onUpdate:modelValue":t[6]||(t[6]=e=>re(S)?S.value=e:null)},null,8,["modelValue"])]),_:1}),ae(b,{type:"success",class:"filter-confirm-btn",disabled:!oe(A),onClick:B},{default:ne(()=>[...t[13]||(t[13]=[ie(ue("生成玩家时间轴"),-1)])]),_:1},8,["disabled"])],64)):oe(A)&&"enemies"===oe(z).type?(te(),le(me,{key:2},[oe(A)?(te(),ce(X,{key:0,modelValue:oe(z).enemiesAbilityFilterSelected,"onUpdate:modelValue":t[7]||(t[7]=e=>oe(z).enemiesAbilityFilterSelected=e),multiple:"",placeholder:"选择需要导入的技能","fit-input-width":!0,class:"ability-filter-select",filterable:""},{default:ne(()=>[(te(!0),le(me,null,fe(oe(z).abilityFilterCandidate,e=>(te(),ce(G,{key:e.actionName,value:e.actionName,class:"ability-filter-option"},{default:ne(()=>[pe("span",null,ue(e.actionName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])):de("",!0),ae(b,{type:"success",class:"filter-confirm-btn",disabled:!oe(A),onClick:N},{default:ne(()=>[...t[14]||(t[14]=[ie(ue("生成敌人时间轴"),-1)])]),_:1},8,["disabled"])],64)):de("",!0)])]),_:1})):de("",!0)])],64)}}}),[["__scopeId","data-v-e2e2f41f"]]),Je={class:"dialog-header"},Pe={class:"layout-container"},Le={class:"form-side"},Me={class:"section-container"},Re={class:"slider-label"},He={class:"label-actions"},Ze={class:"default-hint"},Ke={class:"section-container"},qe={class:"slider-label"},We={class:"label-actions"},Ge={class:"default-hint"},Xe={class:"preview-content"},Ye={class:"slider-container"},Qe={class:"slider-info"},et={class:"time"},tt={class:"preview-box"},lt={class:"inner-preview"},at={class:"dialog-footer"},nt=Oe(Q({__name:"SettingsDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(t,{emit:a}){const n=t,i=a,s=P(),o={config:{[K.显示范围]:120,[K.变色时间]:2.75,[K.零后持续]:.5,[K.战前准备]:30,[K.TTS提前量]:1},style:{[Z.总宽度]:200,[Z.字体尺寸]:16,[Z.未到来不透明度]:.5,[Z.未到来缩放]:.66,[Z.即将到来缩放]:1,[Z.变色动画时间]:1}},c={[K.显示范围]:{min:10,max:200,step:1},[K.变色时间]:{min:0,max:5,step:.25},[K.零后持续]:{min:0,max:5,step:.1},[K.战前准备]:{min:0,max:40,step:1},[K.TTS提前量]:{min:0,max:5,step:.5},[Z.总宽度]:{min:120,max:300,step:5},[Z.字体尺寸]:{min:8,max:48,step:1},[Z.未到来不透明度]:{min:0,max:1,step:.05},[Z.未到来缩放]:{min:.1,max:2,step:.01},[Z.即将到来缩放]:{min:.1,max:2,step:.01},[Z.变色动画时间]:{min:0,max:3,step:.1}};function r(){g.confirm("此操作将恢复所有参数至默认值，确定继续吗？","提示",{confirmButtonText:"确定重置",cancelButtonText:"取消",type:"warning"}).then(()=>{Object.keys(o.config).forEach(e=>{s.configValues[e]=o.config[e]}),Object.keys(o.style).forEach(e=>{s.showStyle[e]=o.style[e]}),x.success("已恢复默认设置")}).catch(()=>{})}ge(()=>{s.saveTimelineSettings()});const d=be({get:()=>n.modelValue,set:e=>i("update:modelValue",e)}),p=ye(-2),m=ye([{time:-15,action:"<圣光幕帘>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:-2,action:"<圣灵>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:0,action:"战斗开始！",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:3,action:"<挑衅>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:5,action:"<神圣领域>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:10,action:"<圣盾阵>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:20,action:"<圣盾阵>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:25,action:"<雪仇>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:30,action:"<铁壁>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:40,action:"<极限防御>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:50,action:"<雪仇>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:60,action:"<圣灵>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:120,action:"<圣盾阵>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:180,action:"<圣光幕帘>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:200,action:"战斗结束！",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1}]);return(t,a)=>{const n=l,i=v,f=u,y=e,w=b;return te(),ce(w,{modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=e=>d.value=e),modal:!0,"close-on-click-modal":!1,"close-on-press-escape":!1,class:"timeline-settings-dialog",width:"fit-content","append-to-body":!0,draggable:!0,"destroy-on-close":"",center:"","align-center":""},{header:ne(()=>[pe("div",Je,[a[5]||(a[5]=pe("span",{class:"title"},"时间轴配置",-1)),ae(n,{link:"",type:"primary",icon:oe(_),size:"small",onClick:r},{default:ne(()=>[...a[4]||(a[4]=[ie(" 重置全部 ",-1)])]),_:1},8,["icon"])])]),footer:ne(()=>[pe("div",at,[ae(n,{size:"small",onClick:a[1]||(a[1]=e=>d.value=!1)},{default:ne(()=>[...a[10]||(a[10]=[ie(" 取消 ",-1)])]),_:1}),ae(n,{size:"small",type:"primary",onClick:a[2]||(a[2]=e=>d.value=!1)},{default:ne(()=>[...a[11]||(a[11]=[ie(" 保存设置 ",-1)])]),_:1})])]),default:ne(()=>[pe("div",Pe,[pe("div",Le,[ae(f,{"label-position":"top",size:"small"},{default:ne(()=>[pe("div",Me,[a[6]||(a[6]=pe("h3",{class:"section-header"}," 核心参数 ",-1)),(te(!0),le(me,null,fe(oe(s).configValues,(e,t)=>(te(),le("div",{key:t,class:"slider-item"},[pe("div",Re,[pe("span",null,ue(oe(s).configTranslate[t]),1),pe("div",He,[pe("span",Ze,"默认: "+ue(o.config[t]),1),ae(n,{link:"",icon:oe(h),onClick:e=>function(e){s.configValues[e]=o.config[e]}(t)},null,8,["icon","onClick"])])]),ae(i,{modelValue:oe(s).configValues[t],"onUpdate:modelValue":e=>oe(s).configValues[t]=e,min:c[t]?.min,max:c[t]?.max,step:c[t]?.step,"show-input":"","show-input-controls":!1,"input-size":"small"},null,8,["modelValue","onUpdate:modelValue","min","max","step"])]))),128))]),pe("div",Ke,[a[7]||(a[7]=pe("h3",{class:"section-header"}," 视觉样式 ",-1)),(te(!0),le(me,null,fe(oe(s).showStyle,(e,t)=>(te(),le("div",{key:t,class:"slider-item"},[pe("div",qe,[pe("span",null,ue(oe(s).showStyleTranslate[t]),1),pe("div",We,[pe("span",Ge,"默认: "+ue(o.style[t]),1),ae(n,{link:"",icon:oe(h),onClick:e=>function(e){s.showStyle[e]=o.style[e]}(t)},null,8,["icon","onClick"])])]),ae(i,{modelValue:oe(s).showStyle[t],"onUpdate:modelValue":e=>oe(s).showStyle[t]=e,min:c[t]?.min,max:c[t]?.max,step:c[t]?.step,"show-input":"","show-input-controls":!1,"input-size":"small"},null,8,["modelValue","onUpdate:modelValue","min","max","step"])]))),128))])]),_:1})]),pe("div",{class:"preview-side",style:se({width:`${oe(s).showStyle["--timeline-width"]+50}px`})},[a[9]||(a[9]=pe("h3",{class:"section-header"}," 效果预览 ",-1)),pe("div",Xe,[pe("div",Ye,[pe("div",Qe,[a[8]||(a[8]=pe("span",{class:"label"},"模拟时间轴进度",-1)),pe("span",et,ue(p.value.toFixed(1))+"s",1)]),ae(i,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),min:-15,max:10,step:.1,size:"small"},null,8,["modelValue"])]),pe("div",tt,[pe("div",lt,[ae(y,{config:oe(s).configValues,lines:m.value,runtime:p.value,"show-style":oe(s).showStyle},null,8,["config","lines","runtime","show-style"])])])])],4)])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-2bb129f6"]]),it={class:"status-text"},st={key:0,class:"sync-time"},ot={style:{"font-size":"13px","line-height":"1.6",color:"var(--el-text-color-regular)"}},ct={class:"batch-operations",style:{"margin-bottom":"15px",display:"flex","flex-wrap":"wrap","justify-content":"space-between",gap:"10px"}},rt={style:{display:"flex",gap:"10px","flex-wrap":"wrap"}},dt={class:"editor-dialog-content"},ut={class:"source-container"},pt={class:"slider-demo-block"},mt={class:"time-display",style:{width:"80px","text-align":"center"}},ft={class:"time-display-text"},yt={class:"time-display-text"},wt={style:{"margin-top":"1em"}},gt={class:"export-size-info"},bt={class:"export-size-info"},ht={class:"export-size-info"},vt={class:"dialog-footer"},_t=Oe(Q({__name:"timelineSettings",setup(a){const n=_e(),{wsConnected:c}=q({allowClose:!0,addWsParam:!0}),d=P(),w=$e(d,"allTimelines"),h=$e(d,"filters"),U=ye(0),J=ye([]),L=ye(!1),M=ye(!1),H=ye(!1),Z=ye(!1),K=ye(!1),Q=ye(!1),ge=ye("compressed_full"),Oe=we({compressedFull:"",compressedZip:"",rawJson:"",fullSize:0,optimizedSize:0,rawSize:0}),Ce=ye("idle"),Be=ye(""),Ee=ye(!1),Ne=/^(?:a:)?\w{16,}(?:[#?]fight=(?:\d+|last))?$/,je=be(()=>{const e=n.resolve({path:"/timeline"});return`${window.location.protocol}//${window.location.host}/ff14-overlay-vue/${e.href}`}),De=he("timelineCurrentlyEditing",{name:"空",condition:{zoneID:"0",jobs:["NONE"],phase:void 0},timeline:"空",source:"空",createdAt:"空"}),Je=ye([]);let Pe=null,Le=!1;const Me=ye(""),Re=ye(""),He=ye(""),Ze=ye(""),Ke=be(()=>w.value.filter(e=>{const t=e.name.toLowerCase().includes(Me.value.toLowerCase()),l=!Re.value||e.condition.zoneID===Re.value,a=!He.value||e.condition.jobs.includes(He.value),n=!Ze.value||("undefined"===Ze.value?!e.condition.phase:e.condition.phase===Ze.value);return t&&l&&a&&n})),qe=be(()=>{const e=U.value,t=e<0,l=Math.abs(Math.floor(e)),a=Math.floor(l/60),n=l%60;return`${t?"-":""}${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`});ve(()=>De.value.condition.zoneID,e=>{W[e]||(De.value.condition.phase=void 0)}),ve(Re,e=>{e&&!W[e]&&(Ze.value="")});const We=ye(0);function Ge(e){De.value=e,M.value=!0,Qe()}function Xe(){M.value=!1}function Ye(){Ge(d.allTimelines[d.newTimeline()])}function Qe(){Je.value=[{time:0,action:"正在加载...",show:!0,windowBefore:0,windowAfter:0,alertAlready:!0}],G(De.value.timeline).then(e=>{Je.value=e;const t=Math.max(...Je.value.map(e=>e.time),550);We.value=t+30,U.value=-d.configValues.preBattle})}function et(){0!==J.value.length?g.confirm(`确定要删除选中的 ${J.value.length} 个时间轴吗？`,"批量删除",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(()=>{const e=new Set(J.value);d.allTimelines=d.allTimelines.filter(t=>!e.has(t)),J.value=[],x.success("批量删除成功")}).catch(()=>{}):x.warning("请选择要删除的时间轴")}function tt(){g.confirm("确定要清空所有时间轴吗？此操作不可逆！","危险操作",{confirmButtonText:"确定清空",cancelButtonText:"取消",confirmButtonClass:"el-button--danger",type:"error"}).then(()=>{g.prompt('输入 "我确认清空" 以执行此操作',"二次确认",{confirmButtonText:"确定清空",cancelButtonText:"取消",inputPattern:/^我确认清空$/,inputErrorMessage:"请输入正确的确认文字",type:"warning"}).then(()=>{d.allTimelines=[],J.value=[],x.success("已清空所有时间轴")})}).catch(()=>{})}function lt(){L.value=!L.value,J.value=L.value?[...w.value]:[]}function at(){0!==J.value.length?_t(J.value):x.warning("请选择要导出的时间轴")}function _t(e){const t=1===e.length,l=t?e[0]:e,a=JSON.stringify(l),n=JSON.stringify(l,null,2);let i;if(t)i=JSON.parse(a),i.timeline=i.timeline.replace(/^#.*(?:\n|$)/gm,"");else{i=JSON.parse(a);for(const e of i)e.timeline=e.timeline.replace(/^#.*(?:\n|$)/gm,"")}const s=JSON.stringify(i);Oe.compressedFull=Se.compressToBase64(a),Oe.compressedZip=Se.compressToBase64(s),Oe.rawJson=n,Oe.fullSize=Oe.compressedFull.length,Oe.optimizedSize=Oe.compressedZip.length,Oe.rawSize=n.length,ge.value="compressed_full",Q.value=!0}function xt(){let e="";e="compressed_full"===ge.value?Oe.compressedFull:"compressed_zip"===ge.value?Oe.compressedZip:Oe.rawJson,function(e,t="复制成功",l="复制失败"){X(e).then(()=>x.success(t)).catch(()=>x.error(l))}(e,"数据复制成功，已写入剪切板。","复制失败，请手动复制！"),Q.value=!1}function Tt(){const e=e=>{if(!e)return null;try{const t=JSON.parse(e);return Array.isArray(t)?t:[t]}catch{const t=e.split("\n").filter(e=>""!==e.trim());let l=[];for(const e of t)try{const t=JSON.parse(e);l=l.concat(Array.isArray(t)?t:[t])}catch{try{const t=Se.decompressFromBase64(e);if(t){const e=JSON.parse(t);l=l.concat(Array.isArray(e)?e:[e])}}catch{}}return l.length>0?l:null}};g.prompt("请输入导出的字符串（支持单行、多行 JSON 或压缩格式）","导入时间轴",{confirmButtonText:"解析",cancelButtonText:"取消",inputType:"textarea",inputValidator:t=>!!e(t)||"无法解析任何有效的时间轴数据，请确保输入格式正确。",inputErrorMessage:"无效的输入"}).then(t=>{const{value:l}=t,a=e(l);if(!a)return;const n=a.length,i=a.map(e=>`「${e.name}」`).join(", ");g.confirm(`确定要导入这 ${n} 个时间轴吗？\n${i}`,"二次确认",{confirmButtonText:"确定导入",cancelButtonText:"取消",type:"warning"}).then(()=>{!function(e){d.allTimelines.push(...e),d.sortTimelines();for(const n of d.allTimelines)d.normalizeTimeline(n);const t=[],l=new Set;for(const n of d.allTimelines){const e=JSON.stringify({name:n.name,condition:n.condition,timeline:n.timeline,source:n.source,createdAt:n.createdAt});l.has(e)||(l.add(e),t.push(n))}const a=d.allTimelines.length-t.length;d.allTimelines=t,x({message:`追加成功！共导入 ${e.length} 个时间轴${a>0?`，但其中 ${a} 个重复，已自动移除。`:""}`,type:"success",duration:3e3})}(a)}).catch(()=>{})}).catch(()=>{})}function Ft(e,t={}){Ie({call:"broadcast",source:"soumaTimelineSettings",msg:{type:e,data:t}})}function $t(){const e=n.resolve({path:"/timeline"}),t=`${window.location.protocol}//${window.location.host}/ff14-overlay-vue/${e.href}`;Le=!0,Pe=D.service({lock:!0,text:`正在请求数据，请确保 ACT 中已添加并启用此悬浮窗：${t}`,background:"rgba(0, 0, 0, 0.7)"}),Ft("get"),setTimeout(()=>{Le&&(x.info("重新尝试获取数据..."),$t())},5e3)}const Vt=e=>{if("soumaTimeline"!==e.source)return;const t=e.msg;if("post"===t.type){Le=!1,Pe.close();const t=e.msg.data;for(const e of t.allTimelines)d.normalizeTimeline(e);d.allTimelines=t.allTimelines,d.configValues=t.configValues,d.showStyle=t.showStyle,x.closeAll(),x({message:"数据获取成功",type:"success",duration:3e3})}else"success"===t.type?(Ee.value=!1,Ce.value="idle",Be.value=(new Date).toLocaleTimeString()):"hello"===t.type&&Ct()};function St(){window.open("https://docs.qq.com/sheet/DTWxKT3lFbmpDV3Fm?tab=5ovrc8","_blank")}function kt(){const e=n.resolve({path:"/timelineHelp"}).href;window.open(e,"_blank")}function Ot(){H.value=!0}function At(e){d.configValues=e.configValues,d.showStyle=e.showStyle}function zt({row:e}){return e===De.value?"editing-row":""}function It(){K.value=!0}function Ct(){Ee.value=!0,Ce.value="syncing",Ft("post",d.$state)}function Bt(e){const t=Y[e]?.name;return t?t.cn||`${t.ja} / ${t.en}`:"未知地图"}function Et(e){return(R.jobToFullName(e.toUpperCase())?.cn??e).replace("冒险者","全部职业")}return ee(()=>{ze("BroadcastMessage",Vt);const e=ve(c,t=>{t&&(0===d.allTimelines.length&&$t(),e())});d.allTimelines.forEach(e=>e.timeline=e.timeline.replaceAll(/^(?<a>.+), once: true(?<b>.+)$/gm,"$<a>$<b> once"));const t=ke(()=>{Ct()},500);ve([()=>d.allTimelines,()=>d.configValues,()=>d.showStyle],t,{deep:!0})}),d.loadTimelineSettings(),d.sortTimelines(),(a,n)=>{const D=p,P=m,R=b,q=nt,G=l,X=S,Y=V,ee=r,ye=O,we=k,be=Ae,he=$,ve=F,_e=Ue,$e=o,Se=t,ke=f,ze=y,Ie=z,Pe=I,Le=i,Ft=C,$t=A,Vt=s,Ct=B,Nt=N,jt=E,Dt=u,Ut=v,Jt=e,Pt=j,Lt=T;return te(),ce(Lt,{class:"container"},{default:ne(()=>[ae(R,{modelValue:oe(K),"onUpdate:modelValue":n[0]||(n[0]=e=>re(K)?K.value=e:null),title:"时间轴解析结果","align-center":"",center:"",draggable:"",width:"80%"},{default:ne(()=>[ae(P,{data:oe(Je)},{default:ne(()=>[ae(D,{property:"time",label:"time","min-width":"60"}),ae(D,{property:"action",label:"action",width:"150"},{default:ne(({row:e})=>[ie(ue(e.action.replaceAll(/(^['"“”]|['"“”]$)/g,"")),1)]),_:1}),ae(D,{property:"sync",label:"sync","min-width":"200"},{default:ne(({row:e})=>[ie(ue(e.sync?e.sync:"-"),1)]),_:1}),ae(D,{property:"syncOnce",label:"once","min-width":"100"},{default:ne(({row:e})=>[ie(ue(e.syncOnce?"✅":"-"),1)]),_:1}),ae(D,{label:"window","min-width":"100"},{default:ne(({row:e})=>[ie(ue(e.sync?`${e.windowBefore},${e.windowAfter}`:"-"),1)]),_:1}),ae(D,{property:"jump",label:"jump","min-width":"100"},{default:ne(({row:e})=>[ie(ue(e.jump?e.jump:"-"),1)]),_:1}),ae(D,{property:"tts",label:"tts","min-width":"150"},{default:ne(({row:e})=>[ie(ue(e.tts?e.tts:"-"),1)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),ae(q,{modelValue:oe(Z),"onUpdate:modelValue":n[1]||(n[1]=e=>re(Z)?Z.value=e:null),onSave:At},null,8,["modelValue"]),ae(ve,{class:"flex-header"},{default:ne(()=>[ae(he,{justify:"space-between",align:"middle"},{default:ne(()=>[ae(Y,null,{default:ne(()=>[ae(X,null,{default:ne(()=>[ae(G,{type:"primary",size:"small",onClick:Ot},{default:ne(()=>[...n[26]||(n[26]=[ie(" 从 FFlogs 生成 ",-1)])]),_:1}),ae(G,{type:"primary",size:"small",onClick:St},{default:ne(()=>[...n[27]||(n[27]=[ie(" 从 在线文档 获取 ",-1)])]),_:1}),ae(G,{type:"primary",size:"small",onClick:Ye},{default:ne(()=>[...n[28]||(n[28]=[ie(" 手动编写 ",-1)])]),_:1})]),_:1}),ae(X,null,{default:ne(()=>[ae(G,{size:"small",onClick:Tt},{default:ne(()=>[...n[29]||(n[29]=[ie(" 导入字符串 ",-1)])]),_:1}),ae(G,{size:"small",class:"export",onClick:n[2]||(n[2]=e=>_t(oe(w)))},{default:ne(()=>[...n[30]||(n[30]=[ie(" 导出全部 ",-1)])]),_:1})]),_:1})]),_:1}),ae(Y,null,{default:ne(()=>[ae(we,{placement:"bottom-end",title:"同步未生效",width:280,trigger:"hover",disabled:oe(c)||!oe(Ee)},{reference:ne(()=>[pe("div",{class:xe(["connection-status",{connected:oe(c),warning:!oe(c)&&oe(Ee)}])},[n[31]||(n[31]=pe("span",{class:"dot"},null,-1)),pe("span",it,[!oe(c)&&oe(Ee)?(te(),le(me,{key:0},[ie(" 改动暂未同步 (连接断开) ")],64)):(te(),le(me,{key:1},[ie(ue(oe(c)?"悬浮窗已连接":"悬浮窗未连接"),1)],64))]),!oe(Be)||oe(Ee)&&!oe(c)?de("",!0):(te(),le("span",st,"（同步于 "+ue(oe(Be))+"）",1)),"syncing"===oe(Ce)?(te(),ce(ee,{key:1,class:"is-loading",style:{"margin-left":"5px"}},{default:ne(()=>[ae(oe(_))]),_:1})):de("",!0)],2)]),default:ne(()=>[pe("div",ot,[n[33]||(n[33]=ie(" 检测到你有未同步的改动。请确保你在ACT中启用了 ",-1)),ae(ye,{type:"danger",href:oe(je),target:"_blank",style:{"vertical-align":"baseline","font-weight":"bold","text-decoration":"underline"}},{default:ne(()=>[...n[32]||(n[32]=[ie(" 时间轴悬浮窗 ",-1)])]),_:1},8,["href"]),n[34]||(n[34]=ie(" ，改动才能实时推送到时间轴。 ",-1))])]),_:1},8,["disabled"]),ae(be,{"storage-key":"timeline-settings-theme"}),ae(G,{color:"#626aef",style:{color:"white"},size:"small",onClick:n[3]||(n[3]=e=>Z.value=!0)},{default:ne(()=>[...n[35]||(n[35]=[ie(" 参数设置 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),ae($t,null,{default:ne(()=>[ae(R,{modelValue:oe(H),"onUpdate:modelValue":n[5]||(n[5]=e=>re(H)?H.value=e:null),title:"从 FFlogs 生成时间轴",width:"80%","before-close":()=>H.value=!1,"close-on-press-escape":!1,"close-on-click-modal":!1},{default:ne(()=>[ae(_e,{filters:oe(h),onShowFFlogsToggle:n[4]||(n[4]=()=>H.value=!1),onEditTimeline:Ge},null,8,["filters"])]),_:1},8,["modelValue","before-close"]),oe(w).length>0?(te(),ce(Le,{key:0},{default:ne(()=>[pe("div",ct,[pe("div",rt,[ae($e,{modelValue:oe(Me),"onUpdate:modelValue":n[6]||(n[6]=e=>re(Me)?Me.value=e:null),placeholder:"搜索名称...",clearable:"",size:"small",style:{width:"180px"}},null,8,["modelValue"]),ae(Se,{"select-zone":oe(Re),"onUpdate:selectZone":n[7]||(n[7]=e=>re(Re)?Re.value=e:null),placeholder:"筛选地图",size:"small",style:{width:"180px"},clearable:!0},null,8,["select-zone"]),ae(ze,{modelValue:oe(Ze),"onUpdate:modelValue":n[8]||(n[8]=e=>re(Ze)?Ze.value=e:null),placeholder:"筛选阶段",clearable:"",size:"small",style:{width:"120px"}},{default:ne(()=>[ae(ke,{label:"全部",value:""}),ae(ke,{label:"门神",value:"door"}),ae(ke,{label:"本体",value:"final"}),ae(ke,{label:"无设定",value:"undefined"})]),_:1},8,["modelValue"]),ae(ze,{modelValue:oe(He),"onUpdate:modelValue":n[9]||(n[9]=e=>re(He)?He.value=e:null),placeholder:"筛选职业",clearable:"",size:"small",style:{width:"180px"}},{default:ne(()=>[ae(ke,{label:"全部职业",value:""}),(te(!0),le(me,null,fe(oe(d).jobList,e=>(te(),ce(ke,{key:e,label:Et(e),value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),Te(pe("div",null,[ae(Ie,{type:"info"},{default:ne(()=>[ie(" 筛选结果：共 "+ue(oe(Ke).length)+" 个时间轴 ",1)]),_:1})],512),[[Fe,oe(Me)||oe(Re)||oe(He)||oe(Ze)]]),pe("div",null,[ae(G,{type:"primary",size:"small",disabled:0===oe(J).length,onClick:at},{default:ne(()=>[ie(" 批量导出 ("+ue(oe(J).length)+") ",1)]),_:1},8,["disabled"]),ae(G,{type:"danger",size:"small",disabled:0===oe(J).length,style:{"margin-left":"10px"},onClick:et},{default:ne(()=>[ie(" 批量删除 ("+ue(oe(J).length)+") ",1)]),_:1},8,["disabled"]),ae(G,{type:"danger",size:"small",plain:"",style:{"margin-left":"10px"},onClick:tt},{default:ne(()=>[...n[36]||(n[36]=[ie(" 清空列表 ",-1)])]),_:1})])]),ae(P,{data:oe(Ke),"row-class-name":zt,style:{width:"100%"},stripe:"","default-sort":{prop:"condition",order:"ascending"},onSelectionChange:n[11]||(n[11]=e=>{J.value=e,L.value=e.length===oe(w).length})},{default:ne(()=>[ae(D,{type:"selection",width:"55",align:"center"},{header:ne(()=>[ae(Pe,{modelValue:oe(L),"onUpdate:modelValue":n[10]||(n[10]=e=>re(L)?L.value=e:null),onChange:lt},null,8,["modelValue"])]),_:1}),ae(D,{prop:"name",label:"名称",sortable:"","show-overflow-tooltip":!0}),ae(D,{label:"地图",sortable:"",prop:"condition"},{default:ne(e=>[ie(ue(Bt(e.row.condition.zoneID)),1)]),_:1}),ae(D,{prop:"condition",label:"阶段",width:"80"},{default:ne(e=>[ie(ue("door"===e.row.condition.phase?"门神":"final"===e.row.condition.phase?"本体":""),1)]),_:1}),ae(D,{prop:"condition",label:"职业"},{default:ne(e=>[ie(ue(e.row.condition.jobs.map(e=>Et(e)).join("、").replace("冒险者","全部职业")),1)]),_:1}),ae(D,{label:"操作",width:"220"},{default:ne(e=>[ae(G,{type:"primary",size:"small",onClick:t=>Ge(e.row)},{default:ne(()=>[...n[37]||(n[37]=[ie(" 编辑 ",-1)])]),_:1},8,["onClick"]),ae(G,{size:"small",onClick:t=>function(e){const t=JSON.parse(JSON.stringify(e));t.name=`${t.name} - 副本`,t.createdAt=(new Date).toLocaleString(),w.value.push(t),d.sortTimelines(),x.success(`已制作「${e.name}」的副本`)}(e.row)},{default:ne(()=>[...n[38]||(n[38]=[ie(" 制作副本 ",-1)])]),_:1},8,["onClick"]),ae(G,{type:"danger",size:"small",onClick:t=>{return l=e.row,void g.confirm(`确定要删除「${l.name}」吗？`,"删除时间轴",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning"}).then(()=>{w.value.splice(w.value.findIndex(e=>e===l),1)}).catch(()=>{});var l}},{default:ne(()=>[...n[39]||(n[39]=[ie(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):(te(),ce(Le,{key:1},{default:ne(()=>[ae(Ft,{description:"点击上方新建或导入一个时间轴吧~"})]),_:1}))]),_:1}),ae(R,{modelValue:oe(M),"onUpdate:modelValue":n[22]||(n[22]=e=>re(M)?M.value=e:null),title:"编辑时间轴",center:"","align-center":"","before-close":Xe,class:"timeline-dialog",width:"65%",style:{"min-width":"550px","max-width":"1000px"},"close-on-click-modal":!1,"close-on-press-escape":!1},{default:ne(()=>[pe("div",dt,[ae(Dt,{model:oe(De)},{default:ne(()=>[ae(he,{class:"timeline-header",gutter:10},{default:ne(()=>[ae(Ct,{span:16},{default:ne(()=>[ae(Vt,{label:"名称"},{default:ne(()=>[ae($e,{modelValue:oe(De).name,"onUpdate:modelValue":n[12]||(n[12]=e=>oe(De).name=e),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1})]),_:1}),ae(Ct,{span:8},{default:ne(()=>[ae(Vt,{label:"来源"},{default:ne(()=>[pe("div",ut,[Ne.test(oe(De).source)?(te(),ce(ye,{key:0,href:`https://cn.fflogs.com/reports/${oe(De).source.replace("#","?")}&type=damage-done`,target:"_blank",class:"source-link"},{default:ne(()=>[n[40]||(n[40]=pe("img",{class:"site-logo",src:"https://assets.rpglogs.cn/img/ff/favicon.png?v=4",alt:"FF Logs"},null,-1)),pe("span",null,ue(oe(De).source),1)]),_:1},8,["href"])):(te(),ce($e,{key:1,value:`${oe(De).source}${oe(De).createdAt?`（${oe(De).createdAt}）`:""}`,disabled:""},null,8,["value"]))])]),_:1})]),_:1}),ae(Ct,{span:24},{default:ne(()=>[ae(he,{gutter:10},{default:ne(()=>[ae(Ct,{span:oe(W)[oe(De).condition.zoneID]?16:24},{default:ne(()=>[ae(Vt,{label:"地图"},{default:ne(()=>[ae(Se,{"select-zone":oe(De).condition.zoneID,"onUpdate:selectZone":n[13]||(n[13]=e=>oe(De).condition.zoneID=e),size:"default",style:{width:"100%"}},null,8,["select-zone"])]),_:1})]),_:1},8,["span"]),oe(W)[oe(De).condition.zoneID]?(te(),ce(Ct,{key:0,span:8},{default:ne(()=>[ae(Vt,{label:"阶段"},{default:ne(()=>[ae(jt,{modelValue:oe(De).condition.phase,"onUpdate:modelValue":n[14]||(n[14]=e=>oe(De).condition.phase=e),size:"default",style:{display:"flex","flex-wrap":"nowrap"}},{default:ne(()=>[ae(Nt,{value:"door"},{default:ne(()=>[...n[41]||(n[41]=[ie(" 门神 ",-1)])]),_:1}),ae(Nt,{value:"final"},{default:ne(()=>[...n[42]||(n[42]=[ie(" 本体 ",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})):de("",!0)]),_:1})]),_:1}),ae(Ct,{span:24},{default:ne(()=>[ae(Vt,{label:"职业"},{default:ne(()=>[ae(ze,{modelValue:oe(De).condition.jobs,"onUpdate:modelValue":n[15]||(n[15]=e=>oe(De).condition.jobs=e),multiple:"","collapse-tags":"","collapse-tags-indicator":"",style:{width:"100%"},placeholder:"选择适用职业"},{default:ne(()=>[(te(!0),le(me,null,fe(oe(d).jobList,e=>(te(),ce(ke,{key:e,label:Et(e),value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),pe("div",pt,[ae(Ut,{modelValue:oe(U),"onUpdate:modelValue":n[16]||(n[16]=e=>re(U)?U.value=e:null),min:-oe(d).configValues.preBattle,max:oe(We),step:.1},null,8,["modelValue","min","max"]),pe("div",mt,[pe("p",ft,ue(oe(qe)),1),pe("p",yt," ("+ue(oe(U))+"s) ",1)])]),ae(he,{class:"timeline-editor-body",gutter:10},{default:ne(()=>[ae(Ct,null,{default:ne(()=>[ae($e,{modelValue:oe(De).timeline,"onUpdate:modelValue":n[17]||(n[17]=e=>oe(De).timeline=e),style:se({width:`calc(100% - ${oe(d).showStyle["--timeline-width"]}px)`}),type:"textarea",autosize:{minRows:10,maxRows:20},wrap:"off",placeholder:"请键入时间轴文本",onChange:n[18]||(n[18]=e=>Qe())},null,8,["modelValue","style"])]),_:1}),ae(Jt,{style:{position:"absolute",right:0,top:0},config:oe(d).configValues,lines:oe(Je),runtime:oe(U),"show-style":oe(d).showStyle},null,8,["config","lines","runtime","show-style"])]),_:1}),pe("div",wt,[ae(Y,null,{default:ne(()=>[ae(G,{onClick:n[19]||(n[19]=e=>_t([oe(De)]))},{default:ne(()=>[...n[43]||(n[43]=[ie(" 导出 ",-1)])]),_:1}),ae(G,{onClick:n[20]||(n[20]=e=>{De.value.timeline=De.value.timeline.replaceAll(new RegExp("(?<=^(?:#\\s*)?)(\\d+(?::\\d+(?:\\.\\d{1,2})?|(?:\\.\\d+)?))","gm"),e=>e.includes(":")?Ve.duration(`00:${e}`).as("seconds").toString():Ve.utc(1e3*Number(e)).format("mm:ss.S"))})},{default:ne(()=>[...n[44]||(n[44]=[ie(" 切换时间格式 ",-1)])]),_:1}),ae(G,{onClick:kt},{default:ne(()=>[...n[45]||(n[45]=[ie(" 时间轴语法 ",-1)])]),_:1}),ae(G,{onClick:n[21]||(n[21]=e=>{g.confirm("要删除所有的注释行，仅保留必要的时间轴数据吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{De.value.timeline=De.value.timeline.replace(/^#.*(?:\n|$)/gm,""),x.success("完成")}).catch(()=>{})})},{default:ne(()=>[...n[46]||(n[46]=[ie(" 去除注释行 ",-1)])]),_:1}),ae(G,{onClick:It},{default:ne(()=>[...n[47]||(n[47]=[ie(" 展示调试信息 ",-1)])]),_:1})]),_:1})])])]),_:1},8,["modelValue"]),ae(R,{modelValue:oe(Q),"onUpdate:modelValue":n[25]||(n[25]=e=>re(Q)?Q.value=e:null),title:"导出时间轴",width:"400px","append-to-body":""},{footer:ne(()=>[pe("span",vt,[ae(G,{onClick:n[24]||(n[24]=e=>Q.value=!1)},{default:ne(()=>[...n[51]||(n[51]=[ie("取消",-1)])]),_:1}),ae(G,{type:"primary",onClick:xt},{default:ne(()=>[...n[52]||(n[52]=[ie(" 复制到剪贴板 ",-1)])]),_:1})])]),default:ne(()=>[n[53]||(n[53]=pe("div",{style:{"margin-bottom":"15px",color:"var(--el-text-color-secondary)"}}," 请选择导出格式和压缩方案： ",-1)),ae(jt,{modelValue:oe(ge),"onUpdate:modelValue":n[23]||(n[23]=e=>re(ge)?ge.value=e:null),class:"export-radio-group"},{default:ne(()=>[ae(Pt,{value:"compressed_full",border:""},{default:ne(()=>[n[48]||(n[48]=ie(" 完整压缩版 ",-1)),pe("span",gt,"("+ue(oe(Oe).fullSize)+" 字节, 带注释)",1)]),_:1}),ae(Pt,{value:"compressed_zip",border:""},{default:ne(()=>[n[49]||(n[49]=ie(" 优化压缩版 ",-1)),pe("span",bt,"("+ue(oe(Oe).optimizedSize)+" 字节, 去注释)",1)]),_:1}),ae(Pt,{value:"raw_json",border:""},{default:ne(()=>[n[50]||(n[50]=ie(" 原始 JSON 版 ",-1)),pe("span",ht,"("+ue(oe(Oe).rawSize)+" 字节, 未压缩)",1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})}}}),[["__scopeId","data-v-926c6cb2"]]);export{_t as default};
