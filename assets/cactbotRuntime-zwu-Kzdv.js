import{_ as e}from"./ActWrapper-DjXKlhz6.js";import{u as a,l as t,_ as r}from"./DragJob-BYfKfmgi.js";import{d as o,g as s,r as n,f as l,h as i,aX as p,j as u,w as d,o as m,a as c,k as y,c as f,B as v,v as b,u as j,l as g,F as h,t as x,b as k}from"./index-CfWIArTm.js";import{E as S}from"./el-divider-CR-1s8F9.js";import{u as _}from"./useDev-B6dM0VfQ.js";import{u as E}from"./useZone-CtmliqbQ.js";import{R as J}from"./demoParty-BV84cNY5.js";import{U as C}from"./util-BOtaAWHW.js";import{a as w,r as T,c as D}from"./overlay_plugin_api-DHbPkDtN.js";import{u as P}from"./index-COZhASc_.js";import{E as U}from"./index-85HngL_Q.js";import{_ as R}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-card-Cetm1Xcc.js";import"./useDemo-Dro0OvzR.js";import"./el-checkbox-B4Wiu_sy.js";import"./index-BfE0MYc2.js";import"./use-form-common-props-CcSJnIzn.js";import"./isEqual-C51h9OPS.js";import"./index-Cmx-_W9k.js";import"./zoneInfo-BArkjkv3.js";import"./zone_info-C7ipylWh.js";import"./content_type-lMHx3DqW.js";import"./index-4qSU9JtA.js";import"./validator-DFIkUK-I.js";import"./index-B2-SMDq2.js";import"./index-bCxfRuk1.js";import"./focus-trap-CWTUl_zP.js";import"./index-C3XwXLs2.js";import"./vnode-CEI2QS5e.js";import"./scroll-8HWjSGjP.js";const z={class:"cactbot-runtime-container"},B={class:"players",flex:"~ nowrap gap-1"},L={class:"fixed-rp"},V={class:"fixed-player"},I={class:"drag-job"},M={key:0,style:{position:"fixed",bottom:"0"}},O=R(o({__name:"cactbotRuntime",setup(o){const{zoneType:R,zoneID:O}=E(),H=s(()=>{if(134===O.value)return!0;switch(R.value){case"Savage":case"Ultimate":case"VCDungeonFinder":case"Default":return!0;default:return le(),!1}}),q=P("cactbotRuntime-showNotification",!0),A=["tank","healer","dps"],F=a(),N=n(!1),Q=_(),X=new J,Z=l({party:[],partySorted:{tank:[],healer:[],dps:[]}});function $(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const G={tank:["MT","ST",...$("T",22,2)],healer:[...$("H",24)],dps:[...$("D",24)]},K=n("");function W(){const e=[...G.tank.slice(0,Z.partySorted.tank.length),...G.healer.slice(0,Z.partySorted.healer.length),...G.dps.slice(0,Z.partySorted.dps.length)],a=[...Z.partySorted.tank,...Z.partySorted.healer,...Z.partySorted.dps].map((a,t)=>({...a,rp:e[t]}));D({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a}})}function Y(){const e=Z.party.slice().sort((e,a)=>F.arr.indexOf(C.baseJobEnumConverted(e.job))-F.arr.indexOf(C.baseJobEnumConverted(a.job)));Z.partySorted.tank=e.filter(e=>C.isTankJob(C.jobEnumToJob(e.job))),Z.partySorted.healer=e.filter(e=>C.isHealerJob(C.jobEnumToJob(e.job))),Z.partySorted.dps=e.filter(e=>C.isDpsJob(C.jobEnumToJob(e.job))),W()}function ee(){Y()}function ae(){W()}const te=()=>{N.value=!0},re=()=>{N.value=!1},oe=e=>{Q.value&&0===e.party.length||(Z.party=e.party.filter(e=>e.inParty),Y())},se=e=>{Q.value||(K.value=e.charName)},ne=e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&W()};function le(){q.value&&U.confirm("即日起，本悬浮窗将只在高难副本中显示，平时隐藏。","公告",{confirmButtonText:"不再提示",cancelButtonText:"关闭",type:"warning",buttonSize:"small"}).then(()=>{q.value=!1}).catch(()=>{})}function ie(){K.value=X.party.value[0].name,Z.party=X.party.value.filter(e=>e.name===K.value),Y()}function pe(){K.value=X.party.value[0].name,Z.party=X.party.value,Y()}function ue(){X.shuffle({dps:4,healer:2,tank:2,crafter:3,gatherer:3,none:3}),pe()}return i(()=>{document.body.addEventListener("mouseenter",te),document.body.addEventListener("mouseleave",re),w("ChangePrimaryPlayer",se),w("PartyChanged",oe),w("BroadcastMessage",ne)}),p(()=>{document.body.removeEventListener("mouseenter",te),document.body.removeEventListener("mouseleave",re),T("PartyChanged",oe),T("ChangePrimaryPlayer",se),T("BroadcastMessage",ne)}),(a,o)=>{const s=S,n=r,l=e;return m(),u(l,null,{readme:d(()=>o[0]||(o[0]=[c("span",{class:"demo-text"},[c("p",null,"使悬浮窗的位置分配对应游戏内的实际位置"),c("ul",null,[c("li",null,"每次小队变化时，会按规则进行排序"),c("li",null,"你可以上下拖拽玩家名称，临时调整"),c("li",null,"只有在高难本里时，才会显示界面。（盛夏农庄除外）")])],-1)])),default:d(()=>[c("div",z,[y(c("main",null,[c("div",B,[c("div",L,[(m(),f(h,null,g(A,(e,a)=>c("div",{key:`fixed-rp-${e}`,class:"player-role"},[(m(!0),f(h,null,g(j(Z).partySorted[e],(a,t)=>(m(),f("div",{key:t,style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},[y(c("span",null,x(G[e][t]),513),[[b,j(N)||a.name===j(K)]])]))),128)),j(Z).partySorted[e].length>0&&a<2&&j(N)?(m(),u(s,{key:0})):v("",!0)])),64))]),c("div",V,[(m(),f(h,null,g(A,(e,a)=>k(j(t),{key:`fixed-player-${e}`,modelValue:j(Z).partySorted[e],"onUpdate:modelValue":a=>j(Z).partySorted[e]=a,animation:200,"ghost-class":"ghost","force-fallback":!0,filter:".no-draggable",onUpdate:ae},{default:d(()=>[(m(!0),f(h,null,g(j(Z).partySorted[e],e=>y((m(),f("div",{key:e.id,class:"player-line"},[c("span",null,x(e.name),1)])),[[b,j(N)]])),128)),j(Z).partySorted[e].length>0&&a<2&&j(N)?(m(),u(s,{key:0,class:"no-draggable"})):v("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])),64))])]),c("div",I,[j(N)?(m(),u(n,{key:0,party:j(Z).party,onUpdate:ee},null,8,["party"])):v("",!0)])],512),[[b,j(H)]]),j(Q)?(m(),f("div",M,[c("button",{onClick:ie}," 测试单人 "),c("button",{onClick:pe}," 测试组队 "),c("button",{onClick:ue}," 测试随机组队 "),c("button",{onClick:le}," 测试弹窗 ")])):v("",!0)])]),_:1})}}}),[["__scopeId","data-v-3e551cf5"]]);export{O as default};
