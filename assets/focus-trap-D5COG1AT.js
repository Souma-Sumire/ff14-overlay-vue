import{aS as e,r as t,h as n,i as o,X as r,Y as s,_ as a,d as u,I as d,U as c,u as i,aV as l,W as f,aw as v,T as p}from"./index-B-PvB7wX.js";const m=e=>Array.from(e.querySelectorAll('a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])')).filter(e=>E(e)&&(e=>"fixed"!==getComputedStyle(e).position&&null!==e.offsetParent)(e)),E=e=>{if(e.tabIndex>0||0===e.tabIndex&&null!==e.getAttribute("tabIndex"))return!0;if(e.tabIndex<0||e.hasAttribute("disabled")||"true"===e.getAttribute("aria-disabled"))return!1;switch(e.nodeName){case"A":return!!e.href&&"ignore"!==e.rel;case"INPUT":return!("hidden"===e.type||"file"===e.type);case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},b=e=>!e.getAttribute("aria-owns"),y=(e,t,n)=>{const{parentNode:o}=e;if(!o)return null;const r=o.querySelectorAll(n);return r[Array.prototype.indexOf.call(r,e)+t]||null},w=e=>{e&&(e.focus(),!b(e)&&e.click())},h="focus-trap.focus-after-trapped",L="focus-trap.focus-after-released",T={cancelable:!0,bubbles:!1},A={cancelable:!0,bubbles:!1},g="focusAfterTrapped",x="focusAfterReleased",S=Symbol("elFocusTrap"),I=t(),N=t(0),R=t(0);let F=0;const P=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},k=(e,t)=>{for(const n of e)if(!K(n,t))return n},K=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1},C=(t,n)=>{if(t&&t.focus){const o=document.activeElement;let r=!1;!e(t)||E(t)||t.getAttribute("tabindex")||(t.setAttribute("tabindex","-1"),r=!0),t.focus({preventScroll:!0}),R.value=window.performance.now(),t!==o&&(e=>e instanceof HTMLInputElement&&"select"in e)(t)&&n&&t.select(),e(t)&&r&&t.removeAttribute("tabindex")}};function _(e,t){const n=[...e],o=e.indexOf(t);return-1!==o&&n.splice(o,1),n}const O=(()=>{let e=[];return{push:t=>{const n=e[0];n&&t!==n&&n.pause(),e=_(e,t),e.unshift(t)},remove:t=>{var n,o;e=_(e,t),null==(o=null==(n=e[0])?void 0:n.resume)||o.call(n)}}})(),U=()=>{I.value="pointer",N.value=window.performance.now()},q=()=>{I.value="keyboard",N.value=window.performance.now()},j=e=>new CustomEvent("focus-trap.focusout-prevented",{...A,detail:e});let B=[];const D=e=>{e.code===s.esc&&B.forEach(t=>t(e))};var W=a(u({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[g,x,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:a}){const u=t();let d,m;const{focusReason:E}=(n(()=>{0===F&&(document.addEventListener("mousedown",U),document.addEventListener("touchstart",U),document.addEventListener("keydown",q)),F++}),o(()=>{F--,F<=0&&(document.removeEventListener("mousedown",U),document.removeEventListener("touchstart",U),document.removeEventListener("keydown",q))}),{focusReason:I,lastUserFocusTimestamp:N,lastAutomatedFocusTimestamp:R});var b;b=t=>{e.trapped&&!y.paused&&a("release-requested",t)},n(()=>{0===B.length&&document.addEventListener("keydown",D),r&&B.push(b)}),o(()=>{B=B.filter(e=>e!==b),0===B.length&&r&&document.removeEventListener("keydown",D)});const y={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},w=t=>{if(!e.loop&&!e.trapped)return;if(y.paused)return;const{code:n,altKey:o,ctrlKey:r,metaKey:u,currentTarget:d,shiftKey:c}=t,{loop:i}=e,l=n===s.tab&&!o&&!r&&!u,f=document.activeElement;if(l&&f){const e=d,[n,o]=(e=>{const t=P(e);return[k(t,e),k(t.reverse(),e)]})(e);if(n&&o)if(c||f!==o){if(c&&[n,e].includes(f)){const e=j({focusReason:E.value});a("focusout-prevented",e),e.defaultPrevented||(t.preventDefault(),i&&C(o,!0))}}else{const e=j({focusReason:E.value});a("focusout-prevented",e),e.defaultPrevented||(t.preventDefault(),i&&C(n,!0))}else if(f===e){const e=j({focusReason:E.value});a("focusout-prevented",e),e.defaultPrevented||t.preventDefault()}}};p(S,{focusTrapRef:u,onKeydown:w}),c(()=>e.focusTrapEl,e=>{e&&(u.value=e)},{immediate:!0}),c([u],([e],[t])=>{e&&(e.addEventListener("keydown",w),e.addEventListener("focusin",_),e.addEventListener("focusout",W)),t&&(t.removeEventListener("keydown",w),t.removeEventListener("focusin",_),t.removeEventListener("focusout",W))});const A=e=>{a(g,e)},K=e=>a(x,e),_=t=>{const n=i(u);if(!n)return;const o=t.target,r=t.relatedTarget,s=o&&n.contains(o);if(!e.trapped){r&&n.contains(r)||(d=r)}s&&a("focusin",t),y.paused||e.trapped&&(s?m=o:C(m,!0))},W=t=>{const n=i(u);if(!y.paused&&n)if(e.trapped){const o=t.relatedTarget;l(o)||n.contains(o)||setTimeout(()=>{if(!y.paused&&e.trapped){const e=j({focusReason:E.value});a("focusout-prevented",e),e.defaultPrevented||C(m,!0)}},0)}else{const e=t.target;e&&n.contains(e)||a("focusout",t)}};async function H(){await f();const t=i(u);if(t){O.push(y);const n=t.contains(document.activeElement)?d:document.activeElement;d=n;if(!t.contains(n)){const o=new Event(h,T);t.addEventListener(h,A),t.dispatchEvent(o),o.defaultPrevented||f(()=>{let o=e.focusStartEl;v(o)||(C(o),document.activeElement!==o&&(o="first")),"first"===o&&((e,t=!1)=>{const n=document.activeElement;for(const o of e)if(C(o,t),document.activeElement!==n)return})(P(t),!0),document.activeElement!==n&&"container"!==o||C(t)})}}}function M(){const e=i(u);if(e){e.removeEventListener(h,A);const t=new CustomEvent(L,{...T,detail:{focusReason:E.value}});e.addEventListener(L,K),e.dispatchEvent(t),t.defaultPrevented||"keyboard"!=E.value&&N.value>R.value&&!e.contains(document.activeElement)||C(null!=d?d:document.body),e.removeEventListener(L,K),O.remove(y)}}return n(()=>{e.trapped&&H(),c(()=>e.trapped,e=>{e?H():M()})}),o(()=>{e.trapped&&M(),u.value&&(u.value.removeEventListener("keydown",w),u.value.removeEventListener("focusin",_),u.value.removeEventListener("focusout",W),u.value=void 0)}),{onKeydown:w}}}),[["render",function(e,t,n,o,r,s){return d(e.$slots,"default",{handleKeydown:e.onKeydown})}],["__file","focus-trap.vue"]]);export{W as E,S as F,E as a,w as f,y as g,b as i,m as o,C as t};
