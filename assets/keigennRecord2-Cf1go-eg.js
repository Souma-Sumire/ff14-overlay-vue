import{t as e,r as i,f as a,P as r,v as s,x as n,A as t,au as l,L as o,a9 as c,K as d,u as m,G as p,J as u,D as y,E as f,M as g,H as h,S as b,c as v,V as k,d as w,ae as F,F as C,O as I,h as N,an as x}from"./vue-vendor-wZ_5aAzA.js";import{_ as j}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{s as $,c as E,a as T}from"./status-ZBCCf2zf.js";import{b as A,u as _}from"./index-CKUOrbjt.js";import{h as D,g as H}from"./xivapi-Ec95Svg1.js";import{V as S}from"./index-ojw9OhtT.js";/* empty css                  *//* empty css                   */import{Q as L}from"./element-plus-8--zztY3.js";import"./style-l0sNRNKZ.js";import{g as O}from"./actionChinese-JglXKfBi.js";import{U as z}from"./util-DL4pAhxD.js";import{N as P,l as W}from"./netregexes-r2K2MLa5.js";import{a as M}from"./overlay_plugin_api-DU1DlPio.js";const R={class:"upload select"},B=j(e({__name:"TestLog",emits:["handleLine","beforeHandle","afterHandle"],setup(e,{emit:l}){const o=l,c=i(null),d=i(null);async function m(e){var i,a;null==(i=d.value)||i.classList.remove("drag");const r=e.target.files;if(r&&0!==r.length){o("beforeHandle");for(let e=0;e<r.length;e++){const i=r[e],a=await i.text();for(const e of a.split("\n"))o("handleLine",e)}o("afterHandle"),null==(a=d.value)||a.classList.remove("drag")}}function p(e){var i;e.preventDefault(),null==(i=d.value)||i.classList.add("drag")}function u(e){var i;e.preventDefault(),null==(i=d.value)||i.classList.remove("drag")}return a((()=>{var e,i,a;null==(e=c.value)||e.addEventListener("change",m),null==(i=d.value)||i.addEventListener("dragover",p),null==(a=d.value)||a.addEventListener("dragleave",u)})),r((()=>{var e,i,a;null==(e=c.value)||e.removeEventListener("change",m),null==(i=d.value)||i.removeEventListener("dragover",p),null==(a=d.value)||a.removeEventListener("dragleave",u)})),(e,i)=>(n(),s("div",R,[t("div",{ref_key:"select",ref:d,class:"upload-select"},[i[0]||(i[0]=t("div",{class:"upload text"},[t("span",null,"+"),t("p",null,"上传或拖入ACT日志")],-1)),t("input",{ref_key:"input",ref:c,type:"file"},null,512)],512)]))}}),[["__scopeId","data-v-d4cc5834"]]),G=[{name:"铁壁",id:1191,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"盾阵",id:1856,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"干预",id:1174,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"预警",id:74,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"武装",id:1176,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神圣领域",id:82,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣光幕帘",id:1362,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣盾阵",id:2674,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"骑士的坚守",id:2675,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"壁垒",id:77,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的直觉",id:735,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的勇猛",id:1857,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的武猛",id:1858,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"战栗",id:87,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"复仇",id:89,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"摆脱",id:1457,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死斗",id:409,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血气",id:2678,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血潮",id:2679,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血烟",id:2680,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"至黑之夜",id:1178,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"弃明投暗",id:746,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"暗影墙",id:747,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑布道",id:1894,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"行尸走肉",id:810,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死而不僵",id:811,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"出死入生",id:3255,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"献奉",id:2682,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"石之心",id:1840,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残暴弹",id:1898,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"伪装",id:1832,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"星云",id:1834,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"光之心",id:1839,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"超火流星",id:1836,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之心",id:2683,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之清",id:2684,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神祝祷",id:1218,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"节制",id:1873,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"水流幕",id:2708,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"鼓舞",id:297,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"激励",id:1918,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"炽天的幕帘",id:1917,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"野战治疗阵",id:299,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"异想的幻光",id:317,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"炽天的幻光",id:1875,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"生命回生法",id:2710,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"怒涛之计",id:2711,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"命运之轮",id:849,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"天星交错",id:1889,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"擢升",id:2717,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"中间学派",id:1921,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡诊断",id:2607,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"齐衡诊断",id:2608,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡预后",id:2609,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚角清汁",id:2618,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"白牛清汁",id:2619,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体论",id:3003,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体盾",id:3365,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"输血",id:2612,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"泛输血",id:2613,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"心眼",id:1232,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"金刚极意",id:1179,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"行吟",id:1934,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"策动",id:1951,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"防守之桑巴",id:1826,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"即兴表演结束",id:2697,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残影",id:488,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"魔罩",id:168,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护之光",id:2702,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护纹",id:2597,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"抗死",id:2707,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"雪仇",id:1193,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"牵制",id:1195,type:"multiplier",performance:{physics:1,magic:.5,darkness:0},isFriendly:!1},{name:"昏乱",id:1203,type:"multiplier",performance:{physics:.5,magic:1,darkness:0},isFriendly:!1},{name:"武装解除",id:860,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"减速",id:9,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"体力增加",id:2120,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"腐臭",id:1715,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"智力精神降低",id:2115,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!1},{name:"龙之力",id:2500,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"超硬化",id:1722,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"玄结界",id:2496,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"仙人盾",id:2119,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"强力守护",id:1719,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"哥布防御",id:2114,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"铜墙铁盾",id:194,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚守要塞",id:195,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"终极堡垒",id:196,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初大地",id:863,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑之力",id:864,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"灵魂之青",id:1931,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"极致防御",id:3829,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"极致护盾",id:3830,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"戮罪",id:3832,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗影卫",id:3835,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"大星云",id:3838,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坦培拉涂层",id:3686,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"油性坦培拉涂层",id:3687,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"世界树之干",id:3890,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"建筑神之塔",id:3892,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"太阳星座",id:3896,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神爱抚",id:3903,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0}],U=[...G],Z=new Map;let V="Chinese";function Y(e){if(V!==e||0===Z.size){Z.clear();for(const i of"Chinese"===e?G:U){const e=$[i.id][1];i.fullIcon=E(e),Z.set(i.id.toString(16).toUpperCase().padStart(2,"0"),i)}V=e}}function J(e){return 1===e?"useful":0===e?"unuseful":"half-useful"}Y("Chinese");function q(e,i){return Object.entries($).reduce(((a,[r,[s,n]])=>(e.test(s)&&a.set(r,{name:s,icon:n,isFriendly:i}),a)),new Map)}const K=q(/(?:耐性|防御力)(?:大幅)?(?:降低|提升|低下|下降)|受伤(?:加重|减轻)|体力(?:增加|衰减|减少)|伤害屏障/,!0),Q=q(/(?:精神|力量|灵巧|智力){1,2}(?:大幅)?降低/,!1),X=A("hash"),ee=l("keigennRecord2",{state:()=>({userOptions:{scale:ie(X.scale,1),opacity:ie(X.opacity,.8),showHeader:ie(X.showHeader,!0),showIcon:ie(X.showIcon,!0),iconType:ie(X.iconType,3),showName:ie(X.showName,!1),abbrId:ie(X.abbrId,!0),anonymous:ie(X.anonymous,!0),replaceWithYou:ie(X.replaceWithYou,!1),parseAA:ie(X.parseAA,!0),parseDoT:ie(X.parseDoT,!1),minimize:ie(X.minimize,!1),actionCN:ie(X.actionCN,!0),statusCN:ie(X.statusCN,!0)},isBrowser:!1,isLocalhost:!1}),getters:{icon4k:e=>e.userOptions.scale>=2||window.devicePixelRatio>=2?"_hr1":""},actions:{recheckIsDev(){this.isBrowser=!window.OverlayPluginApi&&!X.OVERLAY_WS&&!X.HOST_PORT,this.isLocalhost="localhost"===location.hostname,this.isBrowser&&setTimeout((()=>this.recheckIsDev()),1e3)},formatterName:e=>e,initEnvironment(e){/^[A-Z]\S+ [A-Z]\S+$/.test(e)?(this.userOptions.abbrId&&(this.formatterName=e=>e.replace(/^([A-Z])\S+ ([A-Z])\S+$/,"$1.$2.")),Y("Global")):(this.userOptions.abbrId&&(this.formatterName=e=>e.substring(0,2)),Y("Chinese"))}}});function ie(e,i){return"boolean"==typeof i?"0"!==e&&"false"!==(null==e?void 0:e.toLocaleLowerCase())&&("1"===e||"true"===(null==e?void 0:e.toLocaleLowerCase())||i):"number"==typeof i?Number.isNaN(+e)?i:+e:i}function ae(e){switch(e){case"dodge":return"闪避";case"damage done":return"击中";case"blocked damage":return"格挡";case"parried damage":return"招架";case"instant death":return"即死";case"heal":return"治疗";case"crit heal":return"暴击治疗";case"damage":return"普通";case"crit damage":return"暴击";case"direct hit damage":return"直击";case"crit direct hit damage":return"直暴";case"physics":return"物理";case"magic":return"魔法";case"darkness":return"暗黑";default:throw new Error("Unknown type")}}function re(e){const i=function(e){switch(!0){case e.endsWith("1"):return"dodge";case e.endsWith("3"):return"damage done";case e.endsWith("5"):return"blocked damage";case e.endsWith("6"):return"parried damage";case e.endsWith("33"):return"instant death";case e.endsWith("4"):return"heal";case/2\w{4}4$/.test(e):return"crit heal";default:throw new Error(`Unknown effect flag ${e}`)}}(e),a=function(e){switch(!0){case/2\w{3}$/.test(e):return"crit damage";case/4\w{3}$/.test(e):return"direct hit damage";case/6\w{3}$/.test(e):return"crit direct hit damage";default:return"damage"}}(e),r=function(e){switch(!0){case/7?[1-4]\w{3}[35]$|[16]$/.test(e):return"physics";case/^E$/.test(e):case/5\w{4}$/.test(e):return"magic";case/^(?:\d0)?3$/.test(e):case/6\w{4}$/.test(e):return"darkness";default:return"physics"}}(e);return{effect:i,properties:a,type:r}}const se=["3E","113","213","313"],ne=["A10","E"],te=["04"],le=["01","03","05","06","36"];function oe(e){let i=0,a=e[8]??"",r=e[9]??"";se.includes(a)&&(i+=2,a=e[8+i]??a,r=e[8+i+1]??r),ne.includes(a)&&(i+=2,a=e[8+i]??a,r=e[8+i+1]??r);const s=function(e){if(void 0===e)return 0;const i=e.length;if(i<=4)return 0;let a=Number.parseInt(e.slice(0,i-4),16);if("4"===e[i-4]){const r=Number.parseInt(e.slice(i-2,i),16);a=a-r+(r<<16)}return a}(r),n=`00${a}`.slice(-2);return{amount:s,lowByte:n,flags:a,isHeal:te.includes(n),isAttack:le.includes(n)}}const ce={key:0},de={key:1},me=["title","data-duration","data-sourcePov"],pe=["src","alt"],ue=e({__name:"StatusShow",props:{row:{type:Object,required:!0}},setup(e){const i=e,a=ee().icon4k;return(r,l)=>"dot"===i.row.type?(n(),s("div",ce," （不支持） ")):(n(),s("div",de,[(n(!0),s(o,null,c(i.row.keigenns,((i,r)=>(n(),s("span",{key:r},[t("span",{class:"status",title:`${i.name}(${i.source})`,"data-duration":i.remainingDuration,"data-sourcePov":i.isPov},[t("img",{class:p(`statusIcon ${m(J)(i.performance[e.row.type])}`),src:m(H)(`/i/${i.fullIcon}${m(a)}.png`),alt:i.effect,loading:"lazy",onError:l[0]||(l[0]=(...e)=>m(D)&&m(D)(...e))},null,42,pe)],8,me)])))),128)),t("span",null,d("damage done"===e.row.effect?"":m(ae)(e.row.effect)),1)]))}}),ye=e({__name:"AmountDetails",props:{row:{type:Object,required:!0}},setup(e){const i=e;return(e,a)=>(n(),s("div",null,[t("span",null,"来源:"+d(i.row.source),1),a[1]||(a[1]=t("br",null,null,-1)),t("span",null,"目标:"+d(i.row.target),1),a[2]||(a[2]=t("br",null,null,-1)),t("span",null," 护盾:"+d(Math.round(i.row.maxHp*+i.row.shield/100))+" ("+d(i.row.shield)+"%) ",1),a[3]||(a[3]=t("br",null,null,-1)),t("span",null," 血量:"+d(i.row.currentHp)+"/"+d(i.row.maxHp)+" ("+d(Math.round(i.row.currentHp/i.row.maxHp*100))+"%) ",1),a[4]||(a[4]=t("br",null,null,-1)),t("span",null,[a[0]||(a[0]=u("伤害:")),t("span",{class:p(i.row.type)},d(i.row.amount),3)]),a[5]||(a[5]=t("br",null,null,-1)),t("span",null," 剩余:"+d(i.row.currentHp-i.row.amount)+" ("+d(Math.round((i.row.currentHp-i.row.amount)/i.row.maxHp*100))+"%) ",1)]))}}),fe=[Number(409).toString(16).toUpperCase(),Number(810).toString(16).toUpperCase(),Number(811).toString(16).toUpperCase(),Number(1836).toString(16).toUpperCase()];function ge(e){return e.currentHp-e.amount<0&&!e.keigenns.find((e=>fe.includes(e.effectId)))}const he={class:"amount"},be=e({__name:"Amount",props:{row:{type:Object,required:!0}},setup(e){const i=e;return(a,r)=>{const s=ye,l=L;return n(),y(l,{"append-to":".wrapper",effect:"dark",placement:"right-start",title:"",trigger:"hover",enterable:!1,"hide-after":0,"popper-class":"my-el-popover"},{reference:f((()=>[t("span",he,[t("span",{class:p(i.row.type)},[t("span",{class:p(""+(m(ge)(e.row)?"lethal":""))},d(e.row.amount.toLocaleString().padStart(3,"　")),3)],2)])])),default:f((()=>[g(s,{row:e.row},null,8,["row"])])),_:1})}}}),ve={key:0,class:"target"},ke=["src","alt","data-job"],we={key:1,class:"alt-text"},Fe=j(e({__name:"Target",props:{row:{type:Object,required:!0}},setup(e){const a=e,r=ee(),t=i(!1);function l(e){t.value=!0;e.target.style.display="none"}return(e,i)=>{return n(),s("div",null,[m(r).userOptions.showIcon?(n(),s("span",ve,[m(t)?(n(),s("span",we,d(a.row.target),1)):(n(),s("img",{key:0,class:p(`jobIcon cj${m(r).userOptions.iconType}`),src:(o=a.row.jobIcon,c=m(r).userOptions.iconType,`https://souma.diemoe.net/resources/img/cj${c}/${o.replace(/([A-Z])/g," $1").trim()}.png`??""),alt:a.row.jobIcon,"data-job":m(r).userOptions.showName?"":a.row.job,loading:"lazy",onError:l},null,42,ke)),m(r).userOptions.showName?(n(),s("span",{key:2,class:p(`job ${a.row.jobIcon} ${a.row.targetId===a.row.povId?"YOU":""}`),style:b(!m(r).userOptions.abbrId&&m(r).userOptions.showName?{overflow:"hidden",textOverflow:"ellipsis"}:{})},d(a.row.targetId===a.row.povId&&m(r).userOptions.replaceWithYou?"YOU":m(r).userOptions.anonymous?a.row.job:m(r).formatterName(a.row.target)),7)):h("",!0)])):h("",!0)]);var o,c}}}),[["__scopeId","data-v-0e9fa3dd"]]),Ce="function"==typeof structuredClone?structuredClone:e=>{if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e.source,e.flags);if(Array.isArray(e))return e.map((e=>Ce(e)));const i=new e.constructor;for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(i[a]=Ce(e[a]));return i},Ie={key:0},Ne={key:0,class:"testLog"},xe="souma-keigenn-record-2",je=e({__name:"keigennRecord2",setup(e){S.setTheme("dark");const r=ee(),l=r.userOptions;r.recheckIsDev();const d=v((()=>l.actionCN?"actionCN":"action")),u=i(l.minimize),j={line_height:28*l.scale,time:35*l.scale,action:65*l.scale,target:((l.showIcon?24:0)+(l.showName?l.anonymous||!l.anonymous&&l.abbrId?24:36:0)+7)*l.scale,amount:44*l.scale},$={"--vxe-font-size-mini":12*l.scale+"px","--vxe-ui-row-line-height":30*l.scale+"px","--vxe-ui-row-height-mini":30*l.scale+"px","--vxe-input-height-mini":20*l.scale+"px","--vxe-select-option-height-mini":24*l.scale+"px","--vxe-ui-layout-background-color":`rgba(12, 12, 12, ${l.opacity})`},A=99,D=3,H=i(!1),L=i(),R=_("keigenn-record-2-pov-name",""),G=_("keigenn-record-2-pov-id",""),U=_("keigenn-record-2-party-list",[]),V=_("keigenn-record-2-job-map",{}),Y=_("keigenn-record-2-party-event-party",[]),J=i(0),q=i([{zoneName:"",duration:"00:00",table:[],key:"init"}]),X={rsv:/^262\|(?<timestamp>[^|]*)\|[^|]*\|[^|]*\|_rsv_(?<id>\d+)_[^|]+\|(?<real>[^|]*)\|/i,ability:P.ability(),statusEffectExplicit:P.statusEffectExplicit(),gainsEffect:P.gainsEffect(),losesEffect:P.losesEffect(),inCombat:/^260\|(?<timestamp>[^|]*)\|(?<inACTCombat>[^|]*)\|(?<inGameCombat>[^|]*)\|/,changeZone:P.changeZone(),partyList:/^11\|(?<timestamp>[^|]*)\|(?<partyCount>\d*)\|(?<list>(?:\w{8}\|)*)\w{16}/,primaryPlayer:/^02\|(?<timestamp>[^|]*)\|(?<id>[^|]*)\|(?<name>[^|]*)/,addCombatant:P.addedCombatant(),removingCombatant:P.removingCombatant(),networkDoT:P.networkDoT()},ie=i(0),se=_("souma-keigenn-record-2-zone-name",""),ne=_("souma-keigenn-record-2-rsv-data",{}),te={},le={friendly:{},enemy:{}};function ce(){var e;H.value=!0,ie.value=0,J.value=0,q.value.length=1,(e=q.value[0]).table.length=0,e.zoneName="",e.duration="00:00",e.key="init"}function de(){ge(),H.value=!1}function me(e){var i,a,s,n,t,o,c,d,m,p,u;for(const y in X){const f=X[y].exec(e);if(f){const g=e.split("|");switch(y){case"statusEffectExplicit":(null==(i=f.groups)?void 0:i.targetId.startsWith("1"))&&(te[null==(a=f.groups)?void 0:a.targetId]=null==(s=f.groups)?void 0:s.currentShield);break;case"gainsEffect":{const e=g[W.GainsEffect.fields.effectId],i=g[W.GainsEffect.fields.effect],a=g[W.GainsEffect.fields.target],r=g[W.GainsEffect.fields.targetId],s=Number.parseInt(g[W.GainsEffect.fields.count],16);let n=(u=e,Z.get(u));if(!n){const i=r.startsWith("1")&&K.get(Number.parseInt(e,16).toString())||r.startsWith("4")&&Q.get(Number.parseInt(e,16).toString());if(!i)return;const a=E(i.icon),t=s>1?T(a,s):a;n={type:"multiplier",performance:{physics:1,magic:1,darkness:1},id:Number.parseInt(e,16),fullIcon:t,name:i.name,isFriendly:i.isFriendly}}const t=g[W.GainsEffect.fields.duration],l=g[W.GainsEffect.fields.source],o=g[W.GainsEffect.fields.sourceId],c=new Date(g[W.GainsEffect.fields.timestamp]).getTime()+1e3*Number.parseFloat(t),d={name:n.name,count:s,effect:i,effectId:e,source:l,sourceId:o,target:a,targetId:r,expirationTimestamp:c,performance:n.performance,fullIcon:n.fullIcon,isPov:G.value===o};r.startsWith("1")&&n.isFriendly?(void 0===le.friendly[r]&&(le.friendly[r]={}),le.friendly[r][e]=d):r.startsWith("4")&&!n.isFriendly&&(void 0===le.enemy[a]&&(le.enemy[a]={}),le.enemy[a][e]=d)}break;case"losesEffect":{const e=g[W.LosesEffect.fields.target],i=g[W.LosesEffect.fields.targetId],a=g[W.LosesEffect.fields.effectId];i.startsWith("1")?le.friendly[i]&&Reflect.deleteProperty(le.friendly[i],a):le.enemy[e]&&Reflect.deleteProperty(le.enemy[e],a)}break;case"addCombatant":if("00"!==g[W.AddedCombatant.fields.job]){const e=g[W.AddedCombatant.fields.job],i=new Date(g[W.AddedCombatant.fields.timestamp]).getTime();V.value[g[W.AddedCombatant.fields.id]]={job:Number.parseInt(e,16),timestamp:i}}break;case"removingCombatant":Reflect.deleteProperty(V.value,g[W.RemovedCombatant.fields.id]);break;case"primaryPlayer":{G.value=g[W.ChangedPlayer.fields.id];const e=g[W.ChangedPlayer.fields.name];if(R.value===e)return;R.value=e,r.initEnvironment(g[W.ChangedPlayer.fields.name]);break}case"partyList":U.value=(null==(t=null==(n=f.groups)?void 0:n.list)?void 0:t.split("|"))??[];break;case"changeZone":se.value=g[W.ChangeZone.fields.name],fe(new Date(g[W.ChangeZone.fields.timestamp]).getTime());break;case"inCombat":{const e="1"===g[W.InCombat.fields.inACTCombat],i="1"===g[W.InCombat.fields.inGameCombat],a=new Date(g[W.InCombat.fields.timestamp]).getTime();if(e||i){if(ie.value>0)return;return"placeholder"===q.value[0].key&&q.value.splice(0,1),0!==q.value[0].table.length&&(q.value[0]=x(q.value[0]),q.value.unshift({zoneName:"",duration:"00:00",table:[],key:g[W.InCombat.fields.timestamp]}),q.value.length>=A&&q.value.splice(q.value.length-1,1)),ie.value=a,q.value[0].zoneName=se.value,void(J.value=0)}if(!e&&!i)return void fe(a)}break;case"rsv":{const e=Number(null==(o=f.groups)?void 0:o.id),i=g[W.RSVData.fields.value];ne.value[Number(e)]=i}break;case"networkDoT":if(!l.parseDoT)return;{const e=g[W.NetworkDoT.fields.which],i=g[W.NetworkDoT.fields.id];if("DoT"!==e||i.startsWith("4")||i!==G.value&&!U.value.includes(i)&&!Y.value.find((e=>e.id===i)))return;const a=g[W.NetworkDoT.fields.name],r=g[W.NetworkDoT.fields.damage],s=Number.parseInt(r,16),n=new Date(g[W.Ability.fields.timestamp]??"???").getTime(),t=Number(g[W.NetworkDoT.fields.currentHp]),l=Number(g[W.NetworkDoT.fields.maxHp]),o=he(0===ie.value?0:n-ie.value),c=pe(i),d=z.nameToFullName(z.jobEnumToJob(c)).simple2,m=c,p=z.jobEnumToIcon(m);ye({timestamp:n,time:o,id:void 0,action:e,actionCN:e,source:"",target:a,targetId:i,job:d,jobIcon:p,jobEnum:m,amount:s,keigenns:[],currentHp:t,maxHp:l,effect:"damage done",type:"dot",shield:te[i],povId:G.value})}break;case"ability":if(0===ie.value)return;{const e=oe(g);if(e.isAttack&&e.amount>=0){const i=g[W.Ability.fields.sourceId]??"???",a=g[W.Ability.fields.targetId]??"???";if(!i.startsWith("4")||!a.startsWith("1"))return;if(a!==G.value&&!U.value.includes(a)&&!Y.value.find((e=>e.id===a)))return;const r=new Date(g[W.Ability.fields.timestamp]??"???").getTime(),s=g[W.Ability.fields.ability],n=s.match(/^_rsv_(?<id>\d+)_/),t=g[W.Ability.fields.id]??"???";let o=s;if(n){const e=Number(null==(c=n.groups)?void 0:c.id);o=ne.value[e]??(null==(m=null==(d=s.match(/^_(?<id>rsv_\d+)_/))?void 0:d.groups)?void 0:m.id)}else if(o=o.replace(/unknown_.*/,"攻击"),!1===l.parseAA&&/^攻击|攻撃|[Aa]ttack$/.test(o))return;const u=O(Number.parseInt(t,16)),y=u&&""!==u?u:o,h=Number(g[W.Ability.fields.targetCurrentHp])??"???",b=Number(g[W.Ability.fields.targetMaxHp])??"???",v=g[W.Ability.fields.source]??"???",k=g[W.Ability.fields.target]??"???",{effect:w,type:F}=re(e.flags),C=he(0===ie.value?0:r-ie.value),I=pe(a),N=z.nameToFullName(z.jobEnumToJob(I)).simple2,x=I,j=z.jobEnumToIcon(x),$=Ce(Object.values(le.friendly[a]??[]).concat(Object.values(le.enemy[v]??[])).filter((e=>{const i=Math.max(0,(e.expirationTimestamp-r)/1e3);return e.remainingDuration=i>=999?"":i.toFixed(i>.05&&i<.95?1:0),Number(e.remainingDuration)>-3})));ye({timestamp:r,time:C,id:t,action:o,actionCN:y,source:v,target:k,targetId:a,job:N,jobIcon:j,jobEnum:x,amount:e.amount,keigenns:$,currentHp:h,maxHp:b,effect:w,type:F,shield:te[(null==(p=f.groups)?void 0:p.targetId)??""],povId:G.value}),q.value[0].duration=he(new Date(g[W.Ability.fields.timestamp]).getTime()-ie.value)}break}}}}}function pe(e){return[V.value[e],Y.value.find((i=>i.id===e))??{job:0,timestamp:0}].sort(((e,i)=>i.timestamp-e.timestamp))[0].job}function ye(e){q.value[0].table.unshift(e)}function fe(e){0!==ie.value&&(q.value[0].duration=he(e-ie.value),ie.value=0,le.friendly={},le.enemy={},ge())}function ge(){localStorage.setItem(xe,JSON.stringify(q.value.slice(0,D)))}function he(e){const i=Math.max(Math.floor(e/6e4),0),a=Math.max(Math.floor((e-6e4*i)/1e3),0);return`${i<10?"0":""}${i}:${a<10?"0":""}${a}`}const ve=v((()=>{const e=new Set(q.value[J.value].table.map((e=>l.actionCN?e.actionCN:e.action)));return Array.from(e).map((e=>({label:e,value:e})))})),ke=v((()=>{const e={},i=new Set(q.value[J.value].table.slice().sort(((e,i)=>z.enumSortMethod(e.jobEnum,i.jobEnum))).map((i=>(e[i.target]=i.job,i.target))));return Array.from(i).map((i=>({label:`${e[i]}（${i}）`,value:i})))}));function we(e){const{actionCN:i,amount:a,job:r,keigenns:s,time:n,type:t}=e,o="damage done"===e.effect?"":`,${ae(e.effect)}`,c=`${n} ${r} ${i} ${a.toLocaleString()}(${ae(t)}) 减伤:${0===s.length&&""===o?"无":s.map((e=>l.statusCN?e.name:e.effect)).join(",")+o} HP:${e.currentHp}/${e.maxHp}(${Math.round(e.currentHp/e.maxHp*100)}%)+盾:${Math.round(e.maxHp*+e.shield/100)}(${e.shield}%)`;var d;d=c,navigator.clipboard.writeText(d).catch((()=>{const e=document.createElement("input");e.value=d,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)})),S.modal.message({content:"已复制到剪贴板",status:"success"})}r.isBrowser&&(R.value="测试用户"),""!==R.value&&r.initEnvironment(R.value),a((()=>{for(const e in V.value){const i=V.value[e];Date.now()-i.timestamp>864e5&&Reflect.deleteProperty(V.value,e)}!function(){const e=localStorage.getItem(xe);if(e)try{const i=JSON.parse(e);q.value.length=0,q.value.push(...i)}catch(i){}}(),r.isBrowser||"placeholder"===q.value[0].key||q.value.unshift({duration:"00:00",table:[],zoneName:"",key:"placeholder"}),M("LogLine",(e=>{me(e.rawLine)})),M("PartyChanged",(e=>{Y.value=e.party.map((e=>({...e,timestamp:Date.now()})))})),M("ChangePrimaryPlayer",(e=>{R.value=e.charName,G.value=Number(e.charID).toString(16).toUpperCase()}))}));const je=i({target:!1,action:!1}),$e=i(),Ee=k({className:"my-menus",body:{options:[]}});function Te(){u.value=!u.value}w((()=>{var e,i,a,r;(null==(e=Ee.body)?void 0:e.options)&&L.value&&(Ee.body.options[0]=[{code:"copy",name:"复制详情",prefixIcon:"vxe-icon-copy",className:"my-copy-item"},{code:"clearFilterAction",name:"取消技能筛选",prefixIcon:"vxe-icon-funnel-clear",className:"my-clear-filter",visible:je.value.action,disabled:!1},{code:"filterSelectAction",name:(null==(i=$e.value)?void 0:i[d.value])?`只看 ${null==(a=$e.value)?void 0:a[d.value]}`:"只看该技能",prefixIcon:"vxe-icon-info-circle",visible:!je.value.action,disabled:!1},{code:"clearFilterTarget",name:"取消玩家筛选",prefixIcon:"vxe-icon-funnel-clear",visible:je.value.target,disabled:!1},{code:"filterSelectTarget",name:(null==(r=$e.value)?void 0:r.target)?`只看[${$e.value.job}] ${$e.value.target}`:"只看该玩家",prefixIcon:"vxe-icon-user-fill",visible:!je.value.target,disabled:!1}])}));const Ae=({row:e})=>{const i=L.value;i&&(i.setCurrentRow(e),$e.value=e)},_e=({menu:e,row:i})=>{const a=L.value;switch(e.code){case"copy":if(!i)return void S.modal.message({content:"未选中有效数据行",status:"error"});we(i);break;case"clearFilterTarget":a&&(a.clearFilter(a.getColumnByField("target")),je.value.target=!1);break;case"clearFilterAction":a&&(a.clearFilter(a.getColumnByField(d.value)),je.value.action=!1);break;case"filterSelectTarget":if(a){const e=a.getColumnByField("target");if(e){const r=e.filters.find((e=>e.value===i.target));if(!r)return;r.checked=!0,a.updateData().then((()=>{a.scrollToRow(i),je.value.target=!0}))}}break;case"filterSelectAction":if(a){const e=a.getColumnByField(d.value);if(e){const r=e.filters.find((e=>e.value===i[d.value]));if(!r)return;r.checked=!0,a.updateData().then((()=>{a.scrollToRow(i),je.value.action=!0}))}}}};return(e,i)=>{const a=F("vxe-option"),d=F("vxe-select"),v=F("vxe-button"),k=F("vxe-column"),w=Fe,x=be,E=ue,T=F("vxe-table"),A=B;return n(),s(o,null,[t("div",{class:p(["wrapper",m(r).isBrowser?"is-browser":"not-browser"]),style:$},[m(l).showHeader?(n(),s("header",Ie,[C(g(d,{modelValue:m(J),"onUpdate:modelValue":i[0]||(i[0]=e=>N(J)?J.value=e:null),size:"mini",class:"select"},{default:f((()=>[(n(!0),s(o,null,c(m(q).length,(e=>(n(),y(a,{key:`${m(q)[e-1].key}-${m(q)[e-1].duration}-${m(q)[e-1].zoneName}`,value:e-1,label:`${m(q)[e-1].duration} ${m(q)[e-1].zoneName}`},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),[[I,!m(u)]]),g(v,{class:p(["minimize",m(u)?"in-minimize":"not-minimize"]),icon:m(u)?"vxe-icon-fullscreen":"vxe-icon-minimize",style:b({opacity:m(u)?.5:1}),onClick:Te},null,8,["class","icon","style"])])):h("",!0),C(t("main",null,[g(T,{ref_key:"xTable",ref:L,size:"mini",class:"vxe-table","show-overflow":"tooltip",round:"",height:"100%","scroll-y":{enabled:!0},loading:m(H),"show-header":m(l).showHeader,data:m(q)[m(J)].table,"row-config":{isHover:!0},"cell-config":{height:j.line_height},"header-cell-style":{padding:"0px",top:"-0.5em"},"menu-config":m(Ee),onCellMenu:Ae,onMenuClick:_e},{default:f((()=>[g(k,{width:j.time,field:"time",title:"时间",align:"center"},null,8,["width"]),g(k,{width:j.action,field:m(l).actionCN?"actionCN":"action",title:"技能",filters:m(ve),"filter-multiple":!1,resizable:!1,align:"center"},null,8,["width","field","filters"]),g(k,{width:j.target,field:"target",title:"目标",filters:m(ke),"filter-multiple":!1,resizable:!m(l).anonymous&&!m(l).abbrId,align:"left","header-align":"center","header-class-name":m(l).showName?"target-name-column-full":"target-name-column-abbr"},{default:f((({row:e})=>[g(w,{row:e},null,8,["row"])])),_:1},8,["width","filters","resizable","header-class-name"]),g(k,{width:j.amount,title:"伤害","header-align":"center"},{default:f((({row:e})=>[g(x,{row:e},null,8,["row"])])),_:1},8,["width"]),g(k,{title:"减伤",align:"left"},{default:f((({row:e})=>[g(E,{row:e},null,8,["row"])])),_:1})])),_:1},8,["loading","show-header","data","cell-config","menu-config"])],512),[[I,!m(u)]])],2),m(r).isBrowser?(n(),s("div",Ne,[h("",!0),g(A,{"m-1":"",onBeforeHandle:ce,onAfterHandle:de,onHandleLine:me})])):h("",!0)],64)}}});export{je as default};
