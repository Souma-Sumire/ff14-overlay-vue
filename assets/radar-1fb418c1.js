import{_ as e}from"./ActWrapper-75c1891c.js";import"./index-ff85e403.js";/* empty css                 */import{t as a,r as t,aC as l,c as o,e as n,P as s,D as i,E as r,x as u,A as v,H as c,F as f,u as d,v as h,K as m,S as p,O as g}from"./vue-vendor-37eb8ba2.js";import{u as w}from"./useZone-36964c38.js";import{N as P}from"./netregexes-ed180b06.js";import{a as y,r as T,c as b}from"./overlay_plugin_api-974cdd44.js";import{X as x}from"./element-plus-3b00acc6.js";import{_ as M}from"./_plugin-vue_export-helper-6a8c15be.js";/* empty css                */import"./useDevMode-efb02b03.js";import"./index-78df6055.js";import"./zoneInfo-40d5d60a.js";import"./zone_info-e69ac441.js";import"./content_type-e6dd7239.js";import"./regexes-da03e94d.js";const k={class:"radar-container"},S={class:"radar-wrapper"},I={key:0},j=["disabled"],_=["disabled"],C={class:"target-header"},L={key:0,class:"target-name"},N={class:"radar-canvas-container"},E=["width","height"],D=M(a({__name:"radar",setup(a){const M=t(""),D=t([]),O=t(0),W=t(""),X=t([]),Y={echo:P.echo({line:"find\\s*(?<target>.+)"})},H=l("canvas");let z=null;const R=t(window.devicePixelRatio||1),A=t(Math.min(window.innerWidth,window.innerHeight)-80),$=o(()=>A.value/2-20),B=t("flex"===document.getElementById("unlocked")?.style?.display),{zoneType:F}=w(),U=t("single"),q="#0f0",G="#060",K="#0f0",Z="#ff0",J="#f00",Q="#fff",V="#fff",ee=18,ae=3,te=2,le=6,oe=o(()=>A.value/2),ne=o(()=>A.value/2);function se(e,a,t){const l=e.PosX-a.PosX,o=e.PosY-a.PosY;let n=oe.value+l/t,s=ne.value+o/t;const i=Math.hypot(n-oe.value,s-ne.value);if(i>$.value){const e=$.value/i;n=oe.value+(n-oe.value)*e,s=ne.value+(s-ne.value)*e}return{px:n,py:s}}async function ie(){const e=await b({call:"getCombatants"});X.value=e.combatants??[]}async function re(){await ie(),"Pvp"!==F.value&&M.value&&W.value?("*"===M.value?function(){if(U.value="all",!z)throw new Error("canvas context is null");const e=X.value.find(e=>e.Name===W.value),a=X.value.filter(e=>e.Name!==W.value&&e.ID);if(!e)return;z.clearRect(0,0,A.value,A.value),z.strokeStyle=q,z.lineWidth=1,z.beginPath(),z.arc(oe.value,ne.value,$.value,0,2*Math.PI),z.stroke(),z.strokeStyle=G,z.beginPath(),z.moveTo(oe.value-$.value,ne.value),z.lineTo(oe.value+$.value,ne.value),z.moveTo(oe.value,ne.value-$.value),z.lineTo(oe.value,ne.value+$.value),z.stroke();const t=new Map;for(const i of a)t.set(i.ID.toString(),se(i,e,1));for(const i of a){const e=t.get(i.ID.toString());e&&(z.strokeStyle=J,z.lineWidth=te,z.beginPath(),z.moveTo(oe.value,ne.value),z.lineTo(e.px,e.py),z.stroke())}for(const i of a){const e=t.get(i.ID.toString());e&&(z.fillStyle=Z,z.beginPath(),z.arc(e.px,e.py,ae,0,2*Math.PI),z.fill())}for(const i of a){const e=t.get(i.ID.toString());if(!e)continue;const a=i.Name??"",l=z.measureText(a).width;z.shadowColor="black",z.shadowBlur=1,z.shadowOffsetX=1,z.shadowOffsetY=1,z.fillStyle=V,z.font="8px Arial",z.fillText(a,e.px-l/2,e.py-ae-3),z.shadowColor="transparent",z.shadowBlur=0,z.shadowOffsetX=0,z.shadowOffsetY=0}const l=-(e.Heading??0)+Math.PI;z.save(),z.translate(oe.value,ne.value),z.rotate(l),z.fillStyle=K;const o=ee,n=o/3,s=-.2*o;z.beginPath(),z.moveTo(0,-o/2+s),z.lineTo(-n,o/2+s),z.lineTo(n,o/2+s),z.closePath(),z.fill(),z.restore()}():function(){if(U.value="single",!z)throw new Error("canvas context is null");const e=D.value[O.value],a=X.value.find(e=>e.Name===W.value);if(!e)return void z.clearRect(0,0,A.value,A.value);if(!a)return;z.clearRect(0,0,A.value,A.value),z.strokeStyle=q,z.lineWidth=1,z.beginPath(),z.arc(oe.value,ne.value,$.value,0,2*Math.PI),z.stroke(),z.strokeStyle=G,z.beginPath(),z.moveTo(oe.value-$.value,ne.value),z.lineTo(oe.value+$.value,ne.value),z.moveTo(oe.value,ne.value-$.value),z.lineTo(oe.value,ne.value+$.value),z.stroke();const t=e.PosX-a.PosX,l=e.PosY-a.PosY,o=Math.sqrt(t*t+l*l);let n=oe.value+t/.5,s=ne.value+l/.5;const i=Math.hypot(n-oe.value,s-ne.value);if(i>$.value){const e=$.value/i;n=oe.value+(n-oe.value)*e,s=ne.value+(s-ne.value)*e}z.strokeStyle=J,z.lineWidth=te,z.beginPath(),z.moveTo(oe.value,ne.value),z.lineTo(n,s),z.stroke(),z.fillStyle=Z,z.beginPath(),z.arc(n,s,ae,0,2*Math.PI),z.fill();const r=-(a.Heading??0)+Math.PI;z.save(),z.translate(oe.value,ne.value),z.rotate(r),z.fillStyle=K;const u=ee,v=u/3,c=-.2*u;z.beginPath(),z.moveTo(0,-u/2+c),z.lineTo(-v,u/2+c),z.lineTo(v,u/2+c),z.closePath(),z.fill(),z.restore();const f=Math.atan2(s-ne.value,n-oe.value);z.fillStyle=J,z.beginPath(),z.moveTo(n,s),z.lineTo(n-le*Math.cos(f-Math.PI/6),s-le*Math.sin(f-Math.PI/6)),z.lineTo(n-le*Math.cos(f+Math.PI/6),s-le*Math.sin(f+Math.PI/6)),z.closePath(),z.fill(),z.fillStyle=Q,z.font="10px Arial",z.fillText(`${o.toFixed(1)}y`,n+5,s-5)}(),setTimeout(re,100)):M.value=""}const ue=e=>{if("00"===e.line[0]){const a=Y.echo.exec(e.rawLine);a?.groups?.target&&(M.value=a.groups.target,ie().then(()=>{!function(){if(!M.value)return D.value=[],void(O.value=0);const e=X.value.filter(e=>e.Name&&e.Name.includes(M.value));D.value=e,O.value=0}(),re()}))}},ve=e=>{W.value=e.charName};function ce(){A.value=Math.min(window.innerWidth,window.innerHeight)-80,R.value=window.devicePixelRatio||1,z&&(z.setTransform(1,0,0,1,0,0),z.scale(R.value,R.value))}function fe(e){B.value=!1===e?.detail?.isLocked}return n(()=>{z=H.value?.getContext("2d")??null,z&&z.scale(R.value,R.value),y("LogLine",ue),y("ChangePrimaryPlayer",ve),window.addEventListener("resize",ce),document.addEventListener("onOverlayStateUpdate",fe)}),s(()=>{T("LogLine",ue),T("ChangePrimaryPlayer",ve),window.removeEventListener("resize",ce),document.removeEventListener("onOverlayStateUpdate",fe)}),(a,t)=>{const l=x,o=e;return u(),i(o,null,{default:r(()=>[v("div",k,[d(B)?(u(),i(l,{key:0,class:"el-alert-info",type:"info",closable:!1,"show-icon":"",title:"宏命令：/e find 目标名称",description:"名称允许部分匹配，输入*可查看所有目标"})):c("",!0),f(v("div",S,[d(D).length>1?(u(),h("div",I,[v("button",{class:"nav-arrow left-arrow",disabled:d(D).length<=1,"aria-label":"上一目标",onClick:t[0]||(t[0]=e=>O.value=(d(O)-1+d(D).length)%d(D).length)}," ← ",8,j),v("span",null," （"+m(d(O)+1)+" / "+m(d(D).length)+"） ",1),v("button",{class:"nav-arrow right-arrow",disabled:d(D).length<=1,"aria-label":"下一目标",onClick:t[1]||(t[1]=e=>O.value=(d(O)+1)%d(D).length)}," → ",8,_)])):c("",!0),v("div",C,["single"===d(U)?(u(),h("span",L,m(d(D)[d(O)]?.Name??`【未找到${d(M)}】`),1)):c("",!0),v("button",{class:"cancel-btn",onClick:t[2]||(t[2]=e=>{M.value="",D.value=[]})}," 取消 ")]),v("div",N,[v("canvas",{ref_key:"canvas",ref:H,class:"radar-canvas",width:d(A)*d(R),height:d(A)*d(R),style:p({width:`${d(A)}px`,height:`${d(A)}px`})},null,12,E)])],512),[[g,d(M)]])])]),_:1})}}}),[["__scopeId","data-v-745d3276"]]);export{D as default};
