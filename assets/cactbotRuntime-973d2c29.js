import{_ as e}from"./ActWrapper-c56d14eb.js";import{_ as a}from"./DragJob-5bd2b415.js";import"./index-f7be25fa.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                   */import{d as t,u as n}from"./index-aaf5e89d.js";import{u as r}from"./useDevMode-f627f232.js";import{U as o}from"./util-c5e2dd68.js";import{a as l,c as s}from"./overlay_plugin_api-974cdd44.js";/* empty css                */import{K as u,o as i,n as p}from"./element-plus-e8d3f599.js";import{t as m,r as c,e as d,D as y,E as f,x as v,A as b,M as j,v as h,H as g,u as k,h as P,K as _,L as x,a9 as w,G as C}from"./vue-vendor-d1e06839.js";import{_ as J}from"./_plugin-vue_export-helper-6a8c15be.js";/* empty css                *//* empty css                    */const R={class:"cactbot-runtime"},T={key:0,class:"you"},V={key:1,class:"players"},D={class:"job-name"},E={key:0,class:"player-name"},O={key:0,style:{position:"fixed",bottom:"0"}},S=J(m({__name:"cactbotRuntime",setup(m){t();const J=c(!1);function S(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const U=c(!1),A=n("cactbotRuntime-sortArr",[]),G=[{id:"10000001",name:"虚构暗骑",job:32,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构龙骑",job:22,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0},{id:"10000007",name:"虚构画家",job:42,inParty:!0}],L=n("cactbotRuntime-data",{party:[]}),M=n("cactbotRuntime-showTips",c(!0)),K=n("cactbotRuntime-roleSelectLength",{tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0}),N={tank:["MT","ST",...S("T",6,2)],healer:[...S("H",8)],dps:[...S("D",8)],crafter:[...S("C",8)],gatherer:[...S("G",8)],none:[...S("N",8)]};function z(e){const a=q(e);return N[a].filter((e,t)=>t<K.value[a])}const F=r(),H=c(F.value?G[2].name:"");function q(e){return[1,3,19,21,32,37].includes(e)?"tank":[6,24,28,33,40].includes(e)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39,41,42].includes(e)?"dps":o.isCraftingJob(o.jobEnumToJob(e))?"crafter":o.isGatheringJob(o.jobEnumToJob(e))?"gatherer":"none"}function B(e){return N[q(e.job)].find(e=>!L.value.party.find(a=>a.rp===e))??"unknown"}function I(){const e=[...N.tank,...N.healer,...N.dps,...N.crafter,...N.gatherer,...N.none];L.value.party.sort((a,t)=>e.indexOf(a.rp??"unknown")-e.indexOf(t.rp??"unknown")),s({call:"broadcast",source:"soumaRuntimeJS",msg:{party:L.value.party}})}function W(e){A.value=e,Q()}function Q(){!function(){L.value.party.sort((e,a)=>A.value.indexOf(e.job)-A.value.indexOf(a.job));for(const e of L.value.party)e.rp=void 0;for(const e of L.value.party)e.rp=B(e)}(),function(){for(const e in K.value)Object.prototype.hasOwnProperty.call(K.value,e)&&(K.value[e]=L.value.party.reduce((a,t)=>q(t.job)===e?a+1:a,0))}(),I()}function X(){const e={party:G};M.value&&(U.value=!0),L.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),Q()}return d(()=>{document.body.addEventListener("mouseenter",()=>J.value=!0),document.body.addEventListener("mouseleave",()=>J.value=!1),I(),l("PartyChanged",e=>{M.value&&(U.value=!0),F.value&&0===e.party.length||(L.value.party=e.party.filter(e=>e.inParty).map(e=>({...e,rp:"unknown"})),Q())}),l("ChangePrimaryPlayer",e=>{F.value||(H.value=e.charName)}),l("BroadcastMessage",e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&I()})}),(t,n)=>{const r=u,l=i,s=p,m=a,c=e;return v(),y(c,null,{default:f(()=>[b("div",R,[j(r,{modelValue:k(U),"onUpdate:modelValue":n[0]||(n[0]=e=>P(U)?U.value=e:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:n[1]||(n[1]=e=>{U.value=!1,M.value=!1})},{header:f(()=>n[3]||(n[3]=[b("span",null,"用法",-1)])),default:f(()=>n[4]||(n[4]=[b("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1),b("ul",null,[b("li",null,"临时：下拉选择框修改。"),b("li",null,"长期：用鼠标拖动职能顺序。")],-1)])),_:1},8,["modelValue"]),b("main",null,[k(J)?(v(),h("div",V,[(v(!0),h(x,null,w(k(L).party,(e,a)=>{return v(),h("section",{key:e.id,class:C(["player",{"is-you":e.name===k(H)}])},[j(s,{modelValue:e.rp,"onUpdate:modelValue":a=>e.rp=a,size:"small",class:"select","fit-input-width":"",placement:"right",offset:8,onChange:e=>function(e){const a=L.value.party.find(a=>a.rp===L.value.party[e].rp&&a.id!==L.value.party[e].id);a&&(a.rp=B(a)),I()}(a)},{default:f(()=>[(v(!0),h(x,null,w(z(e.job),(e,a)=>(v(),y(l,{key:a,value:e,label:e},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),b("span",D,_((t=e.job,o.nameToFullName(o.jobEnumToJob(t)).simple1)),1),k(J)?(v(),h("span",E,_(e.name),1)):g("",!0)],2);var t}),128)),k(J)?(v(),y(m,{key:0,class:"drag-job",party:k(L).party,"p-1":"",onUpdateSortArr:W},null,8,["party"])):g("",!0)])):(v(),h("div",T,_(k(L).party.find(e=>e.name===k(H))?.rp??""),1))]),k(F)?(v(),h("div",O,[b("button",{onClick:n[2]||(n[2]=e=>{k(L).party=k(L).party.filter(e=>e.name===k(H)),Q()})}," 测试单人 "),b("button",{onClick:X}," 测试组队 ")])):g("",!0)])]),_:1})}}}),[["__scopeId","data-v-b9149fea"]]);export{S as default};
