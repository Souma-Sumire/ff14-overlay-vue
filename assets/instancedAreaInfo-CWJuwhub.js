import{c as a,_ as e}from"./shared-common-9tgN7nPx.js";import{a as n,r as t,c as s}from"./cactbot-DtpbXwrG.js";import{d as o,K as c,o as i,B as r,h as m,g as l,a as d,c as u,n as p,f,t as I}from"./vendor-vue-MSvGQJWD.js";import"./shared-core-Do8QyWoI.js";import"./vendor-element-plus-CsMNiL2J.js";const h={key:0},g={key:1},D=e(o({__name:"instancedAreaInfo",setup(e){const o=c({islandId:0,instanceNum:""}),D=[732,763,795,827,920,975,1252],b=Object.fromEntries(D.map(a=>[a,new Map])),N=async a=>{if(!D.includes(a.zoneID))return void(o.islandId=0);const e=(await s({call:"getCombatants"})).combatants.filter(a=>541===a.BNpcNameID&&a.ID).sort((a,e)=>a.ID-e.ID)[0];if(!e)return;const n=e.ID-1073741824,t=Date.now(),c=b[a.zoneID],i=c.get(n);if(o.islandId=n,i){const a=t-i.timestamp,e=`这个岛${a<6e4?`${Math.floor(a/1e3)}秒`:`${Math.floor(a/6e4)}分钟`}前来过，是第${i.count}个遇到的岛`;i.timestamp=t,s({call:"cactbotSay",text:e})}else{c.set(n,{timestamp:t,count:c.size+1});const a=`这个岛第一次来，现在总共遇到了${c.size}个岛`;s({call:"cactbotSay",text:a})}},j={"":"①","":"②","":"③","":"④","":"⑤","":"⑥","":"⑦","":"⑧","":"⑨"},_=a=>{if("00"===a.line[0]&&"0039"===a.line[2]){const e=a.line[4].match(/当前所在副本区为“([^”]+)(?<instance>[])”/)??a.line[4].match(/You are now in the instanced area (.+?)(?<instance>[])”/)??a.line[4].match(/インスタンスエリア「(.+?)(?<instance>[])」/);e&&(o.instanceNum=j[e.groups?.instance])}else"01"===a.line[0]&&(o.instanceNum="")};return i(()=>{n("LogLine",_),n("ChangeZone",N)}),r(()=>{t("LogLine",_),t("ChangeZone",N)}),(e,n)=>{const t=a;return d(),m(t,null,{default:l(()=>[f(o).instanceNum?(d(),u("p",h,I(f(o).instanceNum),1)):p("",!0),f(o).islandId?(d(),u("p",g,I(f(o).islandId)+"号岛 ",1)):p("",!0)]),_:1})}}}),[["__scopeId","data-v-db42191a"]]);export{D as default};
