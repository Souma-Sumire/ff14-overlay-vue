import{aR as e,k as t,W as o,l as i,B as n,o as s,F as r,ae as a,z as l,H as c,A as m,q as u,U as d,E as p}from"./vue-49c48d91.js";import{c as g}from"./res-status-9bc9036c.js";import{am as h}from"./vendor-979eac9e.js";import{R as b,l as f}from"./cactbot-49e370f3.js";import{U as j}from"./util-3591e9ca.js";import{a as w}from"./element-plus-901ad096.js";import{c as v}from"./chineseToIcon-e0fcd48d.js";import{a as A}from"./xivapi-72ab0990.js";import{_ as y}from"./_plugin-vue_export-helper-6a8c15be.js";var T=(e=>(e["显示范围"]="displayDuration",e["变色时间"]="discoloration",e["零后持续"]="hold",e["战前准备"]="preBattle",e["TTS提前量"]="ttsAdvance",e))(T||{});class E{constructor(e,t,o,i){j.iconToJobEnum(t.jobs[0])&&(t.jobs[0]=j.jobEnumToJob(j.iconToJobEnum(t.jobs[0]))),this.name=e,this.condition=t,this.timeline=o,this.codeFight=i,this.create=(new Date).toLocaleString()}name;condition;timeline;codeFight;create}const O={[T.显示范围]:"显示范围（秒）",[T.变色时间]:"提前变色（秒）",[T.零后持续]:"后续保持（秒）",[T.战前准备]:"倒计时量（秒）",[T.TTS提前量]:"TTS预备（秒）"},N={[T.显示范围]:120,[T.变色时间]:2.75,[T.零后持续]:.5,[T.战前准备]:30,[T.TTS提前量]:1},M={"--timeline-width":"时间轴宽度","--font-size":"字体大小","--normal-scale":"等待缩放","--up-coming-scale":"来临缩放","--opacity":"等待不透明度","--tras-duration":"动画时间"},Y={"--timeline-width":200,"--font-size":16,"--opacity":.5,"--normal-scale":.66,"--up-coming-scale":1,"--tras-duration":1},R=e("timeline",{state:()=>({allTimelines:[],configValues:N,configTranslate:O,settings:{api:""},filters:{},showStyle:Y,showStyleTranslate:M,jobList:[...j.getBattleJobs3(),"NONE"]}),getters:{},actions:{normalizeJobConditions(e){e.condition.jobs||(e.condition.jobs=[e.condition.job],Reflect.deleteProperty(e.condition,"job")),e.condition.jobs.sort((e,t)=>this.jobList.indexOf(e)-this.jobList.indexOf(t)),e.condition.jobs[0]&&j.iconToJobEnum(e.condition.jobs[0])&&(e.condition.jobs[0]=j.jobEnumToJob(j.iconToJobEnum(e.condition.jobs[0])))},newTimeline(e="Demo",t={zoneId:"0",jobs:["NONE"]},o="",i="用户创建"){this.allTimelines.push(new E(e,t,o,i)),this.sortTimelines(),w.success("新建时间轴成功");return this.allTimelines.findIndex(n=>n.timeline===o&&n.name===e&&JSON.stringify(n.condition)===JSON.stringify(t)&&n.codeFight===i)},getTimeline(e){return this.allTimelines.filter(t=>("0"===t.condition.zoneId||t.condition.zoneId===e.zoneId)&&(t.condition.jobs.includes("NONE")||t.condition.jobs.includes(e.jobs[0])))},saveTimelineSettings(){try{localStorage.setItem("timelines",JSON.stringify({allTimelines:this.allTimelines,configValues:this.configValues,settings:this.settings,showStyle:this.showStyle,filters:this.filters}))}catch(e){w.error("保存时间轴设置失败")}},loadTimelineSettings(){const e=localStorage.getItem("timelines");e&&(Object.assign(this,JSON.parse(e)),this.allTimelines.forEach(e=>{this.normalizeJobConditions(e)}),this.sortTimelines());try{const e=localStorage.getItem("timelines");e&&(Object.assign(this,JSON.parse(e)),this.allTimelines.forEach(e=>{this.normalizeJobConditions(e)}),this.sortTimelines())}catch(t){w.error("加载时间轴设置失败")}},sortTimelines(){this.allTimelines.forEach(e=>{this.normalizeJobConditions(e)}),this.allTimelines.sort((e,t)=>{const o=Number(e.condition.zoneId)-Number(t.condition.zoneId);if(0!==o)return o;const i=e.name.localeCompare(t.name);if(0!==i)return i;const n=j.jobToJobEnum(e.condition.jobs[0])-j.jobToJobEnum(t.condition.jobs[0]);return 0!==n?n:e.create.localeCompare(t.create)})},updateFilters(e,t){this.filters[e]=t}}});function S(e){const t=e.match(/^(?<negative>-)?(?<mm>\d+):(?<ss>\d+(?:\.\d*)?)$/);if(t){const e=Number(t.groups?.mm||"0"),o=Number(t.groups?.ss||"0");return(t.groups?.negative?-1:1)*(60*e+o)}return Number.parseFloat(e)}function J(e){return e.matchAll(/<(?<name>[^<>]*?)!?>(?<repeat>~)?/g)}const I=new RegExp(`(?:[^#]*?\\s)?(?<netRegexType>${Object.keys(f).join("|")})\\s*(?<netRegex>\\{.*\\})(?<args>\\s.*)?$`),x={ActorControl:"network6d",StartsUsing:"startsUsing",Ability:"ability",InCombat:"inCombat"};async function z(e){const t=[],o=[...e.matchAll(/^\s*(?<time>[-:：\d.]+)\s+(?<action>["'“”][^"'“”]*["'“”]).*$/gm)];for(let n=0;n<o.length;n++){let e,s=!1;const r=o[n],a=r[0].match(new RegExp("(?<=jump ?)[-:：\\d.]+"))?.[0],l=r[0].match(new RegExp("(?<=sync(?:\\.once)? ?\\/).+(?=\\/)"))?.[0],c=/sync\.once/.test(r[0]),m=r[0].match(new RegExp("(?<=window ?)[-:：\\d.]+"))?.[0],u=r[0].match(new RegExp("(?<=window ?[-:：\\d.]+,)[-:：\\d.]+"))?.[0],d=r[0].match(/ tts ?["'“”](?<tts>[^"'“”]+)["'“”]/)?.groups?.tts,p=/ tts(?: |$)/.test(r[0])?Array.from(J(r.groups?.action??"")).map(e=>e?.groups?.name).filter(Boolean).join(", "):void 0,g=I.exec(r[0])?.groups,f=g?.netRegexType;let j={};try{j=h.parse(g?.netRegex??"{}")}catch(i){w.error({type:"error",message:`“${r[0]??""}”解析失败：${i}`});break}if(Reflect.deleteProperty(j,"source"),f)try{const t=x[f]??f.toLowerCase();s=/ once/.test(r[0])||j.once,Reflect.deleteProperty(j,"once");e=(0,b[t])({...j,capture:!1})}catch(i){}else e=l?new RegExp(l):void 0,s=c;t.push({time:S(r.groups?.time??"0"),action:r.groups?.action||"",alertAlready:!1,sync:e,syncOnce:s,syncAlready:!1,show:!e,windowBefore:Number.parseFloat(m||u||"2.5"),windowAfter:Number.parseFloat(u||m||"2.5"),jump:a?Number.parseFloat(a):void 0,tts:e?void 0:d||p})}return t.sort((e,t)=>e.time-t.time),t}const F=["innerHTML"],U={class:"countdown"},C="data:image/png;base64,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",q=y(t({__name:"TimelineShow",props:{config:{},lines:{},runtime:{},showStyle:{}},setup(e){const t=e,h=o({});function b(e){let t=e.replaceAll(/^["'“”]|["'“”]$/g,"");const o=J(t);if(!o)return t;for(const i of o)if(i.groups?.name){const e=f(i.groups?.name);t=t.replace(i[0],`${e?`<div class="skill_icon"><img src="${e}" loading="auto"/></div>`:""}<span>${i.groups?.repeat?i.groups?.name:""}</span>`)}return t}function f(e){if("string"==typeof h[e])return h[e];if(void 0===h[e]){const t=`/i/${g(v(e)??405)}.png`;h[e]=C,t&&A(t).then(t=>{(function(e){return new Promise((t,o)=>{const i=new Image;i.onload=()=>t(),i.onerror=()=>o(new Error("Failed to load image")),i.src=e})})(t).then(()=>{h[e]=t}).catch(()=>{h[e]=C})})}return C}return(e,o)=>e.lines.length?(s(),i("ul",{key:0,class:"loadedTimelines",style:d(e.showStyle)},[(s(!0),i(r,null,a(t.lines,(t,o)=>l((s(),i("li",{key:o,class:m({upcoming:t.time-e.runtime<=e.config.discoloration,fade:t.time-e.runtime<=0-e.config.hold,passed:t.time-e.runtime<=0})},[u("aside",{style:d({right:100*Math.max((t.time-e.runtime)/e.config.displayDuration,0)+"%"})},null,4),u("section",null,[u("span",{innerHTML:b(t.action??"")},null,8,F),u("span",U,p((t.time-e.runtime).toFixed(1)),1)])],2)),[[c,t.show&&t.time-e.runtime>0-e.config.hold-e.showStyle["--tras-duration"]&&t.time-e.runtime<=e.config.displayDuration]])),128))],4)):n("",!0)}}),[["__scopeId","data-v-961c8ffb"]]);export{q as _,z as p,R as u};
