import{c as e}from"./overlay_plugin_api-DHbPkDtN.js";import{cz as o,r as n,i as t,A as s}from"./index-C_vJrq5H.js";import{E as a}from"./index-DtlOpm4r.js";function l(l={allowClose:!1,addWsParam:!0}){const{t:c}=o(),i=n(void 0),r=n(!1),w=n("overlay");let u=null;function d(){Promise.race([e({call:"getLanguage"}),new Promise((e,o)=>{setTimeout(()=>{o(new Error("Timeout"))},1e3)})]).then(()=>{u&&clearTimeout(u),window.location.href.includes("OVERLAY_WS")&&(i.value=!0,w.value="websocket")}).catch(()=>{i.value=!1,w.value="overlay"})}return window.location.href.includes("OVERLAY_WS")&&(u=window.setInterval(()=>{d()},3e3)),t(()=>{!function(){const e=window.navigator.userAgent,o=e.includes("MSIE "),n=e.includes("Trident/");return o||n}()?(s(i,e=>{e?a.close():function(){if(!r.value){a.close();const e=c("websocket.disconnectMsg",{actWS:"/ff14-overlay-vue/assets/actWS-Dxp7wU0T.webp"}),o=l.allowClose?c("websocket.disconnectTitleCloseable"):c("websocket.disconnectTitleRequired");a.alert(e,o,{dangerouslyUseHTMLString:!0,closeOnClickModal:!1,showClose:!1,closeOnPressEscape:!1,closeOnHashChange:!1,showCancelButton:l.allowClose,showConfirmButton:!1,cancelButtonText:c("websocket.ignoreWarningBtn"),buttonSize:"small"}).catch(()=>{r.value=!0,u&&clearInterval(u)})}}()}),!window.location.href.includes("OVERLAY_WS")&&l.addWsParam&&function(){const e=window.location.href,[o,n=""]=e.split("#"),[t,s=""]=n.split("?"),a=new URLSearchParams(s);let l="";a.forEach((e,o)=>{"OVERLAY_WS"!==o&&(l+=`${o}=${encodeURIComponent(e)}&`)}),l+="OVERLAY_WS=ws://127.0.0.1:10501/ws";let c=o;t&&(c+=`#${t}`,l&&(c+=`?${l}`)),window.location.href=c,location.reload()}(),d()):a.alert(c("websocket.ieBrowserWarning"),c("websocket.ieBrowserTitle"),{type:"error",showConfirmButton:!1,showClose:!1})}),{wsConnected:i,useType:w}}export{l as u};
