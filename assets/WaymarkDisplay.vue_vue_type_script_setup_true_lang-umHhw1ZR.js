import{M as e}from"./map-DW4z5uTS.js";import{k as a,Z as t,V as r,o as s}from"./shared-core-Djp3a06e.js";import{d as n,G as o,x as l,o as i,w as u,c,a as v,n as p,s as m,F as f,r as y,z as d,t as x,h,f as k}from"./vendor-vue-MSvGQJWD.js";import{_ as z}from"./shared-common-CJncmXli.js";const M=["src"],g=z(n({__name:"MapCanvas",props:{mapId:{type:Number,required:!0},markers:{type:Array,required:!0},size:{type:Number,default:180},forceTerritoryType:{type:Number,default:void 0}},setup(n){const h=n,k=o(()=>{if(0===h.mapId&&!h.forceTerritoryType)return;const t=h.forceTerritoryType??a(h.mapId),r=e[t.toString()];return r?`https://v2.xivapi.com/api/asset/map/${r.id}`:void 0});function z(e){const n=h.forceTerritoryType??a(h.mapId),o=t[n]??{sizeFactor:100,offsetX:0,offsetY:0},l=new r(e.x,e.z),i=new r(o.offsetX,o.offsetY);return s(l,i,o.sizeFactor)}const g=l(0),w=l(0),b=l(.5),T=l(16),I=l(!1);let $=0,_=0;function D(e){e.preventDefault(),I.value=!0,$=e.clientX-g.value,_=e.clientY-w.value}function Y(e){e.preventDefault(),I.value&&(g.value=e.clientX-$,w.value=e.clientY-_)}function F(e){e.preventDefault(),I.value=!1}function X(e){e.preventDefault();const a=e.deltaY>0?.9:1.1;let t=b.value*a;t=Math.min(4,Math.max(.2,t));const r=e.currentTarget.getBoundingClientRect(),s=e.clientX-r.left,n=e.clientY-r.top;g.value=s-(s-g.value)*t/b.value,w.value=n-(n-w.value)*t/b.value,b.value=t}function j(e){const a=z(e),t=Math.max(1/b.value*T.value,T.value);return{"--left":`${a.x}px`,"--top":`${a.y}px`,"--font-size":`${t}px`}}const C=o(()=>({width:`${h.size}px`,height:`${h.size}px`,overflow:"hidden",position:"relative",cursor:I.value?"grabbing":"grab",userSelect:"none"})),A=o(()=>({transform:`translate(${g.value}px, ${w.value}px) scale(${b.value})`,transformOrigin:"top left",width:"2048px",height:"2048px",position:"absolute",left:0,top:0})),B=l(null),N=l(!1);return i(()=>{const e=new IntersectionObserver(a=>{a[0]?.isIntersecting&&(N.value=!0,e.disconnect())},{rootMargin:"200px"});B.value&&e.observe(B.value)}),u(()=>h.markers,()=>{const e=h.markers.filter(e=>e.active);if(0===e.length)return b.value=.5,g.value=h.size/2-1024*b.value,void(w.value=h.size/2-1024*b.value);const a=e.reduce((e,a)=>{const t=z(a);return e.x+=t.x,e.y+=t.y,e},{x:0,y:0});a.x/=e.length,a.y/=e.length;let t=1/0,r=-1/0,s=1/0,n=-1/0;for(const v of e){const e=z(v);t=Math.min(t,e.x),r=Math.max(r,e.x),s=Math.min(s,e.y),n=Math.max(n,e.y)}const o=r-t,l=n-s,i=h.size/o,u=h.size/l;let c=Math.min(i,u);c=Math.min(1,Math.max(.5,.5*c)),b.value=c,g.value=h.size/2-a.x*b.value,w.value=h.size/2-a.y*b.value},{immediate:!0,deep:!0}),(e,a)=>(v(),c("div",{ref_key:"containerRef",ref:B,class:"crop-custom",style:m(C.value),onMousedown:D,onMousemove:Y,onMouseup:F,onMouseleave:F,onWheel:X},[N.value?(v(),c("div",{key:0,class:"crop-1024",style:m(A.value)},[k.value?(v(),c("img",{key:0,src:k.value,alt:""},null,8,M)):p("",!0),(v(!0),c(f,null,y(n.markers,e=>(v(),c("span",{key:e.key,class:d(`markIcon markIcon${e.key}`),style:m([j(e)])},x(e.active?e.label:""),7))),128))],4)):p("",!0)],36))}}),[["__scopeId","data-v-c4e50d24"]]),w=n({__name:"WaymarkDisplay",props:{waymark:{},size:{}},setup(e){const a=e,t=a.size??180,r=["A","B","C","D","1","2","3","4"],s=[1,2,4,8,16,32,64,128];const n=o(()=>["A","B","C","D","One","Two","Three","Four"].map((e,t)=>{const n=a.waymark[e];return{key:e,label:r[t]??"",x:n.x/1e3,z:n.z/1e3,active:(o=t,0!==((a.waymark?.enableFlag??0)&(s[o]??0)))};var o}));return(a,r)=>(v(),h(g,{"map-id":e.waymark.regionID,markers:n.value,size:k(t)},null,8,["map-id","markers","size"]))}});export{g as M,w as _};
