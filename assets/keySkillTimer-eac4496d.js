import{_ as e}from"./ActWrapper-3efebdce.js";import"./index-e58fcfa0.js";/* empty css                  */import{u as t}from"./useDemo-b712055f.js";import{u as i}from"./useDev-c4e9ec84.js";import{u as n}from"./useZone-36964c38.js";import{c as l}from"./status-9bc9036c.js";import{r as s,aA as o,V as a,c as r,t as c,e as d,P as u,D as m,E as v,x as j,v as b,H as f,u as p,A as y,L as k,aa as I,G as D,K as P,S as g,J as h,M as w}from"./vue-vendor-37eb8ba2.js";import{U as S}from"./util-3591e9ca.js";import{t as _}from"./tts-5e313398.js";import{a as x,r as L}from"./overlay_plugin_api-974cdd44.js";import{i as C}from"./element-plus-3b00acc6.js";import{_ as T}from"./_plugin-vue_export-helper-6a8c15be.js";/* empty css                */import"./index-78df6055.js";import"./zoneInfo-40d5d60a.js";import"./zone_info-e69ac441.js";import"./content_type-e6dd7239.js";const R=[{id:"骑士ID",name:"虚构骑士",job:19,inParty:!0,level:100},{id:"武僧ID",name:"虚构武僧",job:20,inParty:!0,level:100},{id:"战士ID",name:"虚构战士",job:21,inParty:!0,level:100},{id:"龙骑ID",name:"虚构龙骑",job:22,inParty:!0,level:100},{id:"诗人ID",name:"虚构诗人",job:23,inParty:!0,level:100},{id:"白魔ID",name:"虚构白魔",job:24,inParty:!0,level:100},{id:"黑魔ID",name:"虚构黑魔",job:25,inParty:!0,level:100},{id:"召唤ID",name:"虚构召唤",job:27,inParty:!0,level:100},{id:"学者ID",name:"虚构学者",job:28,inParty:!0,level:100},{id:"忍者ID",name:"虚构忍者",job:30,inParty:!0,level:100},{id:"机工ID",name:"虚构机工",job:31,inParty:!0,level:100},{id:"暗骑ID",name:"虚构暗骑",job:32,inParty:!0,level:100},{id:"占星ID",name:"虚构占星",job:33,inParty:!0,level:100},{id:"武士ID",name:"虚构武士",job:34,inParty:!0,level:100},{id:"赤魔ID",name:"虚构赤魔",job:35,inParty:!0,level:100},{id:"青魔ID",name:"虚构青魔",job:36,inParty:!0,level:100},{id:"绝枪ID",name:"虚构绝枪",job:37,inParty:!0,level:100},{id:"舞者ID",name:"虚构舞者",job:38,inParty:!0,level:100},{id:"钐镰ID",name:"虚构钐镰",job:39,inParty:!0,level:100},{id:"贤者ID",name:"虚构贤者",job:40,inParty:!0,level:100},{id:"蝰蛇ID",name:"虚构蝰蛇",job:41,inParty:!0,level:100},{id:"画家ID",name:"虚构画家",job:42,inParty:!0,level:100}],z={tank:2,healer:2,dps:4};const E=[{id:30,tts:"",duration:10,recast1000ms:15,job:[19],line:0,level:50,icon:2502},{id:43,tts:"",duration:10,recast1000ms:240,job:[3,21],line:0,level:42,icon:266},{id:3638,tts:"",duration:10,recast1000ms:300,job:[32],line:0,level:50,icon:3077},{id:16152,tts:"",duration:10,recast1000ms:360,job:[37],line:0,level:50,icon:3416},{id:140,tts:"天赐",duration:0,recast1000ms:180,job:[24],line:0,level:50,icon:2627},{id:25862,tts:"礼仪之铃",duration:15,recast1000ms:180,job:[24],line:0,level:90,icon:2649},{id:25868,tts:"跑快快",duration:20,recast1000ms:120,job:[28],line:0,level:90,icon:2878},{id:25874,tts:"大宇宙",duration:15,recast1000ms:180,job:[33],line:0,level:90,icon:3562},{id:7549,tts:"牵制",duration:e=>e>=98?15:10,recast1000ms:90,job:[2,4,20,22,30,34,39,41],line:1,level:22,icon:828},{id:7560,tts:"昏乱",duration:e=>e>=98?15:10,recast1000ms:90,job:[7,25,26,27,35,36,42],line:1,level:8,icon:861},{id:7535,tts:"雪愁",duration:e=>e>=98?15:10,recast1000ms:60,job:[1,3,19,21,32,37],line:1,level:22,icon:806},{id:3540,tts:"幕帘",duration:30,recast1000ms:90,job:[19],line:1,level:56,icon:2508},{id:7385,tts:"大翅膀",duration:5,recast1000ms:120,job:[19],line:1,level:70,icon:2515},{id:7388,tts:"摆脱",duration:15,recast1000ms:90,job:[21],line:1,level:68,icon:2563},{id:16471,tts:"布道",duration:15,recast1000ms:90,job:[32],line:1,level:66,icon:3087},{id:16160,tts:"光心",duration:15,recast1000ms:90,job:[37],line:1,level:64,icon:3424},{id:16536,tts:"节制",duration:20,recast1000ms:120,job:[24],line:1,level:80,icon:2645},{id:7405,tts:"行吟",duration:15,recast1000ms:90,job:[23],line:1,level:62,icon:2612},{id:16889,tts:"策动",duration:15,recast1000ms:90,job:[31],line:1,level:56,icon:3040},{id:2887,tts:"武解",duration:10,recast1000ms:120,job:[31],line:1,level:62,icon:3011},{id:16012,tts:"桑巴",duration:15,recast1000ms:90,job:[38],line:1,level:56,icon:3469},{id:25857,tts:"抗死",duration:10,recast1000ms:120,job:[35],line:1,level:86,icon:3237},{id:118,tts:"战歌",duration:20,recast1000ms:120,job:[5,23],line:2,level:50,icon:2601},{id:25785,tts:"光神曲",duration:20,recast1000ms:110,job:[5,23],line:2,level:90,icon:2622},{id:e=>e>=66?36957:2248,tts:"背刺",duration:20,recast1000ms:120,job:[29,30],line:2,level:66,icon:619},{id:24405,tts:"神秘环",duration:20,recast1000ms:120,job:[39],line:2,level:72,icon:3633},{id:3557,tts:"连祷",duration:20,recast1000ms:120,job:[4,22],line:2,level:52,icon:2585},{id:7396,tts:"义结金兰",duration:20,recast1000ms:120,job:[2,20],line:2,level:70,icon:2542},{id:25801,tts:"灼热之光",duration:20,recast1000ms:120,job:[27],line:2,level:66,icon:2780},{id:34675,tts:"星空构想",duration:20,recast1000ms:120,job:[42],line:2,level:70,icon:3826},{id:7436,tts:"连环计",duration:20,recast1000ms:120,job:[28],line:2,level:66,icon:2815},{id:7520,tts:"鼓励",duration:20,recast1000ms:120,job:[35],line:2,level:58,icon:3218},{id:16196,tts:"技巧舞",duration:20,recast1000ms:120,job:[38],line:2,level:70,icon:3474},{id:16011,tts:"探戈",duration:20,recast1000ms:120,job:[38],line:2,level:62,icon:3471},{id:16552,tts:"占卜",duration:20,recast1000ms:120,job:[33],line:2,level:50,icon:3553}],N=[{id:30,tts:"",duration:10,recast1000ms:420,job:[19],line:0,level:50,icon:2502},{id:43,tts:"",duration:10,recast1000ms:240,job:[3,21],line:0,level:42,icon:266},{id:3638,tts:"",duration:10,recast1000ms:300,job:[32],line:0,level:50,icon:3077},{id:16152,tts:"",duration:10,recast1000ms:360,job:[37],line:0,level:50,icon:3416},{id:140,tts:"天赐",duration:0,recast1000ms:180,job:[24],line:0,level:50,icon:2627},{id:25862,tts:"礼仪之铃",duration:15,recast1000ms:180,job:[24],line:0,level:90,icon:2649},{id:25868,tts:"跑快快",duration:20,recast1000ms:120,job:[28],line:0,level:90,icon:2878},{id:25874,tts:"大宇宙",duration:15,recast1000ms:180,job:[33],line:0,level:90,icon:3562},{id:7549,tts:"牵制",duration:e=>e>=98?15:10,recast1000ms:90,job:[2,4,20,22,30,34,39,41],line:1,level:22,icon:828},{id:7560,tts:"昏乱",duration:e=>e>=98?15:10,recast1000ms:90,job:[7,25,26,27,35,36,42],line:1,level:8,icon:861},{id:7535,tts:"雪愁",duration:e=>e>=98?15:10,recast1000ms:60,job:[1,3,19,21,32,37],line:1,level:22,icon:806},{id:3540,tts:"幕帘",duration:30,recast1000ms:90,job:[19],line:1,level:56,icon:2508},{id:7385,tts:"大翅膀",duration:5,recast1000ms:120,job:[19],line:1,level:70,icon:2515},{id:7388,tts:"摆脱",duration:15,recast1000ms:90,job:[21],line:1,level:68,icon:2563},{id:16471,tts:"布道",duration:15,recast1000ms:90,job:[32],line:1,level:66,icon:3087},{id:16160,tts:"光心",duration:15,recast1000ms:90,job:[37],line:1,level:64,icon:3424},{id:16536,tts:"节制",duration:20,recast1000ms:120,job:[24],line:1,level:80,icon:2645},{id:7405,tts:"行吟",duration:15,recast1000ms:90,job:[23],line:1,level:62,icon:2612},{id:16889,tts:"策动",duration:15,recast1000ms:90,job:[31],line:1,level:56,icon:3040},{id:2887,tts:"武解",duration:10,recast1000ms:120,job:[31],line:1,level:62,icon:3011},{id:16012,tts:"桑巴",duration:15,recast1000ms:90,job:[38],line:1,level:56,icon:3469},{id:25857,tts:"抗死",duration:10,recast1000ms:120,job:[35],line:1,level:86,icon:3237},{id:118,tts:"战歌",duration:20,recast1000ms:120,job:[5,23],line:2,level:50,icon:2601},{id:25785,tts:"光神曲",duration:20,recast1000ms:110,job:[5,23],line:2,level:90,icon:2622},{id:e=>e>=66?36957:2248,tts:"背刺",duration:20,recast1000ms:120,job:[29,30],line:2,level:66,icon:619},{id:24405,tts:"神秘环",duration:20,recast1000ms:120,job:[39],line:2,level:72,icon:3633},{id:3557,tts:"连祷",duration:20,recast1000ms:120,job:[4,22],line:2,level:52,icon:2585},{id:7396,tts:"义结金兰",duration:20,recast1000ms:120,job:[2,20],line:2,level:70,icon:2542},{id:25801,tts:"灼热之光",duration:20,recast1000ms:120,job:[27],line:2,level:66,icon:2780},{id:34675,tts:"星空构想",duration:20,recast1000ms:120,job:[42],line:2,level:70,icon:3826},{id:7436,tts:"连环计",duration:20,recast1000ms:120,job:[28],line:2,level:66,icon:2815},{id:7520,tts:"鼓励",duration:20,recast1000ms:120,job:[35],line:2,level:58,icon:3218},{id:16196,tts:"技巧舞",duration:20,recast1000ms:120,job:[38],line:2,level:70,icon:3474},{id:16011,tts:"探戈",duration:20,recast1000ms:120,job:[38],line:2,level:62,icon:3471},{id:16552,tts:"占卜",duration:20,recast1000ms:120,job:[33],line:2,level:50,icon:3553}];const{keySkills:$,loadData:A}=function(e="cn"){const t=s("cn"===e?E:N);return{keySkills:t,loadData:function(e){t.value="cn"===e?E:N}}}(),J=new class{size;party;constructor(e){this.size=e,this.party=s([]),this.shuffle()}shuffle(e=z){const t={...z,...e},i=[...R].sort(()=>Math.random()-.5),n=[];for(const l of i){const e=S.jobEnumToJob(l.job),i=S.jobToRole(e),s=t[i]??0;if(!(s<=0)&&(t[i]=s-1,n.push(l),n.length>=this.size))break}this.party.value=n}}(8);function K(e){return"function"==typeof e}const M=o("keySkill",()=>{const e=i(),n=t(),l=s([]),o=a({}),c=r(()=>e.value||n.value?5:1),d=r(()=>{const t=[],i=r(()=>e.value||n.value?J.party.value:l.value);for(const e of i.value)for(const i of $.value)if(i.job.includes(e.job)&&(void 0===e.level||i.level<=e.level)){const n=K(i.duration)?i.duration(e.level||999):i.duration,l=K(i.id)?i.id(e.level||999):i.id,s=K(i.recast1000ms)?i.recast1000ms(e.level||999):i.recast1000ms,o=K(i.level)?i.level(e.level||999):i.level,a={id:e.id,name:e.name,jobIcon:S.jobEnumToIcon(e.job),jobName:S.jobToFullName(S.jobEnumToJob(e.job)).simple1,hasDuplicate:!1},r=`${l}-${e.id}`;t.push({...i,duration:n,id:l,owner:a,key:r,level:o,recast1000ms:s})}for(const e of t)e.owner.hasDuplicate=t.some(t=>t.id===e.id&&t.owner.id!==e.owner.id);return t.sort((e,t)=>$.value.findIndex(t=>t.id===e.id)-$.value.findIndex(e=>e.id===t.id)),t});return{party:l,skillStates:o,dev:e,demo:n,speed:c,usedSkills:d,triggerSkill:function(e,t){const i=d.value.find(i=>i.id===e&&i.owner.id===t);if(!i)return;const n=i.key,{duration:l,recast1000ms:s}=i;o[n]?.interval&&clearInterval(o[n].interval);const r=a({startTime:Date.now(),isRecast:0===l,durationLeft:l,recastLeft:s-l,text:(l||s).toString(),active:!0,animationKey:Date.now()});r.interval=window.setInterval(()=>{r.isRecast?(r.recastLeft--,r.text=r.recastLeft.toString(),r.recastLeft<=0&&(clearInterval(r.interval),r.interval=void 0,r.text="",r.isRecast=!1,r.active=!1,Reflect.deleteProperty(o,e))):(r.durationLeft--,r.durationLeft<=0&&(r.isRecast=!0),r.text=r.durationLeft.toString())},1e3/c.value),o[n]=r,_(i.tts)},wipe:function(){for(const e in o){const t=o[e];t&&(clearInterval(t.interval),t.interval=void 0,t.text="",t.active=!1)}},loadData:A,shuffle:function(){J.shuffle()}}}),O=new Map(Object.entries({16483:0,16484:16486,16485:16486,25779:16487,7496:16481,2874:0,2890:0,2872:16500,16003:16192,16191:16192,16004:16196,16193:16196,16194:16196,16195:16196,3551:25751,16464:25751,25752:7387,16510:16508,3581:16549,16494:3562,16499:16498,16527:7515,38:7389,7415:16502,92:16478,23287:23290,18324:18325,23272:23285,23280:23285,23273:23275,11426:11427,11428:11429,52:0,48:0,3629:0,3580:0,7429:0,7449:0,16516:0,3631:0,16142:0,28:0,2259:0,2261:0,2262:0,2263:0,3582:0,110:0,117:0,16161:25758,16144:16165,3641:3643,25755:0,16546:0,16548:0,802:0,8324:0,24307:24313,2246:0,24402:24401,24403:0,17206:0,24288:24302,24289:24313,17:36920,44:36923,3636:36927,16148:36935,2248:36957}).map(([e,t])=>[Number(e),t]));const F={class:"demo-text"},H={key:0,class:"key-skills-timer-container"},G={class:"skills-grid"},U=["onClick"],V={class:"buff-filter"},W=["src"],Z={key:1,class:"test"},q=T(c({__name:"keySkillTimer",setup(s){const o=M(),{zoneType:a}=n(),c=r(()=>"Pvp"===a.value),S=i(),_=t(),T=e=>{o.party=e.party},R=e=>{var t;if(!c.value)if("21"===e.line[0]||"22"===e.line[0]&&"0"===e.line[45]){const i=Number.parseInt(e.line[4],16),n=(t=i,O.get(t)||t),l=e.line[2];o.triggerSkill(n,l)}else"33"===e.line[0]&&["40000010","4000000F"].includes(e.line[3])&&o.wipe()},z=e=>{o.loadData(e.charName.includes(" ")?"global":"cn")};function E(){o.usedSkills.forEach(e=>{o.triggerSkill(e.id,e.owner.id)})}return d(()=>{x("PartyChanged",T),x("LogLine",R),x("ChangePrimaryPlayer",z)}),u(()=>{L("PartyChanged",T),L("LogLine",R),L("ChangePrimaryPlayer",z),Object.values(o.skillStates).forEach(e=>clearInterval(e.interval))}),(t,i)=>{const n=C,s=e;return j(),m(s,null,{readme:v(()=>[y("span",F,[i[3]||(i[3]=h(" 当前为演示数据，锁定后将显示真实数据，请尽量拉大窗口 ",-1)),w(n,{type:"primary",onClick:i[0]||(i[0]=()=>p(o).shuffle())},{default:v(()=>i[2]||(i[2]=[h("生成随机小队",-1)])),_:1,__:[2]})])]),default:v(()=>[p(c)?f("",!0):(j(),b("div",H,[y("div",G,[(j(!0),b(k,null,I(p(o).usedSkills,e=>{return j(),b("div",{key:e.key,class:D(["buff-container",`line${e.line+1}`]),onClick:t=>function(e){(S||_)&&o.triggerSkill(e.id,e.owner.id)}(e)},[y("div",V,[y("span",{class:D(["duration",[p(o).skillStates[e.key]?.isRecast?"cooldown":"active"]])},P(p(o).skillStates[e.key]?.text||""),3),y("img",{src:(t=e.icon,`//cafemaker.wakingsands.com/i/${l(t)}_hr1.png`)},null,8,W),p(o).skillStates[e.key]?.active?(j(),b("div",{key:p(o).skillStates[e.key]?.startTime||0,class:"cooldown-layer",style:g({"--duration":e.duration/p(o).speed+"s","--recast":(e.recast1000ms-e.duration)/p(o).speed+"s"})},null,4)):f("",!0)]),e.owner.hasDuplicate?(j(),b("span",{key:0,class:D(`job ${e.owner.jobIcon.toLowerCase()}`)},P(e.owner.jobName),3)):f("",!0)],10,U);var t}),128))])])),p(S)?(j(),b("div",Z,[y("button",{onClick:E}," triggerAll "),y("button",{onClick:i[1]||(i[1]=(...e)=>p(o).wipe&&p(o).wipe(...e))}," wipe ")])):f("",!0)]),_:1})}}}),[["__scopeId","data-v-e526d5c3"]]);export{q as default};
