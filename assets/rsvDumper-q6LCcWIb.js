import{_ as e}from"./ThemeToggle-CCJ-jWxO.js";import{d as t,aI as o,r as s,c as n,a as r,b as a,k as l,G as i,w as c,o as p,e as u,t as d,E as m}from"./index-BUfDMxde.js";import{E as f}from"./index-iKquztDb.js";import{E as _}from"./index-DX1FeqgT.js";import{E as h,a as x}from"./index-C5iNkrxp.js";import{E as g}from"./index-4aRUxv1A.js";import{E as v}from"./index-1uPFADC0.js";import{_ as b}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-CJWPAOrv.js";import"./index-CJ7Ya7nx.js";import"./use-form-common-props-NBrOuJ-a.js";import"./cloneDeep-B1stmBce.js";import"./_baseClone-iYE9ihCS.js";import"./index-CLfF3Ba2.js";import"./index-DX4PP0MN.js";import"./index-D9qdZ5yg.js";import"./index-DtP3UsTe.js";import"./focus-trap-BPk99KAL.js";import"./index-B1vcuvn3.js";import"./vnode-uLauZ6bZ.js";import"./index-LSdAaz51.js";const j={class:"min-h-screen p-6"},E={style:{position:"absolute",top:"2em",right:"2em"}},C={class:"overflow-auto rounded bg-black p-3 text-xs text-green-400"},y=b(t({__name:"rsvDumper",setup(t){o();const b={SE2DC5B04_EE2DC5B04:"Action",S64755250_E64755250:"BNpcName",S74CFC3B0_E74CFC3B0:"Status",S13095D61_E13095D61:"InstanceContentTextData",SF15185AF_EF15185AF:"LogMessage",SCFE39641_ECFE39641:"NpcYell"},y=s([]),w=s(!1),D=s("");const k=async e=>{const t=e.raw,o=(await t.text()).split(/\r?\n/),s=new Set;y.value=[];for(const n of o){const e=n.split("|");if("252"!==e[0])continue;const t=S(e.slice(3,-2));if(!$(t,(new TextEncoder).encode("_rsv_")))continue;const o=F(t.slice(30)),r=o.str1.replace(/^(rsv_\d+)_[^_]+_[^_]+_[^_]+_[^_]+_([^_]{9}_[^_]+)$/,"$1_$2");if(s.has(r))continue;s.add(r);const a=b[r.slice(-19)]||"Unknown",l=Number(r.match(/_rsv_(\d+)_/)?.[1]);y.value.push({type:a,id:l,...o})}};function S(e){const t=[];for(const o of e){const e=Number.parseInt(o,16)>>>0;t.push(255&e,e>>8&255,e>>16&255,e>>24&255)}return new Uint8Array(t)}function $(e,t){const o=e.length-t.length;for(let s=0;s<=o;s++){let o=!0;for(let n=0;n<t.length;n++)if(e[s+n]!==t[n]){o=!1;break}if(o)return!0}return!1}function F(e){return{str1:U(e.slice(2)),str2:U(e.slice(50)),hexDump:R(e)}}function U(e){const t=e.indexOf(0),o=-1!==t?e.slice(0,t):e;let s="";const n=new TextDecoder;let r=[],a=[];const l=()=>{r.length&&(s+=n.decode(Uint8Array.from(r)),r=[])},i=()=>{a.length&&(s+=`<hex:${a.map(e=>e.toString(16).padStart(2,"0")).join("").toUpperCase()}>`,a=[])};let c=0;for(;c<o.length;c++){const e=o[c];if(0!==e&&e>=32)break}const p=o.slice(c);for(const u of p)0===u||u<=31||127===u?(l(),a.push(u)):(i(),r.push(u));return l(),i(),s.replace(/(<hex:(00)+>)$/,"")}function R(e,t=16){let o=e.length;for(;o>0&&0===e[o-1];)o--;const s=e.slice(0,o),n="0123456789ABCDEF",r=[];for(let a=0;a<s.length;a+=t){let e="",o="";for(let r=0;r<t;r++)if(a+r<s.length){const t=s[a+r];e+=`${n[t>>4]}${n[15&t]} `,o+=t>=32&&t<127?String.fromCharCode(t):"."}else e+="   ",o+=" ";r.push(`${e} ${o}`)}return r.join("\n")}function B(){if(0===y.value.length)return void m.error("请先上传日志文件");const e={};y.value.forEach(({type:t,id:o,str2:s})=>{e[t]||(e[t]=[]),e[t].push(`${o} ${s}`)});let t="";for(const[r,a]of Object.entries(e))t+=`=== ${r} ===\n${a.join("\n")}\n\n`;const o=new Blob([t],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(o),n=document.createElement("a");n.href=s,n.download="rsv_results.txt",n.click(),URL.revokeObjectURL(s)}return(t,o)=>{const s=e,m=f,b=_,S=v,$=x,F=h,U=g;return p(),n("div",j,[o[4]||(o[4]=r("h1",{class:"mb-4 text-2xl font-bold"}," FFXIV RSV Dumper ",-1)),r("span",E,[a(s,{"storage-key":"rsv-dumper-theme"})]),a(m,{drag:"",action:"","auto-upload":!1,"show-file-list":!1,accept:".log,.txt",class:"upload-box",onChange:k},{default:c(()=>[...o[1]||(o[1]=[r("i",{class:"el-icon-upload"},null,-1),r("div",{class:"el-upload__text"},[u(" 拖拽日志文件到此处或 "),r("em",null,"点击上传")],-1)])]),_:1}),y.value.length?(p(),l(b,{key:0,type:"success",class:"mb-4",disabled:0===y.value.length,onClick:B},{default:c(()=>[...o[2]||(o[2]=[u(" 保存结果到文件 ",-1)])]),_:1},8,["disabled"])):i("",!0),y.value.length?(p(),l(F,{key:2,data:y.value,stripe:"",style:{width:"100%","margin-top":"20px"},border:""},{default:c(()=>[a($,{prop:"type",label:"Type"}),a($,{prop:"id",label:"ID"}),a($,{prop:"str1",label:"RSV Data 1",width:"400"}),a($,{prop:"str2",label:"RSV Data 2"}),a($,{label:"操作",width:"150"},{default:c(e=>[a(b,{size:"small",type:"primary",onClick:t=>{return o=e.row,D.value=o.hexDump,void(w.value=!0);var o}},{default:c(()=>[...o[3]||(o[3]=[u(" 查看 HexDump ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(p(),l(S,{key:1,description:"请上传 act.log 文件",class:"mt-6"})),a(U,{modelValue:w.value,"onUpdate:modelValue":o[0]||(o[0]=e=>w.value=e),title:"HexDump 原始数据",width:"50%","append-to-body":!0},{default:c(()=>[r("pre",C,d(D.value),1)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-308d8d0c"]]);export{y as default};
