import{c as e,d as l,n as t,e as a,aB as i,K as s,G as n,H as o,aC as r,aD as d,l as c,F as u,aA as m,j as k,k as p,b as S,aE as f,an as y,Y as g,ak as b,ar as h,a9 as v,ax as T,O as _,N as V,E as w,a as x}from"./vendor-element-plus-D1xxVcVE.js";import{a8 as $,a9 as z,u as U,U as j,aa as C,ab as B,ac as D,q as J,ad as N,v as I,y as F}from"./shared-core-C0qTeCVu.js";import{o as E,A as O,t as L,H as M,r as A,v as H,J as K,K as Y,I as q,R as G,am as P,u as R,Z,c as Q,B as W,V as X,Y as ee,dv as le,O as te}from"./vendor-vue-iK2zA9mI.js";import{_ as ae,a as ie,b as se}from"./shared-common-C1I6b8qt.js";import"./cactbot-DbkIe67V.js";const ne={class:"action-icon-wrapper"},oe=["src"],re={key:1,class:"action-icon-placeholder"},de=ae(E({__name:"ActionIcon",props:{id:{}},setup(e){const l=e,t=A("");return O([()=>l.id,z],([e])=>{t.value=$(e)},{immediate:!0}),(e,l)=>(L(),M("div",ne,[t.value?(L(),M("img",{key:0,src:t.value,class:"action-icon",alt:""},null,8,oe)):(L(),M("div",re))]))}}),[["__scopeId","data-v-8bcec3d8"]]),ce={class:"btn-text"},ue={class:"job-selector-content"},me=ae(E({__name:"JobSelector",props:{modelValue:{}},emits:["update:modelValue"],setup(n,{emit:o}){const r=n,d=o,{t:c,locale:u}=U(),m=Object.freeze(j.getBattleJobs()),k=Q(()=>{const e=C(u.value);return m.map(l=>{const t=j.jobToFullName(l);return{value:j.jobToJobEnum(l),label:t[e]??t.en}})}),p=Q(()=>r.modelValue&&0!==r.modelValue.length?r.modelValue.length===m.length?c("keySkillTimerSettings.col.allJobs"):c("keySkillTimerSettings.col.jobsCount",{count:r.modelValue.length}):c("keySkillTimerSettings.col.allJobs"));function S(e){d("update:modelValue",e)}return(o,r)=>{const d=a,c=t,u=l,m=e,f=s;return L(),H(f,{placement:"bottom",width:280,trigger:"click","popper-class":"job-selector-popper"},{reference:K(()=>[q(c,{size:"small",class:"job-popover-btn"},{default:K(()=>[q(d,null,{default:K(()=>[q(R(i))]),_:1}),Y("span",ce,Z(p.value),1)]),_:1})]),default:K(()=>[Y("div",ue,[q(m,{"model-value":n.modelValue,multiple:"",filterable:"",placeholder:"Select Jobs",size:"default",class:"full-width","collapse-tags":"","collapse-tags-tooltip":"","onUpdate:modelValue":S},{default:K(()=>[(L(!0),M(G,null,P(k.value,e=>(L(),H(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"])])]),_:1})}}}),[["__scopeId","data-v-a8044493"]]),ke={class:"settings-table-wrapper"},pe={class:"action-buttons"},Se={style:{display:"flex","align-items":"center",gap:"8px"}},fe={style:{color:"var(--el-text-color-secondary)","font-size":"12px"}},ye={class:"tts-header"},ge=ae(E({__name:"SettingsTable",emits:["delete","move"],setup(e,{emit:l}){const i=l,s=B(),f=Q(()=>s.keySkillsData.chinese);function y(e,l){if(e){l(D(e,50).map(e=>({value:e.id.toString(),label:e.name,id:e.id})))}else l([])}return(e,l)=>{const g=a,b=t,h=c,v=o,T=m,_=p,V=k,w=S,x=n;return L(),M("div",ke,[q(x,{data:f.value,border:"",size:"small","row-key":e=>e.key,height:"100%",class:"custom-table","header-row-class-name":"table-header"},{default:K(()=>[q(v,{label:e.$t("keySkillTimerSettings.col.action"),width:"90",fixed:"left",align:"center"},{default:K(({row:l,$index:t})=>[Y("div",pe,[q(b,{link:"",size:"small",disabled:0===t,onClick:e=>i("move",t,t-1)},{default:K(()=>[q(g,null,{default:K(()=>[q(R(r))]),_:1})]),_:1},8,["disabled","onClick"]),q(b,{link:"",size:"small",disabled:t===f.value.length-1,onClick:e=>i("move",t,t+1)},{default:K(()=>[q(g,null,{default:K(()=>[q(R(d))]),_:1})]),_:1},8,["disabled","onClick"]),q(h,{title:e.$t("keySkillTimerSettings.deleteConfirmTitle"),onConfirm:e=>i("delete",l.key)},{reference:K(()=>[q(b,{link:"",size:"small",type:"danger"},{default:K(()=>[q(g,null,{default:K(()=>[q(R(u))]),_:1})]),_:1})]),_:1},8,["title","onConfirm"])])]),_:1},8,["label"]),q(v,{label:e.$t("keySkillTimerSettings.col.preview"),width:"50",align:"center"},{default:K(({row:e})=>[(L(),H(de,{id:e.id,key:e.id},null,8,["id"]))]),_:1},8,["label"]),q(v,{label:e.$t("keySkillTimerSettings.col.id"),"min-width":"200"},{default:K(({row:e})=>[q(T,{modelValue:e.id,"onUpdate:modelValue":l=>e.id=l,"fetch-suggestions":y,placeholder:"...",size:"small",style:{width:"100%"},clearable:"","trigger-on-focus":!1},{default:K(({item:e})=>[Y("div",Se,[(L(),H(de,{id:e.id,key:e.id,size:20},null,8,["id"])),Y("span",null,Z(e.label),1),Y("span",fe,"("+Z(e.value)+")",1)])]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),q(v,{width:"130"},{header:K(()=>[Y("div",ye,[l[1]||(l[1]=Y("span",null,"TTS",-1)),q(_,{modelValue:R(s).enableTts.chinese,"onUpdate:modelValue":l[0]||(l[0]=e=>R(s).enableTts.chinese=e),size:"small"},null,8,["modelValue"])])]),default:K(({row:e})=>[q(V,{modelValue:e.tts,"onUpdate:modelValue":l=>e.tts=l,size:"small",disabled:!R(s).enableTts.chinese},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),q(v,{label:e.$t("keySkillTimerSettings.col.duration"),"min-width":"180",align:"left"},{default:K(({row:e})=>[q(V,{modelValue:e.duration,"onUpdate:modelValue":l=>e.duration=l,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),q(v,{label:e.$t("keySkillTimerSettings.col.recast"),"min-width":"220",align:"left"},{default:K(({row:e})=>[q(V,{modelValue:e.recast1000ms,"onUpdate:modelValue":l=>e.recast1000ms=l,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),q(v,{label:e.$t("keySkillTimerSettings.col.job"),width:"100",align:"center"},{default:K(({row:e})=>[q(me,{modelValue:e.job,"onUpdate:modelValue":l=>e.job=l},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),q(v,{label:e.$t("keySkillTimerSettings.col.minLevel"),width:"110",align:"center"},{default:K(({row:e})=>[q(w,{modelValue:e.minLevel,"onUpdate:modelValue":l=>e.minLevel=l,min:1,max:100,size:"small",controls:!1,class:"level-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),q(v,{label:e.$t("keySkillTimerSettings.col.line"),width:"110",align:"center"},{default:K(({row:e})=>[q(w,{modelValue:e.line,"onUpdate:modelValue":l=>e.line=l,min:1,max:10,size:"small",controls:!1,class:"line-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["data","row-key"])])}}}),[["__scopeId","data-v-9afbe668"]]),be={class:"page-container"},he={class:"header-toolbar"},ve={class:"left-tools"},Te={class:"preset-list",style:{height:"400px","overflow-y":"auto"}},_e={class:"preset-info"},Ve={class:"name"},we={class:"search-drawer-content",style:{height:"450px",padding:"12px"}},xe={class:"center-tools"},$e={class:"right-tools"},ze={class:"page-content"},Ue=ae(E({__name:"keySkillTimerSettings",setup(e){const{t:l}=U(),i=B(),r=A(!1);function d(){w.confirm(l("keySkillTimerSettings.resetConfirmMsg"),l("keySkillTimerSettings.confirmTitle"),{confirmButtonText:l("keySkillTimerSettings.confirmBtn"),cancelButtonText:l("keySkillTimerSettings.cancelBtn"),type:"warning"}).then(()=>{i.keySkillsData.chinese=[...N],x.success(l("keySkillTimerSettings.resetSuccessMsg"))}).catch(()=>{})}function c(e,t){i.keySkillsData.chinese.unshift({key:crypto.randomUUID(),id:e,tts:t||"",duration:0,recast1000ms:0,job:[],line:1,minLevel:1}),x.success(`${l("keySkillTimerSettings.addSkill")}: ${t||e}`)}function u(){const e=JSON.stringify(i.keySkillsData),t=le.compressToBase64(e);F(t).then(()=>x.success(l("keySkillTimerSettings.copySuccess"))).catch(()=>x.error(l("keySkillTimerSettings.copyFailed")))}function m(){w.prompt(l("keySkillTimerSettings.importPromptMsg"),l("keySkillTimerSettings.importTitle"),{confirmButtonText:l("keySkillTimerSettings.confirmBtn"),cancelButtonText:l("keySkillTimerSettings.cancelBtn"),inputType:"textarea",inputValidator:e=>{try{const t=le.decompressFromBase64(e),a=JSON.parse(t);return"object"==typeof a&&null!==a||l("keySkillTimerSettings.dataFormatError")}catch(t){const e=t instanceof Error?t.message:String(t);return`${l("keySkillTimerSettings.dataFormatError")}: ${e}`}}}).then(e=>{const{value:t}=e;if(t){const e=le.decompressFromBase64(t),a=JSON.parse(e);"object"==typeof a&&null!==a?(i.keySkillsData.chinese=a.chinese,x.success(l("keySkillTimerSettings.importSuccess"))):x.error(l("keySkillTimerSettings.importFormatError"))}}).catch(()=>{})}W(async()=>{try{await J()}catch(e){}finally{r.value=!0}});const p=A(""),S=te([]);let $;return O(p,e=>{$&&clearTimeout($),$=window.setTimeout(()=>{S.value=D(e)},300)}),(e,l)=>{const w=t,x=a,$=h,z=k,U=o,j=n,C=b,B=s,D=g,J=ie,F=se,E=ge,O=f;return X((L(),M("div",be,[Y("div",he,[Y("div",ve,[q(B,{placement:"bottom-start",width:550,trigger:"click","popper-class":"skill-library-popover"},{reference:K(()=>[q(w,{type:"primary",icon:R(T),loading:!r.value},{default:K(()=>[ee(Z(e.$t("keySkillTimerSettings.searchSkill")),1)]),_:1},8,["icon","loading"])]),default:K(()=>[q(C,{type:"border-card",class:"search-tabs"},{default:K(()=>[q($,{label:e.$t("keySkillTimerSettings.presets")},{default:K(()=>[Y("div",Te,[(L(!0),M(G,null,P(R(N),l=>(L(),M("div",{key:l.key,class:"preset-item"},[Y("div",_e,[q(de,{id:l.id,size:24},null,8,["id"]),Y("span",Ve,Z(R(I)(Number(l.id))||l.tts||e.$t("keySkillTimerSettings.unknownSkill")),1)]),q(w,{link:"",type:"primary",onClick:e=>c(Number(l.id),R(I)(Number(l.id))||l.tts)},{default:K(()=>[q(x,null,{default:K(()=>[q(R(v))]),_:1})]),_:1},8,["onClick"])]))),128))])]),_:1},8,["label"]),q($,{label:e.$t("keySkillTimerSettings.searchTab")},{default:K(()=>[Y("div",we,[q(z,{modelValue:p.value,"onUpdate:modelValue":l[0]||(l[0]=e=>p.value=e),clearable:"",placeholder:e.$t("keySkillTimerSettings.skillName"),"prefix-icon":R(T),style:{"margin-bottom":"12px"},size:"default"},null,8,["modelValue","placeholder","prefix-icon"]),q(j,{data:S.value,style:{width:"100%"},height:"390px",size:"default"},{default:K(()=>[q(U,{width:"40",align:"center"},{default:K(({row:e})=>[q(de,{id:e.id,size:20},null,8,["id"])]),_:1}),q(U,{prop:"id",label:e.$t("keySkillTimerSettings.col.shortId"),width:"80"},null,8,["label"]),q(U,{prop:"name",label:e.$t("keySkillTimerSettings.skillName")},null,8,["label"]),q(U,{width:"50",align:"center"},{default:K(({row:e})=>[q(w,{link:"",type:"primary",onClick:l=>c(e.id,e.name)},{default:K(()=>[q(x,null,{default:K(()=>[q(R(v))]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1},8,["label"])]),_:1})]),_:1})]),Y("div",xe,[q(D,null,{default:K(()=>[q(w,{icon:R(_),onClick:u},{default:K(()=>[ee(Z(e.$t("keySkillTimerSettings.export")),1)]),_:1},8,["icon"]),q(w,{icon:R(V),onClick:m},{default:K(()=>[ee(Z(e.$t("keySkillTimerSettings.import")),1)]),_:1},8,["icon"])]),_:1}),q(w,{type:"danger",icon:R(y),onClick:d},{default:K(()=>[ee(Z(e.$t("keySkillTimerSettings.restoreDefault")),1)]),_:1},8,["icon"])]),Y("div",$e,[q(J,{"storage-key":"key-skill-timer-2"}),q(F,{teleported:!1})])]),Y("main",ze,[q(E,{onDelete:l[1]||(l[1]=e=>function(e){const l=i.keySkillsData.chinese,t=l.findIndex(l=>l.key===e);-1!==t&&l.splice(t,1)}(e)),onMove:l[2]||(l[2]=(e,l)=>function(e,l){const t=i.keySkillsData.chinese;if(l<0||l>=t.length||e===l)return;const a=t[e];a&&(t.splice(e,1),t.splice(l,0,a))}(e,l))})])])),[[O,!r.value,void 0,{fullscreen:!0,lock:!0}]])}}}),[["__scopeId","data-v-95579d14"]]);export{Ue as default};
