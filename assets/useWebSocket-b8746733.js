import{c as e}from"./overlay_plugin_api-974cdd44.js";import{j as o}from"./element-plus-e8032da7.js";import{r as t,f as n,w as l}from"./vue-vendor-f82d765d.js";function a(a={allowClose:!1,addWsParam:!0}){const s=t(void 0),r=t(!1),c=t("overlay");let i=null;function u(){Promise.race([e({call:"cactbotRequestState"}),new Promise((e,o)=>{setTimeout(()=>{o(new Error("Timeout"))},1e3)})]).then(()=>{i&&clearTimeout(i),window.location.href.includes("OVERLAY_WS")&&(s.value=!0,c.value="websocket")}).catch(()=>{s.value=!1,c.value="overlay"})}return window.location.href.includes("OVERLAY_WS")&&(i=setInterval(()=>{u()},3e3)),n(()=>{!function(){const e=window.navigator.userAgent,o=e.includes("MSIE "),t=e.includes("Trident/");return o||t}()?(l(s,e=>{e?o.close():r.value||o.alert("请按照下图设置<img src='/ff14-overlay-vue/assets/actWS-f1a7bc14.webp' style='width:100%'>",a.allowClose?"未连接到 ACT":"未连接到 ACT，无法使用",{dangerouslyUseHTMLString:!0,closeOnClickModal:!1,showClose:!1,closeOnPressEscape:!1,closeOnHashChange:!1,showCancelButton:a.allowClose,showConfirmButton:!1,cancelButtonText:"用不了也要看",buttonSize:"small"}).catch(()=>{r.value=!0})}),!window.location.href.includes("OVERLAY_WS")&&a.addWsParam&&function(){const e=window.location.href,[o,t=""]=e.split("#"),[n,l=""]=t.split("?"),a=new URLSearchParams(l);let s="";a.forEach((e,o)=>{"OVERLAY_WS"!==o&&(s+=`${o}=${encodeURIComponent(e)}&`)}),s+="OVERLAY_WS=ws://127.0.0.1:10501/ws";let r=o;n&&(r+=`#${n}`,s&&(r+=`?${s}`)),window.location.href=r,location.reload()}(),u()):o.alert("不支持 IE 浏览器，请使用 Chrome、Firefox、Edge 等现代浏览器访问。","提示",{type:"error",showConfirmButton:!1,showClose:!1})}),{wsConnected:s,useType:c}}export{a as u};
