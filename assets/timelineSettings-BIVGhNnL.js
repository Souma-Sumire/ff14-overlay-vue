import{_ as e}from"./TimelineShow-uYO1ZLUj.js";import{_ as t}from"./zoneSelecter-CSRAVboE.js";import{n as l,Q as n,R as i,f as a,S as s,j as o,q as c,e as r,T as d,U as u,G as p,F as m,d as f,c as y,k as w,E as g,I as b,x as h,V as v,b as _,W as F,o as $,p as T,v as x,X as V,u as O,Y as S,g as k,w as I,Z as C,a as A,_ as j,h as B}from"./vendor-element-plus-B_x0os-c.js";import{C as E,q as N,r as z,s as U,t as P,U as D,v as L,f as J,w as M,y as R,Z as H}from"./shared-core-BRD4Okf9.js";import{o as K,B as q,t as Z,H as W,I as G,J as X,Y,L as Q,u as ee,v as te,a as le,X as ne,Z as ie,K as ae,R as se,am as oe,r as ce,ac as re,G as de,c as ue,dt as pe,A as me,dj as fe,V as ye,_ as we,a6 as ge,du as be,dv as he,dw as ve,aH as _e}from"./vendor-vue-iK2zA9mI.js";import{_ as Fe,a as $e}from"./shared-common-DPD8IBcY.js";import{a as Te,c as xe}from"./cactbot-CmNinDrW.js";const Ve=new Map;Ve.set(26155,{type:"cast",window:[999,999],battleOnce:!0}),Ve.set(28027,{type:"cast",window:[999,999],battleOnce:!0}),Ve.set(26340,{type:"cast",window:[999,999],battleOnce:!0}),Ve.set(25533,{type:"begincast",window:[60,60]}),Ve.set(26376,{type:"cast",window:[999,999],battleOnce:!0}),Ve.set(26814,{type:"begincast",window:[999,999],battleOnce:!0}),Ve.set(25313,{type:"begincast",window:[200,200]}),Ve.set(27526,{type:"begincast",window:[999,999],battleOnce:!0}),Ve.set(26215,{type:"cast",window:[500,30],battleOnce:!0}),Ve.set(29050,{type:"begincast",window:[200,30],battleOnce:!0}),Ve.set(29156,{type:"cast",window:[20,20]}),Ve.set(27973,{type:"cast",window:[20,20]}),Ve.set(27937,{type:"begincast",window:[20,20]}),Ve.set(28059,{type:"begincast",window:[20,20]}),Ve.set(28060,{type:"begincast",window:[20,20]}),Ve.set(28061,{type:"begincast",window:[20,20]}),Ve.set(27956,{type:"begincast",window:[20,20]}),Ve.set(27957,{type:"begincast",window:[20,20]}),Ve.set(27952,{type:"begincast",window:[30,30]}),Ve.set(27969,{type:"begincast",window:[20,20]}),Ve.set(27971,{type:"begincast",window:[20,20]}),Ve.set(27939,{type:"begincast",window:[20,20]}),Ve.set(27966,{type:"begincast",window:[20,20]}),Ve.set(25316,{type:"begincast",window:[999,999],battleOnce:!0}),Ve.set(25544,{type:"begincast",window:[10,10]}),Ve.set(26379,{type:"begincast",window:[10,10]}),Ve.set(31552,{type:"begincast",window:[30,30]}),Ve.set(31573,{type:"begincast",window:[30,30]}),Ve.set(31573,{type:"begincast",window:[30,30]}),Ve.set(31617,{type:"begincast",window:[8,8]}),Ve.set(31624,{type:"begincast",window:[30,30]}),Ve.set(31649,{type:"begincast",window:[30,30]}),Ve.set(18864,{type:"cast",window:[10,2.5],syncOnce:!0}),Ve.set(18480,{type:"cast",window:[200,60],syncOnce:!0,battleOnce:!0}),Ve.set(18516,{type:"cast",window:[250,65],syncOnce:!0,battleOnce:!0}),Ve.set(18522,{type:"begincast",window:[500,500],syncOnce:!0,battleOnce:!0}),Ve.set(18552,{type:"begincast",window:[67,67],syncOnce:!0}),Ve.set(18553,{type:"cast",window:[67,67],syncOnce:!0}),Ve.set(19083,{type:"cast",window:[900,200],syncOnce:!0,battleOnce:!0}),Ve.set(40191,{type:"begincast",window:[200,20],syncOnce:!0}),Ve.set(40265,{type:"begincast",window:[500,20],syncOnce:!0,battleOnce:!0}),Ve.set(40246,{type:"begincast",window:[999,30],syncOnce:!0,battleOnce:!0}),Ve.set(40306,{type:"begincast",window:[30,30],syncOnce:!0}),Ve.set(11103,{type:"begincast",window:[310,30],syncOnce:!0,battleOnce:!0}),Ve.set(11517,{type:"begincast",window:[600,30],syncOnce:!0,battleOnce:!0}),Ve.set(11122,{type:"begincast",window:[100,30],syncOnce:!0,battleOnce:!0}),Ve.set(11143,{type:"begincast",window:[60,60],syncOnce:!0}),Ve.set(11126,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),Ve.set(11596,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),Ve.set(11597,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),Ve.set(42785,{type:"begincast",window:[9.6,2],syncOnce:!0}),Ve.set(42838,{type:"cast",window:[77.2,30],syncOnce:!0,battleOnce:!0}),Ve.set(42863,{type:"cast",window:[30,30],syncOnce:!1}),Ve.set(42787,{type:"cast",window:[30,30],syncOnce:!1}),Ve.set(42864,{type:"cast",window:[30,30],syncOnce:!1}),Ve.set(41946,{type:"begincast",window:[10,10],syncOnce:!1}),Ve.set(41936,{type:"begincast",window:[20,30],syncOnce:!0}),Ve.set(41939,{type:"begincast",window:[20,20],syncOnce:!0}),Ve.set(42825,{type:"begincast",window:[60,60],syncOnce:!0,battleOnce:!0}),Ve.set(41969,{type:"begincast",window:[20,20],syncOnce:!0}),Ve.set(41871,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0}),Ve.set(43053,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0}),Ve.set(45645,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0});const Oe={class:"query-results"},Se={flex:"~","m-t-10":""},ke={class:"ability-filter-container"},Ie={key:0,class:"loading-abilities"},Ce=["src","alt","onerror"],Ae=Fe(K({__name:"FflogsImport",props:{filters:{}},emits:["showFFlogsToggle","editTimeline"],setup(e,{emit:t}){const b=e,h=t,v=new E({key:"souma-fflogs-cache",maxSize:2097152,cleanupRatio:.25});function _(e){const t=v.get(e);if(!t)return null;try{return JSON.parse(t)}catch{return null}}function F(e,t,l=2592e5){const n={data:t,expire:Date.now()+l};v.set(e,JSON.stringify(n),l)}function $(e){return e&&e.expire>Date.now()}q(()=>{v.clearExpired(),N()});const T=new RegExp("(?<=^|\\/)(?<code>(?:a:)?\\w{16,})[#?]fight=(?<fight>\\d+|last)"),x=ce("查询"),V=ce(""),O=ce(!1),S=ce(!1),k=ce(0),I=ce(!1),C=re({});R();const A=z();async function j(e){S.value=!0,k.value=2,C.player=e,C.type="friendies",C.abilityFilterEvents.length=0,C.abilityFilterCandidate.length=0,C.enemiesAbilityFilterSelected.length=0;try{await async function(){I.value=!1;const e=[];async function t(l){try{const n=`events:friendly:${C.code}:${l}:${C.player?.id}`,i=_(n);let a;i&&$(i)?a=i.data:(a=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${C.code}?start=${l}&end=${C.end}&hostility=0&sourceid=${C.player?.id}&api_key=${A.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),F(n,a)),e.push(...a.events),a.nextPageTimestamp&&a.nextPageTimestamp>0&&a.nextPageTimestamp<C.end&&await t(a.nextPageTimestamp)}catch(n){g.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${n}`,"获取友方技能数据失败",{confirmButtonText:"确定",type:"error"})}}async function l(t,n){if(n>=0)try{const i=`events:enemy:${C.code}:${t}:${C.bossIDs[n]}`,a=_(i);let s;a&&$(a)?s=a.data:(s=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${C.code}?start=${t}&end=${C.end}&hostility=1&sourceid=${C.bossIDs[n]}&api_key=${A.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),F(i,s)),e.push(...s.events),s.nextPageTimestamp&&s.nextPageTimestamp>0&&s.nextPageTimestamp<C.end&&await l(s.nextPageTimestamp,n),n<C.bossIDs.length-1&&await l(t,n+1)}catch(i){g.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${i}`,"获取敌方技能数据失败",{confirmButtonText:"确定",type:"error"})}}C.abilityFilterEvents.length=0,C.enemiesAbilityFilterSelected.length=0,await Promise.all([t(C.start),l(C.start,0)]);for(const n of e)"begincast"===n.type&&n.sourceIsFriendly||C.abilityFilterEvents.push({time:Number(((n.timestamp-C.start)/1e3).toFixed(1)),type:n.type,actionName:L(n.ability.guid)??n.ability.name,actionId:n.ability.guid,sourceIsFriendly:n.sourceIsFriendly,url:n?.ability?.abilityIcon.replace("-","/").replace(".png","")??"000000/000405",window:void 0,sourceID:n.sourceID});I.value=!0}(),C.abilityFilterCandidate=C.abilityFilterEvents.reduce((e,t)=>(t.sourceIsFriendly&&!e.find(e=>e.actionId===t.actionId)&&e.push(t),e),[]).sort((e,t)=>e.time-t.time),C.player?.icon&&b.filters[C.player.icon]&&(C.abilityFilterSelected=b.filters[C.player.icon]),C.abilityFilterSelected=C.abilityFilterSelected.filter(e=>C.abilityFilterCandidate.find(t=>t.actionId===e)),S.value=!1}catch(t){g.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${t}`,"获取玩家技能数据失败",{confirmButtonText:"确定",type:"error"}),S.value=!1}}function B(){S.value=!0,k.value=3,C.player?.icon&&A.updateFilters(C.player?.icon,JSON.parse(JSON.stringify(C.abilityFilterSelected))),C.abilityFilterEvents=C.abilityFilterEvents.filter(e=>e.sourceIsFriendly&&C.abilityFilterSelected.includes(e.actionId)||!e.sourceIsFriendly).sort((e,t)=>e.time-t.time),C.abilityFilterEvents=function(e){for(const t of e){const e=Ve.get(t.actionId);e?.type===t.type&&(t.window=e?.window,t.syncOnce=Boolean(e?.syncOnce),t.battleOnce=Boolean(e?.battleOnce))}return e}(C.abilityFilterEvents),C.abilityFilterEventsAfterFilterRawTimeline=C.abilityFilterEvents.map(e=>{const{time:t,actionName:l,actionId:n,type:i,sourceID:a,window:s,sourceIsFriendly:o,syncOnce:c,battleOnce:r}=e;if(o)return`${t} "<${l}>~"${O.value?` tts "${l}"`:""}`;if(/^(?:攻击|attack|攻撃)$/i.test(l)&&!s||"cast"===i&&!s||C.battleSyncedIDs.includes(n))return`# ${t} "${l}"`;const d=C.enemies.find(e=>e.id===a);if(("NPC"===d?.type||/unknown/.test(l))&&!s)return null;const u=`${t} "${l}" ${"begincast"===i?"StartsUsing":"Ability"} { id: "${n.toString(16).toUpperCase()}" }`;return r&&s&&C.battleSyncedIDs.push(n),s?`${u} window ${s.join(",")} ${c?"once":""}`:`# ${u}`}).filter(e=>null!==e).join("\n");const e=A.newTimeline(`导入${C.player?.name}`,{zoneId:C.zoneID.toString(),jobs:[C.player?.icon??"NONE"]},C.abilityFilterEventsAfterFilterRawTimeline,`${C.code}#fight=${C.fightIndex+1}`);R(),h("showFFlogsToggle"),h("editTimeline",A.allTimelines[e]),setTimeout(()=>{k.value=0},500),S.value=!1}async function J(){S.value=!0,k.value=2,C.type="enemies",C.abilityFilterEvents.length=0,C.abilityFilterCandidate.length=0;try{await async function(){I.value=!1;const e=[];async function t(l,n){if(n>=0)try{const i=`events:enemy:${C.code}:${l}:${C.bossIDs[n]}`,a=_(i);let s;a&&$(a)?s=a.data:(s=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${C.code}?start=${l}&end=${C.end}&hostility=1&sourceid=${C.bossIDs[n]}&api_key=${A.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),F(i,s)),e.push(...s.events),s.nextPageTimestamp&&s.nextPageTimestamp>0&&s.nextPageTimestamp<C.end&&await t(s.nextPageTimestamp,n),n<C.bossIDs.length-1&&await t(l,n+1)}catch(i){g.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${i}`,"获取敌方技能数据失败",{confirmButtonText:"确定",type:"error"})}}C.abilityFilterEvents.length=0,C.enemiesAbilityFilterSelected.length=0,await Promise.all([t(C.start,0)]);for(const n of e)C.abilityFilterEvents.push({time:Number(((n.timestamp-C.start)/1e3).toFixed(1)),type:n.type,actionName:L(n.ability.guid)??n.ability.name,actionId:n.ability.guid,sourceIsFriendly:!1,url:"",window:void 0,sourceID:n.sourceID});I.value=!0,C.enemiesAbilityFilterSelected.length=0;const l=Array.from(new Set(C.abilityFilterEvents.map(e=>e.actionName)));C.enemiesAbilityFilterSelected.push(...l)}(),C.abilityFilterCandidate=C.abilityFilterEvents.reduce((e,t)=>(!1!==t.sourceIsFriendly||e.find(e=>e.actionName===t.actionName)||e.push(t),e),[]).sort((e,t)=>e.time-t.time),C.enemiesAbilityFilterSelected=C.enemiesAbilityFilterSelected.filter(e=>C.abilityFilterCandidate.find(t=>t.actionName===e)),S.value=!1}catch(e){g.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${e}`,"获取敌人技能数据失败",{confirmButtonText:"确定",type:"error"}),S.value=!1}}function M(){k.value=3,C.abilityFilterEvents=C.abilityFilterEvents.filter(e=>C.enemiesAbilityFilterSelected.includes(e.actionName)).sort((e,t)=>e.time-t.time),C.abilityFilterEventsAfterFilterRawTimeline=C.abilityFilterEvents.map(e=>{const{time:t,actionName:l,actionId:n,type:i}=e,a="begincast"===i?"StartsUsing":"Ability",s=n.toString(16).toUpperCase(),o=C.enemies.find(t=>t.id===e.sourceID),c="Boss"===o?.type?"Boss":"分身";return`${t} "${l}" ${a} { id: "${s}" } #${o?.name??"未知"}（${c}）`}).join("\n");const e=A.newTimeline("BOSS时间轴（使用前请删除非必要的正则）",{zoneId:C.zoneID.toString(),jobs:[]},C.abilityFilterEventsAfterFilterRawTimeline,`${C.code}#fight=${C.fightIndex+1}`);R(),h("showFFlogsToggle"),h("editTimeline",A.allTimelines[e]),setTimeout(()=>{k.value=0},500)}function R(){C.type="friendies",C.code="",C.fightIndex=0,C.start=0,C.end=0,C.friendlies=[],C.abilityFilterEvents=[],C.abilityFilterCandidate=[],C.abilityFilterSelected=[],C.enemiesAbilityFilterSelected=[],C.abilityFilterEventsAfterFilterRawTimeline="",C.player=void 0,C.zoneID=0,C.bossIDs=[],C.enemies=[],C.battleSyncedIDs=[]}function H(){window.open("https://cn.fflogs.com/profile","_blank")}return(e,t)=>{const b=l,h=n,v=i,E=o,N=s,z=c,L=r,K=u,q=a,ce=p,re=m,de=f,ue=y,pe=w;return Z(),W(se,null,[G(b,{style:Q(ee(k)>0?{}:{visibility:"hidden",pointerEvent:"none"}),type:"primary",text:"","position-absolute":"","z-999":"",class:"guide",onClick:t[0]||(t[0]=e=>k.value--)},{default:X(()=>[...t[8]||(t[8]=[Y(" 上一步 ",-1)])]),_:1},8,["style"]),G(v,{active:ee(k),class:"steps-guide","align-center":""},{default:X(()=>[G(h,{title:"导入战斗"}),G(h,{title:"选择目标"}),G(h,{title:"过滤技能"})]),_:1},8,["active"]),0===ee(k)?(Z(),te(q,{key:0,class:"input-section"},{default:X(()=>[G(K,{"label-width":"150px",class:"fflogs-form"},{default:X(()=>[G(N,{label:"FF Logs 战斗链接"},{default:X(()=>[G(E,{modelValue:ee(V),"onUpdate:modelValue":t[1]||(t[1]=e=>le(V)?V.value=e:null),placeholder:"https://www.fflogs.com/reports/AAAaAaAAaa1aA1aA?fight=1",autocomplete:"on"},null,8,["modelValue"])]),_:1}),G(N,{label:"FF logs V1 Key"},{default:X(()=>[G(E,{modelValue:ee(A).settings.api,"onUpdate:modelValue":t[2]||(t[2]=e=>ee(A).settings.api=e),placeholder:"在 FF Logs 个人设置页面获取 V1 API Key",type:"password","show-password":""},{append:X(()=>[G(z,{content:"点击前往 FF Logs 个人设置页面，在最下方填写 V1客户名称 并点击确认后，再获取你的 V1 客户端密钥",placement:"top",effect:"light"},{default:X(()=>[G(b,{type:"primary",link:"",onClick:H},{default:X(()=>[...t[9]||(t[9]=[Y(" 如何获取 ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),G(N,null,{default:X(()=>[G(b,{disabled:"正在查询..."===ee(x),type:"primary",onClick:t[3]||(t[3]=e=>async function(e){S.value=!0,R(),x.value="正在查询...";const t=e.match(T);if(!A.settings.api)return g.alert("请在FF Logs个人设置页面获取V1 API Key","FF logs API Key 未填写",{confirmButtonText:"确定",type:"error",dangerouslyUseHTMLString:!0,message:'<a href="https://cn.fflogs.com/profile">点击这里，在最下方<strong>填写 V1 客户名称并点击确认</strong>后，获取你的 V1 客户端密钥</a>'}),x.value="查询",void(S.value=!1);if(!t)return g.alert("请正确填写FF Logs链接","FF Logs链接格式错误",{confirmButtonText:"确定",type:"error"}),x.value="查询",void(S.value=!1);C.code=t.groups?.code??"";try{const e=`fights:${C.code}`,l=_(e);let n;l&&$(l)?n=l.data:(n=await fetch(`https://cn.fflogs.com/v1/report/fights/${C.code}?api_key=${A.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),F(e,n)),C.bossIDs=n.enemies.filter(e=>["Boss","NPC"].includes(e.type)).map(e=>e.id),C.enemies=n.enemies.slice(),C.fightIndex=("last"===t?.groups?.fight?n.fights.length:Number.parseInt(t?.groups?.fight??"0"))-1;const i=n.fights[C.fightIndex];C.zoneID=i.zoneID,C.start=i.start_time,C.end=i.end_time,C.friendlies=n.friendlies.filter(e=>"LimitBreak"!==e.icon&&e.fights.find(e=>e.id===C.fightIndex+1)),C.friendlies.sort((e,t)=>{const l=D.iconToJobEnum(e.icon),n=D.iconToJobEnum(t.icon);return D.enumSortMethod(l,n)}),x.value="查询",C.abilityFilterEvents.length=0,C.abilityFilterCandidate.length=0,S.value=!1,k.value=1}catch(l){g.alert(`\n  <h3 style="margin-bottom: 10px;">可能的原因：</h3>\n  <ul style="padding-left: 20px; margin-bottom: 10px;">\n    <li> <strong>90%概率</strong>：你没有<strong style="color: red;">先起名</strong>再获取 V1 客户端密钥</li>\n    <li> <strong>5%概率</strong>：该战斗记录是私人或匿名模式</li>\n    <li> <strong>5%概率</strong>：网络异常</li>\n  </ul>\n<p class="error-details"><strong>错误：</strong>${l}</p>\n`,"请求失败",{confirmButtonText:"确定",type:"error",dangerouslyUseHTMLString:!0}),x.value="查询",S.value=!1}}(ee(V)))},{default:X(()=>[ee(S)?(Z(),te(L,{key:0,class:"is-loading"},{default:X(()=>[G(ee(d))]),_:1})):ne("",!0),Y(" "+ie(ee(x)),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})):ne("",!0),ae("div",Oe,[1===ee(k)?(Z(),te(q,{key:0,class:"player-selection"},{default:X(()=>[G(re,{data:ee(C).friendlies.filter(e=>!["NPC"].includes(e.icon)),stripe:"",border:"",class:"friendlies-table"},{default:X(()=>[G(ce,{prop:"name",label:"玩家名称"}),G(ce,{label:"职业"},{default:X(({row:e})=>{return[Y(ie((t=e.icon,D.jobToFullName(D.jobEnumToJob(D.iconToJobEnum(t))).cn)),1)];var t}),_:1}),G(ce,{label:"选定",width:"100",align:"center"},{default:X(e=>[G(b,{type:"primary",size:"small",onClick:t=>j(e.row)},{default:X(()=>[...t[10]||(t[10]=[Y(" 选择 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),ae("div",Se,[G(b,{type:"info",onClick:t[4]||(t[4]=e=>J())},{default:X(()=>[...t[11]||(t[11]=[Y(" 不选择玩家，而是生成BOSS时间轴 ",-1)])]),_:1})])]),_:1})):ne("",!0),2===ee(k)?(Z(),te(q,{key:1,class:"ability-filter"},{default:X(()=>[ae("div",ke,[ee(I)?ne("",!0):(Z(),W("div",Ie,[G(L,{class:"is-loading"},{default:X(()=>[G(ee(d))]),_:1}),t[12]||(t[12]=ae("span",null,"正在加载技能列表...",-1))])),ee(I)&&"friendies"===ee(C).type?(Z(),W(se,{key:1},[G(ue,{modelValue:ee(C).abilityFilterSelected,"onUpdate:modelValue":t[5]||(t[5]=e=>ee(C).abilityFilterSelected=e),multiple:"",placeholder:"选择需要导入的技能","fit-input-width":!0,class:"ability-filter-select",filterable:""},{default:X(()=>[(Z(!0),W(se,null,oe(ee(C).abilityFilterCandidate,e=>(Z(),te(de,{key:e.actionId,value:e.actionId,label:e.actionName,class:"ability-filter-option"},{default:X(()=>[ae("img",{src:ee(P)(`/i/${e.url}.png`),class:"ability-filter-icon",alt:e.actionName,onerror:ee(U)},null,8,Ce),ae("span",null,ie(e.actionName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"]),G(N,{label:"添加 TTS 语法","m-t-3":"","w-60":""},{default:X(()=>[G(pe,{modelValue:ee(O),"onUpdate:modelValue":t[6]||(t[6]=e=>le(O)?O.value=e:null)},null,8,["modelValue"])]),_:1}),G(b,{type:"success",class:"filter-confirm-btn",disabled:!ee(I),onClick:B},{default:X(()=>[...t[13]||(t[13]=[Y(ie("生成玩家时间轴"),-1)])]),_:1},8,["disabled"])],64)):ee(I)&&"enemies"===ee(C).type?(Z(),W(se,{key:2},[ee(I)?(Z(),te(ue,{key:0,modelValue:ee(C).enemiesAbilityFilterSelected,"onUpdate:modelValue":t[7]||(t[7]=e=>ee(C).enemiesAbilityFilterSelected=e),multiple:"",placeholder:"选择需要导入的技能","fit-input-width":!0,class:"ability-filter-select",filterable:""},{default:X(()=>[(Z(!0),W(se,null,oe(ee(C).abilityFilterCandidate,e=>(Z(),te(de,{key:e.actionName,value:e.actionName,class:"ability-filter-option"},{default:X(()=>[ae("span",null,ie(e.actionName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])):ne("",!0),G(b,{type:"success",class:"filter-confirm-btn",disabled:!ee(I),onClick:M},{default:X(()=>[...t[14]||(t[14]=[Y(ie("生成敌人时间轴"),-1)])]),_:1},8,["disabled"])],64)):ne("",!0)])]),_:1})):ne("",!0)])],64)}}}),[["__scopeId","data-v-7afcf775"]]),je=Fe(K({__name:"SettingsDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(t,{emit:l}){const n=t,i=l,a=z();de(()=>{a.saveTimelineSettings()});const o=ue({get:()=>n.modelValue,set:e=>i("update:modelValue",e)}),c=ce(-15),r=ce([{time:-15,action:"<圣光幕帘>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:-2,action:"<圣灵>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:0,action:"战斗开始！",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:3,action:"<挑衅>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:5,action:"<神圣领域>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1}]);return(t,l)=>{const n=_,i=s,d=v,p=h,m=F,f=e,y=u,w=b;return Z(),te(w,{modelValue:ee(o),"onUpdate:modelValue":l[1]||(l[1]=e=>le(o)?o.value=e:null),modal:!0,overflow:"","close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"timeline-dialog",width:"600px","append-to-body":!0,draggable:!0},{header:X(()=>[...l[2]||(l[2]=[ae("h3",{style:{margin:"0",padding:"10px","background-color":"#f5f7fa",cursor:"move"}}," 设置 ",-1)])]),default:X(()=>[G(y,{"label-position":"right","label-width":"120px",class:"timeline-form"},{default:X(()=>[l[3]||(l[3]=ae("h3",{class:"form-section-title"}," 参数 ",-1)),G(p,{gutter:20},{default:X(()=>[(Z(!0),W(se,null,oe(ee(a).configValues,(e,t,l)=>(Z(),te(d,{key:l,span:12},{default:X(()=>[G(i,{label:ee(a).configTranslate[t]},{default:X(()=>[G(n,{modelValue:ee(a).configValues[t],"onUpdate:modelValue":e=>ee(a).configValues[t]=e,min:0,step:.1,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),l[4]||(l[4]=ae("h3",{class:"form-section-title"}," 样式 ",-1)),G(p,{gutter:20},{default:X(()=>[(Z(!0),W(se,null,oe(ee(a).showStyle,(e,t,l)=>(Z(),te(d,{key:l,span:12},{default:X(()=>[G(i,{label:ee(a).showStyleTranslate[t]},{default:X(()=>[G(n,{modelValue:ee(a).showStyle[t],"onUpdate:modelValue":e=>ee(a).showStyle[t]=e,min:0,step:.01,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),l[5]||(l[5]=ae("h3",{class:"form-section-title"}," 测试用例 ",-1)),G(p,{gutter:20},{default:X(()=>[G(m,{modelValue:ee(c),"onUpdate:modelValue":l[0]||(l[0]=e=>le(c)?c.value=e:null),min:-15,max:5,step:.1,"show-input":""},null,8,["modelValue"]),G(f,{config:ee(a).configValues,lines:ee(r),runtime:ee(c),"show-style":ee(a).showStyle},null,8,["config","lines","runtime","show-style"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-fcf4e153"]]),Be={class:"batch-operations",style:{"margin-bottom":"15px",display:"flex","flex-wrap":"wrap","justify-content":"space-between",gap:"10px"}},Ee={style:{display:"flex",gap:"10px","flex-wrap":"wrap"}},Ne={class:"editor-dialog-content"},ze=["value"],Ue={class:"slider-demo-block"},Pe={class:"time-display",style:{width:"80px","text-align":"center"}},De={class:"time-display-text"},Le={class:"time-display-text"},Je={style:{"margin-top":"1em"}},Me=Fe(K({__name:"timelineSettings",setup(n){const i=fe(),{wsConnected:c}=J({allowClose:!0,addWsParam:!0}),r=z(),d=ge(r,"allTimelines"),u=ge(r,"filters"),w=ce(0),_=ce([]),E=ce(!1),N=ce(!1),U=ce(!1),P=ce(!1),L=ce(!1);let K,ne;const re=pe("timelineCurrentlyEditing",{name:"空",condition:{zoneId:"0",jobs:["NONE"]},timeline:"空",codeFight:"空",create:"空"}),de=ce([]);let Fe=null,Ve=!1;const Oe=ce(""),Se=ce(""),ke=ce("");let Ie;const Ce=ue(()=>d.value.filter(e=>{const t=e.name.toLowerCase().includes(Oe.value.toLowerCase()),l=!Se.value||e.condition.zoneId===Se.value,n=!ke.value||e.condition.jobs.includes(ke.value);return t&&l&&n})),Me=ue(()=>{const e=w.value,t=e<0,l=Math.abs(Math.floor(e)),n=Math.floor(l/60),i=l%60;return`${t?"-":""}${String(n).padStart(2,"0")}:${String(i).padStart(2,"0")}`}),Re=ce(0);function He(e){re.value=e,N.value=!0,Ze()}function Ke(){N.value=!1}function qe(){He(r.allTimelines[r.newTimeline()])}function Ze(){de.value=[{time:0,action:"正在加载...",show:!0,windowBefore:0,windowAfter:0,alertAlready:!0}],M(re.value.timeline).then(e=>{de.value=e;const t=Math.max(...de.value.map(e=>e.time),550);Re.value=t+30,w.value=-r.configValues.preBattle})}function We(){if(0===_.value.length)return void A.warning("请选择要删除的时间轴");const e=_.value.map(e=>`「${e.name}」`).join("<br/>");g.confirm(`确定要删除选中的 ${_.value.length} 个时间轴吗？<br>${e}`,"批量删除时间轴",{confirmButtonText:"确认删除",cancelButtonText:"取消",dangerouslyUseHTMLString:!0,type:"warning"}).then(()=>{A.success(`成功删除 ${_.value.length} 个时间轴`),d.value=d.value.filter(e=>!_.value.includes(e)),_.value=[],E.value=!1}).catch(()=>{})}function Ge(){E.value=!E.value,_.value=E.value?[...d.value]:[]}function Xe(){0!==_.value.length?Ye(_.value):A.warning("请选择要导出的时间轴")}function Ye(e){const t=JSON.stringify(e),l=JSON.parse(t);for(const r of l)r.timeline=r.timeline.replace(/^#.*(?:\n|$)/gm,"");const n=JSON.stringify(l),i=he.compressToBase64(t),a=he.compressToBase64(n),s=i.length,o=a.length;if(s===o)return void ct(i,"数据复制成功，已写入剪切板。","复制失败，请手动复制！");const c=((s-o)/s*100).toFixed(2);g.confirm(`\n     1. 完整版本（包含注释）<br>\n     &nbsp;&nbsp;&nbsp;- 大小：${s} 字节<br>\n     &nbsp;&nbsp;&nbsp;- 包含所有时间轴信息和注释<br><br>\n     2. 优化版本（不含注释）<br>\n     &nbsp;&nbsp;&nbsp;- 大小：${o} 字节<br>\n     &nbsp;&nbsp;&nbsp;- 节省 ${c}% 的空间<br>\n     &nbsp;&nbsp;&nbsp;- 仅包含必要的时间轴数据`,"请选择导出版本：",{confirmButtonText:"导出优化版本",cancelButtonText:"导出完整版本",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnPressEscape:!1,dangerouslyUseHTMLString:!0,showClose:!0,type:"info",callback:e=>{if("cancel"===e||"confirm"===e){ct("confirm"===e?a:i,"数据复制成功，已写入剪切板。","复制失败，请手动复制！")}}})}function Qe(){g.prompt("请输入导出的字符串（支持多行导入）","导入时间轴",{confirmButtonText:"解析",cancelButtonText:"取消",inputType:"textarea",inputValidator:e=>{if(!e)return"请输入导出的字符串";const t=e.split("\n").filter(e=>""!==e.trim());let l=[];for(const n of t){let e;try{e=JSON.parse(n)}catch{try{const t=he.decompressFromBase64(n);e=JSON.parse(t)}catch{return`无法解析输入的数据：${n}，请确保每行都是正确的JSON或压缩后的字符串。`}}if(!Array.isArray(e))return`导入的数据格式不正确：${n}`;l=l.concat(e)}return 0!==l.length||"导入的数据不包含任何时间轴。"},inputErrorMessage:"无效的输入"}).then(e=>{const{value:t}=e,l=t.split("\n").filter(e=>""!==e.trim());let n=[];for(const s of l){let e;try{e=JSON.parse(s)}catch{const t=he.decompressFromBase64(s);e=JSON.parse(t)}n=n.concat(e)}const i=n.length,a=n.map(e=>`「${e.name}」`).join(", ");g({title:"确认",message:`导入 ${i} 个时间轴：\n${a}\n？`,showCancelButton:!0,showConfirmButton:!0,confirmButtonText:"追加",cancelButtonText:"覆盖",distinguishCancelAndClose:!0,type:"warning",callback:e=>{"cancel"===e?g.prompt('覆盖操作将删除所有现有的时间轴。请输入"我确认"以继续。',"二次确认",{confirmButtonText:"确定覆盖",cancelButtonText:"取消",inputPattern:/^我确认$/,inputErrorMessage:'请输入"我确认"以确认覆盖操作',type:"warning"}).then(e=>{const{value:t}=e;"我确认"===t&&et(n,!0)}).catch(()=>{}):"confirm"===e&&et(n,!1)}})}).catch(()=>{})}function et(e,t){t&&(r.allTimelines.length=0),r.allTimelines.push(...e),r.sortTimelines();for(const a of r.allTimelines)void 0===a.condition.jobs&&(a.condition.jobs=[a.condition?.job??"NONE"]);if(t)return void A({type:"success",message:"覆盖成功！",duration:2e3});const l=[],n=new Set;for(const a of r.allTimelines){const e=JSON.stringify({name:a.name,condition:a.condition,timeline:a.timeline,codeFight:a.codeFight,create:a.create});n.has(e)||(n.add(e),l.push(a))}const i=r.allTimelines.length-l.length;r.allTimelines=l,A({message:`追加成功！共导入 ${e.length} 个时间轴${i>0?`，但其中 ${i} 个重复，已自动移除。`:""}`,type:"success",duration:3e3})}function tt(e,t={}){xe({call:"broadcast",source:"soumaTimelineSettings",msg:{type:e,data:t}})}function lt(){const e=i.resolve({path:"/timeline"}),t=`${window.location.protocol}//${window.location.host}/ff14-overlay-vue/${e.href}`;Ve=!0,Fe=B.service({lock:!0,text:`正在请求数据，请确保 ACT 中已添加并启用此悬浮窗：${t}`,background:"rgba(0, 0, 0, 0.7)"}),tt("get"),setTimeout(()=>{Ve&&(A.info("重新尝试获取数据..."),lt())},5e3)}const nt=e=>{if("soumaTimeline"===e.source)if("post"===e.msg.type){Ve=!1,Fe.close();const t=e.msg.data;for(const e of t.allTimelines)void 0===e.condition.jobs&&(e.condition.jobs=[e.condition.job]),e.condition.jobs.sort((e,t)=>r.jobList.indexOf(e)-r.jobList.indexOf(t)),Reflect.deleteProperty(e.condition,"job");r.allTimelines=t.allTimelines,r.configValues=t.configValues,r.showStyle=t.showStyle,A.closeAll(),A({message:"数据获取成功",type:"success",duration:3e3})}else"success"===e.msg.type?(K&&(clearTimeout(K),K=void 0),ne&&(ne.close(),ne=void 0),j.closeAll(),j({message:"数据同步成功",type:"success",duration:1e3,position:"bottom-left",icon:"el-icon-success",zIndex:1,showClose:!1})):"hello"===e.msg.type&&ne&&ut()};function it(){window.open("https://docs.qq.com/sheet/DTWxKT3lFbmpDV3Fm?tab=5ovrc8","_blank")}function at(){const e=i.resolve({path:"/timelineHelp"}).href;window.open(e,"_blank")}function st(){U.value=!0}function ot(e){r.configValues=e.configValues,r.showStyle=e.showStyle}function ct(e,t="复制成功",l="复制失败"){R(e).then(()=>A.success(t)).catch(()=>A.error(l))}function rt({row:e}){return e===re.value?"editing-row":""}function dt(){L.value=!0}function ut(){tt("post",r.$state),clearTimeout(K),K=window.setTimeout(()=>{const e=i.resolve({path:"/timeline"}),t=`${window.location.protocol}//${window.location.host}/ff14-overlay-vue/${e.href}`;ne?.close(),ne=j({title:"同步数据失败",message:_e("div",{style:"color:#f00"},[_e("div",["请确保你已正确启用了 ",_e("a",{href:t,target:"_blank",style:"color:#f00; text-decoration: underline;"},"此悬浮窗"),"。"])]),showClose:!1,duration:0,position:"bottom-left"})},500)}function pt(e){const t=H[e]?.name;return t?t.cn||`${t.ja} / ${t.en}`:"未知地图"}function mt(e){return(D.jobToFullName(e.toUpperCase())?.cn??e).replace("冒险者","全部职业")}return q(()=>{Te("BroadcastMessage",nt);const e=me(c,t=>{t&&(0===r.allTimelines.length&&lt(),e(),Ie&&(Ie.close(),ut()))});r.allTimelines.forEach(e=>e.timeline=e.timeline.replaceAll(/^(?<a>.+), once: true(?<b>.+)$/gm,"$<a>$<b> once"));const t=ve(()=>{c.value?ut():(Ie?.close(),Ie=j({title:"你修改了时间轴，但",message:_e("i",{style:"color: #f00"},"改动未应用，直到你成功连接到 WebSocket。"),showClose:!1,duration:0,position:"bottom-left"}))},500);me(()=>r.$state,t,{deep:!0})}),r.loadTimelineSettings(),r.sortTimelines(),(n,i)=>{const c=p,j=m,B=b,z=je,D=l,J=V,M=x,R=$e,H=h,K=T,q=Ae,ne=o,ce=t,ue=f,pe=y,me=S,fe=k,ge=a,he=I,ve=O,_e=s,Fe=v,Te=C,xe=F,Ve=e,Ie=$;return Z(),te(Ie,{class:"container"},{default:X(()=>[G(B,{modelValue:ee(L),"onUpdate:modelValue":i[0]||(i[0]=e=>le(L)?L.value=e:null),title:"时间轴解析结果","align-center":"",center:"",draggable:"",width:"80%"},{default:X(()=>[G(j,{data:ee(de)},{default:X(()=>[G(c,{property:"time",label:"time","min-width":"60"}),G(c,{property:"action",label:"action",width:"150"},{default:X(({row:e})=>[Y(ie(e.action.replaceAll(/(^['"“”]|['"“”]$)/g,"")),1)]),_:1}),G(c,{property:"sync",label:"sync","min-width":"200"},{default:X(({row:e})=>[Y(ie(e.sync?e.sync:"-"),1)]),_:1}),G(c,{property:"syncOnce",label:"once","min-width":"100"},{default:X(({row:e})=>[Y(ie(e.syncOnce?"✅":"-"),1)]),_:1}),G(c,{label:"window","min-width":"100"},{default:X(({row:e})=>[Y(ie(e.sync?`${e.windowBefore},${e.windowAfter}`:"-"),1)]),_:1}),G(c,{property:"jump",label:"jump","min-width":"100"},{default:X(({row:e})=>[Y(ie(e.jump?e.jump:"-"),1)]),_:1}),G(c,{property:"tts",label:"tts","min-width":"150"},{default:X(({row:e})=>[Y(ie(e.tts?e.tts:"-"),1)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),G(z,{modelValue:ee(P),"onUpdate:modelValue":i[1]||(i[1]=e=>le(P)?P.value=e:null),onSave:ot},null,8,["modelValue"]),G(K,{class:"flex-header"},{default:X(()=>[G(H,{justify:"space-between",align:"middle"},{default:X(()=>[G(M,null,{default:X(()=>[G(J,null,{default:X(()=>[G(D,{type:"primary",size:"small",onClick:st},{default:X(()=>[...i[21]||(i[21]=[Y(" 从 FFlogs 生成 ",-1)])]),_:1}),G(D,{type:"primary",size:"small",onClick:it},{default:X(()=>[...i[22]||(i[22]=[Y(" 从 在线文档 获取 ",-1)])]),_:1}),G(D,{type:"primary",size:"small",onClick:qe},{default:X(()=>[...i[23]||(i[23]=[Y(" 手动编写 ",-1)])]),_:1})]),_:1}),G(J,null,{default:X(()=>[G(D,{size:"small",onClick:Qe},{default:X(()=>[...i[24]||(i[24]=[Y(" 导入字符串 ",-1)])]),_:1}),G(D,{size:"small",class:"export",onClick:i[2]||(i[2]=e=>Ye(ee(d)))},{default:X(()=>[...i[25]||(i[25]=[Y(" 导出全部 ",-1)])]),_:1})]),_:1})]),_:1}),G(M,null,{default:X(()=>[G(R,{"storage-key":"timeline-settings-theme"}),G(D,{color:"#626aef",style:{color:"white"},size:"small",onClick:i[3]||(i[3]=e=>P.value=!0)},{default:X(()=>[...i[26]||(i[26]=[Y(" 参数设置 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),G(ve,null,{default:X(()=>[G(B,{modelValue:ee(U),"onUpdate:modelValue":i[5]||(i[5]=e=>le(U)?U.value=e:null),title:"从 FFlogs 生成时间轴",width:"80%","before-close":()=>U.value=!1,"close-on-press-escape":!1,"close-on-click-modal":!1},{default:X(()=>[G(q,{filters:ee(u),onShowFFlogsToggle:i[4]||(i[4]=()=>U.value=!1),onEditTimeline:He},null,8,["filters"])]),_:1},8,["modelValue","before-close"]),ee(d).length>0?(Z(),te(ge,{key:0},{default:X(()=>[ae("div",Be,[ae("div",Ee,[G(ne,{modelValue:ee(Oe),"onUpdate:modelValue":i[6]||(i[6]=e=>le(Oe)?Oe.value=e:null),placeholder:"搜索名称...",clearable:"",size:"small",style:{width:"180px"}},null,8,["modelValue"]),G(ce,{"select-zone":ee(Se),"onUpdate:selectZone":i[7]||(i[7]=e=>le(Se)?Se.value=e:null),placeholder:"筛选地图",size:"small",style:{width:"180px"},clearable:!0},null,8,["select-zone"]),G(pe,{modelValue:ee(ke),"onUpdate:modelValue":i[8]||(i[8]=e=>le(ke)?ke.value=e:null),placeholder:"筛选职业",clearable:"",size:"small",style:{width:"180px"}},{default:X(()=>[G(ue,{label:"全部职业",value:""}),(Z(!0),W(se,null,oe(ee(r).jobList,e=>(Z(),te(ue,{key:e,label:mt(e),value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),ye(ae("div",null,[G(me,{type:"info"},{default:X(()=>[Y(" 筛选结果：共 "+ie(ee(Ce).length)+" 个时间轴 ",1)]),_:1})],512),[[we,ee(Oe)||ee(Se)||ee(ke)]]),ae("div",null,[G(D,{type:"primary",size:"small",disabled:0===ee(_).length,onClick:Xe},{default:X(()=>[Y(" 批量导出 ("+ie(ee(_).length)+") ",1)]),_:1},8,["disabled"]),G(D,{type:"danger",size:"small",disabled:0===ee(_).length,style:{"margin-left":"10px"},onClick:We},{default:X(()=>[Y(" 批量删除 ("+ie(ee(_).length)+") ",1)]),_:1},8,["disabled"])])]),G(j,{data:ee(Ce),"row-class-name":rt,style:{width:"100%"},stripe:"","default-sort":{prop:"condition",order:"ascending"},onSelectionChange:i[10]||(i[10]=e=>{_.value=e,E.value=e.length===ee(d).length})},{default:X(()=>[G(c,{type:"selection",width:"55",align:"center"},{header:X(()=>[G(fe,{modelValue:ee(E),"onUpdate:modelValue":i[9]||(i[9]=e=>le(E)?E.value=e:null),onChange:Ge},null,8,["modelValue"])]),_:1}),G(c,{prop:"name",label:"名称"}),G(c,{prop:"condition",label:"地图",sortable:""},{default:X(e=>[Y(ie(pt(e.row.condition.zoneId)),1)]),_:1}),G(c,{prop:"condition",label:"职业"},{default:X(e=>[Y(ie(e.row.condition.jobs.map(e=>mt(e)).join("、").replace("冒险者","全部职业")),1)]),_:1}),G(c,{label:"操作",width:"150"},{default:X(e=>[G(D,{type:"primary",size:"small",onClick:t=>He(e.row)},{default:X(()=>[...i[27]||(i[27]=[Y(" 编辑 ",-1)])]),_:1},8,["onClick"]),G(D,{type:"danger",size:"small",onClick:t=>{return l=e.row,void g.confirm(`确定要删除「${l.name}」吗？`,"删除时间轴",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning"}).then(()=>{d.value.splice(d.value.findIndex(e=>e===l),1)}).catch(()=>{});var l}},{default:X(()=>[...i[28]||(i[28]=[Y(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):(Z(),te(ge,{key:1},{default:X(()=>[G(he,{description:"点击上方新建或导入一个时间轴吧~"})]),_:1}))]),_:1}),G(B,{modelValue:ee(N),"onUpdate:modelValue":i[20]||(i[20]=e=>le(N)?N.value=e:null),title:"编辑时间轴",top:"5vh","before-close":Ke,class:"timeline-dialog",width:"65%",style:{"min-width":"550px","max-width":"1000px"},"close-on-click-modal":!1,"close-on-press-escape":!1},{default:X(()=>[ae("div",Ne,[G(H,{class:"timeline-header",gutter:10},{default:X(()=>[G(Fe,{span:14},{default:X(()=>[G(_e,{label:"名称"},{default:X(()=>[G(ne,{modelValue:ee(re).name,"onUpdate:modelValue":i[11]||(i[11]=e=>ee(re).name=e)},null,8,["modelValue"])]),_:1})]),_:1}),G(Fe,{span:8},{default:X(()=>[G(_e,{label:"来源"},{default:X(()=>["用户创建"!==ee(re).codeFight?(Z(),te(Te,{key:0,href:`https://cn.fflogs.com/reports/${ee(re).codeFight.replace("#","?")}&type=damage-done`,target:"_blank"},{default:X(()=>[i[29]||(i[29]=ae("img",{class:"site-logo",src:"https://assets.rpglogs.cn/img/ff/favicon.png?v=4",alt:"FF Logs",style:{width:"34px",height:"33.4688px"}},null,-1)),Y(ie(ee(re).codeFight),1)]),_:1},8,["href"])):(Z(),W("input",{key:1,type:"text",value:`${ee(re).codeFight}（${ee(re).create}）`,disabled:"","w-80":"","p-1.3":""},null,8,ze))]),_:1})]),_:1}),G(Fe,{span:22},{default:X(()=>[G(_e,{label:"地图"},{default:X(()=>[G(ce,{"select-zone":ee(re).condition.zoneId,"onUpdate:selectZone":i[12]||(i[12]=e=>ee(re).condition.zoneId=e),size:"default"},null,8,["select-zone"])]),_:1})]),_:1}),G(Fe,{span:22},{default:X(()=>[G(_e,{label:"职业"},{default:X(()=>[G(pe,{modelValue:ee(re).condition.jobs,"onUpdate:modelValue":i[13]||(i[13]=e=>ee(re).condition.jobs=e),multiple:""},{default:X(()=>[(Z(!0),W(se,null,oe(ee(r).jobList,e=>(Z(),te(ue,{key:e,label:mt(e),value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),ae("div",Ue,[G(xe,{modelValue:ee(w),"onUpdate:modelValue":i[14]||(i[14]=e=>le(w)?w.value=e:null),min:-ee(r).configValues.preBattle,max:ee(Re),step:.1},null,8,["modelValue","min","max"]),ae("div",Pe,[ae("p",De,ie(ee(Me)),1),ae("p",Le," ("+ie(ee(w))+"s) ",1)])]),G(H,{class:"timeline-editor-body",gutter:10},{default:X(()=>[G(Fe,null,{default:X(()=>[G(ne,{modelValue:ee(re).timeline,"onUpdate:modelValue":i[15]||(i[15]=e=>ee(re).timeline=e),style:Q({width:`calc(100% - ${ee(r).showStyle["--timeline-width"]}px)`}),type:"textarea",autosize:{minRows:10,maxRows:20},wrap:"off",placeholder:"请键入时间轴文本",onChange:i[16]||(i[16]=e=>Ze())},null,8,["modelValue","style"])]),_:1}),G(Ve,{style:{position:"absolute",right:0,top:0},config:ee(r).configValues,lines:ee(de),runtime:ee(w),"show-style":ee(r).showStyle},null,8,["config","lines","runtime","show-style"])]),_:1}),ae("div",Je,[G(M,null,{default:X(()=>[G(D,{onClick:i[17]||(i[17]=e=>Ye([ee(re)]))},{default:X(()=>[...i[30]||(i[30]=[Y(" 导出 ",-1)])]),_:1}),G(D,{onClick:i[18]||(i[18]=e=>{re.value.timeline=re.value.timeline.replaceAll(new RegExp("(?<=^(?:#\\s*)?)(\\d+(?::\\d+(?:\\.\\d{1,2})?|(?:\\.\\d+)?))","gm"),e=>e.includes(":")?be.duration(`00:${e}`).as("seconds").toString():be.utc(1e3*Number(e)).format("mm:ss.S"))})},{default:X(()=>[...i[31]||(i[31]=[Y(" 切换时间格式 ",-1)])]),_:1}),G(D,{onClick:at},{default:X(()=>[...i[32]||(i[32]=[Y(" 时间轴语法 ",-1)])]),_:1}),G(D,{onClick:i[19]||(i[19]=e=>{g.confirm("要删除所有的注释行，仅保留必要的时间轴数据吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{re.value.timeline=re.value.timeline.replace(/^#.*(?:\n|$)/gm,""),A.success("完成")}).catch(()=>{})})},{default:X(()=>[...i[33]||(i[33]=[Y(" 去除注释行 ",-1)])]),_:1}),G(D,{onClick:dt},{default:X(()=>[...i[34]||(i[34]=[Y(" 展示调试信息 ",-1)])]),_:1})]),_:1})])])]),_:1},8,["modelValue"])]),_:1})}}}),[["__scopeId","data-v-3f1a9e6c"]]);export{Me as default};
