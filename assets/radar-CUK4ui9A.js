import{_ as e}from"./ActWrapper-Bcs9DyeN.js";import{d as a,r as t,aJ as l,h as o,i as n,aG as s,k as i,w as r,o as u,a as v,l as c,c as f,G as h,u as d,t as g,q as m,v as p,b as w}from"./index-DtMP2P0p.js";import{u as P}from"./useZone-D0XVk2oQ.js";import{N as y}from"./netregexes-DsAXea56.js";import{a as T,r as b,c as x}from"./overlay_plugin_api-DHbPkDtN.js";import{E as k}from"./index-CxAUf4Me.js";import{_ as M}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./useDev-CqmIpkr_.js";import"./useDemo-Bad0-cJj.js";import"./index-CdRUoFhI.js";import"./zoneInfo-Kvs06RCG.js";import"./zone_info-C8YMEhdS.js";import"./content_type-uhloenTS.js";import"./regexes-Blkj7yOl.js";import"./index-BtJFMkz-.js";const I={class:"radar-container"},S={class:"radar-wrapper"},j={key:0},_=["disabled","aria-label"],N=["disabled","aria-label"],C={class:"target-header"},D={key:0,class:"target-name"},$={class:"radar-canvas-container"},L=["width","height"],R=M(a({__name:"radar",setup(a){const M=t(""),R=t([]),W=t(0),E=t(""),X=t([]),Y={echo:y.echo({line:"find\\s*(?<target>.+)"})},z=l("canvas");let H=null;const O=t(window.devicePixelRatio||1),A=t(Math.min(window.innerWidth,window.innerHeight)-80),B=o(()=>A.value/2-20),{zoneType:q}=P(),F=t("single"),G="#0f0",J="#060",K="#0f0",Q="#ff0",V="#f00",Z="#fff",U="#fff",ee=18,ae=3,te=2,le=6,oe=o(()=>A.value/2),ne=o(()=>A.value/2);function se(e,a,t){const l=e.PosX-a.PosX,o=e.PosY-a.PosY;let n=oe.value+l/t,s=ne.value+o/t;const i=Math.hypot(n-oe.value,s-ne.value);if(i>B.value){const e=B.value/i;n=oe.value+(n-oe.value)*e,s=ne.value+(s-ne.value)*e}return{px:n,py:s}}async function ie(){const e=await x({call:"getCombatants"});X.value=e.combatants??[]}async function re(){await ie(),function(){if(!M.value)return R.value=[],void(W.value=0);const e=X.value.filter(e=>e.Name&&e.Name.includes(M.value));R.value=e}(),"Pvp"!==q.value&&M.value&&E.value?("*"===M.value?function(){if(F.value="all",!H)throw new Error("canvas context is null");const e=X.value.find(e=>e.Name===E.value),a=X.value.filter(e=>e.Name!==E.value&&e.ID);if(!e)return;H.clearRect(0,0,A.value,A.value),H.strokeStyle=G,H.lineWidth=1,H.beginPath(),H.arc(oe.value,ne.value,B.value,0,2*Math.PI),H.stroke(),H.strokeStyle=J,H.beginPath(),H.moveTo(oe.value-B.value,ne.value),H.lineTo(oe.value+B.value,ne.value),H.moveTo(oe.value,ne.value-B.value),H.lineTo(oe.value,ne.value+B.value),H.stroke();const t=new Map;for(const i of a)t.set(i.ID.toString(),se(i,e,1));for(const i of a){const e=t.get(i.ID.toString());e&&(H.strokeStyle=V,H.lineWidth=te,H.beginPath(),H.moveTo(oe.value,ne.value),H.lineTo(e.px,e.py),H.stroke())}for(const i of a){const e=t.get(i.ID.toString());e&&(H.fillStyle=Q,H.beginPath(),H.arc(e.px,e.py,ae,0,2*Math.PI),H.fill())}for(const i of a){const e=t.get(i.ID.toString());if(!e)continue;const a=i.Name??"",l=H.measureText(a).width;H.shadowColor="black",H.shadowBlur=1,H.shadowOffsetX=1,H.shadowOffsetY=1,H.fillStyle=U,H.font="8px Arial",H.fillText(a,e.px-l/2,e.py-ae-3),H.shadowColor="transparent",H.shadowBlur=0,H.shadowOffsetX=0,H.shadowOffsetY=0}const l=-(e.Heading??0)+Math.PI;H.save(),H.translate(oe.value,ne.value),H.rotate(l),H.fillStyle=K;const o=ee,n=o/3,s=-.2*o;H.beginPath(),H.moveTo(0,-o/2+s),H.lineTo(-n,o/2+s),H.lineTo(n,o/2+s),H.closePath(),H.fill(),H.restore()}():function(){if(F.value="single",!H)throw new Error("canvas context is null");const e=R.value[W.value],a=X.value.find(e=>e.Name===E.value);if(!e)return void H.clearRect(0,0,A.value,A.value);if(!a)return;H.clearRect(0,0,A.value,A.value),H.strokeStyle=G,H.lineWidth=1,H.beginPath(),H.arc(oe.value,ne.value,B.value,0,2*Math.PI),H.stroke(),H.strokeStyle=J,H.beginPath(),H.moveTo(oe.value-B.value,ne.value),H.lineTo(oe.value+B.value,ne.value),H.moveTo(oe.value,ne.value-B.value),H.lineTo(oe.value,ne.value+B.value),H.stroke();const t=e.PosX-a.PosX,l=e.PosY-a.PosY,o=Math.sqrt(t*t+l*l);let n=oe.value+t/.5,s=ne.value+l/.5;const i=Math.hypot(n-oe.value,s-ne.value);if(i>B.value){const e=B.value/i;n=oe.value+(n-oe.value)*e,s=ne.value+(s-ne.value)*e}H.strokeStyle=V,H.lineWidth=te,H.beginPath(),H.moveTo(oe.value,ne.value),H.lineTo(n,s),H.stroke(),H.fillStyle=Q,H.beginPath(),H.arc(n,s,ae,0,2*Math.PI),H.fill();const r=-(a.Heading??0)+Math.PI;H.save(),H.translate(oe.value,ne.value),H.rotate(r),H.fillStyle=K;const u=ee,v=u/3,c=-.2*u;H.beginPath(),H.moveTo(0,-u/2+c),H.lineTo(-v,u/2+c),H.lineTo(v,u/2+c),H.closePath(),H.fill(),H.restore();const f=Math.atan2(s-ne.value,n-oe.value);H.fillStyle=V,H.beginPath(),H.moveTo(n,s),H.lineTo(n-le*Math.cos(f-Math.PI/6),s-le*Math.sin(f-Math.PI/6)),H.lineTo(n-le*Math.cos(f+Math.PI/6),s-le*Math.sin(f+Math.PI/6)),H.closePath(),H.fill(),H.fillStyle=Z,H.font="10px Arial",H.fillText(`${o.toFixed(1)}y`,n+5,s-5)}(),setTimeout(re,100)):M.value=""}const ue=e=>{if("00"===e.line[0]){const a=Y.echo.exec(e.rawLine);a?.groups?.target&&(M.value=a.groups.target,W.value=0,ie().then(()=>{re()}))}},ve=e=>{E.value=e.charName};function ce(){A.value=Math.min(window.innerWidth,window.innerHeight)-80,O.value=window.devicePixelRatio||1,H&&(H.setTransform(1,0,0,1,0,0),H.scale(O.value,O.value))}return n(()=>{H=z.value?.getContext("2d")??null,H&&H.scale(O.value,O.value),T("LogLine",ue),T("ChangePrimaryPlayer",ve),window.addEventListener("resize",ce)}),s(()=>{b("LogLine",ue),b("ChangePrimaryPlayer",ve),window.removeEventListener("resize",ce)}),(a,t)=>{const l=k,o=e;return u(),i(o,null,{readme:r(()=>[w(l,{class:"el-alert-info",type:"info",closable:!1,"show-icon":"",title:a.$t("radar.radarTitle"),description:a.$t("radar.radarDesc")},null,8,["title","description"])]),default:r(()=>[v("div",I,[c(v("div",S,[d(R).length>1?(u(),f("div",j,[v("button",{class:"nav-arrow left-arrow",disabled:d(R).length<=1,"aria-label":a.$t("radar.prevTarget"),onClick:t[0]||(t[0]=e=>W.value=(d(W)-1+d(R).length)%d(R).length)}," ← ",8,_),v("span",null," （"+g(d(W)+1)+" / "+g(d(R).length)+"） ",1),v("button",{class:"nav-arrow right-arrow",disabled:d(R).length<=1,"aria-label":a.$t("radar.nextTarget"),onClick:t[1]||(t[1]=e=>W.value=(d(W)+1)%d(R).length)}," → ",8,N)])):h("",!0),v("div",C,["single"===d(F)?(u(),f("span",D,g(d(R)[d(W)]?.Name??a.$t("radar.targetNotFound",{targetName:d(M)})),1)):h("",!0),v("button",{class:"cancel-btn",onClick:t[2]||(t[2]=()=>{M.value="",R.value=[]})},g(a.$t("radar.cancelBtn")),1)]),v("div",$,[v("canvas",{ref_key:"canvas",ref:z,class:"radar-canvas",width:d(A)*d(O),height:d(A)*d(O),style:m({width:`${d(A)}px`,height:`${d(A)}px`})},null,12,L)])],512),[[p,d(M)]])])]),_:1})}}}),[["__scopeId","data-v-0a260a2f"]]);export{R as default};
