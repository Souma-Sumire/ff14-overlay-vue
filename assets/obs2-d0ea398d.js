import"./index-8b55d222.js";/* empty css                        *//* empty css                   *//* empty css                  *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                *//* empty css                  *//* empty css                */import{ay as e,w as t,f as a,v as n,x as o,A as l,M as s,E as r,L as c,a9 as i,u,D as d,h as p,t as m,r as h,P as f,H as w,K as g,J as b,V as v}from"./vue-vendor-db4de8ea.js";import{u as y,c as C}from"./index-de57c9c1.js";import{_}from"./_plugin-vue_export-helper-6a8c15be.js";import{n as V,m as S,J as P,F as R,e as D,h as T,T as U,U as E,V as j,W as x,r as k,y as O,z as L,d as N,f as A}from"./element-plus-2ee4efb4.js";import{j as B}from"./obs-60b16d86.js";import{z}from"./zoneInfo-3e3130ac.js";import{d as F}from"./content_type-e6dd7239.js";import{l as G}from"./regexes-da03e94d.js";import{N as I,c as Q}from"./netregexes-ed180b06.js";import{a as W,r as q,c as M}from"./overlay_plugin_api-974cdd44.js";import"./zone_info-d5dde6c2.js";const H={class:"language-switcher"},Y={class:"select-wrapper"},Z=_({__name:"LanguageSwitcher",setup(m){const{locale:h,availableLocales:f}=e(),w={zhCn:"简体中文",en:"English",ja:"日本語"},g=y("user-locale",h.value);return t(g,e=>{h.value=e}),a(()=>{h.value=g.value}),(e,t)=>{const a=V,m=S;return o(),n("div",H,[l("div",Y,[t[1]||(t[1]=l("svg",{class:"globe-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[l("circle",{cx:"12",cy:"12",r:"10"}),l("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),l("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})],-1)),s(m,{modelValue:u(g),"onUpdate:modelValue":t[0]||(t[0]=e=>p(g)?g.value=e:null),size:"small",class:"language-select"},{default:r(()=>[(o(!0),n(c,null,i(u(f),(e,t)=>(o(),d(a,{key:t,value:e,label:w[e]},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-66d37cfa"]]),J={class:"obs-container"},K={class:"card-header"},$={class:"act-not-ready-content"},X={key:1},ee={class:"card-header"},te={key:1},ae={class:"card-header"},ne={class:"status-info"},oe={class:"button-container"},le={class:"card-header"},se={class:"profile-info"},re={class:"file-path-explanation"},ce={class:"file-name-explanation"},ie={class:"card-header"},ue=_(m({__name:"obs2",setup(t){const{t:c}=e(),i=y("obs-user-config",{host:4455,password:"",path:"",fileName:""},localStorage,{writeDefaults:!0}),p=y("obs-user-content-setting",[]),m=y("obs-is-first-time",!0),_=h(!1),V="1"===C("hash").dev,S=h({zone:{},partyLength:1});function H(){return V?Promise.resolve():new Promise(e=>{M({call:"cactbotRequestState"}).then(()=>{_.value=!0,e()}),setTimeout(()=>{_.value||H()},3e3)})}const Y={inCombat:I.inCombat(),countdown:I.countdown(),countdownCancel:I.countdownCancel(),wipe:Q.wipe},ue=["Savage","Extreme","Chaotic","Ultimate","OccultCrescent","Dungeons","Raids","Trials","VCDungeonFinder","DeepDungeons","Guildhests","DisciplesOfTheLand","Eureka","SocietyQuests","GrandCompany","QuestBattles","TreasureHunt","Pvp","Default"],de={enter:!1,countdown:!0,countdownCancel:!0,combatStart:!0,combatEnd:!0,wipe:!0,partyLength:4},pe={enter:!1,countdown:!1,countdownCancel:!1,combatStart:!1,combatEnd:!1,wipe:!1,partyLength:1};const me=new class{ws;status;handleConnectionError=()=>{we("OBS connection error"),this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath=""};handleConnectionClosed=()=>{we("OBS connection closed"),this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath=""};handleRecordStateChanged=e=>{this.status.connected=!0,this.status.recording="OBS_WEBSOCKET_OUTPUT_STARTED"===e.outputState,this.status.outputActive=e.outputActive,this.status.outputPath=e.outputPath||""};constructor(){this.ws=new B,this.status=v({connecting:!1,connected:!1,recording:!1,outputActive:!1,outputPath:""}),this.ws.on("ConnectionClosed",this.handleConnectionClosed),this.ws.on("ConnectionError",this.handleConnectionError),this.ws.on("RecordStateChanged",this.handleRecordStateChanged)}connect(e){we("Attempting to connect to OBS"),i.value.host&&i.value.password&&(this.status.connecting||(this.status.connecting=!0,this.ws.connect(`ws://127.0.0.1:${i.value.host}`,i.value.password).then(()=>{this.ws.call("GetRecordStatus").then(e=>{this.status.recording=e.outputActive,this.status.outputActive=e.outputActive}),this.status.connected=!0,e&&e()}).finally(()=>{this.status.connecting=!1,!i.value.path&&this.status.connected&&this.ws.call("GetRecordDirectory").then(e=>{e.recordDirectory&&(i.value.path=e.recordDirectory)}),i.value.fileName||(i.value.fileName="%CCYY-%MM-%DD %hh-%mm-%ss")})))}disconnect(){we("Disconnecting from OBS"),this.ws.disconnect()}async startRecord(){we("Starting recording"),await this.setProfileParameter(),this.ws.call("StartRecord")}stopRecord(){we("Stopping recording"),this.ws.call("StopRecord")}splitRecord(){we("Splitting recording"),this.ws.call("StopRecord").finally(()=>{setTimeout(()=>{this.ws.call("StartRecord")},1e3)})}async setProfileParameter(){const e=i.value.path,t=i.value.fileName,a=[];return a.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"AdvOut",parameterName:"RecFilePath",parameterValue:e}}),a.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"Output",parameterName:"FilenameFormatting",parameterValue:t}}),i.value.path=e,i.value.fileName=t,this.ws.callBatch(a)}},he=e=>{we("Zone changed:",e);const t=e.zoneID,a=z[t];void 0!==a&&(S.value.zone=a,ge("enter"))},fe=e=>{const t=e.rawLine;for(const a in Y){if(Y[a].exec(t)){const e=t.split("|");switch(a){case"inCombat":{const t="1"===e[G.InCombat.fields.inACTCombat],a="1"===e[G.InCombat.fields.inGameCombat];if(t&&a)return void ge("combatStart");if(!t&&!a)return void ge("combatEnd");break}case"countdown":ge("countdown");break;case"countdownCancel":ge("countdownCancel");break;case"wipe":ge("wipe")}}}};function we(...e){}function ge(e){const t=function(e){const t=e.contentType,a=e.name?.fr,n=e.name?.en;switch(t){case F.ChaoticAllianceRaid:return"Chaotic";case F.UltimateRaids:return"Ultimate";case F.Pvp:return"Pvp";case F.Dungeons:return"Dungeons";case F.DeepDungeons:return"DeepDungeons";case F.VCDungeonFinder:return"VCDungeonFinder";case F.Trials:return a?.includes("(extrême)")?"Extreme":"Trials";case F.Raids:return n?.includes("(Savage)")?"Savage":"Raids";case F.DisciplesOfTheLand:return"DisciplesOfTheLand";case F.Eureka:return"Eureka";case F.GrandCompany:return"GrandCompany";case F.QuestBattles:return"QuestBattles";case F.TreasureHunt:return"TreasureHunt";case F.SocietyQuests:return"SocietyQuests";case F.OccultCrescent:return"OccultCrescent";default:return"Default"}}(S.value.zone),a=p.value.find(e=>e.type===t);if(a&&a[e])if(!1===a.enter&&"enter"===e&&me.status.recording)me.stopRecord();else switch(e){case"enter":case"countdown":case"combatStart":if(S.value.partyLength<a.partyLength)return;return me.status.connected?!1===me.status.recording?void me.startRecord():void(!0===me.status.recording&&"combatStart"!==e&&me.splitRecord()):void me.connect(()=>{me.startRecord()});case"countdownCancel":case"combatEnd":case"wipe":me.status.recording&&me.stopRecord()}}const be=e=>{S.value.partyLength=e.party.map(e=>e.inParty)?.length||1};return a(async()=>{await H(),me.connect(),W("ChangeZone",he),W("LogLine",fe),W("PartyChanged",be),function(){const e=["Savage","Extreme","Ultimate","Chaotic","OccultCrescent","Default"];if(m.value)m.value=!1,p.value=[...e.map(e=>({type:e,...de})),...ue.filter(t=>!e.includes(t)).map(e=>({type:e,...pe}))];else{p.value=p.value.filter(e=>ue.includes(e.type));const t=ue.filter(e=>!p.value.some(t=>t.type===e)&&"Default"!==e).map(t=>e.includes(t)?{type:t,...de}:{type:t,...pe});p.value.push(...t)}p.value.sort((e,t)=>ue.indexOf(e.type)-ue.indexOf(t.type)),p.value=p.value.map(t=>({...e.includes(t.type)?de:pe,...t}))}()}),f(()=>{me.disconnect(),q("ChangeZone",he),q("LogLine",fe)}),(e,t)=>{const a=Z,m=k,h=D,f=R,v=T,y=P,C=U,S=E,B=x,z=j,F=L,G=N,I=A,Q=O;return o(),n("div",J,[l("header",null,[l("h1",null,g(u(c)("OBS Auto Record V2")),1),s(a)]),!u(_)||V?(o(),d(m,{key:0,class:"act-not-ready-card"},{header:r(()=>[l("div",K,[l("span",null,g(u(c)("ACT Not Ready")),1)])]),default:r(()=>[l("div",$,[l("p",null,g(u(c)("overlayTutorial")),1)])]),_:1})):w("",!0),u(_)||V?(o(),n("main",X,[u(me).status.connected||V?(o(),n("div",te,[s(S,{class:"instruction-alert",type:"info",description:u(c)("hideTutorial"),closable:!1,"show-icon":""},null,8,["description"]),V?(o(),d(m,{key:0,class:"status-card"},{header:r(()=>[l("div",ae,[l("span",null,g(u(c)("Connection Status")),1),s(v,{type:"danger",size:"small",class:"disconnect-button",onClick:t[3]||(t[3]=e=>u(me).disconnect())},{default:r(()=>[b(g(u(c)("Disconnect")),1)]),_:1})])]),default:r(()=>[l("div",ne,[s(z,{direction:"vertical",column:1,border:""},{default:r(()=>[s(B,{label:u(c)("Recording")},{default:r(()=>[b(g(u(me).status.recording?u(c)("Yes"):u(c)("No")),1)]),_:1},8,["label"]),s(B,{label:u(c)("Output Path")},{default:r(()=>[b(g(u(me).status.outputPath||u(c)("None")),1)]),_:1},8,["label"])]),_:1})]),l("div",oe,[s(v,{disabled:!u(me).status.connected||u(me).status.recording,type:"primary",onClick:t[4]||(t[4]=e=>u(me).startRecord())},{default:r(()=>[b(g(u(c)("Start Record")),1)]),_:1},8,["disabled"]),s(v,{disabled:!u(me).status.connected||!u(me).status.recording,type:"danger",onClick:t[5]||(t[5]=e=>u(me).stopRecord())},{default:r(()=>[b(g(u(c)("Stop Record")),1)]),_:1},8,["disabled"]),s(v,{disabled:!u(me).status.connected||!u(me).status.recording,type:"warning",onClick:t[6]||(t[6]=e=>u(me).splitRecord())},{default:r(()=>[b(g(u(c)("Split Record")),1)]),_:1},8,["disabled"]),s(v,{type:"primary",onClick:t[7]||(t[7]=e=>u(me).setProfileParameter())},{default:r(()=>[b(g(u(c)("Set Recording Name")),1)]),_:1})])]),_:1})):w("",!0),s(m,{class:"profile-card"},{header:r(()=>[l("div",le,[l("span",null,g(u(c)("Recording Profile")),1)])]),default:r(()=>[l("div",se,[s(y,{"label-position":"top",class:"content-form"},{default:r(()=>[s(f,{label:u(c)("Record Path")},{default:r(()=>[s(h,{modelValue:u(i).path,"onUpdate:modelValue":t[8]||(t[8]=e=>u(i).path=e),placeholder:u(c)("recordPathPlaceholder")},null,8,["modelValue","placeholder"]),l("div",re,g(u(c)("filePathExplanation")),1)]),_:1},8,["label"]),s(f,{label:u(c)("Record File Name")},{default:r(()=>[s(h,{modelValue:u(i).fileName,"onUpdate:modelValue":t[9]||(t[9]=e=>u(i).fileName=e),placeholder:u(c)("recordFileNamePlaceholder")},null,8,["modelValue","placeholder"]),l("div",ce,g(u(c)("fileNameExplanation")),1)]),_:1},8,["label"])]),_:1})])]),_:1}),s(m,{class:"table-card"},{header:r(()=>[l("div",ie,[l("span",null,g(u(c)("User Content Settings")),1)])]),default:r(()=>[s(Q,{data:u(p),style:{width:"100%"},border:!0,stripe:""},{default:r(()=>[s(F,{prop:"type",label:u(c)("Type"),"min-width":"120",fixed:""},{default:r(e=>[l("span",null,g(u(c)(e.row.type)),1)]),_:1},8,["label"]),s(F,{label:u(c)("Start When"),align:"center"},{default:r(()=>[s(F,{label:u(c)("When Party"),align:"center","min-width":"110"},{default:r(e=>[s(G,{modelValue:e.row.partyLength,"onUpdate:modelValue":t=>e.row.partyLength=t,min:1,max:8,style:{width:"85px"},size:"small",class:"party-length-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),s(F,{prop:"enter",label:u(c)("Enter Zone"),align:"center","min-width":"95"},{default:r(e=>[s(I,{modelValue:e.row.enter,"onUpdate:modelValue":t=>e.row.enter=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),s(F,{prop:"countdown",label:u(c)("CountDown"),align:"center","min-width":"95"},{default:r(e=>[s(I,{modelValue:e.row.countdown,"onUpdate:modelValue":t=>e.row.countdown=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),s(F,{prop:"combatStart",label:u(c)("CombatStart"),align:"center","min-width":"95"},{default:r(e=>[s(I,{modelValue:e.row.combatStart,"onUpdate:modelValue":t=>e.row.combatStart=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),s(F,{label:u(c)("End When"),align:"center"},{default:r(()=>[s(F,{prop:"combatEnd",label:u(c)("CombatEnd"),align:"center","min-width":"95"},{default:r(e=>[s(I,{modelValue:e.row.combatEnd,"onUpdate:modelValue":t=>e.row.combatEnd=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),s(F,{prop:"wipe",label:u(c)("Wipe"),align:"center","min-width":"95"},{default:r(e=>[s(I,{modelValue:e.row.wipe,"onUpdate:modelValue":t=>e.row.wipe=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),s(F,{prop:"countdown",label:u(c)("CountDownCancel"),align:"center","min-width":"95"},{default:r(e=>[s(I,{modelValue:e.row.countdownCancel,"onUpdate:modelValue":t=>e.row.countdownCancel=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})])):(o(),d(m,{key:0,class:"connection-card"},{header:r(()=>[l("div",ee,[l("span",null,g(u(c)("Connect to OBS")),1)])]),default:r(()=>[s(y,{"label-position":"top",class:"connection-form"},{default:r(()=>[s(f,{label:u(c)("Port")},{default:r(()=>[s(h,{modelValue:u(i).host,"onUpdate:modelValue":t[0]||(t[0]=e=>u(i).host=e),placeholder:u(c)("portPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(f,{label:u(c)("Password")},{default:r(()=>[s(h,{modelValue:u(i).password,"onUpdate:modelValue":t[1]||(t[1]=e=>u(i).password=e),placeholder:u(c)("passwordPlaceholder"),type:"password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(f,null,{default:r(()=>[s(v,{type:"primary",class:"connect-button",loading:u(me).status.connecting,disabled:u(me).status.connecting||!u(i).host,onClick:t[2]||(t[2]=e=>u(me).connect())},{default:r(()=>[b(g(u(me).status.connecting?u(c)("Connecting"):u(c)("Connect")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),s(C,null,{default:r(()=>[b(g(u(c)("Instructions")),1)]),_:1}),s(S,{class:"instruction-alert",type:"info",description:u(c)("obsTutorial"),closable:!1,"show-icon":""},null,8,["description"]),s(S,{class:"instruction-alert",type:"info",description:u(c)("inputTutorial"),closable:!1,"show-icon":""},null,8,["description"]),s(S,{class:"instruction-alert",type:"info",description:u(c)("firewallTutorial"),closable:!1,"show-icon":""},null,8,["description"])]),_:1}))])):w("",!0)])}}}),[["__scopeId","data-v-929a43fb"]]);export{ue as default};
