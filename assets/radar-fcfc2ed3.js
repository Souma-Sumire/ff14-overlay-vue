import{_ as e}from"./ActWrapper-3efebdce.js";import"./index-e58fcfa0.js";/* empty css                 */import{t as a,r as l,aC as t,c as o,e as n,P as s,D as i,E as r,x as u,A as v,F as c,v as f,H as h,u as d,K as m,S as p,O as g,M as w}from"./vue-vendor-37eb8ba2.js";import{u as P}from"./useZone-36964c38.js";import{N as y}from"./netregexes-ed180b06.js";import{a as T,r as b,c as x}from"./overlay_plugin_api-974cdd44.js";import{X as M}from"./element-plus-3b00acc6.js";import{_ as k}from"./_plugin-vue_export-helper-6a8c15be.js";/* empty css                */import"./useDev-c4e9ec84.js";import"./index-78df6055.js";import"./useDemo-b712055f.js";import"./zoneInfo-40d5d60a.js";import"./zone_info-e69ac441.js";import"./content_type-e6dd7239.js";import"./regexes-da03e94d.js";const I={class:"radar-container"},S={class:"radar-wrapper"},j={key:0},_=["disabled"],C=["disabled"],N={class:"target-header"},D={key:0,class:"target-name"},L={class:"radar-canvas-container"},W=["width","height"],X=k(a({__name:"radar",setup(a){const k=l(""),X=l([]),H=l(0),O=l(""),R=l([]),Y={echo:y.echo({line:"find\\s*(?<target>.+)"})},z=t("canvas");let E=null;const A=l(window.devicePixelRatio||1),$=l(Math.min(window.innerWidth,window.innerHeight)-80),B=o(()=>$.value/2-20),{zoneType:F}=P(),K=l("single"),q="#0f0",J="#060",Z="#0f0",G="#ff0",Q="#f00",U="#fff",V="#fff",ee=18,ae=3,le=2,te=6,oe=o(()=>$.value/2),ne=o(()=>$.value/2);function se(e,a,l){const t=e.PosX-a.PosX,o=e.PosY-a.PosY;let n=oe.value+t/l,s=ne.value+o/l;const i=Math.hypot(n-oe.value,s-ne.value);if(i>B.value){const e=B.value/i;n=oe.value+(n-oe.value)*e,s=ne.value+(s-ne.value)*e}return{px:n,py:s}}async function ie(){const e=await x({call:"getCombatants"});R.value=e.combatants??[]}async function re(){await ie(),"Pvp"!==F.value&&k.value&&O.value?("*"===k.value?function(){if(K.value="all",!E)throw new Error("canvas context is null");const e=R.value.find(e=>e.Name===O.value),a=R.value.filter(e=>e.Name!==O.value&&e.ID);if(!e)return;E.clearRect(0,0,$.value,$.value),E.strokeStyle=q,E.lineWidth=1,E.beginPath(),E.arc(oe.value,ne.value,B.value,0,2*Math.PI),E.stroke(),E.strokeStyle=J,E.beginPath(),E.moveTo(oe.value-B.value,ne.value),E.lineTo(oe.value+B.value,ne.value),E.moveTo(oe.value,ne.value-B.value),E.lineTo(oe.value,ne.value+B.value),E.stroke();const l=new Map;for(const i of a)l.set(i.ID.toString(),se(i,e,1));for(const i of a){const e=l.get(i.ID.toString());e&&(E.strokeStyle=Q,E.lineWidth=le,E.beginPath(),E.moveTo(oe.value,ne.value),E.lineTo(e.px,e.py),E.stroke())}for(const i of a){const e=l.get(i.ID.toString());e&&(E.fillStyle=G,E.beginPath(),E.arc(e.px,e.py,ae,0,2*Math.PI),E.fill())}for(const i of a){const e=l.get(i.ID.toString());if(!e)continue;const a=i.Name??"",t=E.measureText(a).width;E.shadowColor="black",E.shadowBlur=1,E.shadowOffsetX=1,E.shadowOffsetY=1,E.fillStyle=V,E.font="8px Arial",E.fillText(a,e.px-t/2,e.py-ae-3),E.shadowColor="transparent",E.shadowBlur=0,E.shadowOffsetX=0,E.shadowOffsetY=0}const t=-(e.Heading??0)+Math.PI;E.save(),E.translate(oe.value,ne.value),E.rotate(t),E.fillStyle=Z;const o=ee,n=o/3,s=-.2*o;E.beginPath(),E.moveTo(0,-o/2+s),E.lineTo(-n,o/2+s),E.lineTo(n,o/2+s),E.closePath(),E.fill(),E.restore()}():function(){if(K.value="single",!E)throw new Error("canvas context is null");const e=X.value[H.value],a=R.value.find(e=>e.Name===O.value);if(!e)return void E.clearRect(0,0,$.value,$.value);if(!a)return;E.clearRect(0,0,$.value,$.value),E.strokeStyle=q,E.lineWidth=1,E.beginPath(),E.arc(oe.value,ne.value,B.value,0,2*Math.PI),E.stroke(),E.strokeStyle=J,E.beginPath(),E.moveTo(oe.value-B.value,ne.value),E.lineTo(oe.value+B.value,ne.value),E.moveTo(oe.value,ne.value-B.value),E.lineTo(oe.value,ne.value+B.value),E.stroke();const l=e.PosX-a.PosX,t=e.PosY-a.PosY,o=Math.sqrt(l*l+t*t);let n=oe.value+l/.5,s=ne.value+t/.5;const i=Math.hypot(n-oe.value,s-ne.value);if(i>B.value){const e=B.value/i;n=oe.value+(n-oe.value)*e,s=ne.value+(s-ne.value)*e}E.strokeStyle=Q,E.lineWidth=le,E.beginPath(),E.moveTo(oe.value,ne.value),E.lineTo(n,s),E.stroke(),E.fillStyle=G,E.beginPath(),E.arc(n,s,ae,0,2*Math.PI),E.fill();const r=-(a.Heading??0)+Math.PI;E.save(),E.translate(oe.value,ne.value),E.rotate(r),E.fillStyle=Z;const u=ee,v=u/3,c=-.2*u;E.beginPath(),E.moveTo(0,-u/2+c),E.lineTo(-v,u/2+c),E.lineTo(v,u/2+c),E.closePath(),E.fill(),E.restore();const f=Math.atan2(s-ne.value,n-oe.value);E.fillStyle=Q,E.beginPath(),E.moveTo(n,s),E.lineTo(n-te*Math.cos(f-Math.PI/6),s-te*Math.sin(f-Math.PI/6)),E.lineTo(n-te*Math.cos(f+Math.PI/6),s-te*Math.sin(f+Math.PI/6)),E.closePath(),E.fill(),E.fillStyle=U,E.font="10px Arial",E.fillText(`${o.toFixed(1)}y`,n+5,s-5)}(),setTimeout(re,100)):k.value=""}const ue=e=>{if("00"===e.line[0]){const a=Y.echo.exec(e.rawLine);a?.groups?.target&&(k.value=a.groups.target,ie().then(()=>{!function(){if(!k.value)return X.value=[],void(H.value=0);const e=R.value.filter(e=>e.Name&&e.Name.includes(k.value));X.value=e,H.value=0}(),re()}))}},ve=e=>{O.value=e.charName};function ce(){$.value=Math.min(window.innerWidth,window.innerHeight)-80,A.value=window.devicePixelRatio||1,E&&(E.setTransform(1,0,0,1,0,0),E.scale(A.value,A.value))}return n(()=>{E=z.value?.getContext("2d")??null,E&&E.scale(A.value,A.value),T("LogLine",ue),T("ChangePrimaryPlayer",ve),window.addEventListener("resize",ce)}),s(()=>{b("LogLine",ue),b("ChangePrimaryPlayer",ve),window.removeEventListener("resize",ce)}),(a,l)=>{const t=M,o=e;return u(),i(o,null,{readme:r(()=>[w(t,{class:"el-alert-info",type:"info",closable:!1,"show-icon":"",title:"宏命令：/e find 目标名称",description:"名称允许部分匹配。若输入*可查看所有目标"})]),default:r(()=>[v("div",I,[c(v("div",S,[d(X).length>1?(u(),f("div",j,[v("button",{class:"nav-arrow left-arrow",disabled:d(X).length<=1,"aria-label":"上一目标",onClick:l[0]||(l[0]=e=>H.value=(d(H)-1+d(X).length)%d(X).length)}," ← ",8,_),v("span",null," （"+m(d(H)+1)+" / "+m(d(X).length)+"） ",1),v("button",{class:"nav-arrow right-arrow",disabled:d(X).length<=1,"aria-label":"下一目标",onClick:l[1]||(l[1]=e=>H.value=(d(H)+1)%d(X).length)}," → ",8,C)])):h("",!0),v("div",N,["single"===d(K)?(u(),f("span",D,m(d(X)[d(H)]?.Name??`【未找到${d(k)}】`),1)):h("",!0),v("button",{class:"cancel-btn",onClick:l[2]||(l[2]=e=>{k.value="",X.value=[]})}," 取消 ")]),v("div",L,[v("canvas",{ref_key:"canvas",ref:z,class:"radar-canvas",width:d($)*d(A),height:d($)*d(A),style:p({width:`${d($)}px`,height:`${d($)}px`})},null,12,W)])],512),[[g,d(k)]])])]),_:1})}}}),[["__scopeId","data-v-98e25c02"]]);export{X as default};
