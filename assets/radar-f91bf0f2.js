import{_ as e}from"./ActWrapper-7eddf63d.js";import"./index-6d6f2995.js";/* empty css                 */import{t as a,r as t,aB as l,c as n,e as o,P as i,D as s,E as r,x as u,A as v,H as c,F as d,u as h,v as f,K as m,S as p,O as g}from"./vue-vendor-d1e06839.js";import{u as w}from"./useZone-e5c8d379.js";import{N as y}from"./netregexes-ed180b06.js";import{a as P,r as b,c as x}from"./overlay_plugin_api-974cdd44.js";import{W as M}from"./element-plus-e8d3f599.js";import{_ as j}from"./_plugin-vue_export-helper-6a8c15be.js";/* empty css                */import"./useDevMode-49806891.js";import"./index-2ddc6e0c.js";import"./zoneInfo-40d5d60a.js";import"./zone_info-e69ac441.js";import"./content_type-e6dd7239.js";import"./regexes-da03e94d.js";const T={class:"radar-container"},k={class:"radar-wrapper"},_=["disabled"],I=["disabled"],L={class:"target-header"},S={class:"target-name"},E={class:"radar-canvas-container"},C=["width","height"],N=j(a({__name:"radar",setup(a){const j=t(""),N=t([]),W=t(0),z=t(""),H=t([]),R={echo:y.echo({line:"find\\s*(?<target>.+)"})},A=l("canvas");let F=null;const O=t(window.devicePixelRatio||1),Y=t(Math.min(window.innerWidth,window.innerHeight)-80),$=n(()=>Y.value/2-20),B=t("flex"===document.getElementById("unlocked")?.style?.display),{zoneType:D}=w(),K="#0f0",U="#060",X="#0f0",q="#ff0",G="#f00",Z="#fff",J=18,Q=3,V=2,ee=6,ae="10px Arial",te=n(()=>Y.value/2),le=n(()=>Y.value/2);async function ne(){const e=await x({call:"getCombatants"});H.value=e.combatants??[]}async function oe(){await ne(),"Pvp"!==D.value&&j.value&&z.value?(!function(){if(!F)throw new Error("canvas context is null");const e=N.value[W.value],a=H.value.find(e=>e.Name===z.value);if(!e)return void F.clearRect(0,0,Y.value,Y.value);if(!a)return;F.clearRect(0,0,Y.value,Y.value),F.strokeStyle=K,F.lineWidth=1,F.beginPath(),F.arc(te.value,le.value,$.value,0,2*Math.PI),F.stroke(),F.strokeStyle=U,F.beginPath(),F.moveTo(te.value-$.value,le.value),F.lineTo(te.value+$.value,le.value),F.moveTo(te.value,le.value-$.value),F.lineTo(te.value,le.value+$.value),F.stroke();const t=e.PosX-a.PosX,l=e.PosY-a.PosY,n=Math.sqrt(t*t+l*l);let o=te.value+t/.1,i=le.value+l/.1;const s=Math.hypot(o-te.value,i-le.value);if(s>$.value){const e=$.value/s;o=te.value+(o-te.value)*e,i=le.value+(i-le.value)*e}F.strokeStyle=G,F.lineWidth=V,F.beginPath(),F.moveTo(te.value,le.value),F.lineTo(o,i),F.stroke(),F.fillStyle=q,F.beginPath(),F.arc(o,i,Q,0,2*Math.PI),F.fill();const r=-(a.Heading??0)+Math.PI;F.save(),F.translate(te.value,le.value),F.rotate(r),F.fillStyle=X;const u=J,v=u/3,c=-.2*u;F.beginPath(),F.moveTo(0,-u/2+c),F.lineTo(-v,u/2+c),F.lineTo(v,u/2+c),F.closePath(),F.fill(),F.restore();const d=Math.atan2(i-le.value,o-te.value);F.fillStyle=G,F.beginPath(),F.moveTo(o,i),F.lineTo(o-ee*Math.cos(d-Math.PI/6),i-ee*Math.sin(d-Math.PI/6)),F.lineTo(o-ee*Math.cos(d+Math.PI/6),i-ee*Math.sin(d+Math.PI/6)),F.closePath(),F.fill(),F.fillStyle=Z,F.font=ae,F.fillText(`${n.toFixed(1)}y`,o+5,i-5)}(),setTimeout(oe,100)):j.value=""}const ie=e=>{if("00"===e.line[0]){const a=R.echo.exec(e.rawLine);a?.groups?.target&&(j.value=a.groups.target,ne().then(()=>{!function(){if(!j.value)return N.value=[],void(W.value=0);const e=H.value.filter(e=>e.Name&&e.Name.includes(j.value));N.value=e,W.value=0}(),oe()}))}},se=e=>{z.value=e.charName};function re(){Y.value=Math.min(window.innerWidth,window.innerHeight)-80,O.value=window.devicePixelRatio||1,F&&(F.setTransform(1,0,0,1,0,0),F.scale(O.value,O.value))}function ue(e){B.value=!1===e?.detail?.isLocked}return o(()=>{F=A.value?.getContext("2d")??null,F&&F.scale(O.value,O.value),P("LogLine",ie),P("ChangePrimaryPlayer",se),window.addEventListener("resize",re),document.addEventListener("onOverlayStateUpdate",ue)}),i(()=>{b("LogLine",ie),b("ChangePrimaryPlayer",se),window.removeEventListener("resize",re),document.removeEventListener("onOverlayStateUpdate",ue)}),(a,t)=>{const l=M,n=e;return u(),s(n,null,{default:r(()=>[v("div",T,[h(B)?(u(),s(l,{key:0,class:"el-alert-info",type:"info",closable:!1,"show-icon":"",title:"宏命令：/e find 目标名称",description:"名称允许部分匹配"})):c("",!0),d(v("div",k,[h(N).length>1?(u(),f("button",{key:0,class:"nav-arrow left-arrow",disabled:h(N).length<=1,"aria-label":"上一目标",onClick:t[0]||(t[0]=e=>W.value=(h(W)-1+h(N).length)%h(N).length)}," ← ",8,_)):c("",!0),h(N).length>1?(u(),f("button",{key:1,class:"nav-arrow right-arrow",disabled:h(N).length<=1,"aria-label":"下一目标",onClick:t[1]||(t[1]=e=>W.value=(h(W)+1)%h(N).length)}," → ",8,I)):c("",!0),v("div",L,[v("span",S,m(h(N)[h(W)]?.Name??"【未找到目标】"),1),v("button",{class:"cancel-btn",onClick:t[2]||(t[2]=e=>{j.value="",N.value=[]})}," 取消 ")]),v("div",E,[v("canvas",{ref_key:"canvas",ref:A,class:"radar-canvas",width:h(Y)*h(O),height:h(Y)*h(O),style:p({width:`${h(Y)}px`,height:`${h(Y)}px`})},null,12,C)])],512),[[g,h(j)]])])]),_:1})}}}),[["__scopeId","data-v-b62f3967"]]);export{N as default};
