import"./index-7c7e7b78.js";/* empty css                *//* empty css                 */import{t as e,r as a,ay as t,c as l,f as n,P as o,v as i,x as s,D as r,H as u,F as v,u as c,E as d,A as h,O as f,K as m,S as p}from"./vue-vendor-f82d765d.js";import{u as g}from"./useZone-29d7412c.js";import{N as y}from"./netregexes-ed180b06.js";import{a as w,r as P,c as b}from"./overlay_plugin_api-974cdd44.js";import{r as T,b as M,U as k}from"./element-plus-e8032da7.js";import{_ as x}from"./_plugin-vue_export-helper-6a8c15be.js";import"./zoneInfo-40d5d60a.js";import"./zone_info-e69ac441.js";import"./content_type-e6dd7239.js";import"./regexes-da03e94d.js";const _={class:"radar-container"},j={class:"radar-wrapper"},S=["disabled"],I=["disabled"],L={class:"target-header"},C={class:"target-name"},E={class:"radar-canvas-container"},N=["width","height"],z=x(e({__name:"radar",setup(e){const x=a(!1),z=a(""),H=a([]),W=a(0),R=a(""),A=a([]),O={echo:y.echo({line:"find\\s*(?<target>.+)"})},U=t("canvas");let Y=null;const $=a(window.devicePixelRatio||1),q=a(Math.min(window.innerWidth,window.innerHeight)-80),F=l(()=>q.value/2-20),X=a("flex"===document.getElementById("unlocked")?.style?.display),{zoneType:B}=g(),D="#0f0",J="#060",K="#0f0",Z="#ff0",G="#f00",Q="#fff",V=18,ee=3,ae=2,te=6,le="10px Arial",ne=l(()=>q.value/2),oe=l(()=>q.value/2);async function ie(){const e=await b({call:"getCombatants"});A.value=e.combatants??[]}async function se(){await ie(),"Pvp"!==B.value&&z.value&&R.value&&x.value?(!function(){if(!Y)return;const e=H.value[W.value],a=A.value.find(e=>e.Name===R.value);if(!e)return z.value="",void M("找不到目标");if(!a)return;Y.clearRect(0,0,q.value,q.value),Y.strokeStyle=D,Y.lineWidth=1,Y.beginPath(),Y.arc(ne.value,oe.value,F.value,0,2*Math.PI),Y.stroke(),Y.strokeStyle=J,Y.beginPath(),Y.moveTo(ne.value-F.value,oe.value),Y.lineTo(ne.value+F.value,oe.value),Y.moveTo(ne.value,oe.value-F.value),Y.lineTo(ne.value,oe.value+F.value),Y.stroke();const t=e.PosX-a.PosX,l=e.PosY-a.PosY,n=Math.sqrt(t*t+l*l);let o=ne.value+t/.1,i=oe.value+l/.1;const s=Math.hypot(o-ne.value,i-oe.value);if(s>F.value){const e=F.value/s;o=ne.value+(o-ne.value)*e,i=oe.value+(i-oe.value)*e}Y.strokeStyle=G,Y.lineWidth=ae,Y.beginPath(),Y.moveTo(ne.value,oe.value),Y.lineTo(o,i),Y.stroke(),Y.fillStyle=Z,Y.beginPath(),Y.arc(o,i,ee,0,2*Math.PI),Y.fill();const r=-(a.Heading??0)+Math.PI;Y.save(),Y.translate(ne.value,oe.value),Y.rotate(r),Y.fillStyle=K;const u=V,v=u/3,c=-.2*u;Y.beginPath(),Y.moveTo(0,-u/2+c),Y.lineTo(-v,u/2+c),Y.lineTo(v,u/2+c),Y.closePath(),Y.fill(),Y.restore();const d=Math.atan2(i-oe.value,o-ne.value);Y.fillStyle=G,Y.beginPath(),Y.moveTo(o,i),Y.lineTo(o-te*Math.cos(d-Math.PI/6),i-te*Math.sin(d-Math.PI/6)),Y.lineTo(o-te*Math.cos(d+Math.PI/6),i-te*Math.sin(d+Math.PI/6)),Y.closePath(),Y.fill(),Y.fillStyle=Q,Y.font=le,Y.fillText(`${n.toFixed(1)}y`,o+5,i-5)}(),setTimeout(se,100)):z.value=""}function re(){return new Promise(e=>{b({call:"cactbotRequestState"}).then(()=>{x.value=!0,e()}),setTimeout(()=>{x.value||re()},3e3)})}const ue=e=>{if("00"===e.line[0]){const a=O.echo.exec(e.rawLine);a?.groups?.target&&(z.value=a.groups.target,ie().then(()=>{!function(){if(!z.value)return H.value=[],void(W.value=0);const e=A.value.filter(e=>e.Name&&e.Name.includes(z.value));H.value=e,W.value=0}(),se()}))}},ve=e=>{R.value=e.charName};function ce(){q.value=Math.min(window.innerWidth,window.innerHeight)-80,$.value=window.devicePixelRatio||1,Y&&(Y.setTransform(1,0,0,1,0,0),Y.scale($.value,$.value))}function de(e){X.value=!1===e?.detail?.isLocked}return n(()=>{Y=U.value?.getContext("2d")??null,Y&&Y.scale($.value,$.value),re(),w("LogLine",ue),w("ChangePrimaryPlayer",ve),window.addEventListener("resize",ce),document.addEventListener("onOverlayStateUpdate",de)}),o(()=>{P("LogLine",ue),P("ChangePrimaryPlayer",ve),window.removeEventListener("resize",ce),document.removeEventListener("onOverlayStateUpdate",de)}),(e,a)=>{const t=k,l=T;return s(),i("div",_,[c(X)?(s(),r(t,{key:0,class:"el-alert-info",type:"info",closable:!1,"show-icon":"",title:"宏命令：/e find 目标名称",description:"名称允许部分匹配"})):u("",!0),c(x)?u("",!0):(s(),r(l,{key:1,class:"activation-prompt"},{default:d(()=>a[3]||(a[3]=[h("h1",null,"在 ACT 中添加本页面作为数据统计悬浮窗",-1)])),_:1,__:[3]})),v(h("div",j,[c(H).length>1?(s(),i("button",{key:0,class:"nav-arrow left-arrow",disabled:c(H).length<=1,"aria-label":"上一目标",onClick:a[0]||(a[0]=e=>W.value=(c(W)-1+c(H).length)%c(H).length)}," ← ",8,S)):u("",!0),c(H).length>1?(s(),i("button",{key:1,class:"nav-arrow right-arrow",disabled:c(H).length<=1,"aria-label":"下一目标",onClick:a[1]||(a[1]=e=>W.value=(c(W)+1)%c(H).length)}," → ",8,I)):u("",!0),h("div",L,[h("span",C,m(c(H)[c(W)]?.Name??""),1),h("button",{class:"cancel-btn",onClick:a[2]||(a[2]=e=>{z.value="",H.value=[]})}," 取消 ")]),h("div",E,[h("canvas",{ref_key:"canvas",ref:U,class:"radar-canvas",width:c(q)*c($),height:c(q)*c($),style:p({width:`${c(q)}px`,height:`${c(q)}px`})},null,12,N)])],512),[[f,c(x)&&c(z)]])])}}}),[["__scopeId","data-v-72d5df8d"]]);export{z as default};
