import{r as e,f as t,bB as n,d as o,bm as l,bC as s,x as i,w as r,k as a,b as u,v as c,al as d,bt as v,ab as b,av as g,a7 as m,bD as f,bu as p,aT as x,a0 as y,bE as C}from"./index.js";function k(b,g){let m;const f=e(!1),p=t({...b,originalPosition:"",originalOverflow:"",visible:!1});function x(){var e,t;null==(t=null==(e=A.$el)?void 0:e.parentNode)||t.removeChild(A.$el)}function y(){if(!f.value)return;const e=p.parent;f.value=!1,e.vLoadingAddClassList=void 0,function(){const e=p.parent,t=A.ns;if(!e.vLoadingAddClassList){let n=e.getAttribute("loading-number");n=Number.parseInt(n)-1,n?e.setAttribute("loading-number",n.toString()):(v(e,t.bm("parent","relative")),e.removeAttribute("loading-number")),v(e,t.bm("parent","hidden"))}x(),k.unmount()}()}const C=o({name:"ElLoading",setup(e,{expose:t}){const{ns:n,zIndex:o}=s("loading");return t({ns:n,zIndex:o}),()=>{const e=p.spinner||p.svg,t=i("svg",{class:"circular",viewBox:p.svgViewBox?p.svgViewBox:"0 0 50 50",...e?{innerHTML:e}:{}},[i("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),o=p.text?i("p",{class:n.b("text")},[p.text]):void 0;return i(d,{name:n.b("fade"),onAfterLeave:y},{default:r(()=>[a(u("div",{style:{backgroundColor:p.background||""},class:[n.b("mask"),p.customClass,p.fullscreen?"is-fullscreen":""]},[i("div",{class:n.b("spinner")},[t,o])]),[[c,p.visible]])])})}}}),k=n(C);Object.assign(k._context,null!=g?g:{});const A=k.mount(document.createElement("div"));return{...l(p),setText:function(e){p.text=e},removeElLoadingChild:x,close:function(){var e;b.beforeClose&&!b.beforeClose()||(f.value=!0,clearTimeout(m),m=setTimeout(y,400),p.visible=!1,null==(e=b.closed)||e.call(b))},handleAfterLeave:y,vm:A,get $el(){return A.$el}}}let A;const w=function(e={}){if(!b)return;const t=L(e);if(t.fullscreen&&A)return A;const n=k({...t,closed:()=>{var e;null==(e=t.closed)||e.call(t),t.fullscreen&&(A=void 0)}},w._context);B(t,t.parent,n),_(t,t.parent,n),t.parent.vLoadingAddClassList=()=>_(t,t.parent,n);let o=t.parent.getAttribute("loading-number");return o=o?`${Number.parseInt(o)+1}`:"1",t.parent.setAttribute("loading-number",o),t.parent.appendChild(n.$el),g(()=>n.visible.value=t.visible),t.fullscreen&&(A=n),n},L=e=>{var t,n,o,l;let s;return s=m(e.target)?null!=(t=document.querySelector(e.target))?t:document.body:e.target||document.body,{parent:s===document.body||e.body?document.body:s,background:e.background||"",svg:e.svg||"",svgViewBox:e.svgViewBox||"",spinner:e.spinner||!1,text:e.text||"",fullscreen:s===document.body&&(null==(n=e.fullscreen)||n),lock:null!=(o=e.lock)&&o,customClass:e.customClass||"",visible:null==(l=e.visible)||l,beforeClose:e.beforeClose,closed:e.closed,target:s}},B=async(e,t,n)=>{const{nextZIndex:o}=n.vm.zIndex||n.vm._.exposed.zIndex,l={};if(e.fullscreen)n.originalPosition.value=f(document.body,"position"),n.originalOverflow.value=f(document.body,"overflow"),l.zIndex=o();else if(e.parent===document.body){n.originalPosition.value=f(document.body,"position"),await g();for(const t of["top","left"]){const n="top"===t?"scrollTop":"scrollLeft";l[t]=e.target.getBoundingClientRect()[t]+document.body[n]+document.documentElement[n]-Number.parseInt(f(document.body,`margin-${t}`),10)+"px"}for(const t of["height","width"])l[t]=`${e.target.getBoundingClientRect()[t]}px`}else n.originalPosition.value=f(t,"position");for(const[s,i]of Object.entries(l))n.$el.style[s]=i},_=(e,t,n)=>{const o=n.vm.ns||n.vm._.exposed.ns;["absolute","fixed","sticky"].includes(n.originalPosition.value)?v(t,o.bm("parent","relative")):p(t,o.bm("parent","relative")),e.fullscreen&&e.lock?p(t,o.bm("parent","hidden")):v(t,o.bm("parent","hidden"))};w._context=null;const h=Symbol("ElLoading"),$=e=>`element-loading-${C(e)}`,I=(t,n)=>{var o,l,s,i;const r=n.instance,a=e=>x(n.value)?n.value[e]:void 0,u=n=>(t=>{const n=m(t)&&(null==r?void 0:r[t])||t;return e(n)})(a(n)||t.getAttribute($(n))),c=null!=(o=a("fullscreen"))?o:n.modifiers.fullscreen,d={text:u("text"),svg:u("svg"),svgViewBox:u("svgViewBox"),spinner:u("spinner"),background:u("background"),customClass:u("customClass"),fullscreen:c,target:null!=(l=a("target"))?l:c?void 0:t,body:null!=(s=a("body"))?s:n.modifiers.body,lock:null!=(i=a("lock"))?i:n.modifiers.lock},v=w(d);v._context=V._context,t[h]={options:d,instance:v}},V={mounted(e,t){t.value&&I(e,t)},updated(e,t){const n=e[h];if(!t.value)return null==n||n.instance.close(),void(e[h]=null);n?((e,t)=>{for(const n of Object.keys(e))y(e[n])&&(e[n].value=t[n])})(n.options,x(t.value)?t.value:{text:e.getAttribute($("text")),svg:e.getAttribute($("svg")),svgViewBox:e.getAttribute($("svgViewBox")),spinner:e.getAttribute($("spinner")),background:e.getAttribute($("background")),customClass:e.getAttribute($("customClass"))}):I(e,t)},unmounted(e){var t;null==(t=e[h])||t.instance.close(),e[h]=null},_context:null},E={install(e){w._context=e._context,V._context=e._context,e.directive("loading",V),e.config.globalProperties.$loading=w},directive:V,service:w};export{E};
