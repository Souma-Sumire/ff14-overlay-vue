import{a as e,_ as t}from"./shared-common-CeUyZiRZ.js";import{o as s,bH as a,H as o,K as n,I as l,J as r,v as c,X as i,r as u,t as p,Y as d,Z as f}from"./vendor-vue-iK2zA9mI.js";import{a5 as m,n as h,G as _,J as v,H as b,x as g,a as x}from"./vendor-element-plus-ICQGukrc.js";import"./shared-core-w2Ysp_jo.js";import"./cactbot-Bq2Gp82n.js";const y={class:"min-h-screen p-6"},C={style:{position:"absolute",top:"2em",right:"2em"}},w={class:"overflow-auto rounded bg-black p-3 text-xs text-green-400"},D=t(s({__name:"rsvDumper",setup(t){a();const s={SE2DC5B04_EE2DC5B04:"Action",S64755250_E64755250:"BNpcName",S74CFC3B0_E74CFC3B0:"Status",S13095D61_E13095D61:"InstanceContentTextData",SF15185AF_EF15185AF:"LogMessage",SCFE39641_ECFE39641:"NpcYell"},D=u([]),E=u(!1),S=u("");const k=async e=>{const t=e.raw,a=(await t.text()).split(/\r?\n/),o=new Set;D.value=[];for(const n of a){const e=n.split("|");if("252"!==e[0])continue;const t=$(e.slice(3,-2));if(!j(t,(new TextEncoder).encode("_rsv_")))continue;const a=F(t.slice(30)),l=a.str1.replace(/^(rsv_\d+)_[^_]+_[^_]+_[^_]+_[^_]+_([^_]{9}_[^_]+)$/,"$1_$2");if(o.has(l))continue;o.add(l);const r=s[l.slice(-19)]||"Unknown",c=Number(l.match(/_rsv_(\d+)_/)?.[1]);D.value.push({type:r,id:c,...a})}};function $(e){const t=[];for(const s of e){const e=Number.parseInt(s,16)>>>0;t.push(255&e,e>>8&255,e>>16&255,e>>24&255)}return new Uint8Array(t)}function j(e,t){const s=e.length-t.length;for(let a=0;a<=s;a++){let s=!0;for(let o=0;o<t.length;o++)if(e[a+o]!==t[o]){s=!1;break}if(s)return!0}return!1}function F(e){return{str1:U(e.slice(2)),str2:U(e.slice(50)),hexDump:B(e)}}function U(e){const t=e.indexOf(0),s=-1!==t?e.slice(0,t):e;let a="";const o=new TextDecoder;let n=[],l=[];const r=()=>{n.length&&(a+=o.decode(Uint8Array.from(n)),n=[])},c=()=>{l.length&&(a+=`<hex:${l.map(e=>e.toString(16).padStart(2,"0")).join("").toUpperCase()}>`,l=[])};let i=0;for(;i<s.length;i++){const e=s[i];if(0!==e&&e>=32)break}const u=s.slice(i);for(const p of u)0===p||p<=31||127===p?(r(),l.push(p)):(c(),n.push(p));return r(),c(),a.replace(/(<hex:(00)+>)$/,"")}function B(e,t=16){let s=e.length;for(;s>0&&0===e[s-1];)s--;const a=e.slice(0,s),o="0123456789ABCDEF",n=[];for(let l=0;l<a.length;l+=t){let e="",s="";for(let n=0;n<t;n++)if(l+n<a.length){const t=a[l+n];e+=`${o[t>>4]}${o[15&t]} `,s+=t>=32&&t<127?String.fromCharCode(t):"."}else e+="   ",s+=" ";n.push(`${e} ${s}`)}return n.join("\n")}function R(){if(0===D.value.length)return void x.error("请先上传日志文件");const e={};D.value.forEach(({type:t,id:s,str2:a})=>{e[t]||(e[t]=[]),e[t].push(`${s} ${a}`)});let t="";for(const[n,l]of Object.entries(e))t+=`=== ${n} ===\n${l.join("\n")}\n\n`;const s=new Blob([t],{type:"text/plain;charset=utf-8"}),a=URL.createObjectURL(s),o=document.createElement("a");o.href=a,o.download="rsv_results.txt",o.click(),URL.revokeObjectURL(a)}return(t,s)=>{const a=e,u=m,x=h,$=g,j=b,F=_,U=v;return p(),o("div",y,[s[4]||(s[4]=n("h1",{class:"mb-4 text-2xl font-bold"}," FFXIV RSV Dumper ",-1)),n("span",C,[l(a,{"storage-key":"rsv-dumper-theme"})]),l(u,{drag:"",action:"","auto-upload":!1,"show-file-list":!1,accept:".log,.txt",class:"upload-box",onChange:k},{default:r(()=>[...s[1]||(s[1]=[n("i",{class:"el-icon-upload"},null,-1),n("div",{class:"el-upload__text"},[d(" 拖拽日志文件到此处或 "),n("em",null,"点击上传")],-1)])]),_:1}),D.value.length?(p(),c(x,{key:0,type:"success",class:"mb-4",disabled:0===D.value.length,onClick:R},{default:r(()=>[...s[2]||(s[2]=[d(" 保存结果到文件 ",-1)])]),_:1},8,["disabled"])):i("",!0),D.value.length?(p(),c(F,{key:2,data:D.value,stripe:"",style:{width:"100%","margin-top":"20px"},border:""},{default:r(()=>[l(j,{prop:"type",label:"Type"}),l(j,{prop:"id",label:"ID"}),l(j,{prop:"str1",label:"RSV Data 1",width:"400"}),l(j,{prop:"str2",label:"RSV Data 2"}),l(j,{label:"操作",width:"150"},{default:r(e=>[l(x,{size:"small",type:"primary",onClick:t=>{return s=e.row,S.value=s.hexDump,void(E.value=!0);var s}},{default:r(()=>[...s[3]||(s[3]=[d(" 查看 HexDump ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(p(),c($,{key:1,description:"请上传 act.log 文件",class:"mt-6"})),l(U,{modelValue:E.value,"onUpdate:modelValue":s[0]||(s[0]=e=>E.value=e),title:"HexDump 原始数据",width:"50%","append-to-body":!0},{default:r(()=>[n("pre",w,f(S.value),1)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-308d8d0c"]]);export{D as default};
