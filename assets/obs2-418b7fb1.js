import{_ as e}from"./ActWrapper-82461ca1.js";import"./index-cb6d85bc.js";/* empty css                        *//* empty css                   *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                 *//* empty css                *//* empty css                  *//* empty css                *//* empty css                  */import{aC as t,w as a,f as o,v as l,x as n,A as s,M as r,E as i,L as c,a9 as d,u,D as p,h as m,t as h,r as f,P as w,H as b,K as g,J as v,V as y}from"./vue-vendor-e9f6d682.js";import{u as C}from"./index-bc46afe1.js";import{_}from"./_plugin-vue_export-helper-6a8c15be.js";import{n as V,m as S,r as P,J as R,F as j,e as U,h as x,Y as E,W as T,Z as k,_ as D,y as N,z as A,d as O,f as L}from"./element-plus-31eb5454.js";import{_ as z}from"./ThemeToggle-8f79f38d.js";import{j as B}from"./obs-d6693326.js";import{u as F}from"./useDevMode-c2e16311.js";import{u as I,C as W}from"./useZone-63bc3fbf.js";import{z as Z}from"./zoneInfo-40d5d60a.js";import{l as q}from"./regexes-da03e94d.js";import{N as M,c as G}from"./netregexes-ed180b06.js";import{a as Y,r as K,c as H}from"./overlay_plugin_api-974cdd44.js";import"./content_type-e6dd7239.js";import"./zone_info-e69ac441.js";const J={class:"language-switcher"},$={class:"select-wrapper"},Q=_({__name:"LanguageSwitcher",setup(e){const{locale:h,availableLocales:f}=t(),w={zhCn:"简体中文",en:"English",ja:"日本語"},b=C("user-locale",h.value);return a(b,e=>{h.value=e}),o(()=>{h.value=b.value}),(e,t)=>{const a=V,o=S;return n(),l("div",J,[s("div",$,[t[1]||(t[1]=s("svg",{class:"globe-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[s("circle",{cx:"12",cy:"12",r:"10"}),s("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),s("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})],-1)),r(o,{modelValue:u(b),"onUpdate:modelValue":t[0]||(t[0]=e=>m(b)?b.value=e:null),size:"small",class:"language-select"},{default:i(()=>[(n(!0),l(c,null,d(u(f),(e,t)=>(n(),p(a,{key:t,value:e,label:w[e]},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-20ae48e5"]]),X={class:"obs-container"},ee={class:"button-container"},te={class:"card-header"},ae={class:"act-not-ready-content"},oe={key:1},le={class:"card-header"},ne={key:1},se={class:"card-header"},re={class:"status-info"},ie={class:"button-container"},ce={class:"card-header"},de={class:"profile-info"},ue={class:"file-path-explanation"},pe={class:"file-name-explanation"},me={class:"card-header"},he=_(h({__name:"obs2",setup(a){const{t:c}=t(),{zoneType:d}=I(),m=C("obs-user-config",{host:4455,password:"",path:"",fileName:""},localStorage,{writeDefaults:!0}),h=C("obs-user-content-setting",[]),_=C("obs-is-first-time",!0),V=f(!1),S=F(),J=f(1);function $(){return S.value?Promise.resolve():new Promise(e=>{H({call:"cactbotRequestState"}).then(()=>{V.value=!0,e()}),setTimeout(()=>{V.value||$()},3e3)})}const he={inCombat:M.inCombat(),countdown:M.countdown(),countdownCancel:M.countdownCancel(),wipe:G.wipe},fe={enter:!1,countdown:!0,countdownCancel:!0,combatStart:!0,combatEnd:!0,wipe:!0,partyLength:4},we={enter:!1,countdown:!1,countdownCancel:!1,combatStart:!1,combatEnd:!1,wipe:!1,partyLength:1};const be=new class{ws;status;handleConnectionError=()=>{ye("OBS connection error"),this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath=""};handleConnectionClosed=()=>{ye("OBS connection closed"),this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath=""};handleRecordStateChanged=e=>{this.status.connected=!0,this.status.recording="OBS_WEBSOCKET_OUTPUT_STARTED"===e.outputState,this.status.outputActive=e.outputActive,this.status.outputPath=e.outputPath||""};constructor(){this.ws=new B,this.status=y({connecting:!1,connected:!1,recording:!1,outputActive:!1,outputPath:""}),this.ws.on("ConnectionClosed",this.handleConnectionClosed),this.ws.on("ConnectionError",this.handleConnectionError),this.ws.on("RecordStateChanged",this.handleRecordStateChanged)}connect(e){ye("Attempting to connect to OBS"),m.value.host&&m.value.password&&(this.status.connecting||(this.status.connecting=!0,this.ws.connect(`ws://127.0.0.1:${m.value.host}`,m.value.password).then(()=>{this.ws.call("GetRecordStatus").then(e=>{this.status.recording=e.outputActive,this.status.outputActive=e.outputActive}),this.status.connected=!0,e&&e()}).finally(()=>{this.status.connecting=!1,!m.value.path&&this.status.connected&&this.ws.call("GetRecordDirectory").then(e=>{e.recordDirectory&&(m.value.path=e.recordDirectory)}),m.value.fileName||(m.value.fileName="%CCYY-%MM-%DD %hh-%mm-%ss")})))}disconnect(){ye("Disconnecting from OBS"),this.ws.disconnect()}async startRecord(){ye("Starting recording"),await this.setProfileParameter(),this.ws.call("StartRecord")}stopRecord(){ye("Stopping recording"),this.ws.call("StopRecord")}splitRecord(){ye("Splitting recording"),this.ws.call("StopRecord").finally(()=>{setTimeout(()=>{this.ws.call("StartRecord")},1e3)})}async setProfileParameter(){const e=m.value.path,t=m.value.fileName,a=[];return a.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"AdvOut",parameterName:"RecFilePath",parameterValue:e}}),a.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"Output",parameterName:"FilenameFormatting",parameterValue:t}}),m.value.path=e,m.value.fileName=t,this.ws.callBatch(a)}},ge=e=>{ye("Zone changed:",e);const t=e.zoneID;void 0!==Z[t]&&Ce("enter")},ve=e=>{const t=e.rawLine;for(const a in he){if(he[a].exec(t)){const e=t.split("|");switch(a){case"inCombat":{const t="1"===e[q.InCombat.fields.inACTCombat],a="1"===e[q.InCombat.fields.inGameCombat];if(t&&a)return void Ce("combatStart");if(!t&&!a)return void Ce("combatEnd");break}case"countdown":Ce("countdown");break;case"countdownCancel":Ce("countdownCancel");break;case"wipe":Ce("wipe")}}}};function ye(...e){S.value}function Ce(e){ye();const t=h.value.find(e=>e.type===d.value);if(t)if(t[e])if(ye(d.value),!1===t.enter&&"enter"===e&&be.status.recording)be.stopRecord();else switch(e){case"enter":case"countdown":case"combatStart":if(J.value<t.partyLength)return;return be.status.connected?!1===be.status.recording?void be.startRecord():void(!0===be.status.recording&&"combatStart"!==e&&be.splitRecord()):void be.connect(()=>{be.startRecord()});case"countdownCancel":case"combatEnd":case"wipe":be.status.recording&&be.stopRecord()}else ye()}const _e=e=>{ye(),J.value=e.party.map(e=>e.inParty)?.length||1};return o(async()=>{await $(),be.connect(),Y("ChangeZone",ge),Y("LogLine",ve),Y("PartyChanged",_e),function(){const e=["Savage","Extreme","Ultimate","Chaotic","OccultCrescent","Default"];if(_.value)_.value=!1,h.value=[...e.map(e=>({type:e,...fe})),...W.filter(t=>!e.includes(t)).map(e=>({type:e,...we}))];else{h.value=h.value.filter(e=>W.includes(e.type));const t=W.filter(e=>!h.value.some(t=>t.type===e)&&"Default"!==e).map(t=>e.includes(t)?{type:t,...fe}:{type:t,...we});h.value.push(...t)}h.value.sort((e,t)=>W.indexOf(e.type)-W.indexOf(t.type)),h.value=h.value.map(t=>({...e.includes(t.type)?fe:we,...t}))}()}),w(()=>{be.disconnect(),K("ChangeZone",ge),K("LogLine",ve)}),(t,a)=>{const o=z,d=Q,f=P,w=U,y=j,C=x,_=R,B=E,F=T,I=D,W=k,Z=A,q=O,M=L,G=N,Y=e;return n(),p(Y,null,{default:i(()=>[s("div",X,[s("header",null,[s("h1",null,g(u(c)("OBS Auto Record V2")),1),s("div",ee,[r(o),r(d)])]),!u(V)||u(S)?(n(),p(f,{key:0,class:"act-not-ready-card"},{header:i(()=>[s("div",te,[s("span",null,g(u(c)("ACT Not Ready")),1)])]),default:i(()=>[s("div",ae,[s("p",null,g(u(c)("overlayTutorial")),1)])]),_:1})):b("",!0),u(V)||u(S)?(n(),l("main",oe,[u(be).status.connected||u(S)?(n(),l("div",ne,[r(F,{class:"instruction-alert",type:"info",description:u(c)("hideTutorial"),closable:!1,"show-icon":""},null,8,["description"]),u(S)?(n(),p(f,{key:0,class:"status-card"},{header:i(()=>[s("div",se,[s("span",null,g(u(c)("Connection Status")),1),r(C,{type:"danger",size:"small",class:"disconnect-button",onClick:a[3]||(a[3]=e=>u(be).disconnect())},{default:i(()=>[v(g(u(c)("Disconnect")),1)]),_:1})])]),default:i(()=>[s("div",re,[r(W,{direction:"vertical",column:1,border:""},{default:i(()=>[r(I,{label:u(c)("Recording")},{default:i(()=>[v(g(u(be).status.recording?u(c)("Yes"):u(c)("No")),1)]),_:1},8,["label"]),r(I,{label:u(c)("Output Path")},{default:i(()=>[v(g(u(be).status.outputPath||u(c)("None")),1)]),_:1},8,["label"])]),_:1})]),s("div",ie,[r(C,{disabled:!u(be).status.connected||u(be).status.recording,type:"primary",onClick:a[4]||(a[4]=e=>u(be).startRecord())},{default:i(()=>[v(g(u(c)("Start Record")),1)]),_:1},8,["disabled"]),r(C,{disabled:!u(be).status.connected||!u(be).status.recording,type:"danger",onClick:a[5]||(a[5]=e=>u(be).stopRecord())},{default:i(()=>[v(g(u(c)("Stop Record")),1)]),_:1},8,["disabled"]),r(C,{disabled:!u(be).status.connected||!u(be).status.recording,type:"warning",onClick:a[6]||(a[6]=e=>u(be).splitRecord())},{default:i(()=>[v(g(u(c)("Split Record")),1)]),_:1},8,["disabled"]),r(C,{type:"primary",onClick:a[7]||(a[7]=e=>u(be).setProfileParameter())},{default:i(()=>[v(g(u(c)("Set Recording Name")),1)]),_:1})])]),_:1})):b("",!0),r(f,{class:"profile-card"},{header:i(()=>[s("div",ce,[s("span",null,g(u(c)("Recording Profile")),1)])]),default:i(()=>[s("div",de,[r(_,{"label-position":"top",class:"content-form"},{default:i(()=>[r(y,{label:u(c)("Record Path")},{default:i(()=>[r(w,{modelValue:u(m).path,"onUpdate:modelValue":a[8]||(a[8]=e=>u(m).path=e),placeholder:u(c)("recordPathPlaceholder")},null,8,["modelValue","placeholder"]),s("div",ue,g(u(c)("filePathExplanation")),1)]),_:1},8,["label"]),r(y,{label:u(c)("Record File Name")},{default:i(()=>[r(w,{modelValue:u(m).fileName,"onUpdate:modelValue":a[9]||(a[9]=e=>u(m).fileName=e),placeholder:u(c)("recordFileNamePlaceholder")},null,8,["modelValue","placeholder"]),s("div",pe,g(u(c)("fileNameExplanation")),1)]),_:1},8,["label"])]),_:1})])]),_:1}),r(f,{class:"table-card"},{header:i(()=>[s("div",me,[s("span",null,g(u(c)("User Content Settings")),1)])]),default:i(()=>[r(G,{data:u(h),style:{width:"100%"},border:!0,stripe:""},{default:i(()=>[r(Z,{prop:"type",label:u(c)("Type"),"min-width":"120",fixed:""},{default:i(e=>[s("span",null,g(u(c)(e.row.type)),1)]),_:1},8,["label"]),r(Z,{label:u(c)("Start When"),align:"center"},{default:i(()=>[r(Z,{label:u(c)("When Party"),align:"center","min-width":"110"},{default:i(e=>[r(q,{modelValue:e.row.partyLength,"onUpdate:modelValue":t=>e.row.partyLength=t,min:1,max:8,style:{width:"85px"},size:"small",class:"party-length-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),r(Z,{prop:"enter",label:u(c)("Enter Zone"),align:"center","min-width":"95"},{default:i(e=>[r(M,{modelValue:e.row.enter,"onUpdate:modelValue":t=>e.row.enter=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),r(Z,{prop:"countdown",label:u(c)("CountDown"),align:"center","min-width":"95"},{default:i(e=>[r(M,{modelValue:e.row.countdown,"onUpdate:modelValue":t=>e.row.countdown=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),r(Z,{prop:"combatStart",label:u(c)("CombatStart"),align:"center","min-width":"95"},{default:i(e=>[r(M,{modelValue:e.row.combatStart,"onUpdate:modelValue":t=>e.row.combatStart=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),r(Z,{label:u(c)("End When"),align:"center"},{default:i(()=>[r(Z,{prop:"combatEnd",label:u(c)("CombatEnd"),align:"center","min-width":"95"},{default:i(e=>[r(M,{modelValue:e.row.combatEnd,"onUpdate:modelValue":t=>e.row.combatEnd=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),r(Z,{prop:"wipe",label:u(c)("Wipe"),align:"center","min-width":"95"},{default:i(e=>[r(M,{modelValue:e.row.wipe,"onUpdate:modelValue":t=>e.row.wipe=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),r(Z,{prop:"countdown",label:u(c)("CountDownCancel"),align:"center","min-width":"95"},{default:i(e=>[r(M,{modelValue:e.row.countdownCancel,"onUpdate:modelValue":t=>e.row.countdownCancel=t},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})])):(n(),p(f,{key:0,class:"connection-card"},{header:i(()=>[s("div",le,[s("span",null,g(u(c)("Connect to OBS")),1)])]),default:i(()=>[r(_,{"label-position":"top",class:"connection-form"},{default:i(()=>[r(y,{label:u(c)("Port")},{default:i(()=>[r(w,{modelValue:u(m).host,"onUpdate:modelValue":a[0]||(a[0]=e=>u(m).host=e),placeholder:u(c)("portPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(y,{label:u(c)("Password")},{default:i(()=>[r(w,{modelValue:u(m).password,"onUpdate:modelValue":a[1]||(a[1]=e=>u(m).password=e),placeholder:u(c)("passwordPlaceholder"),type:"password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(y,null,{default:i(()=>[r(C,{type:"primary",class:"connect-button",loading:u(be).status.connecting,disabled:u(be).status.connecting||!u(m).host,onClick:a[2]||(a[2]=e=>u(be).connect())},{default:i(()=>[v(g(u(be).status.connecting?u(c)("Connecting"):u(c)("Connect")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),r(B,null,{default:i(()=>[v(g(u(c)("Instructions")),1)]),_:1}),r(F,{class:"instruction-alert",type:"info",description:u(c)("obsTutorial"),closable:!1,"show-icon":""},null,8,["description"]),r(F,{class:"instruction-alert",type:"info",description:u(c)("inputTutorial"),closable:!1,"show-icon":""},null,8,["description"]),r(F,{class:"instruction-alert",type:"info",description:u(c)("firewallTutorial"),closable:!1,"show-icon":""},null,8,["description"])]),_:1}))])):b("",!0)])]),_:1})}}}),[["__scopeId","data-v-769de1bc"]]);export{he as default};
