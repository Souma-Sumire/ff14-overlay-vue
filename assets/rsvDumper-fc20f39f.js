import{a3 as e,aD as t,K as s,a7 as a,aE as o,ab as l,_ as n,d as r,af as i,M as u,r as c,c as d,g as p,n as f,j as m,e as v,N as y,F as g,k as h,aF as b,u as _,q as k,B as w,f as x,al as E,i as F,S as j,aG as C,t as R,p as S,aH as $,H as T,T as L,ap as D,I as U,aI as B,R as O,ai as P,aJ as A,aK as H,aL as q,aM as N,y as M,b as I,P as K,z as V,ax as z,aw as X,V as G,h as J,E as W}from"./index-eb5b86c5.js";import{E as Y}from"./el-overlay-283fb51f.js";import{E as Q,a as Z}from"./el-table-column-39e9cc34.js";import"./el-checkbox-53835649.js";import"./el-tooltip-1f970b29.js";import"./el-popper-5a06dfe1.js";import"./el-scrollbar-6c8756a3.js";/* empty css               */import{E as ee}from"./el-empty-2c721ace.js";import{E as te}from"./el-button-e7d3c65d.js";import{E as se}from"./el-progress-ccf2e140.js";import{_ as ae}from"./ThemeToggle-af6384f2.js";import{e as oe}from"./index-f59a44c5.js";import{t as le,d as ne}from"./index-18f799cf.js";import{a as re}from"./use-form-common-props-b715c3d2.js";import{b as ie}from"./_baseClone-c383e314.js";import{i as ue}from"./isEqual-5de8f8cf.js";import{_ as ce}from"./_plugin-vue_export-helper-6a8c15be.js";import"./index-55fc5f22.js";import"./vnode-42269146.js";import"./scroll-61e241b2.js";import"./focus-trap-6e6a8bdf.js";import"./index-c045a9dd.js";import"./index-96698635.js";import"./_initCloneObject-c283b436.js";import"./debounce-bcff8352.js";import"./raf-052123a8.js";import"./index-d5ff9f9e.js";function de(e){return ie(e,5)}const pe=Symbol("uploadContextKey");class fe extends Error{constructor(e,t,s,a){super(e),this.name="UploadAjaxError",this.status=t,this.method=s,this.url=a}}function me(e,t,s){let a;return a=s.response?`${s.response.error||s.response}`:s.responseText?`${s.responseText}`:`fail to ${t.method} ${e} ${s.status}`,new fe(a,s.status,t.method,e)}const ve=["text","picture","picture-card"];let ye=1;const ge=()=>Date.now()+ye++,he=s({action:{type:String,default:"#"},headers:{type:a(Object)},method:{type:String,default:"post"},data:{type:a([Object,Function,Promise]),default:()=>l({})},multiple:Boolean,name:{type:String,default:"file"},drag:Boolean,withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:a(Array),default:()=>l([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ve,default:"text"},httpRequest:{type:a(Function),default:s=>{"undefined"==typeof XMLHttpRequest&&le("ElUpload","XMLHttpRequest is undefined");const a=new XMLHttpRequest,o=s.action;a.upload&&a.upload.addEventListener("progress",e=>{const t=e;t.percent=e.total>0?e.loaded/e.total*100:0,s.onProgress(t)});const l=new FormData;if(s.data)for(const[t,r]of Object.entries(s.data))e(r)&&r.length?l.append(t,...r):l.append(t,r);l.append(s.filename,s.file,s.file.name),a.addEventListener("error",()=>{s.onError(me(o,s,a))}),a.addEventListener("load",()=>{if(a.status<200||a.status>=300)return s.onError(me(o,s,a));s.onSuccess(function(e){const t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(s){return t}}(a))}),a.open(s.method,o,!0),s.withCredentials&&"withCredentials"in a&&(a.withCredentials=!0);const n=s.headers||{};if(n instanceof Headers)n.forEach((e,t)=>a.setRequestHeader(t,e));else for(const[e,r]of Object.entries(n))t(r)||a.setRequestHeader(e,String(r));return a.send(l),a}},disabled:Boolean,limit:Number}),be=s({...he,beforeUpload:{type:a(Function),default:o},beforeRemove:{type:a(Function)},onRemove:{type:a(Function),default:o},onChange:{type:a(Function),default:o},onPreview:{type:a(Function),default:o},onSuccess:{type:a(Function),default:o},onProgress:{type:a(Function),default:o},onError:{type:a(Function),default:o},onExceed:{type:a(Function),default:o},crossorigin:{type:a(String)}}),_e=s({files:{type:a(Array),default:()=>l([])},disabled:Boolean,handlePreview:{type:a(Function),default:o},listType:{type:String,values:ve,default:"text"},crossorigin:{type:a(String)}}),ke=r({name:"ElUploadList"});var we=n(r({...ke,props:_e,emits:{remove:e=>!!e},setup(e,{emit:t}){const s=e,{t:a}=i(),o=u("upload"),l=u("icon"),n=u("list"),r=re(),O=c(!1),P=d(()=>[o.b("list"),o.bm("list",s.listType),o.is("disabled",s.disabled)]),A=e=>{t("remove",e)};return(e,t)=>(f(),p(B,{tag:"ul",class:k(_(P)),name:_(n).b()},{default:m(()=>[(f(!0),v(g,null,h(e.files,(t,s)=>(f(),v("li",{key:t.uid||t.name,class:k([_(o).be("list","item"),_(o).is(t.status),{focusing:O.value}]),tabindex:"0",onKeydown:b(e=>!_(r)&&A(t),["delete"]),onFocus:e=>O.value=!0,onBlur:e=>O.value=!1,onClick:e=>O.value=!1},[y(e.$slots,"default",{file:t,index:s},()=>["picture"===e.listType||"uploading"!==t.status&&"picture-card"===e.listType?(f(),v("img",{key:0,class:k(_(o).be("list","item-thumbnail")),src:t.url,crossorigin:e.crossorigin,alt:""},null,10,["src","crossorigin"])):w("v-if",!0),"uploading"===t.status||"picture-card"!==e.listType?(f(),v("div",{key:1,class:k(_(o).be("list","item-info"))},[x("a",{class:k(_(o).be("list","item-name")),onClick:E(s=>e.handlePreview(t),["prevent"])},[F(_(j),{class:k(_(l).m("document"))},{default:m(()=>[F(_(C))]),_:1},8,["class"]),x("span",{class:k(_(o).be("list","item-file-name")),title:t.name},R(t.name),11,["title"])],10,["onClick"]),"uploading"===t.status?(f(),p(_(se),{key:0,type:"picture-card"===e.listType?"circle":"line","stroke-width":"picture-card"===e.listType?6:2,percentage:Number(t.percentage),style:S("picture-card"===e.listType?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):w("v-if",!0)],2)):w("v-if",!0),x("label",{class:k(_(o).be("list","item-status-label"))},["text"===e.listType?(f(),p(_(j),{key:0,class:k([_(l).m("upload-success"),_(l).m("circle-check")])},{default:m(()=>[F(_($))]),_:1},8,["class"])):["picture-card","picture"].includes(e.listType)?(f(),p(_(j),{key:1,class:k([_(l).m("upload-success"),_(l).m("check")])},{default:m(()=>[F(_(T))]),_:1},8,["class"])):w("v-if",!0)],2),_(r)?w("v-if",!0):(f(),p(_(j),{key:2,class:k(_(l).m("close")),onClick:e=>A(t)},{default:m(()=>[F(_(L))]),_:2},1032,["class","onClick"])),w(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),w(" This is a bug which needs to be fixed "),w(" TODO: Fix the incorrect navigation interaction "),_(r)?w("v-if",!0):(f(),v("i",{key:3,class:k(_(l).m("close-tip"))},R(_(a)("el.upload.deleteTip")),3)),"picture-card"===e.listType?(f(),v("span",{key:4,class:k(_(o).be("list","item-actions"))},[x("span",{class:k(_(o).be("list","item-preview")),onClick:s=>e.handlePreview(t)},[F(_(j),{class:k(_(l).m("zoom-in"))},{default:m(()=>[F(_(D))]),_:1},8,["class"])],10,["onClick"]),_(r)?w("v-if",!0):(f(),v("span",{key:0,class:k(_(o).be("list","item-delete")),onClick:e=>A(t)},[F(_(j),{class:k(_(l).m("delete"))},{default:m(()=>[F(_(U))]),_:1},8,["class"])],10,["onClick"]))],2)):w("v-if",!0)])],42,["onKeydown","onFocus","onBlur","onClick"]))),128)),y(e.$slots,"append")]),_:3},8,["class","name"]))}}),[["__file","upload-list.vue"]]);const xe=s({disabled:Boolean}),Ee={file:t=>e(t)},Fe="ElUploadDrag",je=r({name:Fe});var Ce=n(r({...je,props:xe,emits:Ee,setup(e,{emit:t}){O(pe)||le(Fe,"usage: <el-upload><el-upload-dragger /></el-upload>");const s=u("upload"),a=c(!1),o=re(),l=e=>{if(o.value)return;a.value=!1,e.stopPropagation();const s=Array.from(e.dataTransfer.files),l=e.dataTransfer.items||[];s.forEach((e,t)=>{var s;const a=l[t],o=null==(s=null==a?void 0:a.webkitGetAsEntry)?void 0:s.call(a);o&&(e.isDirectory=o.isDirectory)}),t("file",s)},n=()=>{o.value||(a.value=!0)},r=e=>{e.currentTarget.contains(e.relatedTarget)||(a.value=!1)};return(e,t)=>(f(),v("div",{class:k([_(s).b("dragger"),_(s).is("dragover",a.value)]),onDrop:E(l,["prevent"]),onDragover:E(n,["prevent"]),onDragleave:E(r,["prevent"])},[y(e.$slots,"default")],42,["onDrop","onDragover","onDragleave"]))}}),[["__file","upload-dragger.vue"]]);const Re=s({...he,beforeUpload:{type:a(Function),default:o},onRemove:{type:a(Function),default:o},onStart:{type:a(Function),default:o},onSuccess:{type:a(Function),default:o},onProgress:{type:a(Function),default:o},onError:{type:a(Function),default:o},onExceed:{type:a(Function),default:o}}),Se=r({name:"ElUploadContent",inheritAttrs:!1});var $e=n(r({...Se,props:Re,setup(e,{expose:t}){const s=e,a=u("upload"),o=re(),l=P({}),n=P(),r=e=>{if(0===e.length)return;const{autoUpload:t,limit:a,fileList:o,multiple:l,onStart:n,onExceed:r}=s;if(a&&o.length+e.length>a)r(e,o);else{l||(e=e.slice(0,1));for(const s of e){const e=s;e.uid=ge(),n(e),t&&i(e)}}},i=async e=>{if(n.value.value="",!s.beforeUpload)return c(e);let t,a={};try{const o=s.data,l=s.beforeUpload(e);a=A(s.data)?de(s.data):s.data,t=await l,A(s.data)&&ue(o,a)&&(a=de(s.data))}catch(l){t=!1}if(!1===t)return void s.onRemove(e);let o=e;t instanceof Blob&&(o=t instanceof File?t:new File([t],e.name,{type:e.type})),c(Object.assign(o,{uid:e.uid}),a)},c=async(e,t)=>{const{headers:a,data:o,method:n,withCredentials:r,name:i,action:u,onProgress:c,onSuccess:d,onError:p,httpRequest:f}=s;try{t=await(async(e,t)=>q(e)?e(t):e)(null!=t?t:o,e)}catch(g){return void s.onRemove(e)}const{uid:m}=e,v={headers:a||{},withCredentials:r,file:e,data:t,method:n,filename:i,action:u,onProgress:t=>{c(t,e)},onSuccess:t=>{d(t,e),delete l.value[m]},onError:t=>{p(t,e),delete l.value[m]}},y=f(v);l.value[m]=y,y instanceof Promise&&y.then(v.onSuccess,v.onError)},d=e=>{const t=e.target.files;t&&r(Array.from(t))},g=()=>{o.value||(n.value.value="",n.value.click())},h=()=>{g()};return t({abort:e=>{H(l.value).filter(e?([t])=>String(e.uid)===t:()=>!0).forEach(([e,t])=>{t instanceof XMLHttpRequest&&t.abort(),delete l.value[e]})},upload:i}),(e,t)=>(f(),v("div",{class:k([_(a).b(),_(a).m(e.listType),_(a).is("drag",e.drag),_(a).is("disabled",_(o))]),tabindex:_(o)?"-1":"0",onClick:g,onKeydown:b(E(h,["self"]),["enter","space"])},[e.drag?(f(),p(Ce,{key:0,disabled:_(o),onFile:r},{default:m(()=>[y(e.$slots,"default")]),_:3},8,["disabled"])):y(e.$slots,"default",{key:1}),x("input",{ref_key:"inputRef",ref:n,class:k(_(a).e("input")),name:e.name,disabled:_(o),multiple:e.multiple,accept:e.accept,type:"file",onChange:d,onClick:E(()=>{},["stop"])},null,42,["name","disabled","multiple","accept","onClick"])],42,["tabindex","onKeydown"]))}}),[["__file","upload-content.vue"]]);const Te="ElUpload",Le=e=>{var t;(null==(t=e.url)?void 0:t.startsWith("blob:"))&&URL.revokeObjectURL(e.url)},De=r({name:"ElUpload"});const Ue=G(n(r({...De,props:be,setup(e,{expose:s}){const a=e,o=re(),l=P(),{abort:n,submit:r,clearFiles:i,uploadFiles:u,handleStart:c,handleError:g,handleRemove:h,handleSuccess:b,handleProgress:k,revokeFileObjectURL:x}=((e,s)=>{const a=N(e,"fileList",void 0,{passive:!0}),o=e=>a.value.find(t=>t.uid===e.uid);function l(e){var t;null==(t=s.value)||t.abort(e)}function n(e){a.value=a.value.filter(t=>t.uid!==e.uid)}return M(()=>e.listType,t=>{"picture-card"!==t&&"picture"!==t||(a.value=a.value.map(t=>{const{raw:s,url:o}=t;if(!o&&s)try{t.url=URL.createObjectURL(s)}catch(l){e.onError(l,t,a.value)}return t}))}),M(a,e=>{for(const t of e)t.uid||(t.uid=ge()),t.status||(t.status="success")},{immediate:!0,deep:!0}),{uploadFiles:a,abort:l,clearFiles:function(e=["ready","uploading","success","fail"]){a.value=a.value.filter(t=>!e.includes(t.status))},handleError:(t,s)=>{const l=o(s);l&&(l.status="fail",n(l),e.onError(t,l,a.value),e.onChange(l,a.value))},handleProgress:(t,s)=>{const l=o(s);l&&(e.onProgress(t,l,a.value),l.status="uploading",l.percentage=Math.round(t.percent))},handleStart:s=>{t(s.uid)&&(s.uid=ge());const o={name:s.name,percentage:0,status:"ready",size:s.size,raw:s,uid:s.uid};if("picture-card"===e.listType||"picture"===e.listType)try{o.url=URL.createObjectURL(s)}catch(l){ne(Te,l.message),e.onError(l,o,a.value)}a.value=[...a.value,o],e.onChange(o,a.value)},handleSuccess:(t,s)=>{const l=o(s);l&&(l.status="success",l.response=t,e.onSuccess(t,l,a.value),e.onChange(l,a.value))},handleRemove:async t=>{const s=t instanceof File?o(t):t;s||le(Te,"file to be removed not found");const r=t=>{l(t),n(t),e.onRemove(t,a.value),Le(t)};e.beforeRemove?!1!==await e.beforeRemove(s,a.value)&&r(s):r(s)},submit:function(){a.value.filter(({status:e})=>"ready"===e).forEach(({raw:e})=>{var t;return e&&(null==(t=s.value)?void 0:t.upload(e))})},revokeFileObjectURL:Le}})(a,l),E=d(()=>"picture-card"===a.listType),j=d(()=>({...a,fileList:u.value,onStart:c,onProgress:k,onSuccess:b,onError:g,onRemove:h}));return I(()=>{u.value.forEach(x)}),K(pe,{accept:V(a,"accept")}),s({abort:n,submit:r,clearFiles:i,handleStart:c,handleRemove:h}),(e,t)=>(f(),v("div",null,[_(E)&&e.showFileList?(f(),p(we,{key:0,disabled:_(o),"list-type":e.listType,files:_(u),crossorigin:e.crossorigin,"handle-preview":e.onPreview,onRemove:_(h)},z({append:m(()=>[F($e,X({ref_key:"uploadRef",ref:l},_(j)),{default:m(()=>[e.$slots.trigger?y(e.$slots,"trigger",{key:0}):w("v-if",!0),!e.$slots.trigger&&e.$slots.default?y(e.$slots,"default",{key:1}):w("v-if",!0)]),_:3},16)]),_:2},[e.$slots.file?{name:"default",fn:m(({file:t,index:s})=>[y(e.$slots,"file",{file:t,index:s})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):w("v-if",!0),!_(E)||_(E)&&!e.showFileList?(f(),p($e,X({key:1,ref_key:"uploadRef",ref:l},_(j)),{default:m(()=>[e.$slots.trigger?y(e.$slots,"trigger",{key:0}):w("v-if",!0),!e.$slots.trigger&&e.$slots.default?y(e.$slots,"default",{key:1}):w("v-if",!0)]),_:3},16)):w("v-if",!0),e.$slots.trigger?y(e.$slots,"default",{key:2}):w("v-if",!0),y(e.$slots,"tip"),!_(E)&&e.showFileList?(f(),p(we,{key:3,disabled:_(o),"list-type":e.listType,files:_(u),crossorigin:e.crossorigin,"handle-preview":e.onPreview,onRemove:_(h)},z({_:2},[e.$slots.file?{name:"default",fn:m(({file:t,index:s})=>[y(e.$slots,"file",{file:t,index:s})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):w("v-if",!0)]))}}),[["__file","upload.vue"]])),Be={class:"min-h-screen p-6"},Oe={style:{position:"absolute",top:"2em",right:"2em"}},Pe={class:"overflow-auto rounded bg-black p-3 text-xs text-green-400"},Ae=ce(r({__name:"rsvDumper",setup(e){oe();const t={SE2DC5B04_EE2DC5B04:"Action",S64755250_E64755250:"BNpcName",S74CFC3B0_E74CFC3B0:"Status",S13095D61_E13095D61:"InstanceContentTextData",SF15185AF_EF15185AF:"LogMessage",SCFE39641_ECFE39641:"NpcYell"},s=c([]),a=c(!1),o=c("");const l=async e=>{const a=e.raw,o=(await a.text()).split(/\r?\n/),l=new Set;s.value=[];for(const u of o){const e=u.split("|");if("252"!==e[0])continue;const a=n(e.slice(3,-2));if(!r(a,(new TextEncoder).encode("_rsv_")))continue;const o=i(a.slice(30)),c=o.str1.replace(/^(rsv_\d+)_[^_]+_[^_]+_[^_]+_[^_]+_([^_]{9}_[^_]+)$/,"$1_$2");if(l.has(c))continue;l.add(c);const d=t[c.slice(-19)]||"Unknown",p=Number(c.match(/_rsv_(\d+)_/)?.[1]);s.value.push({type:d,id:p,...o})}};function n(e){const t=[];for(const s of e){const e=Number.parseInt(s,16)>>>0;t.push(255&e,e>>8&255,e>>16&255,e>>24&255)}return new Uint8Array(t)}function r(e,t){const s=e.length-t.length;for(let a=0;a<=s;a++){let s=!0;for(let o=0;o<t.length;o++)if(e[a+o]!==t[o]){s=!1;break}if(s)return!0}return!1}function i(e){return{str1:u(e.slice(2)),str2:u(e.slice(50)),hexDump:d(e)}}function u(e){const t=e.indexOf(0),s=-1!==t?e.slice(0,t):e;return new TextDecoder("utf-8").decode(s)}function d(e,t=16){const s="0123456789ABCDEF",a=[];for(let o=0;o<e.length;o+=t){let l="",n="";for(let a=0;a<t;a++)if(o+a<e.length){const t=e[o+a];l+=`${s[t>>4]}${s[15&t]} `,n+=t>=32&&t<127?String.fromCharCode(t):"."}else l+="   ",n+=" ";a.push(`${l} ${n}`)}return a.join("\n")}function y(){if(0===s.value.length)return void W.error("请先上传日志文件");const e={};s.value.forEach(({type:t,id:s,str2:a})=>{e[t]||(e[t]=[]),e[t].push(`${s} ${a}`)});let t="";for(const[s,n]of Object.entries(e))t+=`=== ${s} ===\n${n.join("\n")}\n\n`;const a=new Blob([t],{type:"text/plain;charset=utf-8"}),o=URL.createObjectURL(a),l=document.createElement("a");l.href=o,l.download="rsv_results.txt",l.click(),URL.revokeObjectURL(o)}return(e,t)=>{const n=ae,r=Ue,i=te,u=ee,c=Z,d=Q,g=Y;return f(),v("div",Be,[t[4]||(t[4]=x("h1",{class:"mb-4 text-2xl font-bold"}," FFXIV RSV Dumper ",-1)),x("span",Oe,[F(n,{"storage-key":"rsv-dumper-theme"})]),F(r,{drag:"",action:"","auto-upload":!1,"show-file-list":!1,accept:".log,.txt",class:"upload-box",onChange:l},{default:m(()=>t[1]||(t[1]=[x("i",{class:"el-icon-upload"},null,-1),x("div",{class:"el-upload__text"},[J(" 拖拽日志文件到此处或 "),x("em",null,"点击上传")],-1)])),_:1,__:[1]}),s.value.length?(f(),p(i,{key:0,type:"success",class:"mb-4",disabled:0===s.value.length,onClick:y},{default:m(()=>t[2]||(t[2]=[J(" 保存结果到文件 ",-1)])),_:1,__:[2]},8,["disabled"])):w("",!0),s.value.length?(f(),p(d,{key:2,data:s.value,stripe:"",style:{width:"100%","margin-top":"20px"},border:""},{default:m(()=>[F(c,{prop:"type",label:"Type"}),F(c,{prop:"id",label:"ID"}),F(c,{prop:"str1",label:"RSV Data 1",width:"400"}),F(c,{prop:"str2",label:"RSV Data 2"}),F(c,{label:"操作",width:"150"},{default:m(e=>[F(i,{size:"small",type:"primary",onClick:t=>{return s=e.row,o.value=s.hexDump,void(a.value=!0);var s}},{default:m(()=>t[3]||(t[3]=[J(" 查看 HexDump ",-1)])),_:2,__:[3]},1032,["onClick"])]),_:1})]),_:1},8,["data"])):(f(),p(u,{key:1,description:"请上传 act.log 文件",class:"mt-6"})),F(g,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),title:"HexDump 原始数据",width:"50%","append-to-body":!0},{default:m(()=>[x("pre",Pe,R(o.value),1)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-e16205ba"]]);export{Ae as default};
