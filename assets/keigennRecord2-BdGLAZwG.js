import{t as e,r as a,f as i,P as r,v as s,x as t,A as n,aw as l,L as o,a9 as c,K as m,u as d,G as p,J as u,D as y,E as f,M as g,H as h,S as b,c as v,V as k,d as w,ae as F,F as C,O as I,h as N,an as x}from"./vue-vendor-Bp7_Yb1I.js";import{_ as j}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{s as $,c as E,a as T}from"./status-_H3qHe59.js";import{b as A,u as _}from"./index-DPl59_9W.js";import{h as D,g as H}from"./xivapi-CDkmt4QZ.js";import{V as S}from"./index-tSscdUG2.js";/* empty css                  *//* empty css                   */import{P as L}from"./element-plus-Dve18By8.js";import"./style-l0sNRNKZ.js";import{g as O}from"./actionChinese-BSDFMVcH.js";import{U as z}from"./util-u6u0BslC.js";import{N as P,l as W}from"./netregexes-BPXJ-L2_.js";import{a as M}from"./overlay_plugin_api-DHbPkDtN.js";const R={class:"upload select"},B=j(e({__name:"TestLog",emits:["handleLine","beforeHandle","afterHandle"],setup(e,{emit:l}){const o=l,c=a(null),m=a(null);async function d(e){m.value?.classList.remove("drag");const a=e.target.files;if(a&&0!==a.length){o("beforeHandle");for(let e=0;e<a.length;e++){const i=a[e],r=await i.text();for(const e of r.split("\n"))o("handleLine",e)}o("afterHandle"),m.value?.classList.remove("drag")}}function p(e){e.preventDefault(),m.value?.classList.add("drag")}function u(e){e.preventDefault(),m.value?.classList.remove("drag")}return i(()=>{c.value?.addEventListener("change",d),m.value?.addEventListener("dragover",p),m.value?.addEventListener("dragleave",u)}),r(()=>{c.value?.removeEventListener("change",d),m.value?.removeEventListener("dragover",p),m.value?.removeEventListener("dragleave",u)}),(e,a)=>(t(),s("div",R,[n("div",{ref_key:"select",ref:m,class:"upload-select"},[a[0]||(a[0]=n("div",{class:"upload text"},[n("span",null,"+"),n("p",null,"上传或拖入ACT日志")],-1)),n("input",{ref_key:"input",ref:c,type:"file"},null,512)],512)]))}}),[["__scopeId","data-v-d4cc5834"]]),G=[{name:"铁壁",id:1191,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"盾阵",id:1856,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"干预",id:1174,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"预警",id:74,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"武装",id:1176,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神圣领域",id:82,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣光幕帘",id:1362,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣盾阵",id:2674,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"骑士的坚守",id:2675,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"壁垒",id:77,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的直觉",id:735,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的勇猛",id:1857,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的武猛",id:1858,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"战栗",id:87,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"复仇",id:89,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"摆脱",id:1457,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死斗",id:409,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血气",id:2678,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血潮",id:2679,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血烟",id:2680,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"至黑之夜",id:1178,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"弃明投暗",id:746,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"暗影墙",id:747,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑布道",id:1894,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"行尸走肉",id:810,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死而不僵",id:811,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"出死入生",id:3255,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"献奉",id:2682,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"石之心",id:1840,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残暴弹",id:1898,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"伪装",id:1832,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"星云",id:1834,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"光之心",id:1839,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"超火流星",id:1836,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之心",id:2683,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之清",id:2684,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神祝祷",id:1218,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"节制",id:1873,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"水流幕",id:2708,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"鼓舞",id:297,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"激励",id:1918,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"炽天的幕帘",id:1917,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"野战治疗阵",id:299,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"异想的幻光",id:317,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"炽天的幻光",id:1875,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"生命回生法",id:2710,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"怒涛之计",id:2711,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"命运之轮",id:849,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"天星交错",id:1889,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"擢升",id:2717,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"中间学派",id:1921,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡诊断",id:2607,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"齐衡诊断",id:2608,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡预后",id:2609,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚角清汁",id:2618,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"白牛清汁",id:2619,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体论",id:3003,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体盾",id:3365,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"输血",id:2612,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"泛输血",id:2613,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"心眼",id:1232,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"金刚极意",id:1179,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"行吟",id:1934,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"策动",id:1951,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"防守之桑巴",id:1826,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"即兴表演结束",id:2697,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残影",id:488,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"魔罩",id:168,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护之光",id:2702,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护纹",id:2597,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"抗死",id:2707,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"雪仇",id:1193,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"牵制",id:1195,type:"multiplier",performance:{physics:1,magic:.5,darkness:0},isFriendly:!1},{name:"昏乱",id:1203,type:"multiplier",performance:{physics:.5,magic:1,darkness:0},isFriendly:!1},{name:"武装解除",id:860,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"减速",id:9,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"体力增加",id:2120,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"腐臭",id:1715,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"智力精神降低",id:2115,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!1},{name:"龙之力",id:2500,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"超硬化",id:1722,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"玄结界",id:2496,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"仙人盾",id:2119,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"强力守护",id:1719,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"哥布防御",id:2114,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"铜墙铁盾",id:194,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚守要塞",id:195,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"终极堡垒",id:196,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初大地",id:863,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑之力",id:864,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"灵魂之青",id:1931,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"极致防御",id:3829,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"极致护盾",id:3830,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"戮罪",id:3832,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗影卫",id:3835,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"大星云",id:3838,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坦培拉涂层",id:3686,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"油性坦培拉涂层",id:3687,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"世界树之干",id:3890,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"建筑神之塔",id:3892,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"太阳星座",id:3896,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神爱抚",id:3903,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0}],U=[...G],Z=new Map;let V="Chinese";function Y(e){if(V!==e||0===Z.size){Z.clear();for(const a of"Chinese"===e?G:U){const e=$[a.id][1];a.fullIcon=E(e),Z.set(a.id.toString(16).toUpperCase().padStart(2,"0"),a)}V=e}}function J(e){return Z.get(e)}function q(e){return 1===e?"useful":0===e?"unuseful":"half-useful"}Y("Chinese");function K(e,a){return Object.entries($).reduce((i,[r,[s,t]])=>(e.test(s)&&i.set(r,{name:s,icon:t,isFriendly:a}),i),new Map)}const X=K(/(?:耐性|防御力)(?:大幅)?(?:降低|提升|低下|下降)|受伤(?:加重|减轻)|体力(?:增加|衰减|减少)|伤害屏障/,!0),Q=K(/(?:精神|力量|灵巧|智力){1,2}(?:大幅)?降低/,!1),ee=A("hash"),ae=l("keigennRecord2",{state:()=>({userOptions:{scale:ie(ee.scale,1),opacity:ie(ee.opacity,.8),showHeader:ie(ee.showHeader,!0),showIcon:ie(ee.showIcon,!0),iconType:ie(ee.iconType,3),showName:ie(ee.showName,!1),abbrId:ie(ee.abbrId,!0),anonymous:ie(ee.anonymous,!0),replaceWithYou:ie(ee.replaceWithYou,!1),parseAA:ie(ee.parseAA,!0),parseDoT:ie(ee.parseDoT,!1),minimize:ie(ee.minimize,!1),actionCN:ie(ee.actionCN,!0),statusCN:ie(ee.statusCN,!0)},isBrowser:!1,isLocalhost:!1}),getters:{icon4k:e=>e.userOptions.scale>=2||window.devicePixelRatio>=2?"_hr1":""},actions:{recheckIsDev(){this.isBrowser=!window.OverlayPluginApi&&!ee.OVERLAY_WS&&!ee.HOST_PORT,this.isLocalhost="localhost"===location.hostname,this.isBrowser&&setTimeout(()=>this.recheckIsDev(),1e3)},formatterName:e=>e,initEnvironment(e){/^[A-Z]\S+ [A-Z]\S+$/.test(e)?(this.userOptions.abbrId&&(this.formatterName=e=>e.replace(/^([A-Z])\S+ ([A-Z])\S+$/,"$1.$2.")),Y("Global")):(this.userOptions.abbrId&&(this.formatterName=e=>e.substring(0,2)),Y("Chinese"))}}});function ie(e,a){return"boolean"==typeof a?"0"!==e&&"false"!==e?.toLocaleLowerCase()&&("1"===e||"true"===e?.toLocaleLowerCase()||a):"number"==typeof a?Number.isNaN(+e)?a:+e:a}function re(e){switch(e){case"dodge":return"闪避";case"damage done":return"击中";case"blocked damage":return"格挡";case"parried damage":return"招架";case"instant death":return"即死";case"heal":return"治疗";case"crit heal":return"暴击治疗";case"damage":return"普通";case"crit damage":return"暴击";case"direct hit damage":return"直击";case"crit direct hit damage":return"直暴";case"physics":return"物理";case"magic":return"魔法";case"darkness":return"暗黑";default:throw new Error("Unknown type")}}function se(e){const a=function(e){switch(!0){case e.endsWith("1"):return"dodge";case e.endsWith("3"):return"damage done";case e.endsWith("5"):return"blocked damage";case e.endsWith("6"):return"parried damage";case e.endsWith("33"):return"instant death";case e.endsWith("4"):return"heal";case/2\w{4}4$/.test(e):return"crit heal";default:throw new Error(`Unknown effect flag ${e}`)}}(e),i=function(e){switch(!0){case/2\w{3}$/.test(e):return"crit damage";case/4\w{3}$/.test(e):return"direct hit damage";case/6\w{3}$/.test(e):return"crit direct hit damage";default:return"damage"}}(e),r=function(e){switch(!0){case/7?[1-4]\w{3}[35]$|[16]$/.test(e):return"physics";case/^E$/.test(e):case/5\w{4}$/.test(e):return"magic";case/^(?:\d0)?3$/.test(e):case/6\w{4}$/.test(e):return"darkness";default:return"physics"}}(e);return{effect:a,properties:i,type:r}}const te=["3E","113","213","313"],ne=["A10","E"],le=["04"],oe=["01","03","05","06","36"];function ce(e){let a=0,i=e[8]??"",r=e[9]??"";te.includes(i)&&(a+=2,i=e[8+a]??i,r=e[8+a+1]??r),ne.includes(i)&&(a+=2,i=e[8+a]??i,r=e[8+a+1]??r);const s=function(e){if(void 0===e)return 0;const a=e.length;if(a<=4)return 0;let i=Number.parseInt(e.slice(0,a-4),16);if("4"===e[a-4]){const r=Number.parseInt(e.slice(a-2,a),16);i=i-r+(r<<16)}return i}(r),t=`00${i}`.slice(-2);return{amount:s,lowByte:t,flags:i,isHeal:le.includes(t),isAttack:oe.includes(t)}}const me={key:0},de={key:1},pe=["title","data-duration","data-sourcePov"],ue=["src","alt"],ye=e({__name:"StatusShow",props:{row:{type:Object,required:!0}},setup(e){const a=e,i=ae().icon4k;return(r,l)=>"dot"===a.row.type?(t(),s("div",me," （不支持） ")):(t(),s("div",de,[(t(!0),s(o,null,c(a.row.keigenns,(a,r)=>(t(),s("span",{key:r},[n("span",{class:"status",title:`${a.name}(${a.source})`,"data-duration":a.remainingDuration,"data-sourcePov":a.isPov},[n("img",{class:p(`statusIcon ${d(q)(a.performance[e.row.type])}`),src:d(H)(`/i/${a.fullIcon}${d(i)}.png`),alt:a.effect,loading:"lazy",onError:l[0]||(l[0]=(...e)=>d(D)&&d(D)(...e))},null,42,ue)],8,pe)]))),128)),n("span",null,m("damage done"===e.row.effect?"":d(re)(e.row.effect)),1)]))}}),fe=e({__name:"AmountDetails",props:{row:{type:Object,required:!0}},setup(e){const a=e;return(e,i)=>(t(),s("div",null,[n("span",null,"来源:"+m(a.row.source),1),i[1]||(i[1]=n("br",null,null,-1)),n("span",null,"目标:"+m(a.row.target),1),i[2]||(i[2]=n("br",null,null,-1)),n("span",null," 护盾:"+m(Math.round(a.row.maxHp*+a.row.shield/100))+" ("+m(a.row.shield)+"%) ",1),i[3]||(i[3]=n("br",null,null,-1)),n("span",null," 血量:"+m(a.row.currentHp)+"/"+m(a.row.maxHp)+" ("+m(Math.round(a.row.currentHp/a.row.maxHp*100))+"%) ",1),i[4]||(i[4]=n("br",null,null,-1)),n("span",null,[i[0]||(i[0]=u("伤害:")),n("span",{class:p(a.row.type)},m(a.row.amount),3)]),i[5]||(i[5]=n("br",null,null,-1)),n("span",null," 剩余:"+m(a.row.currentHp-a.row.amount)+" ("+m(Math.round((a.row.currentHp-a.row.amount)/a.row.maxHp*100))+"%) ",1)]))}}),ge=[Number(409).toString(16).toUpperCase(),Number(810).toString(16).toUpperCase(),Number(811).toString(16).toUpperCase(),Number(1836).toString(16).toUpperCase()];function he(e){return e.currentHp-e.amount<0&&!e.keigenns.find(e=>ge.includes(e.effectId))}const be={class:"amount"},ve=e({__name:"Amount",props:{row:{type:Object,required:!0}},setup(e){const a=e;return(i,r)=>{const s=fe,l=L;return t(),y(l,{"append-to":".wrapper",effect:"dark",placement:"right-start",title:"",trigger:"hover",enterable:!1,"hide-after":0,"popper-class":"my-el-popover"},{reference:f(()=>[n("span",be,[n("span",{class:p(a.row.type)},[n("span",{class:p(""+(d(he)(e.row)?"lethal":""))},m(e.row.amount.toLocaleString().padStart(3,"　")),3)],2)])]),default:f(()=>[g(s,{row:e.row},null,8,["row"])]),_:1})}}}),ke={key:0,class:"target"},we=["src","alt","data-job"],Fe={key:1,class:"alt-text"},Ce=j(e({__name:"Target",props:{row:{type:Object,required:!0}},setup(e){const i=e,r=ae(),n=a(!1);function l(e){n.value=!0;e.target.style.display="none"}return(e,a)=>{return t(),s("div",null,[d(r).userOptions.showIcon?(t(),s("span",ke,[d(n)?(t(),s("span",Fe,m(i.row.target),1)):(t(),s("img",{key:0,class:p(`jobIcon cj${d(r).userOptions.iconType}`),src:(o=i.row.jobIcon,c=d(r).userOptions.iconType,`https://souma.diemoe.net/resources/img/cj${c}/${o.replace(/([A-Z])/g," $1").trim()}.png`??""),alt:i.row.jobIcon,"data-job":d(r).userOptions.showName?"":i.row.job,loading:"lazy",onError:l},null,42,we)),d(r).userOptions.showName?(t(),s("span",{key:2,class:p(`job ${i.row.jobIcon} ${i.row.targetId===i.row.povId?"YOU":""}`),style:b(!d(r).userOptions.abbrId&&d(r).userOptions.showName?{overflow:"hidden",textOverflow:"ellipsis"}:{})},m(i.row.targetId===i.row.povId&&d(r).userOptions.replaceWithYou?"YOU":d(r).userOptions.anonymous?i.row.job:d(r).formatterName(i.row.target)),7)):h("",!0)])):h("",!0)]);var o,c}}}),[["__scopeId","data-v-0e9fa3dd"]]),Ie="function"==typeof structuredClone?structuredClone:e=>{if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e.source,e.flags);if(Array.isArray(e))return e.map(e=>Ie(e));const a=new e.constructor;for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=Ie(e[i]));return a},Ne={key:0},xe={key:0,class:"testLog"},je="souma-keigenn-record-2",$e=e({__name:"keigennRecord2",setup(e){S.setTheme("dark");const r=ae(),l=r.userOptions;r.recheckIsDev();const m=v(()=>l.actionCN?"actionCN":"action"),u=a(l.minimize),j={line_height:28*l.scale,time:35*l.scale,action:65*l.scale,target:((l.showIcon?24:0)+(l.showName?l.anonymous||!l.anonymous&&l.abbrId?24:36:0)+7)*l.scale,amount:44*l.scale},$={"--vxe-font-size-mini":12*l.scale+"px","--vxe-ui-row-line-height":30*l.scale+"px","--vxe-ui-row-height-mini":30*l.scale+"px","--vxe-input-height-mini":20*l.scale+"px","--vxe-select-option-height-mini":24*l.scale+"px","--vxe-ui-layout-background-color":`rgba(12, 12, 12, ${l.opacity})`},A=99,D=3,H=a(!1),L=a(),R=_("keigenn-record-2-pov-name",""),G=_("keigenn-record-2-pov-id",""),U=_("keigenn-record-2-party-list",[]),Z=_("keigenn-record-2-job-map",{}),V=_("keigenn-record-2-party-event-party",[]),Y=a(0),q=a([{zoneName:"",duration:"00:00",table:[],key:"init"}]),K={rsv:/^262\|(?<timestamp>[^|]*)\|[^|]*\|[^|]*\|_rsv_(?<id>\d+)_[^|]+\|(?<real>[^|]*)\|/i,ability:P.ability(),statusEffectExplicit:P.statusEffectExplicit(),gainsEffect:P.gainsEffect(),losesEffect:P.losesEffect(),inCombat:/^260\|(?<timestamp>[^|]*)\|(?<inACTCombat>[^|]*)\|(?<inGameCombat>[^|]*)\|/,changeZone:P.changeZone(),partyList:/^11\|(?<timestamp>[^|]*)\|(?<partyCount>\d*)\|(?<list>(?:\w{8}\|)*)\w{16}/,primaryPlayer:/^02\|(?<timestamp>[^|]*)\|(?<id>[^|]*)\|(?<name>[^|]*)/,addCombatant:P.addedCombatant(),removingCombatant:P.removingCombatant(),networkDoT:P.networkDoT()},ee=a(0),ie=_("souma-keigenn-record-2-zone-name",""),te=_("souma-keigenn-record-2-rsv-data",{}),ne={},le={friendly:{},enemy:{}};function oe(){var e;H.value=!0,ee.value=0,Y.value=0,q.value.length=1,(e=q.value[0]).table.length=0,e.zoneName="",e.duration="00:00",e.key="init"}function me(){ge(),H.value=!1}function de(e){for(const a in K){const i=K[a].exec(e);if(i){const s=e.split("|");switch(a){case"statusEffectExplicit":i.groups?.targetId.startsWith("1")&&(ne[i.groups?.targetId]=i.groups?.currentShield);break;case"gainsEffect":{const e=s[W.GainsEffect.fields.effectId],a=s[W.GainsEffect.fields.effect],i=s[W.GainsEffect.fields.target],r=s[W.GainsEffect.fields.targetId],t=Number.parseInt(s[W.GainsEffect.fields.count],16);let n=J(e);if(!n){const a=r.startsWith("1")&&X.get(Number.parseInt(e,16).toString())||r.startsWith("4")&&Q.get(Number.parseInt(e,16).toString());if(!a)return;const i=E(a.icon),s=t>1?T(i,t):i;n={type:"multiplier",performance:{physics:1,magic:1,darkness:1},id:Number.parseInt(e,16),fullIcon:s,name:a.name,isFriendly:a.isFriendly}}const l=s[W.GainsEffect.fields.duration],o=s[W.GainsEffect.fields.source],c=s[W.GainsEffect.fields.sourceId],m=new Date(s[W.GainsEffect.fields.timestamp]).getTime()+1e3*Number.parseFloat(l),d={name:n.name,count:t,effect:a,effectId:e,source:o,sourceId:c,target:i,targetId:r,expirationTimestamp:m,performance:n.performance,fullIcon:n.fullIcon,isPov:G.value===c};r.startsWith("1")&&n.isFriendly?(void 0===le.friendly[r]&&(le.friendly[r]={}),le.friendly[r][e]=d):r.startsWith("4")&&!n.isFriendly&&(void 0===le.enemy[i]&&(le.enemy[i]={}),le.enemy[i][e]=d)}break;case"losesEffect":{const e=s[W.LosesEffect.fields.target],a=s[W.LosesEffect.fields.targetId],i=s[W.LosesEffect.fields.effectId];a.startsWith("1")?le.friendly[a]&&Reflect.deleteProperty(le.friendly[a],i):le.enemy[e]&&Reflect.deleteProperty(le.enemy[e],i)}break;case"addCombatant":if("00"!==s[W.AddedCombatant.fields.job]){const e=s[W.AddedCombatant.fields.job],a=new Date(s[W.AddedCombatant.fields.timestamp]).getTime();Z.value[s[W.AddedCombatant.fields.id]]={job:Number.parseInt(e,16),timestamp:a}}break;case"removingCombatant":Reflect.deleteProperty(Z.value,s[W.RemovedCombatant.fields.id]);break;case"primaryPlayer":{G.value=s[W.ChangedPlayer.fields.id];const e=s[W.ChangedPlayer.fields.name];if(R.value===e)return;R.value=e,r.initEnvironment(s[W.ChangedPlayer.fields.name]);break}case"partyList":U.value=i.groups?.list?.split("|")??[];break;case"changeZone":ie.value=s[W.ChangeZone.fields.name],fe(new Date(s[W.ChangeZone.fields.timestamp]).getTime());break;case"inCombat":{const e="1"===s[W.InCombat.fields.inACTCombat],a="1"===s[W.InCombat.fields.inGameCombat],i=new Date(s[W.InCombat.fields.timestamp]).getTime();if(e||a){if(ee.value>0)return;return"placeholder"===q.value[0].key&&q.value.splice(0,1),0!==q.value[0].table.length&&(q.value[0]=x(q.value[0]),q.value.unshift({zoneName:"",duration:"00:00",table:[],key:s[W.InCombat.fields.timestamp]}),q.value.length>=A&&q.value.splice(q.value.length-1,1)),ee.value=i,q.value[0].zoneName=ie.value,void(Y.value=0)}if(!e&&!a)return void fe(i)}break;case"rsv":{const e=Number(i.groups?.id),a=s[W.RSVData.fields.value];te.value[Number(e)]=a}break;case"networkDoT":if(!l.parseDoT)return;{const e=s[W.NetworkDoT.fields.which],a=s[W.NetworkDoT.fields.id];if("DoT"!==e||a.startsWith("4")||a!==G.value&&!U.value.includes(a)&&!V.value.find(e=>e.id===a))return;const i=s[W.NetworkDoT.fields.name],r=s[W.NetworkDoT.fields.damage],t=Number.parseInt(r,16),n=new Date(s[W.Ability.fields.timestamp]??"???").getTime(),l=Number(s[W.NetworkDoT.fields.currentHp]),o=Number(s[W.NetworkDoT.fields.maxHp]),c=he(0===ee.value?0:n-ee.value),m=pe(a),d=z.nameToFullName(z.jobEnumToJob(m)).simple2,p=m,u=z.jobEnumToIcon(p);ue({timestamp:n,time:c,id:void 0,action:e,actionCN:e,source:"",target:i,targetId:a,job:d,jobIcon:u,jobEnum:p,amount:t,keigenns:[],currentHp:l,maxHp:o,effect:"damage done",type:"dot",shield:ne[a],povId:G.value})}break;case"ability":if(0===ee.value)return;{const e=ce(s);if(e.isAttack&&e.amount>=0){const a=s[W.Ability.fields.sourceId]??"???",r=s[W.Ability.fields.targetId]??"???";if(!a.startsWith("4")||!r.startsWith("1"))return;if(r!==G.value&&!U.value.includes(r)&&!V.value.find(e=>e.id===r))return;const t=new Date(s[W.Ability.fields.timestamp]??"???").getTime(),n=s[W.Ability.fields.ability],o=n.match(/^_rsv_(?<id>\d+)_/),c=s[W.Ability.fields.id]??"???";let m=n;if(o){const e=Number(o.groups?.id);m=te.value[e]??n.match(/^_(?<id>rsv_\d+)_/)?.groups?.id}else if(m=m.replace(/unknown_.*/,"攻击"),!1===l.parseAA&&/^攻击|攻撃|[Aa]ttack$/.test(m))return;const d=O(Number.parseInt(c,16)),p=d&&""!==d?d:m,u=Number(s[W.Ability.fields.targetCurrentHp])??"???",y=Number(s[W.Ability.fields.targetMaxHp])??"???",f=s[W.Ability.fields.source]??"???",g=s[W.Ability.fields.target]??"???",{effect:h,type:b}=se(e.flags),v=he(0===ee.value?0:t-ee.value),k=pe(r),w=z.nameToFullName(z.jobEnumToJob(k)).simple2,F=k,C=z.jobEnumToIcon(F),I=Ie(Object.values(le.friendly[r]??[]).concat(Object.values(le.enemy[f]??[])).filter(e=>{const a=Math.max(0,(e.expirationTimestamp-t)/1e3);return e.remainingDuration=a>=999?"":a.toFixed(a>.05&&a<.95?1:0),Number(e.remainingDuration)>-3}));ue({timestamp:t,time:v,id:c,action:m,actionCN:p,source:f,target:g,targetId:r,job:w,jobIcon:C,jobEnum:F,amount:e.amount,keigenns:I,currentHp:u,maxHp:y,effect:h,type:b,shield:ne[i.groups?.targetId??""],povId:G.value}),q.value[0].duration=he(new Date(s[W.Ability.fields.timestamp]).getTime()-ee.value)}break}}}}}function pe(e){return[Z.value[e],V.value.find(a=>a.id===e)??{job:0,timestamp:0}].sort((e,a)=>a.timestamp-e.timestamp)[0].job}function ue(e){q.value[0].table.unshift(e)}function fe(e){0!==ee.value&&(q.value[0].duration=he(e-ee.value),ee.value=0,le.friendly={},le.enemy={},ge())}function ge(){localStorage.setItem(je,JSON.stringify(q.value.slice(0,D)))}function he(e){const a=Math.max(Math.floor(e/6e4),0),i=Math.max(Math.floor((e-6e4*a)/1e3),0);return`${a<10?"0":""}${a}:${i<10?"0":""}${i}`}const be=v(()=>{const e=new Set(q.value[Y.value].table.map(e=>l.actionCN?e.actionCN:e.action));return Array.from(e).map(e=>({label:e,value:e}))}),ke=v(()=>{const e={},a=new Set(q.value[Y.value].table.slice().sort((e,a)=>z.enumSortMethod(e.jobEnum,a.jobEnum)).map(a=>(e[a.target]=a.job,a.target)));return Array.from(a).map(a=>({label:`${e[a]}（${a}）`,value:a}))});function we(e){const{actionCN:a,amount:i,job:r,keigenns:s,time:t,type:n}=e,o="damage done"===e.effect?"":`,${re(e.effect)}`,c=`${t} ${r} ${a} ${i.toLocaleString()}(${re(n)}) 减伤:${0===s.length&&""===o?"无":s.map(e=>l.statusCN?e.name:e.effect).join(",")+o} HP:${e.currentHp}/${e.maxHp}(${Math.round(e.currentHp/e.maxHp*100)}%)+盾:${Math.round(e.maxHp*+e.shield/100)}(${e.shield}%)`;var m;m=c,navigator.clipboard.writeText(m).catch(()=>{const e=document.createElement("input");e.value=m,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}),S.modal.message({content:"已复制到剪贴板",status:"success"})}r.isBrowser&&(R.value="测试用户"),""!==R.value&&r.initEnvironment(R.value),i(()=>{for(const e in Z.value){const a=Z.value[e];Date.now()-a.timestamp>864e5&&Reflect.deleteProperty(Z.value,e)}!function(){const e=localStorage.getItem(je);if(e)try{const a=JSON.parse(e);q.value.length=0,q.value.push(...a)}catch(a){}}(),r.isBrowser||"placeholder"===q.value[0].key||q.value.unshift({duration:"00:00",table:[],zoneName:"",key:"placeholder"}),M("LogLine",e=>{de(e.rawLine)}),M("PartyChanged",e=>{V.value=e.party.map(e=>({...e,timestamp:Date.now()}))}),M("ChangePrimaryPlayer",e=>{R.value=e.charName,G.value=Number(e.charID).toString(16).toUpperCase()})});const Fe=a({target:!1,action:!1}),$e=a(),Ee=k({className:"my-menus",body:{options:[]}});function Te(){u.value=!u.value}w(()=>{Ee.body?.options&&L.value&&(Ee.body.options[0]=[{code:"copy",name:"复制详情",prefixIcon:"vxe-icon-copy",className:"my-copy-item"},{code:"clearFilterAction",name:"取消技能筛选",prefixIcon:"vxe-icon-funnel-clear",className:"my-clear-filter",visible:Fe.value.action,disabled:!1},{code:"filterSelectAction",name:$e.value?.[m.value]?`只看 ${$e.value?.[m.value]}`:"只看该技能",prefixIcon:"vxe-icon-info-circle",visible:!Fe.value.action,disabled:!1},{code:"clearFilterTarget",name:"取消玩家筛选",prefixIcon:"vxe-icon-funnel-clear",visible:Fe.value.target,disabled:!1},{code:"filterSelectTarget",name:$e.value?.target?`只看[${$e.value.job}] ${$e.value.target}`:"只看该玩家",prefixIcon:"vxe-icon-user-fill",visible:!Fe.value.target,disabled:!1}])});const Ae=({row:e})=>{const a=L.value;a&&(a.setCurrentRow(e),$e.value=e)},_e=({menu:e,row:a})=>{const i=L.value;switch(e.code){case"copy":if(!a)return void S.modal.message({content:"未选中有效数据行",status:"error"});we(a);break;case"clearFilterTarget":i&&(i.clearFilter(i.getColumnByField("target")),Fe.value.target=!1);break;case"clearFilterAction":i&&(i.clearFilter(i.getColumnByField(m.value)),Fe.value.action=!1);break;case"filterSelectTarget":if(i){const e=i.getColumnByField("target");if(e){const r=e.filters.find(e=>e.value===a.target);if(!r)return;r.checked=!0,i.updateData().then(()=>{i.scrollToRow(a),Fe.value.target=!0})}}break;case"filterSelectAction":if(i){const e=i.getColumnByField(m.value);if(e){const r=e.filters.find(e=>e.value===a[m.value]);if(!r)return;r.checked=!0,i.updateData().then(()=>{i.scrollToRow(a),Fe.value.action=!0})}}}};return(e,a)=>{const i=F("vxe-option"),m=F("vxe-select"),v=F("vxe-button"),k=F("vxe-column"),w=Ce,x=ve,E=ye,T=F("vxe-table"),A=B;return t(),s(o,null,[n("div",{class:p(["wrapper",d(r).isBrowser?"is-browser":"not-browser"]),style:$},[d(l).showHeader?(t(),s("header",Ne,[C(g(m,{modelValue:d(Y),"onUpdate:modelValue":a[0]||(a[0]=e=>N(Y)?Y.value=e:null),size:"mini",class:"select"},{default:f(()=>[(t(!0),s(o,null,c(d(q).length,e=>(t(),y(i,{key:`${d(q)[e-1].key}-${d(q)[e-1].duration}-${d(q)[e-1].zoneName}`,value:e-1,label:`${d(q)[e-1].duration} ${d(q)[e-1].zoneName}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),[[I,!d(u)]]),g(v,{class:p(["minimize",d(u)?"in-minimize":"not-minimize"]),icon:d(u)?"vxe-icon-fullscreen":"vxe-icon-minimize",style:b({opacity:d(u)?.5:1}),onClick:Te},null,8,["class","icon","style"])])):h("",!0),C(n("main",null,[g(T,{ref_key:"xTable",ref:L,size:"mini",class:"vxe-table","show-overflow":"tooltip",round:"",height:"100%","scroll-y":{enabled:!0},loading:d(H),"show-header":d(l).showHeader,data:d(q)[d(Y)].table,"row-config":{isHover:!0},"cell-config":{height:j.line_height},"header-cell-style":{padding:"0px",top:"-0.5em"},"menu-config":d(Ee),onCellMenu:Ae,onMenuClick:_e},{default:f(()=>[g(k,{width:j.time,field:"time",title:"时间",align:"center"},null,8,["width"]),g(k,{width:j.action,field:d(l).actionCN?"actionCN":"action",title:"技能",filters:d(be),"filter-multiple":!1,resizable:!1,align:"center"},null,8,["width","field","filters"]),g(k,{width:j.target,field:"target",title:"目标",filters:d(ke),"filter-multiple":!1,resizable:!d(l).anonymous&&!d(l).abbrId,align:"left","header-align":"center","header-class-name":d(l).showName?"target-name-column-full":"target-name-column-abbr"},{default:f(({row:e})=>[g(w,{row:e},null,8,["row"])]),_:1},8,["width","filters","resizable","header-class-name"]),g(k,{width:j.amount,title:"伤害","header-align":"center"},{default:f(({row:e})=>[g(x,{row:e},null,8,["row"])]),_:1},8,["width"]),g(k,{title:"减伤",align:"left"},{default:f(({row:e})=>[g(E,{row:e},null,8,["row"])]),_:1})]),_:1},8,["loading","show-header","data","cell-config","menu-config"])],512),[[I,!d(u)]])],2),d(r).isBrowser?(t(),s("div",xe,[h("",!0),g(A,{"m-1":"",onBeforeHandle:oe,onAfterHandle:me,onHandleLine:de})])):h("",!0)],64)}}});export{$e as default};
