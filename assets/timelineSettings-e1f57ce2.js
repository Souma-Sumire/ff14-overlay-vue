import"./index-fdde2d6a.js";/* empty css                  *//* empty css                  *//* empty css                */import{u as e,_ as t,p as n}from"./TimelineShow-bde8f448.js";/* empty css                  *//* empty css                 *//* empty css                        */import"./el-tooltip-1f970b29.js";/* empty css                  *//* empty css               *//* empty css                *//* empty css                 *//* empty css                *//* empty css                    *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                        *//* empty css                  *//* empty css                  */import{i as l,D as i,F as a,t as o,G as s,e as c,H as r,f as d,I as u,J as m,K as p,B as f,A as y,n as w,q as g,j as b,L as h,u as v,M as _,d as S,N as x,k as T,l as j,m as F,r as P,s as V,O,P as I,Q as $,b as D,R as M,S as N}from"./element-plus-cb4c922a.js";import{g as A}from"./actionChinese-e2356100.js";import{U as k}from"./util-3591e9ca.js";import{h as R,g as C}from"./xivapi-72ab0990.js";import{t as z,r as B,V as J,e as E,v as U,x as L,M as K,D as G,H,A as W,E as q,J as Q,S as X,u as Y,h as Z,K as ee,L as te,aa as ne,w as le,c as ie,C as ae,f as oe,aw as se,F as ce,O as re,a4 as de}from"./vue-vendor-6f37fd53.js";import{_ as ue}from"./_plugin-vue_export-helper-6a8c15be.js";import{u as me}from"./useWebSocket-c3a2e685.js";import{_ as pe}from"./ThemeToggle-13a9eb97.js";/* empty css                 *//* empty css                   */import{l as fe}from"./lz-string-343805bb.js";import{h as ye}from"./utils-4cf81527.js";import{z as we}from"./zoneInfo-40d5d60a.js";import{c as ge}from"./clipboard-e5e2548c.js";import{a as be,c as he}from"./overlay_plugin_api-974cdd44.js";/* empty css                */import{b as ve,c as _e}from"./index-c9f4301b.js";import"./status-9bc9036c.js";import"./regexes-da03e94d.js";import"./chineseToIcon-e0fcd48d.js";import"./zone_info-e69ac441.js";const Se=new Map;Se.set(26155,{type:"cast",window:[999,999],battleOnce:!0}),Se.set(28027,{type:"cast",window:[999,999],battleOnce:!0}),Se.set(26340,{type:"cast",window:[999,999],battleOnce:!0}),Se.set(25533,{type:"begincast",window:[60,60]}),Se.set(26376,{type:"cast",window:[999,999],battleOnce:!0}),Se.set(26814,{type:"begincast",window:[999,999],battleOnce:!0}),Se.set(25313,{type:"begincast",window:[200,200]}),Se.set(27526,{type:"begincast",window:[999,999],battleOnce:!0}),Se.set(26215,{type:"cast",window:[500,30],battleOnce:!0}),Se.set(29050,{type:"begincast",window:[200,30],battleOnce:!0}),Se.set(29156,{type:"cast",window:[20,20]}),Se.set(27973,{type:"cast",window:[20,20]}),Se.set(27937,{type:"begincast",window:[20,20]}),Se.set(28059,{type:"begincast",window:[20,20]}),Se.set(28060,{type:"begincast",window:[20,20]}),Se.set(28061,{type:"begincast",window:[20,20]}),Se.set(27956,{type:"begincast",window:[20,20]}),Se.set(27957,{type:"begincast",window:[20,20]}),Se.set(27952,{type:"begincast",window:[30,30]}),Se.set(27969,{type:"begincast",window:[20,20]}),Se.set(27971,{type:"begincast",window:[20,20]}),Se.set(27939,{type:"begincast",window:[20,20]}),Se.set(27966,{type:"begincast",window:[20,20]}),Se.set(25316,{type:"begincast",window:[999,999],battleOnce:!0}),Se.set(25544,{type:"begincast",window:[10,10]}),Se.set(26379,{type:"begincast",window:[10,10]}),Se.set(31552,{type:"begincast",window:[30,30]}),Se.set(31573,{type:"begincast",window:[30,30]}),Se.set(31573,{type:"begincast",window:[30,30]}),Se.set(31617,{type:"begincast",window:[8,8]}),Se.set(31624,{type:"begincast",window:[30,30]}),Se.set(31649,{type:"begincast",window:[30,30]}),Se.set(18864,{type:"cast",window:[10,2.5],syncOnce:!0}),Se.set(18480,{type:"cast",window:[200,60],syncOnce:!0,battleOnce:!0}),Se.set(18516,{type:"cast",window:[250,65],syncOnce:!0,battleOnce:!0}),Se.set(18522,{type:"begincast",window:[500,500],syncOnce:!0,battleOnce:!0}),Se.set(18552,{type:"begincast",window:[67,67],syncOnce:!0}),Se.set(18553,{type:"cast",window:[67,67],syncOnce:!0}),Se.set(19083,{type:"cast",window:[900,200],syncOnce:!0,battleOnce:!0}),Se.set(40191,{type:"begincast",window:[200,20],syncOnce:!0}),Se.set(40265,{type:"begincast",window:[500,20],syncOnce:!0,battleOnce:!0}),Se.set(40246,{type:"begincast",window:[999,30],syncOnce:!0,battleOnce:!0}),Se.set(40306,{type:"begincast",window:[30,30],syncOnce:!0}),Se.set(11103,{type:"begincast",window:[310,30],syncOnce:!0,battleOnce:!0}),Se.set(11517,{type:"begincast",window:[600,30],syncOnce:!0,battleOnce:!0}),Se.set(11122,{type:"begincast",window:[100,30],syncOnce:!0,battleOnce:!0}),Se.set(11143,{type:"begincast",window:[60,60],syncOnce:!0}),Se.set(11126,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),Se.set(11596,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),Se.set(11597,{type:"begincast",window:[100,100],syncOnce:!0,battleOnce:!0}),Se.set(42785,{type:"begincast",window:[9.6,2],syncOnce:!0}),Se.set(42838,{type:"cast",window:[77.2,30],syncOnce:!0,battleOnce:!0}),Se.set(42863,{type:"cast",window:[30,30],syncOnce:!1}),Se.set(42787,{type:"cast",window:[30,30],syncOnce:!1}),Se.set(42864,{type:"cast",window:[30,30],syncOnce:!1}),Se.set(41946,{type:"begincast",window:[10,10],syncOnce:!1}),Se.set(41936,{type:"begincast",window:[20,30],syncOnce:!0}),Se.set(41939,{type:"begincast",window:[20,20],syncOnce:!0}),Se.set(42825,{type:"begincast",window:[60,60],syncOnce:!0,battleOnce:!0}),Se.set(41969,{type:"begincast",window:[20,20],syncOnce:!0}),Se.set(41871,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0}),Se.set(43053,{type:"cast",window:[60,60],syncOnce:!0,battleOnce:!0});class xe{storageKey;maxSize;cleanupRatio;constructor(e){this.storageKey=e?.key??"cache:all",this.maxSize=e?.maxSize??2097152,this.cleanupRatio=e?.cleanupRatio??.25}loadAll(){try{const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):{}}catch{return{}}}saveAll(e){try{localStorage.setItem(this.storageKey,JSON.stringify(e))}catch{this.cleanupOldEntries(e);try{localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(t){}}}getTotalSize(e){return new Blob([JSON.stringify(e)]).size}cleanupOldEntries(e){const t=Object.entries(e),n=t.map(([e,t])=>({key:e,expire:t?.expire??0}));n.sort((e,t)=>e.expire-t.expire);const l=Math.ceil(t.length*this.cleanupRatio);for(let i=0;i<l;i++)delete e[n[i].key]}set(e,t,n=2592e5){const l=this.loadAll();l[e]={data:t,expire:Date.now()+n},this.getTotalSize(l)>this.maxSize&&this.cleanupOldEntries(l),this.saveAll(l)}get(e){const t=this.loadAll(),n=t[e];return n?n.expire<Date.now()?(delete t[e],this.saveAll(t),null):n.data:null}clearExpired(){const e=this.loadAll(),t=Date.now();let n=!1;for(const l in e)(!e[l].expire||e[l].expire<t)&&(delete e[l],n=!0);n&&this.saveAll(e)}clearAll(){localStorage.removeItem(this.storageKey)}}const Te={class:"query-results"},je={class:"ability-filter-container"},Fe={key:0,class:"loading-abilities"},Pe=["src","alt","onerror"],Ve=ue(z({__name:"FflogsImport",props:{filters:{}},emits:["showFFlogsToggle","editTimeline"],setup(t,{emit:n}){const h=t,v=n,_=new RegExp("(?<=^|\\/)(?<code>(?:a:)?\\w{16,})[#?]fight=(?<fight>\\d+|last)"),S=B("查询"),x=B(""),T=B(!1),j=B(!1),F=B(0),P=B(!1),V=J({});le();const O=e(),I=new xe({key:"souma-fflogs-cache",maxSize:2097152,cleanupRatio:.25});function $(e){const t=I.get(e);if(!t)return null;try{return JSON.parse(t)}catch{return null}}function D(e,t,n=2592e5){const l={data:t,expire:Date.now()+n};I.set(e,JSON.stringify(l),n)}function M(e){return e&&e.expire>Date.now()}async function N(e){j.value=!0,F.value=2,V.player=e;try{await async function(){P.value=!1;const e=[];async function t(n){try{const l=`events:friendly:${V.code}:${n}:${V.player?.id}`,i=$(l);let a;i&&M(i)?a=i.data:(a=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${V.code}?start=${n}&end=${V.end}&hostility=0&sourceid=${V.player?.id}&api_key=${O.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),D(l,a)),e.push(...a.events),a.nextPageTimestamp&&a.nextPageTimestamp>0&&a.nextPageTimestamp<V.end&&await t(a.nextPageTimestamp)}catch(l){b.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${l}`,"获取友方技能数据失败",{confirmButtonText:"确定",type:"error"})}}async function n(t,l){if(l>=0)try{const i=`events:enemy:${V.code}:${t}:${V.bossIDs[l]}`,a=$(i);let o;a&&M(a)?o=a.data:(o=await fetch(`https://cn.fflogs.com/v1/report/events/casts/${V.code}?start=${t}&end=${V.end}&hostility=1&sourceid=${V.bossIDs[l]}&api_key=${O.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),D(i,o)),e.push(...o.events),o.nextPageTimestamp&&o.nextPageTimestamp>0&&o.nextPageTimestamp<V.end&&await n(o.nextPageTimestamp,l),l<V.bossIDs.length-1&&await n(t,l+1)}catch(i){b.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${i}`,"获取敌方技能数据失败",{confirmButtonText:"确定",type:"error"})}}V.abilityFilterEvents.length=0,await Promise.all([t(V.start),n(V.start,0)]);for(const l of e)"begincast"===l.type&&l.sourceIsFriendly||V.abilityFilterEvents.push({time:Number(((l.timestamp-V.start)/1e3).toFixed(1)),type:l.type,actionName:A(l.ability.guid)??l.ability.name,actionId:l.ability.guid,sourceIsFriendly:l.sourceIsFriendly,url:l?.ability?.abilityIcon.replace("-","/").replace(".png","")??"000000/000405",window:void 0,sourceID:l.sourceID});V.player?.icon&&h.filters[V.player.icon]&&(V.abilityFilterSelected=h.filters[V.player.icon]);P.value=!0}(),V.abilityFilterCandidate=V.abilityFilterEvents.reduce((e,t)=>(t.sourceIsFriendly&&!e.find(e=>e.actionId===t.actionId)&&e.push(t),e),[]),j.value=!1}catch(t){b.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${t}`,"获取玩家技能数据失败",{confirmButtonText:"确定",type:"error"}),j.value=!1}}function z(){j.value=!0,F.value=3,V.player?.icon&&O.updateFilters(V.player?.icon,JSON.parse(JSON.stringify(V.abilityFilterSelected))),V.abilityFilterEvents=V.abilityFilterEvents.filter(e=>e.sourceIsFriendly&&V.abilityFilterSelected.includes(e.actionId)||!e.sourceIsFriendly).sort((e,t)=>e.time-t.time),V.abilityFilterEvents=function(e){for(const t of e){const e=Se.get(t.actionId);e?.type===t.type&&(t.window=e?.window,t.syncOnce=Boolean(e?.syncOnce),t.battleOnce=Boolean(e?.battleOnce))}return e}(V.abilityFilterEvents),V.abilityFilterEventsAfterFilterRawTimeline=V.abilityFilterEvents.map(e=>{const{time:t,actionName:n,actionId:l,type:i,sourceID:a,window:o,sourceIsFriendly:s,syncOnce:c,battleOnce:r}=e;if(s)return`${t} "<${n}>~"${T.value?` tts "${n}"`:""}`;if(/^(?:攻击|attack|攻撃)$/i.test(n)&&!o||"cast"===i&&!o||V.battleSyncedIDs.includes(l))return`# ${t} "${n}"`;const d=V.enemies.find(e=>e.id===a);if(("NPC"===d?.type||/unknown/.test(n))&&!o)return null;const u=`${t} "${n}" ${"begincast"===i?"StartsUsing":"Ability"} { id: "${l.toString(16).toUpperCase()}" }`;return r&&o&&V.battleSyncedIDs.push(l),o?`${u} window ${o.join(",")} ${c?"once":""}`:`# ${u}`}).filter(e=>null!==e).join("\n");const e=O.newTimeline(`导入${V.player?.name}`,{zoneId:V.zoneID.toString(),jobs:[V.player?.icon??"NONE"]},V.abilityFilterEventsAfterFilterRawTimeline,`${V.code}#fight=${V.fightIndex+1}`);le(),v("showFFlogsToggle"),v("editTimeline",O.allTimelines[e]),setTimeout(()=>{F.value=0},500),j.value=!1}function le(){V.code="",V.fightIndex=0,V.start=0,V.end=0,V.friendlies=[],V.abilityFilterEvents=[],V.abilityFilterCandidate=[],V.abilityFilterSelected=[],V.abilityFilterEventsAfterFilterRawTimeline="",V.player=void 0,V.zoneID=0,V.bossIDs=[],V.enemies=[],V.battleSyncedIDs=[]}function ie(){window.open("https://cn.fflogs.com/profile","_blank")}return E(()=>{I.clearExpired()}),(e,t)=>{const n=l,h=i,v=a,I=c,A=s,B=r,J=d,E=u,ae=p,oe=o,se=f,ce=y,re=g,de=w;return L(),U(te,null,[K(n,{style:X(Y(F)>0?{}:{visibility:"hidden",pointerEvent:"none"}),type:"primary",text:"","position-absolute":"","z-999":"",class:"guide",onClick:t[0]||(t[0]=e=>F.value--)},{default:q(()=>t[6]||(t[6]=[Q(" 上一步 ",-1)])),_:1,__:[6]},8,["style"]),K(v,{active:Y(F),class:"steps-guide","align-center":""},{default:q(()=>[K(h,{title:"输入链接"}),K(h,{title:"选择玩家"}),K(h,{title:"过滤技能"})]),_:1},8,["active"]),0===Y(F)?(L(),G(oe,{key:0,class:"input-section"},{default:q(()=>[K(ae,{"label-width":"150px",class:"fflogs-form"},{default:q(()=>[K(A,{label:"FF Logs 战斗链接"},{default:q(()=>[K(I,{modelValue:Y(x),"onUpdate:modelValue":t[1]||(t[1]=e=>Z(x)?x.value=e:null),placeholder:"https://www.fflogs.com/reports/AAAaAaAAaa1aA1aA?fight=1",autocomplete:"on"},null,8,["modelValue"])]),_:1}),K(A,{label:"FF logs V1 Key"},{default:q(()=>[K(I,{modelValue:Y(O).settings.api,"onUpdate:modelValue":t[2]||(t[2]=e=>Y(O).settings.api=e),placeholder:"在 FF Logs 个人设置页面获取 V1 API Key",type:"password","show-password":""},{append:q(()=>[K(B,{content:"点击前往 FF Logs 个人设置页面，在最下方填写 V1客户名称 并点击确认后，再获取你的 V1 客户端密钥",placement:"top",effect:"light"},{default:q(()=>[K(n,{type:"primary",link:"",onClick:ie},{default:q(()=>t[7]||(t[7]=[Q(" 如何获取 ",-1)])),_:1,__:[7]})]),_:1})]),_:1},8,["modelValue"])]),_:1}),K(A,{label:"使用 TTS"},{default:q(()=>[K(J,{modelValue:Y(T),"onUpdate:modelValue":t[3]||(t[3]=e=>Z(T)?T.value=e:null)},null,8,["modelValue"])]),_:1}),K(A,null,{default:q(()=>[K(n,{disabled:"正在查询..."===Y(S),type:"primary",onClick:t[4]||(t[4]=e=>async function(e){j.value=!0,le(),S.value="正在查询...";const t=e.match(_);if(!O.settings.api)return b.alert("请在FF Logs个人设置页面获取V1 API Key","FF logs API Key 未填写",{confirmButtonText:"确定",type:"error",dangerouslyUseHTMLString:!0,message:'<a href="https://cn.fflogs.com/profile">点击这里，在最下方<strong>填写 V1 客户名称并点击确认</strong>后，获取你的 V1 客户端密钥</a>'}),S.value="查询",void(j.value=!1);if(!t)return b.alert("请正确填写FF Logs链接","FF Logs链接格式错误",{confirmButtonText:"确定",type:"error"}),S.value="查询",void(j.value=!1);V.code=t.groups?.code??"";try{const e=`fights:${V.code}`,n=$(e);let l;n&&M(n)?l=n.data:(l=await fetch(`https://cn.fflogs.com/v1/report/fights/${V.code}?api_key=${O.settings.api}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}),D(e,l)),V.bossIDs=l.enemies.filter(e=>["Boss","NPC"].includes(e.type)).map(e=>e.id),V.enemies=l.enemies.slice(),V.fightIndex=("last"===t?.groups?.fight?l.fights.length:Number.parseInt(t?.groups?.fight??"0"))-1;const i=l.fights[V.fightIndex];V.zoneID=i.zoneID,V.start=i.start_time,V.end=i.end_time,V.friendlies=l.friendlies.filter(e=>"LimitBreak"!==e.icon&&e.fights.find(e=>e.id===V.fightIndex+1)),S.value="查询",V.abilityFilterEvents.length=0,V.abilityFilterCandidate.length=0,j.value=!1,F.value=1}catch(n){b.alert(`\n  <h3 style="margin-bottom: 10px;">可能的原因：</h3>\n  <ul style="padding-left: 20px; margin-bottom: 10px;">\n    <li> <strong>90%概率</strong>：你没有<strong style="color: red;">先起名</strong>再获取 V1 客户端密钥</li>\n    <li> <strong>5%概率</strong>：该战斗记录是私人或匿名模式</li>\n    <li> <strong>5%概率</strong>：网络异常</li>\n  </ul>\n<p class="error-details"><strong>错误：</strong>${n}</p>\n`,"请求失败",{confirmButtonText:"确定",type:"error",dangerouslyUseHTMLString:!0}),S.value="查询",j.value=!1}}(Y(x)))},{default:q(()=>[Y(j)?(L(),G(E,{key:0,class:"is-loading"},{default:q(()=>[K(Y(m))]),_:1})):H("",!0),Q(" "+ee(Y(S)),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})):H("",!0),W("div",Te,[1===Y(F)?(L(),G(oe,{key:0,class:"player-selection"},{default:q(()=>[K(ce,{data:Y(V).friendlies.filter(e=>!["NPC"].includes(e.icon)),stripe:"",border:"",class:"friendlies-table"},{default:q(()=>[K(se,{prop:"name",label:"玩家名称"}),K(se,{label:"职业"},{default:q(({row:e})=>[Q(ee(Y(k).jobToFullName(Y(k).jobEnumToJob(Y(k).iconToJobEnum(e.icon))).cn),1)]),_:1}),K(se,{label:"选定",width:"100",align:"center"},{default:q(e=>[K(n,{type:"primary",size:"small",onClick:t=>N(e.row)},{default:q(()=>t[8]||(t[8]=[Q(" 选择 ",-1)])),_:2,__:[8]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):H("",!0),2===Y(F)?(L(),G(oe,{key:1,class:"ability-filter"},{default:q(()=>[W("div",je,[Y(P)?H("",!0):(L(),U("div",Fe,[K(E,{class:"is-loading"},{default:q(()=>[K(Y(m))]),_:1}),t[9]||(t[9]=W("span",null,"正在加载技能列表...",-1))])),Y(P)?(L(),G(de,{key:1,modelValue:Y(V).abilityFilterSelected,"onUpdate:modelValue":t[5]||(t[5]=e=>Y(V).abilityFilterSelected=e),multiple:"",placeholder:"选择需要导入的技能","fit-input-width":!0,class:"ability-filter-select"},{default:q(()=>[(L(!0),U(te,null,ne(Y(V).abilityFilterCandidate,e=>(L(),G(re,{key:e.actionId,value:e.actionId,label:e.actionName,class:"ability-filter-option"},{default:q(()=>[W("img",{src:Y(C)(`/i/${e.url}.png`),class:"ability-filter-icon",alt:e.actionName,onerror:Y(R)},null,8,Pe),W("span",null,ee(e.actionName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])):H("",!0),Y(P)?(L(),G(n,{key:2,type:"success",class:"filter-confirm-btn",disabled:!Y(P),onClick:z},{default:q(()=>t[10]||(t[10]=[Q(ee("生成时间轴"),-1)])),_:1,__:[10]},8,["disabled"])):H("",!0)])]),_:1})):H("",!0)])],64)}}}),[["__scopeId","data-v-7863b3d0"]]),Oe=ue(z({__name:"SettingsDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(n,{emit:l}){const i=n,a=l,o=e();le(()=>{o.saveTimelineSettings()});const c=ie({get:()=>i.modelValue,set:e=>a("update:modelValue",e)}),r=B(-15),d=B([{time:-15,action:"<圣光幕帘>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:-2,action:"<圣灵>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:0,action:"战斗开始！",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:3,action:"<挑衅>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1},{time:5,action:"<神圣领域>~",show:!0,windowBefore:0,windowAfter:0,alertAlready:!1}]);return(e,n)=>{const l=S,i=s,a=_,u=v,m=x,f=t,y=p,w=h;return L(),G(w,{modelValue:Y(c),"onUpdate:modelValue":n[1]||(n[1]=e=>Z(c)?c.value=e:null),modal:!0,overflow:"","close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"timeline-dialog",width:"600px","append-to-body":!0,draggable:!0},{header:q(()=>n[2]||(n[2]=[W("h3",{style:{margin:"0",padding:"10px","background-color":"#f5f7fa",cursor:"move"}}," 设置 ",-1)])),default:q(()=>[K(y,{"label-position":"right","label-width":"120px",class:"timeline-form"},{default:q(()=>[n[3]||(n[3]=W("h3",{class:"form-section-title"}," 参数 ",-1)),K(u,{gutter:20},{default:q(()=>[(L(!0),U(te,null,ne(Y(o).configValues,(e,t,n)=>(L(),G(a,{key:n,span:12},{default:q(()=>[K(i,{label:Y(o).configTranslate[t]},{default:q(()=>[K(l,{modelValue:Y(o).configValues[t],"onUpdate:modelValue":e=>Y(o).configValues[t]=e,min:0,step:.1,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),n[4]||(n[4]=W("h3",{class:"form-section-title"}," 样式 ",-1)),K(u,{gutter:20},{default:q(()=>[(L(!0),U(te,null,ne(Y(o).showStyle,(e,t,n)=>(L(),G(a,{key:n,span:12},{default:q(()=>[K(i,{label:Y(o).showStyleTranslate[t]},{default:q(()=>[K(l,{modelValue:Y(o).showStyle[t],"onUpdate:modelValue":e=>Y(o).showStyle[t]=e,min:0,step:.01,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),n[5]||(n[5]=W("h3",{class:"form-section-title"}," 测试用例 ",-1)),K(u,{gutter:20},{default:q(()=>[K(m,{modelValue:Y(r),"onUpdate:modelValue":n[0]||(n[0]=e=>Z(r)?r.value=e:null),min:-15,max:5,step:.1,"show-input":""},null,8,["modelValue"]),K(f,{config:Y(o).configValues,lines:Y(d),runtime:Y(r),"show-style":Y(o).showStyle},null,8,["config","lines","runtime","show-style"])]),_:1})]),_:1,__:[3,4,5]})]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-fcf4e153"]]),Ie=JSON.parse('[{"name":"SPJP(mmw/xivstrat) M5S D1","condition":{"zoneId":"1257","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"01:02 \\"<牵制>~\\"\\n03:57 \\"<牵制>~\\"\\n05:54 \\"<牵制>~\\"\\n09:18 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M5S D2","condition":{"zoneId":"1257","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"00:55 \\"<牵制>~\\"\\n02:33 \\"<牵制>~\\"\\n04:38 \\"<牵制>~\\"\\n06:22 \\"<牵制>~\\"\\n09:09 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M5S D3","condition":{"zoneId":"1257","jobs":["BRD","DNC","MCH"]},"timeline":"01:02 \\"<行吟>~\\"\\n03:57 \\"<行吟>~\\"\\n05:54 \\"<行吟>~\\"\\n09:18 \\"<行吟>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M5S D4","condition":{"zoneId":"1257","jobs":["RDM","BLM","SMN","PCT"]},"timeline":"01:02 \\"<昏乱>~\\"\\n03:57 \\"<昏乱>~\\"\\n05:54 \\"<昏乱>~\\"\\n09:18 \\"<昏乱>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M5S MT","condition":{"zoneId":"1257","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"01:02 \\"<雪仇>~\\"\\n02:05 \\"<雪仇>~\\"\\n04:38 \\"<雪仇>~\\"\\n05:54 \\"<雪仇>~\\"\\n07:57 \\"<雪仇>~\\"\\n09:18 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:33:41"},{"name":"SPJP(mmw/xivstrat) M5S ST","condition":{"zoneId":"1257","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"00:55 \\"<雪仇>~\\"\\n01:58 \\"<雪仇>~\\"\\n03:57 \\"<雪仇>~\\"\\n05:12 \\"<雪仇>~\\"\\n06:22 \\"<雪仇>~\\"\\n08:49 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:14"},{"name":"SPJP(mmw/xivstrat) M6S D1","condition":{"zoneId":"1259","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"00:05 \\"<牵制>~\\"\\n03:08 \\"<牵制>~\\"\\n05:02 \\"<牵制>~\\"\\n06:49 \\"<牵制>~\\"\\n09:56 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M6S D2","condition":{"zoneId":"1259","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"00:52 \\"<牵制>~\\"\\n02:25 \\"<牵制>~\\"\\n04:56 \\"<牵制>~\\"\\n06:27 \\"<牵制>~\\"\\n08:34 \\"<牵制>~\\"\\n10:08 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M6S D3","condition":{"zoneId":"1259","jobs":["BRD","DNC","MCH"]},"timeline":"00:52 \\"<行吟>~\\"\\n02:25 \\"<行吟>~\\"\\n04:56 \\"<行吟>~\\"\\n06:27 \\"<行吟>~\\"\\n08:34 \\"<行吟>~\\"\\n10:08 \\"<行吟>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M6S D4","condition":{"zoneId":"1259","jobs":["RDM","BLM","SMN","PCT"]},"timeline":"00:05 \\"<昏乱>~\\"\\n03:08 \\"<昏乱>~\\"\\n05:02 \\"<昏乱>~\\"\\n06:49 \\"<昏乱>~\\"\\n09:56 \\"<昏乱>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M6S MT","condition":{"zoneId":"1259","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"00:05 \\"<雪仇>~\\"\\n01:06 \\"<雪仇>~\\"\\n02:07 \\"<雪仇>~\\"\\n03:08 \\"<雪仇>~\\"\\n05:02 \\"<雪仇>~\\"\\n06:25 \\"<雪仇>~\\"\\n07:29 \\"<雪仇>~\\"\\n08:34 \\"<雪仇>~\\"\\n09:56 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:33:41"},{"name":"SPJP(mmw/xivstrat) M6S ST","condition":{"zoneId":"1259","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"00:52 \\"<雪仇>~\\"\\n02:25 \\"<雪仇>~\\"\\n06:49 \\"<雪仇>~\\"\\n09:07 \\"<雪仇>~\\"\\n10:08 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:14"},{"name":"SPJP(mmw/xivstrat) M7S D1","condition":{"zoneId":"1261","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"0:05 \\"<牵制>~\\"\\n2:23 \\"<牵制>~\\"\\n4:38 \\"<牵制>~\\"\\n6:17 \\"<牵制>~\\"\\n9:07 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M7S D2","condition":{"zoneId":"1261","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"0:52 \\"<牵制>~\\"\\n3:04 \\"<牵制>~\\"\\n5:30 \\"<牵制>~\\"\\n7:18 \\"<牵制>~\\"\\n8:56 \\"<牵制>~\\"\\n10:35 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M7S D3","condition":{"zoneId":"1261","jobs":["BRD","DNC","MCH"]},"timeline":"0:05 \\"<行吟>~\\"\\n1:36 \\"<行吟>~\\"\\n3:29 \\"<行吟>~\\"\\n5:38 \\"<行吟>~\\"\\n7:18 \\"<行吟>~\\"\\n8:56 \\"<行吟>~\\"\\n10:35 \\"<行吟>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M7S D4","condition":{"zoneId":"1261","jobs":["RDM","BLM","SMN","PCT"]},"timeline":"0:05 \\"<昏乱>~\\"\\n1:36 \\"<昏乱>~\\"\\n3:07 \\"<昏乱>~\\"\\n4:38 \\"<昏乱>~\\"\\n6:17 \\"<昏乱>~\\"\\n9:07 \\"<昏乱>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M7S MT","condition":{"zoneId":"1261","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"0:05 \\"<雪仇>~\\"\\n2:01 \\"<雪仇>~\\"\\n3:04 \\"<雪仇>~\\"\\n4:06 \\"<雪仇>~\\"\\n5:07 \\"<雪仇>~\\"\\n6:17 \\"<雪仇>~\\"\\n7:18 \\"<雪仇>~\\"\\n9:07 \\"<雪仇>~\\"\\n10:35 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:33:41"},{"name":"SPJP(mmw/xivstrat) M7S ST","condition":{"zoneId":"1261","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"0:52 \\"<雪仇>~\\"\\n2:23 \\"<雪仇>~\\"\\n3:29 \\"<雪仇>~\\"\\n4:30 \\"<雪仇>~\\"\\n5:38 \\"<雪仇>~\\"\\n6:42 \\"<雪仇>~\\"\\n8:56 \\"<雪仇>~\\"\\n10:08 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:14"},{"name":"SPJP(mmw/xivstrat) M8S D1","condition":{"zoneId":"1263","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"00:40.0 \\"<牵制>~\\"\\n02:42.0 \\"<牵制>~\\"\\n04:13.0 \\"<牵制>~\\"\\n06:18.0 \\"<牵制>~\\"\\n06:49.2 \\"--sync--\\" Ability { id: \\"A82D\\" } window 60,60 once\\n08:29.0 \\"<牵制>~\\"\\n10:40.0 \\"<牵制>~\\"\\n12:20.0 \\"<牵制>~\\"\\n13:50.0 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M8S D2","condition":{"zoneId":"1263","jobs":["MNK","DRG","NIN","SAM","RPR","VPR"]},"timeline":"00:03.0 \\"<牵制>~\\"\\n01:41.0 \\"<牵制>~\\"\\n05:01.0 \\"<牵制>~\\"\\n06:49.2 \\"--sync--\\" Ability { id: \\"A82D\\" } window 60,60 once\\n07:44.0 \\"<牵制>~\\"\\n09:30.0 \\"<牵制>~\\"\\n13:41.0 \\"<牵制>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M8S D3","condition":{"zoneId":"1263","jobs":["BRD","DNC","MCH"]},"timeline":"00:03.0 \\"<行吟>~\\"\\n01:41.0 \\"<行吟>~\\"\\n03:18.0 \\"<行吟>~\\"\\n06:18.0 \\"<行吟>~\\"\\n06:49.2 \\"--sync--\\" Ability { id: \\"A82D\\" } window 60,60 once\\n08:29.0 \\"<行吟>~\\"\\n10:40.0 \\"<行吟>~\\"\\n13:41.0 \\"<行吟>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M8S D4","condition":{"zoneId":"1263","jobs":["RDM","BLM","SMN","PCT"]},"timeline":"00:40.0 \\"<昏乱>~\\"\\n02:42.0 \\"<昏乱>~\\"\\n04:13.0 \\"<昏乱>~\\"\\n06:18.0 \\"<昏乱>~\\"\\n06:49.2 \\"--sync--\\" Ability { id: \\"A82D\\" } window 60,60 once\\n08:29.0 \\"<昏乱>~\\"\\n10:40.0 \\"<昏乱>~\\"\\n12:20.0 \\"<昏乱>~\\"\\n13:50.0 \\"<昏乱>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:54"},{"name":"SPJP(mmw/xivstrat) M8S MT","condition":{"zoneId":"1263","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"00:03.0 \\"<雪仇>~\\"\\n01:04.0 \\"<雪仇>~\\"\\n02:16.0 \\"<雪仇>~\\"\\n04:09.0 \\"<雪仇>~\\"\\n05:57.0 \\"<雪仇>~\\"\\n06:49.2 \\"--sync--\\" Ability { id: \\"A82D\\" } window 60,60 once\\n07:44.0 \\"<雪仇>~\\"\\n09:00.0 \\"<雪仇>~\\"\\n10:40.0 \\"<雪仇>~\\"\\n12:22.0 \\"<雪仇>~\\"\\n13:42.0 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:33:41"},{"name":"SPJP(mmw/xivstrat) M8S ST","condition":{"zoneId":"1263","jobs":["PLD","WAR","DRK","GNB"]},"timeline":"00:15.0 \\"<雪仇>~\\"\\n01:41.0 \\"<雪仇>~\\"\\n02:42.0 \\"<雪仇>~\\"\\n05:01.0 \\"<雪仇>~\\"\\n06:18.0 \\"<雪仇>~\\"\\n06:49.2 \\"--sync--\\" Ability { id: \\"A82D\\" } window 60,60 once\\n08:29.0 \\"<雪仇>~\\"\\n09:30.0 \\"<雪仇>~\\"\\n10:58.0 \\"<雪仇>~\\"\\n12:05.0 \\"<雪仇>~\\"\\n13:23.0 \\"<雪仇>~\\"","codeFight":"用户创建","create":"2025/7/8 08:36:14"}]'),$e={class:"batch-operations",style:{"margin-bottom":"15px",display:"flex","flex-wrap":"wrap","justify-content":"space-between",gap:"10px"}},De={style:{display:"flex",gap:"10px","flex-wrap":"wrap"}},Me={class:"editor-dialog-content"},Ne={class:"slider-demo-block"},Ae={class:"time-display",style:{width:"80px","text-align":"center"}},ke={class:"time-display-text"},Re={class:"time-display-text"},Ce={style:{"margin-top":"1em"}},ze=ue(z({__name:"timelineSettings",setup(i){const a=se(),{wsConnected:r}=me({allowClose:!0,addWsParam:!0}),d=e(),u=ae(d,"allTimelines"),m=ae(d,"filters"),p=B(0),S=B([]),A=B(!1),R=B(!1),C=B(!1),z=B(!1),J=B(!1);let H,le;const ue=ve("timelineCurrentlyEditing",{name:"空",condition:{zoneId:"0",jobs:["NONE"]},timeline:"空",codeFight:"空",create:"空"}),Se=B([]),xe=[{id:"0",name:"任意"}];let Te=null,je=!1;const Fe=B(""),Pe=B(""),ze=B("");let Be;const Je=ie(()=>u.value.filter(e=>{const t=e.name.toLowerCase().includes(Fe.value.toLowerCase()),n=!Pe.value||e.condition.zoneId===Pe.value,l=!ze.value||e.condition.jobs.includes(ze.value);return t&&n&&l})),Ee=ie(()=>{const e=p.value,t=e<0,n=Math.abs(Math.floor(e)),l=Math.floor(n/60),i=n%60;return`${t?"-":""}${String(l).padStart(2,"0")}:${String(i).padStart(2,"0")}`}),Ue=B(0);function Le(e){ue.value=e,R.value=!0,He()}function Ke(){R.value=!1}function Ge(){Le(d.allTimelines[d.newTimeline()])}function He(){Se.value=[{time:0,action:"正在加载...",show:!0,windowBefore:0,windowAfter:0,alertAlready:!0}],n(ue.value.timeline).then(e=>{Se.value=e;const t=Math.max(...Se.value.map(e=>e.time),550);Ue.value=t+30,p.value=-d.configValues.preBattle})}function We(){if(0===S.value.length)return void D.warning("请选择要删除的时间轴");const e=S.value.map(e=>`「${e.name}」`).join("<br/>");b.confirm(`确定要删除选中的 ${S.value.length} 个时间轴吗？<br>${e}`,"批量删除时间轴",{confirmButtonText:"确认删除",cancelButtonText:"取消",dangerouslyUseHTMLString:!0,type:"warning"}).then(()=>{D.success(`成功删除 ${S.value.length} 个时间轴`),u.value=u.value.filter(e=>!S.value.includes(e)),S.value=[],A.value=!1}).catch(()=>{})}function qe(){A.value=!A.value,S.value=A.value?[...u.value]:[]}function Qe(){0!==S.value.length?Xe(S.value):D.warning("请选择要导出的时间轴")}function Xe(e){const t=JSON.stringify(e),n=JSON.parse(t);for(const r of n)r.timeline=r.timeline.replace(/^#.*(?:\n|$)/gm,"");const l=JSON.stringify(n),i=fe.compressToBase64(t),a=fe.compressToBase64(l),o=i.length,s=a.length;if(o===s)return void st(i,"数据复制成功，已写入剪切板。","复制失败，请手动复制！");const c=((o-s)/o*100).toFixed(2);b.confirm(`\n     1. 完整版本（包含注释）<br>\n     &nbsp;&nbsp;&nbsp;- 大小：${o} 字节<br>\n     &nbsp;&nbsp;&nbsp;- 包含所有时间轴信息和注释<br><br>\n     2. 优化版本（不含注释）<br>\n     &nbsp;&nbsp;&nbsp;- 大小：${s} 字节<br>\n     &nbsp;&nbsp;&nbsp;- 节省 ${c}% 的空间<br>\n     &nbsp;&nbsp;&nbsp;- 仅包含必要的时间轴数据`,"请选择导出版本：",{confirmButtonText:"导出优化版本",cancelButtonText:"导出完整版本",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnPressEscape:!1,dangerouslyUseHTMLString:!0,showClose:!0,type:"info",callback:e=>{if("cancel"===e||"confirm"===e){st("confirm"===e?a:i,"数据复制成功，已写入剪切板。","复制失败，请手动复制！")}}})}function Ye(){b.prompt("请输入导出的字符串（支持多行导入）","导入时间轴",{confirmButtonText:"解析",cancelButtonText:"取消",inputType:"textarea",inputValidator:e=>{if(!e)return"请输入导出的字符串";const t=e.split("\n").filter(e=>""!==e.trim());let n=[];for(const l of t){let e;try{e=JSON.parse(l)}catch{try{const t=fe.decompressFromBase64(l);e=JSON.parse(t)}catch{return`无法解析输入的数据：${l}，请确保每行都是正确的JSON或压缩后的字符串。`}}if(!Array.isArray(e))return`导入的数据格式不正确：${l}`;n=n.concat(e)}return 0!==n.length||"导入的数据不包含任何时间轴。"},inputErrorMessage:"无效的输入"}).then(({value:e})=>{const t=e.split("\n").filter(e=>""!==e.trim());let n=[];for(const a of t){let e;try{e=JSON.parse(a)}catch{const t=fe.decompressFromBase64(a);e=JSON.parse(t)}n=n.concat(e)}const l=n.length,i=n.map(e=>`「${e.name}」`).join(", ");b({title:"确认",message:`导入 ${l} 个时间轴：\n${i}\n？`,showCancelButton:!0,showConfirmButton:!0,confirmButtonText:"追加",cancelButtonText:"覆盖",distinguishCancelAndClose:!0,type:"warning",callback:e=>{"cancel"===e?b.prompt('覆盖操作将删除所有现有的时间轴。请输入"我确认"以继续。',"二次确认",{confirmButtonText:"确定覆盖",cancelButtonText:"取消",inputPattern:/^我确认$/,inputErrorMessage:'请输入"我确认"以确认覆盖操作',type:"warning"}).then(({value:e})=>{"我确认"===e&&Ze(n,!0)}).catch(()=>{}):"confirm"===e&&Ze(n,!1)}})}).catch(()=>{})}function Ze(e,t){t&&(d.allTimelines.length=0),d.allTimelines.push(...e),d.sortTimelines();for(const a of d.allTimelines)void 0===a.condition.jobs&&(a.condition.jobs=[a.condition.job]);if(t)return void D({type:"success",message:"覆盖成功！",duration:2e3});const n=[],l=new Set;for(const a of d.allTimelines){const e=JSON.stringify({name:a.name,condition:a.condition,timeline:a.timeline,codeFight:a.codeFight,create:a.create});l.has(e)||(l.add(e),n.push(a))}const i=d.allTimelines.length-n.length;d.allTimelines=n,D({message:`追加成功！共导入 ${e.length} 个时间轴${i>0?`，但其中 ${i} 个重复，已自动移除。`:""}`,type:"success",duration:3e3})}function et(e,t={}){he({call:"broadcast",source:"soumaTimelineSettings",msg:{type:e,data:t}})}function tt(){const e=a.resolve({path:"/timeline"}),t=`${window.location.protocol}//${window.location.host}/ff14-overlay-vue/${e.href}`;je=!0,Te=N.service({lock:!0,text:`正在请求数据，请确保 ACT 中已添加并启用此悬浮窗：${t}`,background:"rgba(0, 0, 0, 0.7)"}),et("get"),setTimeout(()=>{je&&(D.info("重新尝试获取数据..."),tt())},5e3)}const nt=e=>{if("soumaTimeline"===e.source)if("post"===e.msg.type){je=!1,Te.close();const t=e.msg.data;for(const e of t.allTimelines)void 0===e.condition.jobs&&(e.condition.jobs=[e.condition.job]),e.condition.jobs.sort((e,t)=>d.jobList.indexOf(e)-d.jobList.indexOf(t)),Reflect.deleteProperty(e.condition,"job");d.allTimelines=t.allTimelines,d.configValues=t.configValues,d.showStyle=t.showStyle,D.closeAll(),D({message:"数据获取成功",type:"success",duration:3e3})}else"success"===e.msg.type?(H&&(clearTimeout(H),H=void 0),le&&(le.close(),le=void 0),M.closeAll(),M({message:"数据同步成功",type:"success",duration:1e3,position:"bottom-left",icon:"el-icon-success",zIndex:1,showClose:!1})):"hello"===e.msg.type&&le&&ut()};function lt(){window.open("https://docs.qq.com/sheet/DTWxKT3lFbmpDV3Fm?tab=5ovrc8","_blank")}function it(){const e=a.resolve({path:"/timelineHelp"}).href;window.open(e,"_blank")}function at(){C.value=!0}function ot(e){d.configValues=e.configValues,d.showStyle=e.showStyle}function st(e,t="复制成功",n="复制失败"){ge(e).then(()=>D.success(t)).catch(()=>D.error(n))}function ct({row:e}){return e===ue.value?"editing-row":""}function rt(){J.value=!0}function dt(){Ze(Ie,!1)}function ut(){et("post",d.$state),clearTimeout(H),H=window.setTimeout(()=>{const e=a.resolve({path:"/timeline"}),t=`${window.location.protocol}//${window.location.host}/ff14-overlay-vue/${e.href}`;le?.close(),le=M({title:"同步数据失败",message:de("div",{style:"color:#f00"},[de("div",["请确保你已正确启用了 ",de("a",{href:t,target:"_blank",style:"color:#f00; text-decoration: underline;"},"此悬浮窗"),"。"])]),showClose:!1,duration:0,position:"bottom-left"})},500)}return E(()=>{be("BroadcastMessage",nt);const e=oe(r,t=>{t&&(0===d.allTimelines.length&&tt(),e(),Be&&(Be.close(),ut()))});d.allTimelines.forEach(e=>e.timeline=e.timeline.replaceAll(/^(?<a>.+), once: true(?<b>.+)$/gm,"$<a>$<b> once"));const t=_e(()=>{r.value?ut():(Be?.close(),Be=M({title:"你修改了时间轴，但",message:de("i",{style:"color: #f00"},"改动未应用，直到你成功连接到 WebSocket。"),showClose:!1,duration:0,position:"bottom-left"}))},500);oe(()=>d.$state,t,{deep:!0})}),function(){for(const e in we)if(Object.prototype.hasOwnProperty.call(we,e)){const t=we[e];switch(t.contentType){case 4:case 5:case 28:xe.push({id:e,name:t.name?.cn??t.name?.ja??e})}}d.loadTimelineSettings(),d.sortTimelines()}(),(e,n)=>{const i=f,a=y,r=h,M=Oe,N=l,B=P,E=F,H=pe,le=v,ie=j,ae=Ve,oe=c,se=g,de=w,me=O,fe=I,we=o,ge=$,be=V,he=s,ve=_,_e=x,Te=t,je=T;return L(),G(je,{class:"container"},{default:q(()=>[K(r,{modelValue:Y(J),"onUpdate:modelValue":n[0]||(n[0]=e=>Z(J)?J.value=e:null),title:"时间轴解析结果","align-center":"",center:"",draggable:"",width:"80%"},{default:q(()=>[K(a,{data:Y(Se)},{default:q(()=>[K(i,{property:"time",label:"time","min-width":"60"}),K(i,{property:"action",label:"action",width:"150"},{default:q(({row:e})=>[Q(ee(e.action.replaceAll(/(^['"“”]|['"“”]$)/g,"")),1)]),_:1}),K(i,{property:"sync",label:"sync","min-width":"200"},{default:q(({row:e})=>[Q(ee(e.sync?e.sync:"-"),1)]),_:1}),K(i,{property:"syncOnce",label:"once","min-width":"100"},{default:q(({row:e})=>[Q(ee(e.syncOnce?"✅":"-"),1)]),_:1}),K(i,{label:"window","min-width":"100"},{default:q(({row:e})=>[Q(ee(e.sync?`${e.windowBefore},${e.windowAfter}`:"-"),1)]),_:1}),K(i,{property:"jump",label:"jump","min-width":"100"},{default:q(({row:e})=>[Q(ee(e.jump?e.jump:"-"),1)]),_:1}),K(i,{property:"tts",label:"tts","min-width":"150"},{default:q(({row:e})=>[Q(ee(e.tts?e.tts:"-"),1)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),K(M,{modelValue:Y(z),"onUpdate:modelValue":n[1]||(n[1]=e=>Z(z)?z.value=e:null),onSave:ot},null,8,["modelValue"]),K(ie,{class:"flex-header"},{default:q(()=>[K(le,{justify:"space-between",align:"middle"},{default:q(()=>[K(E,null,{default:q(()=>[K(B,null,{default:q(()=>[K(N,{type:"primary",size:"small",onClick:at},{default:q(()=>n[22]||(n[22]=[Q(" 从 FFlogs 生成 ",-1)])),_:1,__:[22]}),K(N,{type:"primary",size:"small",onClick:lt},{default:q(()=>n[23]||(n[23]=[Q(" 从 在线文档 获取 ",-1)])),_:1,__:[23]}),K(N,{type:"primary",size:"small",onClick:Ge},{default:q(()=>n[24]||(n[24]=[Q(" 手动编写 ",-1)])),_:1,__:[24]})]),_:1}),K(N,{color:"#543d6c",size:"small",onClick:dt},{default:q(()=>n[25]||(n[25]=[Q(" 导入 SPJP M5S~M8S 时间轴 ",-1)])),_:1,__:[25]}),K(B,null,{default:q(()=>[K(N,{size:"small",onClick:Ye},{default:q(()=>n[26]||(n[26]=[Q(" 导入字符串 ",-1)])),_:1,__:[26]}),K(N,{size:"small",class:"export",onClick:n[2]||(n[2]=e=>Xe(Y(u)))},{default:q(()=>n[27]||(n[27]=[Q(" 导出全部 ",-1)])),_:1,__:[27]})]),_:1})]),_:1}),K(E,null,{default:q(()=>[K(H,{"storage-key":"timeline-settings-theme"}),K(N,{color:"#626aef",style:{color:"white"},size:"small",onClick:n[3]||(n[3]=e=>z.value=!0)},{default:q(()=>n[28]||(n[28]=[Q(" 参数设置 ",-1)])),_:1,__:[28]})]),_:1})]),_:1})]),_:1}),K(be,null,{default:q(()=>[K(r,{modelValue:Y(C),"onUpdate:modelValue":n[5]||(n[5]=e=>Z(C)?C.value=e:null),title:"从 FFlogs 生成时间轴",width:"80%","before-close":()=>C.value=!1,"close-on-press-escape":!1},{default:q(()=>[K(ae,{filters:Y(m),onShowFFlogsToggle:n[4]||(n[4]=()=>C.value=!1),onEditTimeline:Le},null,8,["filters"])]),_:1},8,["modelValue","before-close"]),Y(u).length>0?(L(),G(we,{key:0},{default:q(()=>[W("div",$e,[W("div",De,[K(oe,{modelValue:Y(Fe),"onUpdate:modelValue":n[6]||(n[6]=e=>Z(Fe)?Fe.value=e:null),placeholder:"搜索名称...",clearable:"",size:"small",style:{width:"180px"}},null,8,["modelValue"]),K(de,{modelValue:Y(Pe),"onUpdate:modelValue":n[7]||(n[7]=e=>Z(Pe)?Pe.value=e:null),placeholder:"筛选地图",clearable:"",size:"small",style:{width:"180px"}},{default:q(()=>[K(se,{label:"全部地图",value:""}),(L(),U(te,null,ne(xe,e=>K(se,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),K(de,{modelValue:Y(ze),"onUpdate:modelValue":n[8]||(n[8]=e=>Z(ze)?ze.value=e:null),placeholder:"筛选职业",clearable:"",size:"small",style:{width:"180px"}},{default:q(()=>[K(se,{label:"全部职业",value:""}),(L(!0),U(te,null,ne(Y(d).jobList,e=>(L(),G(se,{key:e,label:(Y(k).jobToFullName(e)?.cn??e).replace("冒险者","全部职业"),value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),ce(W("div",null,[K(me,{type:"info"},{default:q(()=>[Q(" 筛选结果：共 "+ee(Y(Je).length)+" 个时间轴 ",1)]),_:1})],512),[[re,Y(Fe)||Y(Pe)||Y(ze)]]),W("div",null,[K(N,{type:"primary",size:"small",disabled:0===Y(S).length,onClick:Qe},{default:q(()=>[Q(" 批量导出 ("+ee(Y(S).length)+") ",1)]),_:1},8,["disabled"]),K(N,{type:"danger",size:"small",disabled:0===Y(S).length,style:{"margin-left":"10px"},onClick:We},{default:q(()=>[Q(" 批量删除 ("+ee(Y(S).length)+") ",1)]),_:1},8,["disabled"])])]),K(a,{data:Y(Je),"row-class-name":ct,style:{width:"100%"},stripe:"","default-sort":{prop:"condition",order:"ascending"},onSelectionChange:n[10]||(n[10]=e=>{S.value=e,A.value=e.length===Y(u).length})},{default:q(()=>[K(i,{type:"selection",width:"55",align:"center"},{header:q(()=>[K(fe,{modelValue:Y(A),"onUpdate:modelValue":n[9]||(n[9]=e=>Z(A)?A.value=e:null),onChange:qe},null,8,["modelValue"])]),_:1}),K(i,{prop:"name",label:"名称"}),K(i,{prop:"condition",label:"地图",sortable:""},{default:q(e=>[Q(ee(xe.find(t=>t.id===e.row.condition.zoneId)?.name),1)]),_:1}),K(i,{prop:"condition",label:"职业"},{default:q(e=>[Q(ee(e.row.condition.jobs.map(e=>Y(k).jobToFullName(e.toUpperCase())?.cn??e).join("、").replace("冒险者","全部职业")),1)]),_:1}),K(i,{label:"操作",width:"150"},{default:q(e=>[K(N,{type:"primary",size:"small",onClick:t=>Le(e.row)},{default:q(()=>n[29]||(n[29]=[Q(" 编辑 ",-1)])),_:2,__:[29]},1032,["onClick"]),K(N,{type:"danger",size:"small",onClick:t=>{return n=e.row,void b.confirm(`确定要删除「${n.name}」吗？`,"删除时间轴",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning"}).then(()=>{u.value.splice(u.value.findIndex(e=>e===n),1)}).catch(()=>{});var n}},{default:q(()=>n[30]||(n[30]=[Q(" 删除 ",-1)])),_:2,__:[30]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):(L(),G(we,{key:1},{default:q(()=>[K(ge,{description:"点击上方新建或导入一个时间轴吧~"})]),_:1}))]),_:1}),K(r,{modelValue:Y(R),"onUpdate:modelValue":n[21]||(n[21]=e=>Z(R)?R.value=e:null),title:"编辑时间轴",top:"5vh","before-close":Ke,class:"timeline-dialog",width:"65%",style:{"min-width":"550px","max-width":"1000px"},"close-on-click-modal":!1,"close-on-press-escape":!1},{default:q(()=>[W("div",Me,[K(le,{class:"timeline-header",gutter:10},{default:q(()=>[K(ve,{span:14},{default:q(()=>[K(he,{label:"名称"},{default:q(()=>[K(oe,{modelValue:Y(ue).name,"onUpdate:modelValue":n[11]||(n[11]=e=>Y(ue).name=e)},null,8,["modelValue"])]),_:1})]),_:1}),K(ve,{span:8},{default:q(()=>[K(he,{label:"来源"},{default:q(()=>[K(oe,{modelValue:Y(ue).codeFight,"onUpdate:modelValue":n[12]||(n[12]=e=>Y(ue).codeFight=e),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),K(ve,{span:22},{default:q(()=>[K(he,{label:"地图"},{default:q(()=>[K(de,{modelValue:Y(ue).condition.zoneId,"onUpdate:modelValue":n[13]||(n[13]=e=>Y(ue).condition.zoneId=e),filterable:"",style:{width:"100%"}},{default:q(()=>[(L(),U(te,null,ne(xe,e=>K(se,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),K(ve,{span:22},{default:q(()=>[K(he,{label:"职业"},{default:q(()=>[K(de,{modelValue:Y(ue).condition.jobs,"onUpdate:modelValue":n[14]||(n[14]=e=>Y(ue).condition.jobs=e),multiple:""},{default:q(()=>[(L(!0),U(te,null,ne(Y(d).jobList,e=>(L(),G(se,{key:e,label:(Y(k).jobToFullName(e)?.cn??e).replace("冒险者","全部职业"),value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),W("div",Ne,[K(_e,{modelValue:Y(p),"onUpdate:modelValue":n[15]||(n[15]=e=>Z(p)?p.value=e:null),min:-Y(d).configValues.preBattle,max:Y(Ue),step:.1},null,8,["modelValue","min","max"]),W("div",Ae,[W("p",ke,ee(Y(Ee)),1),W("p",Re," ("+ee(Y(p))+"s) ",1)])]),K(le,{class:"timeline-editor-body",gutter:10},{default:q(()=>[K(ve,null,{default:q(()=>[K(oe,{modelValue:Y(ue).timeline,"onUpdate:modelValue":n[16]||(n[16]=e=>Y(ue).timeline=e),style:X({width:`calc(100% - ${Y(d).showStyle["--timeline-width"]}px)`}),type:"textarea",autosize:{minRows:10,maxRows:20},wrap:"off",placeholder:"请键入时间轴文本",onChange:n[17]||(n[17]=e=>He())},null,8,["modelValue","style"])]),_:1}),K(Te,{style:{position:"absolute",right:0,top:0},config:Y(d).configValues,lines:Y(Se),runtime:Y(p),"show-style":Y(d).showStyle},null,8,["config","lines","runtime","show-style"])]),_:1}),W("div",Ce,[K(E,null,{default:q(()=>[K(N,{onClick:n[18]||(n[18]=e=>Xe([Y(ue)]))},{default:q(()=>n[31]||(n[31]=[Q(" 导出 ",-1)])),_:1,__:[31]}),K(N,{onClick:n[19]||(n[19]=e=>{ue.value.timeline=ue.value.timeline.replaceAll(new RegExp("(?<=^|#\\s*)(\\d+:\\d+(?:\\.\\d{1,2})?|\\d+(?:\\.\\d+)?)","gm"),e=>e.includes(":")?ye.duration(`00:${e}`).as("seconds").toString():ye.utc(1e3*Number(e)).format("mm:ss.S"))})},{default:q(()=>n[32]||(n[32]=[Q(" 切换时间格式 ",-1)])),_:1,__:[32]}),K(N,{onClick:it},{default:q(()=>n[33]||(n[33]=[Q(" 时间轴语法 ",-1)])),_:1,__:[33]}),K(N,{onClick:n[20]||(n[20]=e=>{b.confirm("要删除所有的注释行，仅保留必要的时间轴数据吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{ue.value.timeline=ue.value.timeline.replace(/^#.*(?:\n|$)/gm,""),D.success("完成")}).catch(()=>{})})},{default:q(()=>n[34]||(n[34]=[Q(" 去除注释行 ",-1)])),_:1,__:[34]}),K(N,{onClick:rt},{default:q(()=>n[35]||(n[35]=[Q(" 展示调试信息 ",-1)])),_:1,__:[35]})]),_:1})])])]),_:1},8,["modelValue"])]),_:1})}}}),[["__scopeId","data-v-0d1d43bc"]]);export{ze as default};
