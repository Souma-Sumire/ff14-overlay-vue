import"./index-4f50b799.js";/* empty css                   *//* empty css                        *//* empty css                    */import"./el-tooltip-1f970b29.js";/* empty css                  *//* empty css                     *//* empty css               *//* empty css                 *//* empty css                  *//* empty css                    */import{_ as e}from"./ThemeToggle-dc5f4e39.js";import{e as t}from"./index-9c6472dd.js";import{W as o,i as s,A as l,L as a,Q as n,B as r,b as i}from"./element-plus-3b00acc6.js";import{t as c,r as p,v as u,A as d,M as m,D as _,H as f,E as h,x as v,J as b,K as x}from"./vue-vendor-37eb8ba2.js";import{_ as g}from"./_plugin-vue_export-helper-6a8c15be.js";const j={class:"p-6 min-h-screen"},y={style:{position:"absolute",top:"2em",right:"2em"}},D={class:"rounded bg-black text-green-400 p-3 text-xs overflow-auto"},w=g(c({__name:"rsvDumper",setup(c){t();const g={SE2DC5B04_EE2DC5B04:"Action",S64755250_E64755250:"BNpcName",S74CFC3B0_E74CFC3B0:"Status",S13095D61_E13095D61:"InstanceContentTextData",SF15185AF_EF15185AF:"LogMessage",SCFE39641_ECFE39641:"NpcYell"},w=p([]),C=p(!1),E=p("");async function S(e){const t=e.raw,o=(await t.text()).split(/\r?\n/),s=new Set;w.value=[];for(const l of o){const e=l.split("|");if("252"!==e[0])continue;const t=k(e.slice(3,-2));if(!F(t,(new TextEncoder).encode("_rsv_")))continue;const o=$(t.slice(30)),a=o.str1.replace(/^(rsv_\d+)_[^_]+_[^_]+_[^_]+_[^_]+_([^_]{9}_[^_]+)$/,"$1_$2");if(s.has(a))continue;s.add(a);const n=g[a.slice(-19)]||"Unknown",r=Number(a.match(/_rsv_(\d+)_/)?.[1]);w.value.push({type:n,id:r,...o})}}function k(e){const t=[];for(const o of e){const e=Number.parseInt(o,16)>>>0;t.push(255&e,e>>8&255,e>>16&255,e>>24&255)}return new Uint8Array(t)}function F(e,t){const o=e.length-t.length;for(let s=0;s<=o;s++){let o=!0;for(let l=0;l<t.length;l++)if(e[s+l]!==t[l]){o=!1;break}if(o)return!0}return!1}function $(e){return{str1:A(e.slice(2)),str2:A(e.slice(50)),hexDump:B(e)}}function A(e){const t=e.indexOf(0),o=-1!==t?e.slice(0,t):e;return new TextDecoder("utf-8").decode(o)}function B(e,t=16){const o="0123456789ABCDEF",s=[];for(let l=0;l<e.length;l+=t){let a="",n="";for(let s=0;s<t;s++)if(l+s<e.length){const t=e[l+s];a+=`${o[t>>4]}${o[15&t]} `,n+=t>=32&&t<127?String.fromCharCode(t):"."}else a+="   ",n+=" ";s.push(`${a} ${n}`)}return s.join("\n")}function R(){if(0===w.value.length)return void i.error("请先上传日志文件");const e={};w.value.forEach(({type:t,id:o,str2:s})=>{e[t]||(e[t]=[]),e[t].push(`${o} ${s}`)});let t="";for(const[a,n]of Object.entries(e))t+=`=== ${a} ===\n${n.join("\n")}\n\n`;const o=new Blob([t],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(o),l=document.createElement("a");l.href=s,l.download="rsv_results.txt",l.click(),URL.revokeObjectURL(s)}return(t,i)=>{const c=e,p=o,g=s,k=n,F=r,$=l,A=a;return v(),u("div",j,[i[4]||(i[4]=d("h1",{class:"text-2xl font-bold mb-4"}," FFXIV RSV Dumper ",-1)),d("span",y,[m(c)]),m(p,{drag:"",action:"","auto-upload":!1,"show-file-list":!1,accept:".log,.txt",class:"upload-box",onChange:S},{default:h(()=>i[1]||(i[1]=[d("i",{class:"el-icon-upload"},null,-1),d("div",{class:"el-upload__text"},[b(" 拖拽日志文件到此处或 "),d("em",null,"点击上传")],-1)])),_:1,__:[1]}),w.value.length?(v(),_(g,{key:0,type:"success",class:"mb-4",disabled:0===w.value.length,onClick:R},{default:h(()=>i[2]||(i[2]=[b(" 保存结果到文件 ",-1)])),_:1,__:[2]},8,["disabled"])):f("",!0),w.value.length?(v(),_($,{key:2,data:w.value,stripe:"",style:{width:"100%","margin-top":"20px"},border:""},{default:h(()=>[m(F,{prop:"type",label:"Type"}),m(F,{prop:"id",label:"ID"}),m(F,{prop:"str1",label:"RSV Data 1",width:"400"}),m(F,{prop:"str2",label:"RSV Data 2"}),m(F,{label:"操作",width:"150"},{default:h(e=>[m(g,{size:"small",type:"primary",onClick:t=>{return o=e.row,E.value=o.hexDump,void(C.value=!0);var o}},{default:h(()=>i[3]||(i[3]=[b(" 查看 HexDump ",-1)])),_:2,__:[3]},1032,["onClick"])]),_:1})]),_:1},8,["data"])):(v(),_(k,{key:1,description:"请上传 act.log 文件",class:"mt-6"})),m(A,{modelValue:C.value,"onUpdate:modelValue":i[0]||(i[0]=e=>C.value=e),title:"HexDump 原始数据",width:"50%","append-to-body":!0},{default:h(()=>[d("pre",D,x(E.value),1)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-55e250c9"]]);export{w as default};
