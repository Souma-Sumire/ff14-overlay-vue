import{R as t,U as e,a}from"./regexes-BKeG-dSP.js";const r="\\|",i="[^|]*",n=/^\^\^/,s=["ability","name","source","target","line"],o={echo:"0038",dialog:"0044",message:"0839"},c={setAnimState:"003E",publicContentText:"0834",logMsg:"020F",logMsgParams:"0210"},l=(t,e,r)=>{const i=a[e][t];void 0===r&&(r=Object.keys(i.fields),"repeatingFields"in i&&r.push(i.repeatingFields.label));const n={},s=i.firstOptionalField;for(const[a,o]of Object.entries(i.fields)){if(!r.includes(a))continue;const t={field:a,optional:void 0!==s&&o>=s};"type"===a&&(t.value=i.type),n[o]=t}return"repeatingFields"in i&&r.includes(i.repeatingFields.label)&&(n[i.repeatingFields.startingIndex]={field:i.repeatingFields.label,optional:void 0!==s&&i.repeatingFields.startingIndex>=s,repeating:!0,repeatingKeys:[...i.repeatingFields.names],sortKeys:i.repeatingFields.sortKeys,primaryKey:i.repeatingFields.primaryKey,possibleKeys:[...i.repeatingFields.possibleKeys]}),n},d=(t,e)=>{if(!0!==t)return!1;if(void 0===e)return!0;if(!Array.isArray(e))return!1;for(const a of e)if("object"!=typeof a)return!1;return!0},u=(a,n,o)=>{a=a??{};const c=[];for(const t in o){const e=o[t];e&&c.push(e.field)}t.validateParams(a,n,["capture",...c]);const l=t.trueIfUndefined(a.capture),u=Object.keys(o).sort((t,e)=>parseInt(t)-parseInt(e));let g;if(l){const t=[];for(const a in o)t.push(a);let e=t.pop();if(void 0===e)g=u[u.length-1]??"0";else{for(;o[e]?.optional&&!((o[e]?.field??"")in a);)e=t.pop();g=e??"0"}}else{g="0";for(const t in o){if("object"!=typeof(o[t]??{}))continue;const e=o[t]?.field;void 0!==e&&e in a&&(g=t)}}const f=parseInt(g),m=Object.keys(a).filter(t=>s.includes(t));let y=p.flagTranslationsNeeded&&m.length>0?"^^":"^",b=-1;for(const s in o){const c=parseInt(s),u=c-b-1;1===u?y+="\\y{NetField}":u>1&&(y+=`\\y{NetField}{${u}}`),b=c;const g=o[s];if("object"!=typeof g)throw new Error(`${n}: invalid value: ${JSON.stringify(g)}`);const p=g.field,m=g.value?.toString()??i,C=a[p];if(d(o[s]?.repeating,C)){let a=C;const n=o[s]?.sortKeys,c=o[s]?.primaryKey,d=o[s]?.possibleKeys;if(void 0===c||void 0===d)throw new e;n&&(d.sort((t,e)=>t.toLowerCase().localeCompare(e.toLowerCase())),void 0!==a&&(a=[...a].sort((t,e)=>{if("object"!=typeof t||void 0===t[c])return 0;const a=t[c];if("string"!=typeof a||!d?.includes(a))return 0;if("object"!=typeof e||void 0===e[c])return 0;const r=e[c];return"string"==typeof r&&d?.includes(r)?a.toLowerCase().localeCompare(r.toLowerCase()):0})));const u=a;d.forEach(e=>{const a=u?.find(t=>c in t&&t[c]===e);let n="";o[s]?.repeatingKeys?.forEach(s=>{let o=a?.[s];void 0!==a&&s in a||(o=s===c?e:i),"string"!=typeof o&&(Array.isArray(o)?(o.length<1||o.some(t=>"string"!=typeof t))&&(o=i):o=i),n+=t.maybeCapture(s!==c&&l,p+e,o,m)+r}),n.length>0&&(y+=`(?:${n})${void 0!==a?"":"?"}`)})}else o[s]?.repeating||(y+=void 0!==p?t.maybeCapture(l,p,C,m)+r:m+r);if(c>=f)break}return t.parse(y)},g=(t,e)=>u(e,t,l(t,p.logVersion));class p{static logVersion="latest";static flagTranslationsNeeded=!1;static setFlagTranslationsNeeded(t){p.flagTranslationsNeeded=t}static doesNetRegexNeedTranslation(t){const e="string"==typeof t?t:t.source;return!!n.exec(e)}static startsUsing(t){return g("StartsUsing",t)}static ability(t){return u(t,"Ability",{...l("Ability",p.logVersion),0:{field:"type",value:"2[12]",optional:!1}})}static abilityFull(t){return this.ability(t)}static headMarker(t){return g("HeadMarker",t)}static addedCombatant(t){return u(t,"AddedCombatant",l("AddedCombatant",p.logVersion))}static addedCombatantFull(t){return p.addedCombatant(t)}static removingCombatant(t){return g("RemovedCombatant",t)}static gainsEffect(t){return g("GainsEffect",t)}static statusEffectExplicit(t){return g("StatusEffect",t)}static losesEffect(t){return g("LosesEffect",t)}static tether(t){return g("Tether",t)}static wasDefeated(t){return g("WasDefeated",t)}static networkDoT(t){return g("NetworkDoT",t)}static echo(e){return void 0===e&&(e={}),t.validateParams(e,"Echo",["type","timestamp","code","name","line","capture"]),p.gameLog({...e,code:o.echo})}static dialog(e){return void 0===e&&(e={}),t.validateParams(e,"Dialog",["type","timestamp","code","name","line","capture"]),p.gameLog({...e,code:o.dialog})}static message(e){return void 0===e&&(e={}),t.validateParams(e,"Message",["type","timestamp","code","name","line","capture"]),p.gameLog({...e,code:o.message})}static gameLog(t){return g("GameLog",t)}static gameNameLog(t){return p.gameLog(t)}static statChange(t){return g("PlayerStats",t)}static changeZone(t){return g("ChangeZone",t)}static network6d(t){return g("ActorControl",t)}static nameToggle(t){return g("NameToggle",t)}static map(t){return g("Map",t)}static systemLogMessage(t){return g("SystemLogMessage",t)}static mapEffect(t){return g("MapEffect",t)}static fateDirector(t){return g("FateDirector",t)}static ceDirector(t){return g("CEDirector",t)}static inCombat(t){return g("InCombat",t)}static combatantMemory(t){return g("CombatantMemory",t)}static rsvData(t){return g("RSVData",t)}static startsUsingExtra(t){return g("StartsUsingExtra",t)}static abilityExtra(t){return g("AbilityExtra",t)}static contentFinderSettings(t){return g("ContentFinderSettings",t)}static npcYell(t){return g("NpcYell",t)}static battleTalk2(t){return g("BattleTalk2",t)}static countdown(t){return g("Countdown",t)}static countdownCancel(t){return g("CountdownCancel",t)}static actorMove(t){return g("ActorMove",t)}static actorSetPos(t){return g("ActorSetPos",t)}static spawnNpcExtra(t){return g("SpawnNpcExtra",t)}static actorControlExtra(t){return g("ActorControlExtra",t)}static actorControlSelfExtra(t){return g("ActorControlSelfExtra",t)}}const f={wipe:p.network6d({command:["40000010","4000000F"]}),cactbotWipeEcho:p.echo({line:"cactbot wipe.*?"}),userWipeEcho:p.echo({line:"end"})};export{p as N,c as a,f as c,o as g};
