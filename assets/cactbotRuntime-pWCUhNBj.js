import{_ as e}from"./ActWrapper-CuKJdwxn.js";import{u as a,l as t,_ as r}from"./DragJob-CrTxHUbj.js";import{d as o,r as s,f as n,h as l,aX as i,j as p,w as d,o as u,a as m,c,B as y,l as f,F as v,u as b,k as j,v as h,t as g,b as x}from"./index-KNkPbdkU.js";import{E as k}from"./el-divider-pSjIf5p9.js";import{u as S}from"./useDev-CB2pdli4.js";import{R as E}from"./demoParty-7LLZDNnQ.js";import{U as _}from"./util-BOtaAWHW.js";import{a as J,r as C,c as w}from"./overlay_plugin_api-DHbPkDtN.js";import{u as P}from"./index-wlJhqTud.js";import{E as T}from"./index-C5q4r5pQ.js";import{_ as D}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-card-NvrJqvpr.js";import"./useDemo-B1pbSd_l.js";import"./el-checkbox-m_POwlhi.js";import"./index-BXREeuwV.js";import"./use-form-common-props-C7P8fkLL.js";import"./isEqual-C-aUwPp5.js";import"./index-6ZoMTuL0.js";import"./index-Degz3efR.js";import"./validator-CNqbqKc7.js";import"./index-M-kIsmzg.js";import"./index-B9BOu3Vi.js";import"./focus-trap-CcAsMXyh.js";import"./index-CPjPqUcQ.js";import"./vnode-BN0wtDqF.js";import"./scroll-B0p5cNs5.js";const R={class:"cactbot-runtime-container"},U={class:"players",flex:"~ nowrap gap-1"},B={class:"fixed-rp"},L={class:"fixed-player"},V={class:"drag-job"},H={key:0,style:{position:"fixed",bottom:"0"}},I=D(o({__name:"cactbotRuntime",setup(o){const D=P("cactbotRuntime-showNotification",!0),I=["tank","healer","dps"],M=a(),O=s(!1),q=S(),A=new E,K=n({party:[],partySorted:{tank:[],healer:[],dps:[]}});function N(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const Q={tank:["MT","ST",...N("T",22,2)],healer:[...N("H",24)],dps:[...N("D",24)]},X=s("");function $(){const e=[...Q.tank.slice(0,K.partySorted.tank.length),...Q.healer.slice(0,K.partySorted.healer.length),...Q.dps.slice(0,K.partySorted.dps.length)],a=[...K.partySorted.tank,...K.partySorted.healer,...K.partySorted.dps].map((a,t)=>({...a,rp:e[t]}));w({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a}})}function z(){const e=K.party.slice().sort((e,a)=>M.arr.indexOf(_.baseJobEnumConverted(e.job))-M.arr.indexOf(_.baseJobEnumConverted(a.job)));K.partySorted.tank=e.filter(e=>_.isTankJob(_.jobEnumToJob(e.job))),K.partySorted.healer=e.filter(e=>_.isHealerJob(_.jobEnumToJob(e.job))),K.partySorted.dps=e.filter(e=>_.isDpsJob(_.jobEnumToJob(e.job))),$()}function F(){z()}function G(){$()}const W=()=>{O.value=!0},Y=()=>{O.value=!1},Z=e=>{q.value&&0===e.party.length||(K.party=e.party.filter(e=>e.inParty),z())},ee=e=>{q.value||(X.value=e.charName)},ae=e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&$()};function te(){D.value&&T.confirm("即日起，本悬浮窗将只在高难副本中显示，平时隐藏。","公告",{confirmButtonText:"不再提示",cancelButtonText:"关闭",type:"warning",buttonSize:"small"}).then(()=>{D.value=!1}).catch(()=>{})}function re(){X.value=A.party.value[0].name,K.party=A.party.value.filter(e=>e.name===X.value),z()}function oe(){X.value=A.party.value[0].name,K.party=A.party.value,z()}function se(){A.shuffle({dps:4,healer:2,tank:2,crafter:3,gatherer:3,none:3}),oe()}return l(()=>{document.body.addEventListener("mouseenter",W),document.body.addEventListener("mouseleave",Y),J("ChangePrimaryPlayer",ee),J("PartyChanged",Z),J("BroadcastMessage",ae)}),i(()=>{document.body.removeEventListener("mouseenter",W),document.body.removeEventListener("mouseleave",Y),C("PartyChanged",Z),C("ChangePrimaryPlayer",ee),C("BroadcastMessage",ae)}),(a,o)=>{const s=k,n=r,l=e;return u(),p(l,null,{readme:d(()=>o[0]||(o[0]=[m("span",{class:"demo-text"},[m("p",null,"使悬浮窗的位置分配对应游戏内的实际位置"),m("ul",null,[m("li",null,"每次小队变化时，会按规则进行排序"),m("li",null,"你可以上下拖拽玩家名称，临时调整")])],-1)])),default:d(()=>[m("div",R,[m("main",null,[m("div",U,[m("div",B,[(u(),c(v,null,f(I,(e,a)=>m("div",{key:`fixed-rp-${e}`,class:"player-role"},[(u(!0),c(v,null,f(b(K).partySorted[e],(a,t)=>(u(),c("div",{key:t,style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},[j(m("span",null,g(Q[e][t]),513),[[h,b(O)||a.name===b(X)]])]))),128)),b(K).partySorted[e].length>0&&a<2&&b(O)?(u(),p(s,{key:0})):y("",!0)])),64))]),m("div",L,[(u(),c(v,null,f(I,(e,a)=>x(b(t),{key:`fixed-player-${e}`,modelValue:b(K).partySorted[e],"onUpdate:modelValue":a=>b(K).partySorted[e]=a,animation:200,"ghost-class":"ghost","force-fallback":!0,filter:".no-draggable",onUpdate:G},{default:d(()=>[(u(!0),c(v,null,f(b(K).partySorted[e],e=>j((u(),c("div",{key:e.id,class:"player-line"},[m("span",null,g(e.name),1)])),[[h,b(O)]])),128)),b(K).partySorted[e].length>0&&a<2&&b(O)?(u(),p(s,{key:0,class:"no-draggable"})):y("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])),64))])]),m("div",V,[b(O)?(u(),p(n,{key:0,party:b(K).party,onUpdate:F},null,8,["party"])):y("",!0)])]),b(q)?(u(),c("div",H,[m("button",{onClick:re}," 测试单人 "),m("button",{onClick:oe}," 测试组队 "),m("button",{onClick:se}," 测试随机组队 "),m("button",{onClick:te}," 测试弹窗 ")])):y("",!0)])]),_:1})}}}),[["__scopeId","data-v-fac0a784"]]);export{I as default};
