import{_ as e}from"./ActWrapper-DXd25rGK.js";import{u as t,l as a,_ as r}from"./DragJob-DCDwQE_k.js";import{d as o,r as s,f as n,i as l,bk as i,k as p,w as u,o as d,a as m,c,D as y,m as f,F as b,u as v,l as g,v as h,t as j,b as k}from"./index-t5dIK90X.js";import{E as S}from"./el-divider-BPOELkwJ.js";import{u as x}from"./useDev-C-ldc2K_.js";import{R as _}from"./demoParty-W5tndbAa.js";import{U as E}from"./util-BOtaAWHW.js";import{a as J,r as C,c as P}from"./overlay_plugin_api-DHbPkDtN.js";import{_ as R}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-card-CdVqqIun.js";import"./useDemo-D2aAk6cZ.js";import"./el-checkbox-C5k6kIyx.js";import"./index-D-Ykx3fQ.js";import"./use-form-common-props-DvV4ZFFx.js";import"./index-CfSiKev4.js";import"./_baseClone-jw2yLeBj.js";const D={class:"demo-text"},T={class:"cactbot-runtime-container"},$={class:"players",flex:"~ nowrap gap-1"},w={class:"fixed-rp"},L={class:"fixed-player"},U={class:"drag-job"},M={key:0,style:{position:"fixed",bottom:"0"}},V=R(o({__name:"cactbotRuntime",setup(o){const R=["tank","healer","dps"],V=t(),H=s(!1),z=x(),A=new _,B=n({party:[],partySorted:{tank:[],healer:[],dps:[]}});function I(e,t,a=0){return Array.from({length:t},()=>e).map((e,t)=>e+(+t+1+a))}const K={tank:["MT","ST",...I("T",22,2)],healer:[...I("H",24)],dps:[...I("D",24)]},N=s("");function O(){const e=[...K.tank.slice(0,B.partySorted.tank.length),...K.healer.slice(0,B.partySorted.healer.length),...K.dps.slice(0,B.partySorted.dps.length)],t=[...B.partySorted.tank,...B.partySorted.healer,...B.partySorted.dps].map((t,a)=>({...t,rp:e[a]}));P({call:"broadcast",source:"soumaRuntimeJS",msg:{party:t}})}function q(){const e=B.party.slice().sort((e,t)=>V.arr.indexOf(E.baseJobEnumConverted(e.job))-V.arr.indexOf(E.baseJobEnumConverted(t.job)));B.partySorted.tank=e.filter(e=>E.isTankJob(E.jobEnumToJob(e.job))),B.partySorted.healer=e.filter(e=>E.isHealerJob(E.jobEnumToJob(e.job))),B.partySorted.dps=e.filter(e=>E.isDpsJob(E.jobEnumToJob(e.job))),O()}function F(){q()}function W(){O()}const G=()=>{H.value=!0},Q=()=>{H.value=!1},X=e=>{z.value&&0===e.party.length||(B.party=e.party.filter(e=>e.inParty),q())},Y=e=>{z.value||(N.value=e.charName)},Z=e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&O()};function ee(){N.value=A.party.value[0].name,B.party=A.party.value.filter(e=>e.name===N.value),q()}function te(){N.value=A.party.value[0].name,B.party=A.party.value,q()}function ae(){A.shuffle({dps:4,healer:2,tank:2,crafter:3,gatherer:3,none:3}),te()}return l(()=>{document.body.addEventListener("mouseenter",G),document.body.addEventListener("mouseleave",Q),J("ChangePrimaryPlayer",Y),J("PartyChanged",X),J("BroadcastMessage",Z)}),i(()=>{document.body.removeEventListener("mouseenter",G),document.body.removeEventListener("mouseleave",Q),C("PartyChanged",X),C("ChangePrimaryPlayer",Y),C("BroadcastMessage",Z)}),(t,o)=>{const s=S,n=r,l=e;return d(),p(l,null,{readme:u(()=>[m("span",D,[m("p",null,j(t.$t("cactbotRuntime.usageLine1")),1),m("ul",null,[m("li",null,j(t.$t("cactbotRuntime.usageLine2")),1),m("li",null,j(t.$t("cactbotRuntime.usageLine3")),1)])])]),default:u(()=>[m("div",T,[m("main",null,[m("div",$,[m("div",w,[(d(),c(b,null,f(R,(e,t)=>m("div",{key:`fixed-rp-${e}`,class:"player-role"},[(d(!0),c(b,null,f(v(B).partySorted[e],(t,a)=>(d(),c("div",{key:a,style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},[g(m("span",null,j(K[e][a]),513),[[h,v(H)||t.name===v(N)]])]))),128)),v(B).partySorted[e].length>0&&t<2&&v(H)?(d(),p(s,{key:0})):y("",!0)])),64))]),m("div",L,[(d(),c(b,null,f(R,(e,t)=>k(v(a),{key:`fixed-player-${e}`,modelValue:v(B).partySorted[e],"onUpdate:modelValue":t=>v(B).partySorted[e]=t,animation:200,"ghost-class":"ghost","force-fallback":!0,filter:".no-draggable",onUpdate:W},{default:u(()=>[(d(!0),c(b,null,f(v(B).partySorted[e],e=>g((d(),c("div",{key:e.id,class:"player-line"},[m("span",null,j(e.name),1)])),[[h,v(H)]])),128)),v(B).partySorted[e].length>0&&t<2&&v(H)?(d(),p(s,{key:0,class:"no-draggable"})):y("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])),64))])]),m("div",U,[v(H)?(d(),p(n,{key:0,party:v(B).party,onUpdate:F},null,8,["party"])):y("",!0)])]),v(z)?(d(),c("div",M,[m("button",{onClick:ee},j(t.$t("cactbotRuntime.testSolo")),1),m("button",{onClick:te},j(t.$t("cactbotRuntime.testParty")),1),m("button",{onClick:ae},j(t.$t("cactbotRuntime.testShuffleParty")),1)])):y("",!0)])]),_:1})}}}),[["__scopeId","data-v-e7558aa3"]]);export{V as default};
