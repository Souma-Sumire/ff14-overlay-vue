import{d as _e,v as N,x as be,o as F,b as D,a as n,w as o,u as i,a3 as re,f as w,I as P,g as f,D as Z,F as G,G as O,H as J,S as p,ah as ae,L as he,ai as De,M as Oe,i as ve,aj as Pe,j as Fe,k as Te,ag as xe,a4 as Ce,ak as Ue,c as k,af as Se,a1 as ye,al as je,A as we,$ as Re,a8 as H,Y as ze,am as ge,h as qe,an as Je,a7 as Le,ao as Me,ap as We,l as Ke,e as Qe,O as Ye,P as He,K as Ze,aq as Ge}from"./vendor-8ebccccd.js";import{u as Xe,p as et,_ as tt}from"./timelineShow-fe9acdb7.js";import{U}from"./util-213940cd.js";import{g as nt}from"./actionChinese-2f368d47.js";import{_ as Ie}from"./_plugin-vue_export-helper-c27b6911.js";import{Z as se}from"./zoneInfo-895ff7f9.js";import"./xivapi-8d39f7fe.js";import"./queryParams-77a1fad5.js";const s=new Map;s.set(26155,{type:"cast",window:[999,999]});s.set(28027,{type:"cast",window:[999,999]});s.set(26340,{type:"cast",window:[999,999]});s.set(25533,{type:"begincast",window:[60,60]});s.set(26376,{type:"cast",window:[999,999]});s.set(26814,{type:"begincast",window:[999,999]});s.set(25313,{type:"begincast",window:[200,200]});s.set(27526,{type:"begincast",window:[999,999]});s.set(26215,{type:"cast",window:[500,30]});s.set(29050,{type:"begincast",window:[200,30]});s.set(29156,{type:"cast",window:[20,20]});s.set(27973,{type:"cast",window:[20,20]});s.set(27937,{type:"begincast",window:[20,20]});s.set(28059,{type:"begincast",window:[20,20]});s.set(28060,{type:"begincast",window:[20,20]});s.set(28061,{type:"begincast",window:[20,20]});s.set(27956,{type:"begincast",window:[20,20]});s.set(27957,{type:"begincast",window:[20,20]});s.set(27952,{type:"begincast",window:[30,30]});s.set(27969,{type:"begincast",window:[20,20]});s.set(27971,{type:"begincast",window:[20,20]});s.set(27939,{type:"begincast",window:[20,20]});s.set(27966,{type:"begincast",window:[20,20]});s.set(25316,{type:"begincast",window:[999,999]});s.set(25544,{type:"begincast",window:[10,10]});s.set(26379,{type:"begincast",window:[10,10]});s.set(31552,{type:"begincast",window:[30,30]});s.set(31573,{type:"begincast",window:[30,30]});s.set(31573,{type:"begincast",window:[30,30]});s.set(31617,{type:"begincast",window:[8,8]});s.set(31624,{type:"begincast",window:[30,30]});s.set(31649,{type:"begincast",window:[30,30]});s.set(18516,{type:"cast",window:[250,60]});s.set(18522,{type:"begincast",window:[500,500]});s.set(18552,{type:"begincast",window:[500,500]});s.set(19083,{type:"cast",window:[500,0]});function it(V){const _=new Map;V.filter(l=>l.type==="begincast").map(l=>_.set(l.actionId,(_.get(l.actionId)??0)+1));for(const l of V){_.get(l.actionId)===1&&l.type==="begincast"&&(l.window=[12,12]);const b=s.get(l.actionId);(b==null?void 0:b.type)===l.type&&(l.window=b==null?void 0:b.window)}return V}const lt={class:"fflogs-query-result-friendlies"},ot=["src","onerror"],at=_e({__name:"fflogsImport",props:{settings:{},filters:{}},emits:["newTimeline","showFFlogsToggle","clearCurrentlyTimeline"],setup(V,{emit:_}){const l=V,b=new RegExp("(?<=^|\\/)(?<code>[\\d\\w]{16,})\\/?#fight=(?<fight>\\d+|last)"),X={begincast:"14",cast:"1[56]"};let C=N("查询"),S=N("");const A=N(!1),e=be({code:"",fightIndex:0,start:0,end:0,friendlies:[],abilityFilterEvents:[],abilityFilterCandidate:[],abilityFilterSelected:[],abilityFilterEventsAfterFilterRawTimeline:"",player:{},zoneID:0,bossIDs:[]});z();function ee(r){p.fire({text:"正在解析数据 (步骤1/3)",showConfirmButton:!1}),z(),C.value="正在请求";let d=r.match(b);l.settings.api?d?d?(e.code=d.groups.code,ae.get(`https://cn.fflogs.com/v1/report/fights/${e.code}?api_key=${l.settings.api}`).then(g=>{e.bossIDs=g.data.enemies.filter(h=>h.type==="Boss").map(h=>h.id),e.fightIndex=(d.groups.fight==="last"?g.data.fights.length:parseInt(d.groups.fight))-1;const T=g.data.fights[e.fightIndex];e.zoneID=T.zoneID,e.start=T.start_time,e.end=T.end_time,e.friendlies=g.data.friendlies.filter(h=>h.icon!=="LimitBreak"&&h.fights.find(v=>v.id===e.fightIndex+1)),C.value="查询",e.abilityFilterEvents.length=0,e.abilityFilterCandidate.length=0,p.fire("在列表中选择一名玩家")}).catch(g=>{p.fire({icon:"error",title:"Oops...(步骤1)",text:g}),C.value="查询"})):(p.fire({icon:"error",title:"url链接格式错误",footer:`验证规则：${b.toString().replaceAll(/\?\<\w+\>/g,"")}`}),C.value="查询"):(p.fire({icon:"error",title:"FF logs 战斗记录链接 未填写",footer:"例如：aaAAAAaAAAaAaa11#fight=18"}),C.value="查询"):(p.fire({icon:"error",title:"FF logs API Key 未填写",footer:'<a href="https://cn.fflogs.com/profile">点击这里，在最下方起名，然后获得你的V1 Client Key</a>'}),C.value="查询")}async function j(r){e.player=r,await R().then(()=>{e.abilityFilterCandidate=e.abilityFilterEvents.reduce((d,g)=>(g.sourceIsFriendly&&!d.find(T=>T.actionId===g.actionId)&&d.push(g),d),[])}).catch(d=>{p.fire({icon:"error",title:"Oops...(步骤2)",text:d})})}async function R(){p.fire({text:"正在解析数据，请耐心等待。(步骤2/3)",showConfirmButton:!1});let r=[];e.abilityFilterEvents.length=0;async function d(v){await ae.get(`https://cn.fflogs.com/v1/report/events/casts/${e.code}?start=${v}&end=${e.end}&hostility=0&sourceid=${e.player.id}&api_key=${l.settings.api}`).then(async c=>{r.push(...c.data.events),c.data.nextPageTimestamp&&c.data.nextPageTimestamp>0&&c.data.nextPageTimestamp<e.end&&await d(c.data.nextPageTimestamp)}).catch(c=>{p.fire({icon:"error",title:"Oops...(步骤3.1)",text:c})})}async function g(v,c){c>=0&&await ae.get(`https://cn.fflogs.com/v1/report/events/casts/${e.code}?start=${v}&end=${e.end}&hostility=1&sourceid=${e.bossIDs[c]}&api_key=${l.settings.api}`).then(async x=>{r.push(...x.data.events),x.data.nextPageTimestamp&&x.data.nextPageTimestamp>0&&x.data.nextPageTimestamp<e.end&&await g(x.data.nextPageTimestamp,c),c<e.bossIDs.length-1&&await g(v,c+1)}).catch(x=>{p.fire({icon:"error",title:"Oops...(步骤3.2)",text:x})})}let T=await d(e.start),h=await g(e.start,0);await Promise.all([T,h]).then(()=>{var v;for(const c of r)c.type==="begincast"&&c.sourceIsFriendly||e.abilityFilterEvents.push({time:Number(((c.timestamp-e.start)/1e3).toFixed(1)),type:c.type,actionName:nt(c.ability.guid)??c.ability.name,actionId:c.ability.guid,sourceIsFriendly:c.sourceIsFriendly,url:((v=c==null?void 0:c.ability)==null?void 0:v.abilityIcon.replace("-","/").replace(".png",""))??"000000/000405",window:void 0});e.player.icon&&l.filters[e.player.icon]&&(e.abilityFilterSelected=l.filters[e.player.icon]),p.fire("请在技能过滤器中选择需要的技能")})}function te(){p.fire({text:"正在解析数据 (步骤3/3)",showConfirmButton:!1}),e.player.icon&&(l.filters[e.player.icon]=JSON.parse(JSON.stringify(e.abilityFilterSelected))),e.abilityFilterEvents=e.abilityFilterEvents.filter(r=>r.sourceIsFriendly&&e.abilityFilterSelected.includes(r.actionId)||!r.sourceIsFriendly).sort((r,d)=>r.time-d.time),e.abilityFilterEvents=it(e.abilityFilterEvents),e.abilityFilterEventsAfterFilterRawTimeline=e.abilityFilterEvents.map(r=>r.sourceIsFriendly?`${r.time} "<${r.actionName}>~"${A.value?` tts "${r.actionName}"`:""}`:/^(?:攻击|attack|攻撃)$|^unknown/i.test(r.actionName)||r.type==="cast"&&r.window===void 0?`# ${r.time} "${r.actionName}"`:`${r.time} "${r.actionName}" sync /^.{14} \\w+ ${X[r.type]}:4.{7}:[^:]+:${r.actionId.toString(16).toUpperCase()}:/${r.window?` window ${r.window.join(",")}`:""}`).join(`
`),_("newTimeline",`导入${e.player.name}`,{zoneId:e.zoneID.toString(),job:e.player.icon??"NONE"},e.abilityFilterEventsAfterFilterRawTimeline,`${e.code}#fight=${e.fightIndex+1}`),z(),_("showFFlogsToggle"),p.fire({position:"top-end",icon:"success",title:"已生成新时间轴",showConfirmButton:!1,timer:1500})}function z(){e.code="",e.fightIndex=0,e.start=0,e.end=0,e.friendlies=[],e.abilityFilterEvents=[],e.abilityFilterCandidate=[],e.abilityFilterSelected=[],e.abilityFilterEventsAfterFilterRawTimeline="",e.player={},e.zoneID=0,e.bossIDs=[]}return(r,d)=>{const g=he,T=De,h=Oe,v=ve,c=Pe,x=Fe,ne=Te,L=xe,M=Se,ie=Ce,W=Ue;return F(),D(O,null,[n(c,{inline:!0,class:"fflogs-query"},{default:o(()=>[n(T,{label:"FF logs 战斗",style:{width:"450px"}},{default:o(()=>[n(g,{modelValue:i(S),"onUpdate:modelValue":d[0]||(d[0]=m=>re(S)?S.value=m:S=m),placeholder:"reports/AAAaAaAAaa1aA1aA#fight=3",autocomplete:"on"},null,8,["modelValue"])]),_:1}),n(T,{label:"FF logs V1 Key",style:{width:"450px"}},{default:o(()=>[n(g,{modelValue:l.settings.api,"onUpdate:modelValue":d[1]||(d[1]=m=>l.settings.api=m)},null,8,["modelValue"])]),_:1}),n(T,{label:"添加TTS",style:{width:"100px"}},{default:o(()=>[n(h,{modelValue:i(A),"onUpdate:modelValue":d[2]||(d[2]=m=>re(A)?A.value=m:null)},null,8,["modelValue"])]),_:1}),n(T,null,{default:o(()=>[n(v,{disabled:i(C)==="正在请求",type:"primary",onClick:d[3]||(d[3]=m=>ee(i(S)))},{default:o(()=>[w(P(i(C)),1)]),_:1},8,["disabled"])]),_:1})]),_:1}),f("div",lt,[n(L,null,{default:o(()=>[Z(n(ne,{data:i(e).friendlies.filter(m=>m.icon!=="NPC"),stripe:"",border:"",class:"fflogs-query-result-friendlies-list"},{default:o(()=>[n(x,{prop:"name",label:"玩家名称","min-width":"60px"}),n(x,{prop:"server",label:"服务器","min-width":"60px"}),n(x,{label:"职业","min-width":"60px"},{default:o(({row:m})=>[w(P(i(U).nameToFullName(i(U).jobEnumToJob(i(U).iconToJobEnum(m.icon))).cn),1)]),_:1}),n(x,{label:"选定","min-width":"20px"},{default:o(m=>[n(v,{type:"primary",size:"small",onClick:de=>j(m.row)},{default:o(()=>[w("选择")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),[[G,i(e).abilityFilterEvents.length===0]])]),_:1}),Z(n(L,{class:"fflogs-query-result-friendlies-ability-filter-select"},{default:o(()=>[n(W,{span:20},{default:o(()=>[n(ie,{modelValue:i(e).abilityFilterSelected,"onUpdate:modelValue":d[4]||(d[4]=m=>i(e).abilityFilterSelected=m),multiple:"",placeholder:"技能过滤器","fit-input-width":!0},{default:o(()=>[(F(!0),D(O,null,J(i(e).abilityFilterCandidate,m=>(F(),k(M,{class:"ability-filter-li",key:m.actionId,value:m.actionId,label:m.actionName},{default:o(()=>[f("img",{src:`https://cafemaker.wakingsands.com/i/${m.url}.png`,class:"ability-filter-li-icon",title:"",loading:"auto",onerror:`javascript:this.src='https://xivapi.com/i/${m.url}.png';this.onerror=null;`},null,8,ot),w(P(m.actionName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(W,{span:4},{default:o(()=>[n(v,{type:"success",onClick:d[5]||(d[5]=m=>te())},{default:o(()=>[w("选择好了")]),_:1})]),_:1})]),_:1},512),[[G,i(e).abilityFilterEvents.length>0]])])],64)}}});const st=Ie(at,[["__scopeId","data-v-cdf9e8a3"]]),rt=`# 新建之后先限制一个职业
00:00.0 "--同步化--" sync /^.{14} \\w+ 1[56]:[^:]*:[^:]+:7947:/ window 40,0
00:07.1 "创世真炎" sync /^.{14} \\w+ 14:4.{7}:[^:]+:7944:/ window 50,20
# 00:12.2 判定 "创世真炎"
# 00:15.3 读条 "八分核爆之念"
# 00:18.3 判定 "八分核爆之念"
# 00:21.5 读条 "灼炎创火"
# 00:24.5 判定 "灼炎创火"
# 00:32.9 读条 "创兽炎舞"
# 00:39.9 判定 "创兽炎舞"
# 00:43.1 读条 "炎蛇炮"
# 00:48.2 判定 "炎蛇炮"
# 00:51.4 判定 "炎蛇炮"

# 蛇轴（时间统一加1分钟或60秒）
01:00.9 "变异创身" sync /^.{14} \\w+ 14:4.{7}:[^:]+:794C:/ window 100,100 jump 120.9
# 02:03.9 判定 "变异创身"
# 02:11.2 判定 "回旋蛇踢"
# 02:14.4 读条 "戈尔贡的诅咒"
# 02:17.3 判定 "戈尔贡的诅咒"
# 02:20.5 读条 "潜入阴影"
# 02:23.5 判定 "潜入阴影"
# 02:56.7 读条 "爆热波动"
# 03:01.7 判定 "爆热波动"
# 03:17.2 读条 "创造幻影"
# 03:20.2 判定 "创造幻影"
# 03:23.3 读条 "创造命令"
# 03:26.3 判定 "创造命令"
# 03:29.5 读条 "多重灼炎"
# 03:34.5 判定 "多重灼炎"
# 03:38.6 判定 "多重灼炎"
# 03:41.7 读条 "四分核爆"
# 03:46.7 判定 "四分核爆"
# 03:58.9 读条 "创世真炎"
# 04:03.9 判定 "创世真炎"
# 04:13.4 读条 "变异创身"
# 04:16.4 判定 "变异创身"
# 04:23.8 读条 "双足狂怒"
# 04:28.8 判定 "双足狂怒"
# 04:30.9 判定 "双足狂怒"
# 04:33.0 判定 "双足狂怒"
# 04:35.1 判定 "双足狂怒"
# 04:37.3 读条 "致命践踏"
# 04:42.3 判定 "致命践踏"
# 04:42.5 判定 "致命践踏"
# 04:44.8 判定 "致命践踏"
# 04:47.1 判定 "致命践踏"
# 04:49.4 判定 "致命践踏"
# 05:03.7 读条 "八分核爆之念"
# 05:06.7 判定 "八分核爆之念"
# 05:09.9 读条 "四重火炎风暴"
# 05:12.9 判定 "四重火炎风暴"
# 05:19.1 读条 "喷炎升蛇"
# 05:22.1 判定 "喷炎升蛇"
# 05:32.3 读条 "四分核爆"
# 05:37.3 判定 "四分核爆"
# 05:43.8 读条 "创兽炎舞"
# 05:50.8 判定 "创兽炎舞"
# 05:53.9 读条 "炎蛇炮"
# 05:59.0 判定 "炎蛇炮"
# 06:02.3 判定 "炎蛇炮"
# 06:11.7 读条 "变异创身"
# 06:14.7 判定 "变异创身"
# 06:22.0 判定 "回旋蛇踢"
# 06:25.1 读条 "戈尔贡的诅咒"
# 06:28.1 判定 "戈尔贡的诅咒"
# 06:31.3 读条 "潜入阴影"
# 06:34.3 判定 "潜入阴影"
# 06:53.5 读条 "创造幻影"
# 06:56.5 判定 "创造幻影"
# 07:16.0 读条 "炎蛇炮"
# 07:21.0 判定 "炎蛇炮"
# 07:24.2 判定 "炎蛇炮"
# 07:33.6 读条 "变异创身"
# 07:36.6 判定 "变异创身"
# 07:44.4 读条 "践踏冲击"
# 07:49.4 判定 "践踏冲击"
# 07:52.9 读条 "二分核爆之念"
# 07:55.9 判定 "二分核爆之念"
# 07:59.1 读条 "炽热践踏"
# 08:11.1 判定 "炽热践踏"
# 08:15.8 判定 "践踏冲击"
# 08:19.7 判定 "踏火寻迹"
# 08:22.4 判定 "践踏碎击"
# 08:35.1 读条 "创世真炎"
# 08:40.1 判定 "创世真炎"

# 兽轴（时间统一加10分钟或600秒）
01:00.8 "变异创身" sync /^.{14} \\w+ 14:4.{7}:[^:]+:794B:/ window 100,100 jump 660.8
# 11:03.8 判定 "变异创身"
# 11:11.3 读条 "双足狂怒"
# 11:16.2 判定 "双足狂怒"
# 11:18.4 判定 "双足狂怒"
# 11:20.5 判定 "双足狂怒"
# 11:22.6 判定 "双足狂怒"
# 11:24.8 读条 "致命践踏"
# 11:29.7 判定 "致命践踏"
# 11:30.0 判定 "致命践踏"
# 11:32.3 判定 "致命践踏"
# 11:34.6 判定 "致命践踏"
# 11:36.8 判定 "致命践踏"
# 11:51.2 读条 "创造幻影"
# 11:54.2 判定 "创造幻影"
# 11:57.4 读条 "创造命令"
# 12:00.4 判定 "创造命令"
# 12:03.5 读条 "多重灼炎"
# 12:08.5 判定 "多重灼炎"
# 12:12.7 判定 "多重灼炎"
# 12:15.8 读条 "四分核爆"
# 12:20.8 判定 "四分核爆"
# 12:33.0 读条 "创世真炎"
# 12:38.0 判定 "创世真炎"
# 12:47.5 读条 "变异创身"
# 12:50.4 判定 "变异创身"
# 12:57.7 判定 "回旋蛇踢"
# 13:00.9 读条 "戈尔贡的诅咒"
# 13:03.9 判定 "戈尔贡的诅咒"
# 13:07.0 读条 "潜入阴影"
# 13:10.0 判定 "潜入阴影"
# 13:43.3 读条 "爆热波动"
# 13:48.3 判定 "爆热波动"
# 14:03.7 读条 "八分核爆之念"
# 14:06.7 判定 "八分核爆之念"
# 14:09.9 读条 "四重火炎风暴"
# 14:12.9 判定 "四重火炎风暴"
# 14:19.1 读条 "喷炎升蛇"
# 14:22.1 判定 "喷炎升蛇"
# 14:32.3 读条 "八分核爆"
# 14:37.3 判定 "八分核爆"
# 14:43.8 读条 "创兽炎舞"
# 14:50.8 判定 "创兽炎舞"
# 14:54.0 读条 "炎蛇炮"
# 14:59.1 判定 "炎蛇炮"
# 15:02.3 判定 "炎蛇炮"
# 15:11.7 读条 "变异创身"
# 15:14.7 判定 "变异创身"
# 15:22.5 读条 "践踏冲击"
# 15:27.4 判定 "践踏冲击"
# 15:31.0 读条 "二分核爆之念"
# 15:34.0 判定 "二分核爆之念"
# 15:37.2 读条 "炽热践踏"
# 15:49.2 判定 "炽热践踏"
# 15:53.9 判定 "践踏碎击"
# 15:57.7 判定 "踏火寻迹"
# 16:00.4 判定 "践踏冲击"
# 16:13.2 读条 "炎蛇炮"
# 16:18.2 判定 "炎蛇炮"
# 16:21.4 判定 "炎蛇炮"
# 16:30.8 读条 "变异创身"
# 16:33.8 判定 "变异创身"
# 16:41.1 判定 "回旋蛇踢"
# 16:44.3 读条 "戈尔贡的诅咒"
# 16:47.3 判定 "戈尔贡的诅咒"
# 16:50.4 读条 "潜入阴影"
# 16:53.4 判定 "潜入阴影"
# 17:12.7 读条 "创造幻影"
# 17:15.7 判定 "创造幻影"
# 17:35.1 读条 "创世真炎"
# 17:40.1 判定 "创世真炎"
`,E=V=>(Ye("data-v-26771d01"),V=V(),He(),V),dt=E(()=>f("br",null,null,-1)),ct=E(()=>f("br",null,null,-1)),ut={class:"slider-demo-block"},mt=E(()=>f("span",null,"模拟时间：",-1)),pt={class:"timeline-info-config"},ft=E(()=>f("span",null,"名称：",-1)),yt={class:"timeline-info-config"},wt=E(()=>f("span",null,"地图：",-1)),gt={class:"timeline-info-config"},_t=E(()=>f("span",null,"职业：",-1)),bt={class:"timeline-info-config"},ht=E(()=>f("span",null,"来源：",-1)),vt={class:"timeline-info-config"},Ft=E(()=>f("span",null,"创建：",-1)),Tt={style:{flex:"1"}},xt={style:{"max-height":"353px"}},Ct={class:"timeline-timeline-view"},St=E(()=>f("br",null,null,-1)),It=E(()=>f("br",null,null,-1)),Vt=_e({__name:"timelineSettings",setup(V){const _=N(0),l=Xe(),b=ye(l,"allTimelines"),X=ye(l,"filters"),C=[{id:"0",name:"任意"}],S=N(!1),A=N(!1);let e=be({timeline:{name:"空",condition:{zoneId:"0",job:"NONE"},timeline:"空",codeFight:"空",create:"空"}});const ee=location.href.includes("OVERLAY_WS="),j=N([]);h();async function R(){j.value=[{time:0,action:"正在加载...",show:!0,windowBefore:0,windowAfter:0,alertAlready:!0}],j.value=await et(e.timeline.timeline)}const te=je(we(()=>U.getBattleJobs2()),500,{maxWait:5e3});z();function z(){var u,t,y;for(const B in se)if(Object.prototype.hasOwnProperty.call(se,B)){const $=se[B];switch($.contentType){case 4:case 5:case 28:C.push({id:B,name:((u=$.name)==null?void 0:u.cn)??((t=$.name)==null?void 0:t.ja)??((y=$.name)==null?void 0:y.ja)??B})}}ne(),l.sortTimelines(),L()}function r(){callOverlayHandler({call:"broadcast",source:"soumuaTimelineSetting",msg:{store:l.$state}})}function d(){var u;(u=g({url:location.href}))!=null&&u.OVERLAY_WS?(r(),p.fire({title:"已尝试进行通信,请检查ACT悬浮窗是否接收",text:"若无法通信，可将本页面直接添加到ACT悬浮窗进行编辑，设置将会自动保存。（编辑后刷新一下时间轴网页）"})):p.fire({icon:"error",title:"目前与ACT断开了连接。",text:'请启用ACT OverlayPlugin WSServer，并使本页面url参数中的端口号与其保持一致：OVERLAY_WS=ws://127.0.0.1:端口号/ws"'})}function g({url:u}){const t=u.split("?").pop().split("&"),y={};return t.forEach(B=>{let $=B.split("=");y[$[0]]=$[1]}),y}function T(){S.value=!S.value,h()}function h(){_.value=-30,e.timeline={name:"空",condition:{zoneId:"0",job:"NONE"},timeline:"空",codeFight:"空",create:"空"}}function v(){e.timeline=l.allTimelines[l.newTimeline()],R()}function c(u){window.scrollTo({top:0,behavior:"smooth"}),e.timeline=u,R()}function x(u){p.fire({title:`确定要删除${u.name}吗？`,text:"这将无法撤回！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"确认删除",cancelButtonText:"取消"}).then(t=>{t.isConfirmed&&(h(),b.value.splice(b.value.findIndex(y=>y===u),1))})}function ne(){l.loadTimelineSettings(),Reflect.deleteProperty(l.configValues,"refreshRateMs")}function L(){Re(()=>{l.saveTimelineSettings()},{flush:"post"})}function M(u){let t=new ze(".export",{text:()=>JSON.stringify(u)});t.on("success",()=>{p.fire({position:"top-end",icon:"success",title:"复制成功，已写入剪切板。",showConfirmButton:!1,timer:1500}),t.destroy()}),t.on("error",()=>{p.fire("复制失败，请手动复制！",JSON.stringify([u])),t.destroy()})}function ie(){p.fire({title:"输入导出的字符串",input:"text",returnInputValueOnDeny:!0,showDenyButton:!0,denyButtonText:"覆盖",showConfirmButton:!0,confirmButtonText:"追加",showCancelButton:!0,cancelButtonText:"放弃"}).then(u=>{if(u.isConfirmed||u.isDenied)try{u.isDenied?p.fire({title:"这将丢失目前拥有的所有数据，你确定要覆盖吗？",showConfirmButton:!1,showDenyButton:!0,denyButtonText:"确定覆盖",showCancelButton:!0,cancelButtonText:"取消"}).then(t=>{t.isDenied&&(l.allTimelines.length=0,l.allTimelines.push(...JSON.parse(u.value)),l.sortTimelines())}):(l.allTimelines.push(...JSON.parse(u.value)),l.sortTimelines())}catch(t){p.fire({icon:"error",title:"Oops...",text:t})}})}function W(){e.timeline=l.allTimelines[l.newTimeline("门神模板",{zoneId:"1088",job:"NONE"},rt,"P8S门神模板V6")]}const m=we(()=>(_.value<0?"-":"")+(Array(2).join("0")+(Math.floor(_.value/60)+(_.value<0?1:0))).slice(-2)+":"+(Array(2).join("0")+Math.floor(_.value%60)).slice(-2));function de(){e.timeline.timeline=e.timeline.timeline.replaceAll(new RegExp("(?<=^|^#\\s*)(?<time>[:：\\d.]+)","gm"),(u,t)=>/^\d+[::]\d+(?:\.\d{1,2})?$/.test(u.toString())?ge.duration("00:"+u.toString()).as("seconds").toString():ge.utc(parseFloat(u.toString())*1e3).format("mm:ss.S"))}function Ve(){p.fire({title:"确定删除相关LocalStorage吗？",text:"仅有当图片/技能缓存需要强制刷新时你才需要这样做。",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"gray",confirmButtonText:"确定",cancelButtonText:"取消"}).then(u=>{u.isConfirmed&&(localStorage.removeItem("souma-img-cache"),localStorage.removeItem("souma-action-cache"),p.fire({position:"top-end",icon:"success",title:"已清理",showConfirmButton:!1,timer:1500}))})}return(u,t)=>{const y=ve,B=qe,$=st,ce=Ze,ue=Ge,me=Je,K=Le,Ee=Me,Q=he,pe=Se,fe=Ce,le=xe,$e=tt,Y=Fe,ke=Te,Ae=We,Be=Ke,Ne=Qe;return F(),k(Ne,{class:"container"},{default:o(()=>[n(B,null,{default:o(()=>[n(y,{type:"primary",onClick:t[0]||(t[0]=a=>v())},{default:o(()=>[w("新建")]),_:1}),n(y,{onClick:t[1]||(t[1]=a=>T())},{default:o(()=>[w("从FFlogs导入")]),_:1}),n(y,{onClick:t[2]||(t[2]=a=>A.value=!i(A)),color:"#626aef",style:{color:"white"}},{default:o(()=>[w("样式设置")]),_:1}),n(y,{onClick:t[3]||(t[3]=a=>ie())},{default:o(()=>[w("导入")]),_:1}),n(y,{class:"export",onClick:t[4]||(t[4]=a=>M(i(b)))},{default:o(()=>[w("全部导出")]),_:1}),i(ee)?(F(),k(y,{key:0,type:"success",onClick:t[5]||(t[5]=a=>d())},{default:o(()=>[w("通过WS发送到悬浮窗")]),_:1})):H("",!0),n(y,{onClick:t[6]||(t[6]=a=>W())},{default:o(()=>[w("P8S门神模板")]),_:1}),n(y,{onClick:t[7]||(t[7]=a=>Ve())},{default:o(()=>[w("清理LocalStorage缓存")]),_:1})]),_:1}),n(Be,null,{default:o(()=>[i(S)?(F(),k($,{key:0,settings:i(l).settings,filters:i(X),onClearCurrentlyTimeline:h,onShowFFlogsToggle:t[8]||(t[8]=()=>S.value=!i(S)),onNewTimeline:i(l).newTimeline},null,8,["settings","filters","onNewTimeline"])):H("",!0),Z(n(K,{class:"box-card"},{default:o(()=>[n(me,{title:"时间轴参数",size:"small",border:""},{default:o(()=>[(F(!0),D(O,null,J(i(l).configValues,(a,I,q)=>(F(),k(ue,{key:q,label:i(l).configTranslate[I],"label-align":"right",width:"16em"},{default:o(()=>[n(ce,{min:0,step:.1,modelValue:i(l).configValues[I],"onUpdate:modelValue":oe=>i(l).configValues[I]=oe},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1}),dt,n(me,{size:"small",title:"时间轴样式",border:""},{default:o(()=>[(F(!0),D(O,null,J(i(l).showStyle,(a,I,q)=>(F(),k(ue,{key:q,label:i(l).showStyleTranslate[I],"label-align":"right",width:"16em"},{default:o(()=>[n(ce,{min:0,step:.01,modelValue:i(l).showStyle[I],"onUpdate:modelValue":oe=>i(l).showStyle[I]=oe},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1},512),[[G,i(A)]]),ct,Z(n(K,null,{default:o(()=>[f("div",ut,[mt,n(Ee,{modelValue:i(_),"onUpdate:modelValue":t[9]||(t[9]=a=>re(_)?_.value=a:null),min:-30,max:1500,step:.1,"show-input":""},null,8,["modelValue"]),f("div",null,P(i(m)),1)]),n(le,{class:"timeline-info"},{default:o(()=>[f("div",null,[f("p",pt,[ft,n(Q,{modelValue:i(e).timeline.name,"onUpdate:modelValue":t[10]||(t[10]=a=>i(e).timeline.name=a),class:"timeline-info-name"},null,8,["modelValue"])]),f("p",yt,[wt,n(fe,{modelValue:i(e).timeline.condition.zoneId,"onUpdate:modelValue":t[11]||(t[11]=a=>i(e).timeline.condition.zoneId=a),filterable:""},{default:o(()=>[(F(),D(O,null,J(C,a=>n(pe,{key:a.id,label:a.name,value:a.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),f("p",gt,[_t,n(fe,{modelValue:i(e).timeline.condition.job,"onUpdate:modelValue":t[12]||(t[12]=a=>i(e).timeline.condition.job=a),required:"",placeholder:"职业"},{default:o(()=>[(F(!0),D(O,null,J(i(te),a=>(F(),k(pe,{key:a,label:i(U).nameToFullName(a).cn,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),f("p",bt,[ht,n(Q,{modelValue:i(e).timeline.codeFight,"onUpdate:modelValue":t[13]||(t[13]=a=>i(e).timeline.codeFight=a),disabled:""},null,8,["modelValue"])]),f("p",vt,[Ft,n(Q,{modelValue:i(e).timeline.create,"onUpdate:modelValue":t[14]||(t[14]=a=>i(e).timeline.create=a),disabled:""},null,8,["modelValue"])]),n(le,{"m-b-10px":""},{default:o(()=>[n(y,{span:12,class:"export",onClick:t[15]||(t[15]=a=>M([i(e).timeline]))},{default:o(()=>[w("单独导出")]),_:1}),n(y,{type:"primary",span:12,onClick:t[16]||(t[16]=a=>de())},{default:o(()=>[w("切换时间")]),_:1})]),_:1}),n(le,null,{default:o(()=>[n(y,{span:12,type:"danger",onClick:t[17]||(t[17]=a=>x(i(e).timeline))},{default:o(()=>[w("删除")]),_:1}),n(y,{span:12,onClick:t[18]||(t[18]=a=>h())},{default:o(()=>[w("隐藏编辑界面")]),_:1})]),_:1})]),f("div",Tt,[n(Q,{class:"timeline-timeline-raw",modelValue:i(e).timeline.timeline,"onUpdate:modelValue":t[19]||(t[19]=a=>i(e).timeline.timeline=a),type:"textarea",rows:12,wrap:"off",placeholder:"请键入时间轴文本",style:{"max-width":"569px"},onChange:t[20]||(t[20]=a=>R())},null,8,["modelValue"])]),f("div",xt,[f("div",Ct,[n($e,{config:i(l).configValues,lines:i(j),runtime:i(_),"show-style":i(l).showStyle},null,8,["config","lines","runtime","show-style"])])])]),_:1}),St]),_:1},512),[[G,i(e).timeline.create!=="空"]]),It,i(b).length>0?(F(),k(K,{key:1},{default:o(()=>[n(ke,{data:i(b),style:{width:"100%"},stripe:""},{default:o(()=>[n(Y,{prop:"name",label:"名称"}),n(Y,{prop:"conditon",label:"地图",sortable:""},{default:o(a=>{var I;return[w(P((I=C.find(q=>q.id===a.row.condition.zoneId))==null?void 0:I.name),1)]}),_:1}),n(Y,{prop:"conditon",label:"职业"},{default:o(a=>[w(P(i(U).nameToFullName(a.row.condition.job).cn),1)]),_:1}),n(Y,{fixed:"right",label:"操作",width:"100"},{default:o(a=>[n(y,{onClick:I=>c(a.row),type:"primary",size:"small"},{default:o(()=>[w("编辑")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):H("",!0),i(b).length===0?(F(),k(K,{key:2},{default:o(()=>[n(Ae,{description:"点击上方新建或导入一个时间轴吧~"})]),_:1})):H("",!0)]),_:1})]),_:1})}}});const Pt=Ie(Vt,[["__scopeId","data-v-26771d01"]]);export{Pt as default};
