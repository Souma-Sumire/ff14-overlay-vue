import{c as e,d as a,_ as t}from"./shared-common-BdSdGmdv.js";import{o as r,B as o,a5 as n,v as s,J as l,r as d,t as u,K as i,H as c,am as p,R as m,u as y,V as b,_ as f,Z as v,X as g,I as h,bI as k,ac as S}from"./vendor-vue-GqahCgpc.js";import{c as j,ar as x,h as J,U as R}from"./shared-core-CcY-Sor_.js";import{a as C,r as E,c as P}from"./cactbot-CmNinDrW.js";import{t as $}from"./vendor-element-plus-DIlhOlLn.js";const _={class:"demo-text"},L={class:"cactbot-runtime-container"},T={class:"players",flex:"~ nowrap gap-1"},w={class:"fixed-rp"},U={class:"fixed-player"},V={class:"drag-job"},B={key:0,style:{position:"fixed",bottom:"0"}},D=t(r({__name:"cactbotRuntime",setup(t){const r=["tank","healer","dps"],D=j(),H=d(!1),I=J(),M=new x,O=S({party:[],partySorted:{tank:[],healer:[],dps:[]}});function q(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const A={tank:["MT","ST",...q("T",22,2)],healer:[...q("H",24)],dps:[...q("D",24)]},K=d("");function N(){const e=[...A.tank.slice(0,O.partySorted.tank.length),...A.healer.slice(0,O.partySorted.healer.length),...A.dps.slice(0,O.partySorted.dps.length)],a=[...O.partySorted.tank,...O.partySorted.healer,...O.partySorted.dps].map((a,t)=>({...a,rp:e[t]}));P({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a}})}function X(){const e=O.party.slice().sort((e,a)=>D.arr.indexOf(R.baseJobEnumConverted(e.job))-D.arr.indexOf(R.baseJobEnumConverted(a.job)));O.partySorted.tank=e.filter(e=>R.isTankJob(R.jobEnumToJob(e.job))),O.partySorted.healer=e.filter(e=>R.isHealerJob(R.jobEnumToJob(e.job))),O.partySorted.dps=e.filter(e=>R.isDpsJob(R.jobEnumToJob(e.job))),N()}function Z(){X()}function z(){N()}const F=()=>{H.value=!0},G=()=>{H.value=!1},Q=e=>{I.value&&0===e.party.length||(O.party=e.party.filter(e=>e.inParty),X())},W=e=>{I.value||(K.value=e.charName)},Y=e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&N()};function ee(){K.value=M.party.value[0].name,O.party=M.party.value.filter(e=>e.name===K.value),X()}function ae(){K.value=M.party.value[0].name,O.party=M.party.value,X()}function te(){M.shuffle({dps:4,healer:2,tank:2,crafter:3,gatherer:3,none:3}),ae()}return o(()=>{document.body.addEventListener("mouseenter",F),document.body.addEventListener("mouseleave",G),C("ChangePrimaryPlayer",W),C("PartyChanged",Q),C("BroadcastMessage",Y)}),n(()=>{document.body.removeEventListener("mouseenter",F),document.body.removeEventListener("mouseleave",G),E("PartyChanged",Q),E("ChangePrimaryPlayer",W),E("BroadcastMessage",Y)}),(t,o)=>{const n=$,d=a,S=e;return u(),s(S,null,{readme:l(()=>[i("span",_,[i("p",null,v(t.$t("cactbotRuntime.usageLine1")),1),i("ul",null,[i("li",null,v(t.$t("cactbotRuntime.usageLine2")),1),i("li",null,v(t.$t("cactbotRuntime.usageLine3")),1)])])]),default:l(()=>[i("div",L,[i("main",null,[i("div",T,[i("div",w,[(u(),c(m,null,p(r,(e,a)=>i("div",{key:`fixed-rp-${e}`,class:"player-role"},[(u(!0),c(m,null,p(y(O).partySorted[e],(a,t)=>(u(),c("div",{key:t,style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},[b(i("span",null,v(A[e][t]),513),[[f,y(H)||a.name===y(K)]])]))),128)),y(O).partySorted[e].length>0&&a<2&&y(H)?(u(),s(n,{key:0})):g("",!0)])),64))]),i("div",U,[(u(),c(m,null,p(r,(e,a)=>h(y(k),{key:`fixed-player-${e}`,modelValue:y(O).partySorted[e],"onUpdate:modelValue":a=>y(O).partySorted[e]=a,animation:200,"ghost-class":"ghost","force-fallback":!0,filter:".no-draggable",onUpdate:z},{default:l(()=>[(u(!0),c(m,null,p(y(O).partySorted[e],e=>b((u(),c("div",{key:e.id,class:"player-line"},[i("span",null,v(e.name),1)])),[[f,y(H)]])),128)),y(O).partySorted[e].length>0&&a<2&&y(H)?(u(),s(n,{key:0,class:"no-draggable"})):g("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])),64))])]),i("div",V,[y(H)?(u(),s(d,{key:0,party:y(O).party,onUpdate:Z},null,8,["party"])):g("",!0)])]),y(I)?(u(),c("div",B,[i("button",{onClick:ee},v(t.$t("cactbotRuntime.testSolo")),1),i("button",{onClick:ae},v(t.$t("cactbotRuntime.testParty")),1),i("button",{onClick:te},v(t.$t("cactbotRuntime.testShuffleParty")),1)])):g("",!0)])]),_:1})}}}),[["__scopeId","data-v-d15bedf9"]]);export{D as default};
