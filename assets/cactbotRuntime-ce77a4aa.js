import{_ as e}from"./ActWrapper-1ad3973c.js";import{u as a,l as t,_ as r}from"./DragJob-2f9d606f.js";import{d as o,r as s,a as l,o as n,y as i,aW as p,g as d,j as u,n as m,f as c,e as y,B as f,k as v,F as b,u as g,w as h,v as j,t as k,i as S}from"./index-869ae773.js";import{E as x}from"./el-divider-d3b56d26.js";import{u as _}from"./useDev-6c09ce53.js";import{R as E}from"./demoParty-4083529b.js";import{U as J}from"./util-12a91873.js";import{a as C,r as P,c as w}from"./overlay_plugin_api-974cdd44.js";import{_ as T}from"./_plugin-vue_export-helper-6a8c15be.js";import"./el-card-5d9af152.js";import"./useDemo-26f0b35c.js";import"./el-checkbox-f31a6dd9.js";import"./index-9b34d145.js";import"./use-form-common-props-1c074be8.js";import"./isEqual-80cfe890.js";import"./index-4a1437e7.js";import"./index-27b56b2c.js";const D={class:"cactbot-runtime-container"},U={class:"players",flex:"~ nowrap gap-1"},L={class:"fixed-rp"},V={class:"fixed-player"},B={class:"drag-job"},R={key:0,style:{position:"fixed",bottom:"0"}},A=T(o({__name:"cactbotRuntime",setup(o){const T=["tank","healer","dps"],A=a(),M=s(!1),N=_(),O=new E,$=O.party,q=l({party:N.value?$.value.slice():[],partySorted:{tank:[],healer:[],dps:[]}});function F(e,a,t=0){return Array.from({length:a},()=>e).map((e,a)=>e+(+a+1+t))}const G={tank:["MT","ST",...F("T",22,2)],healer:[...F("H",24)],dps:[...F("D",24)]},H=s(N.value?$.value[0].name:"");function I(){const e=[...G.tank.slice(0,q.partySorted.tank.length),...G.healer.slice(0,q.partySorted.healer.length),...G.dps.slice(0,q.partySorted.dps.length)],a=[...q.partySorted.tank,...q.partySorted.healer,...q.partySorted.dps].map((a,t)=>({...a,rp:e[t]}));w({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a}})}function W(){const e=q.party.slice().sort((e,a)=>A.arr.indexOf(J.baseJobEnumConverted(e.job))-A.arr.indexOf(J.baseJobEnumConverted(a.job)));q.partySorted.tank=e.filter(e=>J.isTankJob(J.jobEnumToJob(e.job))),q.partySorted.healer=e.filter(e=>J.isHealerJob(J.jobEnumToJob(e.job))),q.partySorted.dps=e.filter(e=>J.isDpsJob(J.jobEnumToJob(e.job))),I()}function z(){W()}function K(){I()}const Q=()=>{M.value=!0},X=()=>{M.value=!1},Y=e=>{N.value&&0===e.party.length||(q.party=e.party.filter(e=>e.inParty))},Z=e=>{N.value&&(H.value=e.charName)},ee=e=>{"soumaUserJS"===e.source&&"object"==typeof e.msg&&null!==e.msg&&"requestData"===Reflect.get(e.msg,"text")&&I()};function ae(){H.value=$.value[0].name,q.party.length=0,q.party.push($.value.find(e=>e.name===H.value))}function te(){H.value=$.value[0].name,q.party.length=0,q.party.push(...$.value)}function re(){O.shuffle({dps:4,healer:2,tank:2,crafter:3,gatherer:3,none:3}),te()}return n(()=>{document.body.addEventListener("mouseenter",Q),document.body.addEventListener("mouseleave",X),C("PartyChanged",Y),C("ChangePrimaryPlayer",Z),C("BroadcastMessage",ee),i(q.party,()=>{W()},{immediate:!0})}),p(()=>{document.body.removeEventListener("mouseenter",Q),document.body.removeEventListener("mouseleave",X),P("PartyChanged",Y),P("ChangePrimaryPlayer",Z),P("BroadcastMessage",ee)}),(a,o)=>{const s=x,l=r,n=e;return m(),d(n,null,{readme:u(()=>o[0]||(o[0]=[c("span",{class:"demo-text"},[c("p",null,"使悬浮窗的位置分配对应游戏内的实际位置"),c("ul",null,[c("li",null,"每次小队变化时，会按规则进行排序"),c("li",null,"你可以上下拖拽玩家名称，临时调整")])],-1)])),default:u(()=>[c("div",D,[c("main",null,[c("div",U,[c("div",L,[(m(),y(b,null,v(T,(e,a)=>c("div",{key:`fixed-rp-${e}`,class:"player-role"},[(m(!0),y(b,null,v(g(q).partySorted[e],(a,t)=>(m(),y("div",{key:t,style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},[h(c("span",null,k(G[e][t]),513),[[j,g(M)||a.name===g(H)]])]))),128)),g(q).partySorted[e].length>0&&a<2&&g(M)?(m(),d(s,{key:0})):f("",!0)])),64))]),c("div",V,[(m(),y(b,null,v(T,(e,a)=>S(g(t),{key:`fixed-player-${e}`,modelValue:g(q).partySorted[e],"onUpdate:modelValue":a=>g(q).partySorted[e]=a,animation:200,"ghost-class":"ghost","force-fallback":!0,filter:".no-draggable",onUpdate:K},{default:u(()=>[(m(!0),y(b,null,v(g(q).partySorted[e],e=>h((m(),y("div",{key:e.id,class:"player-line"},[c("span",null,k(e.name),1)])),[[j,g(M)]])),128)),g(q).partySorted[e].length>0&&a<2&&g(M)?(m(),d(s,{key:0,class:"no-draggable"})):f("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])),64))])]),c("div",B,[g(M)?(m(),d(l,{key:0,party:g(q).party,onUpdate:z},null,8,["party"])):f("",!0)])]),g(N)?(m(),y("div",R,[c("button",{onClick:ae}," 测试单人 "),c("button",{onClick:te}," 测试组队 "),c("button",{onClick:re}," 测试随机组队 ")])):f("",!0)])]),_:1})}}}),[["__scopeId","data-v-cb26e557"]]);export{A as default};
