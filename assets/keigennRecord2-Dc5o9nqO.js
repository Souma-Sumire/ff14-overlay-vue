import{u as e,a as t}from"./useLang-DZW6wLeY.js";import{E as r}from"./index-Dfl1vKS4.js";import{U as a,h as n,bL as o,P as l,bM as s,ak as i,aJ as c,d,S as u,r as m,f as p,u as h,A as f,j as y,z as g,ad as w,bh as v,M as b,Q as x,ao as S,ab as R,bg as k,O as C,ah as I,B as T,X as E,a3 as H,b as F,aQ as D,i as j,ap as M,n as L,aF as N,aZ as $,F as A,bA as O,a2 as W,bN as z,V as K,T as B,ae as P,Y as _,bD as V,bO as G,bP as q,ax as U,a0 as Z,bk as Y,c as X,o as J,a as Q,t as ee,x as te,aH as re,k as ae,w as ne,D as oe,e as le,s as se,m as ie,bj as ce,bQ as de,q as ue,E as me,g as pe,bR as he,bc as fe,y as ye,l as ge,v as we,a5 as ve,aU as be,aT as xe,aK as Se,bS as Re}from"./index-rZ-K0BKR.js";import{_ as ke}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{E as Ce}from"./el-empty-B8mb1dkG.js";import{B as Ie,d as Te,c as Ee}from"./el-tag-D539Tm3-.js";import{c as He}from"./clipboard-BKuKuDeo.js";import{U as Fe}from"./util-BSI8OlRX.js";import"./el-popper-C8Gal2fm.js";/* empty css                   */import{E as De}from"./el-divider-eNMILRKn.js";import{E as je}from"./index-DfCr4PDf.js";import{s as Me,c as Le,a as Ne}from"./status-BaboS99R.js";import{h as $e,g as Ae}from"./xivapi-a6oZXlzI.js";import{c as Oe,r as We}from"./raf-B2_bWnBD.js";import{c as ze}from"./vnode-DU1YfFdt.js";import{E as Ke,a as Be}from"./el-select-DKMATTVM.js";import{E as Pe}from"./el-button-bJMds-8Y.js";import{u as _e}from"./useDev-CoLP8M1N.js";import{g as Ve}from"./actionChinese-BfVl1gTK.js";import{l as Ge}from"./regexes-CQgF4nC9.js";import{N as qe}from"./netregexes-vajTpmRp.js";import{a as Ue}from"./overlay_plugin_api-DHbPkDtN.js";import{Z as Ze}from"./zoneInfo-BU1Nx5Ma.js";import"./use-form-common-props-49GEHqiI.js";import"./index-D2W7ciPr.js";import"./index-C5V7YmJV.js";import"./index-yX9Xip5X.js";import"./index-BcKeXsod.js";import"./zone_info-xphf4uS4.js";var Ye=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function Xe(e,t){return e===t||!(!Ye(e)||!Ye(t))}function Je(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!Xe(e[r],t[r]))return!1;return!0}const Qe=()=>{const e=a().proxy.$props;return n(()=>{const t=(e,t,r)=>({});return e.perfMode?o(t):function(e,t){void 0===t&&(t=Je);var r=null;function a(){for(var a=[],n=0;n<arguments.length;n++)a[n]=arguments[n];if(r&&r.lastThis===this&&t(a,r.lastArgs))return r.lastResult;var o=e.apply(this,a);return r={lastResult:o,lastArgs:a,lastThis:this},o}return a.clear=function(){r=null},a}(t)})},et="itemRendered",tt="scroll",rt="forward",at="backward",nt="auto",ot="smart",lt="start",st="center",it="end",ct="horizontal",dt="vertical",ut="negative",mt="positive-ascending",pt="positive-descending",ht={[ct]:"left",[dt]:"top"},ft=s({type:i([Number,Function]),required:!0}),yt=s({type:Number}),gt=s({type:Number,default:2}),wt=s({type:String,values:["ltr","rtl"],default:"ltr"}),vt=s({type:Number,default:0}),bt=s({type:Number,required:!0}),xt=s({type:String,values:["horizontal","vertical"],default:dt}),St=l({className:{type:String,default:""},containerElement:{type:i([String,Object]),default:"div"},data:{type:i(Array),default:()=>c([])},direction:wt,height:{type:[String,Number],required:!0},innerElement:{type:[String,Object],default:"div"},innerProps:{type:i(Object),default:()=>({})},style:{type:i([Object,String,Array])},useIsScrolling:Boolean,width:{type:[Number,String],required:!1},perfMode:{type:Boolean,default:!0},scrollbarAlwaysOn:Boolean}),Rt=l({cache:gt,estimatedItemSize:yt,layout:xt,initScrollOffset:vt,total:bt,itemSize:ft,...St}),kt={type:Number,default:6},Ct={type:Number,default:0},It={type:Number,default:2},Tt=l({columnCache:gt,columnWidth:ft,estimatedColumnWidth:yt,estimatedRowHeight:yt,initScrollLeft:vt,initScrollTop:vt,itemKey:{type:i(Function),default:({columnIndex:e,rowIndex:t})=>`${t}:${e}`},rowCache:gt,rowHeight:ft,totalColumn:bt,totalRow:bt,hScrollbarSize:kt,vScrollbarSize:kt,scrollbarStartGap:Ct,scrollbarEndGap:It,role:String,...St}),Et=l({alwaysOn:Boolean,class:String,layout:xt,total:bt,ratio:{type:Number,required:!0},clientSize:{type:Number,required:!0},scrollFrom:{type:Number,required:!0},scrollbarSize:kt,startGap:Ct,endGap:It,visible:Boolean}),Ht=(e,t)=>e<t?rt:at,Ft=e=>"rtl"===e;let Dt=null;function jt(e=!1){if(null===Dt||e){const e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",t.direction="rtl";const r=document.createElement("div"),a=r.style;return a.width="100px",a.height="100px",e.appendChild(r),document.body.appendChild(e),e.scrollLeft>0?Dt=pt:(e.scrollLeft=1,Dt=0===e.scrollLeft?ut:mt),document.body.removeChild(e),Dt}return Dt}const Mt=d({name:"ElVirtualScrollBar",props:Et,emits:["scroll","start-move","stop-move"],setup(e,{emit:t}){const r=n(()=>e.startGap+e.endGap),a=u("virtual-scrollbar"),o=u("scrollbar"),l=m(),s=m();let i=null,c=null;const d=p({isDragging:!1,traveled:0}),v=n(()=>Ie[e.layout]),b=n(()=>e.clientSize-h(r)),x=n(()=>({position:"absolute",width:`${ct===e.layout?b.value:e.scrollbarSize}px`,height:`${ct===e.layout?e.scrollbarSize:b.value}px`,[ht[e.layout]]:"2px",right:"2px",bottom:"2px",borderRadius:"4px"})),S=n(()=>{const t=e.ratio;if(t>=100)return Number.POSITIVE_INFINITY;if(t>=50)return t*b.value/100;const r=b.value/3;return Math.floor(Math.min(Math.max(t*b.value/100,20),r))}),R=n(()=>{if(!Number.isFinite(S.value))return{display:"none"};const t=`${S.value}px`,r=function({move:e,size:t,bar:r},a){const n={},o=`translate${r.axis}(${e}px)`;return n[r.size]=t,n.transform=o,"horizontal"===a?n.height="100%":n.width="100%",n}({bar:v.value,size:t,move:d.traveled},e.layout);return r}),k=n(()=>Math.ceil(e.clientSize-S.value-h(r))),C=()=>{window.removeEventListener("mousemove",E),window.removeEventListener("mouseup",T),document.onselectstart=c,c=null;const e=h(s);e&&(e.removeEventListener("touchmove",E),e.removeEventListener("touchend",T))},I=e=>{e.stopImmediatePropagation(),e.ctrlKey||[1,2].includes(e.button)||(d.isDragging=!0,d[v.value.axis]=e.currentTarget[v.value.offset]-(e[v.value.client]-e.currentTarget.getBoundingClientRect()[v.value.direction]),t("start-move"),(()=>{window.addEventListener("mousemove",E),window.addEventListener("mouseup",T);const e=h(s);e&&(c=document.onselectstart,document.onselectstart=()=>!1,e.addEventListener("touchmove",E,{passive:!0}),e.addEventListener("touchend",T))})())},T=()=>{d.isDragging=!1,d[v.value.axis]=0,t("stop-move"),C()},E=e=>{const{isDragging:r}=d;if(!r)return;if(!s.value||!l.value)return;const a=d[v.value.axis];if(!a)return;Oe(i);const n=-1*(l.value.getBoundingClientRect()[v.value.direction]-e[v.value.client])-(s.value[v.value.offset]-a);i=We(()=>{d.traveled=Math.max(0,Math.min(n,k.value)),t("scroll",n,k.value)})},H=e=>{const r=Math.abs(e.target.getBoundingClientRect()[v.value.direction]-e[v.value.client])-s.value[v.value.offset]/2;d.traveled=Math.max(0,Math.min(r,k.value)),t("scroll",r,k.value)};return f(()=>e.scrollFrom,e=>{d.isDragging||(d.traveled=Math.ceil(e*k.value))}),y(()=>{C()}),()=>g("div",{role:"presentation",ref:l,class:[a.b(),e.class,(e.alwaysOn||d.isDragging)&&"always-on"],style:x.value,onMousedown:w(H,["stop","prevent"]),onTouchstartPrevent:I},g("div",{ref:s,class:o.e("thumb"),style:R.value,onMousedown:I},[]))}});var Lt=(e=>(e.ASC="asc",e.DESC="desc",e))(Lt||{}),Nt=(e=>(e.LEFT="left",e.CENTER="center",e.RIGHT="right",e))(Nt||{}),$t=(e=>(e.LEFT="left",e.RIGHT="right",e))($t||{});const At={asc:"desc",desc:"asc"},Ot=Symbol("placeholder");const Wt=(e,{mainTableRef:t,leftTableRef:r,rightTableRef:o,tableInstance:l,ns:s,isScrolling:i})=>{const c=a(),{emit:d}=c,u=b(!1),p=m(e.defaultExpandedRowKeys||[]),f=m(-1),y=b(null),g=m({}),w=m({}),v=b({}),R=b({}),k=b({}),C=n(()=>x(e.estimatedRowHeight));function I({hovered:e,rowKey:t}){if(i.value)return;l.vnode.el.querySelectorAll(`[rowkey="${String(t)}"]`).forEach(t=>{e?t.classList.add(s.is("hovered")):t.classList.remove(s.is("hovered"))})}const T=Te(()=>{var e,a,n,l;u.value=!0,g.value={...h(g),...h(w)},E(h(y),!1),w.value={},y.value=null,null==(e=t.value)||e.forceUpdate(),null==(a=r.value)||a.forceUpdate(),null==(n=o.value)||n.forceUpdate(),null==(l=c.proxy)||l.$forceUpdate(),u.value=!1},0);function E(e,a=!1){h(C)&&[t,r,o].forEach(t=>{const r=h(t);r&&r.resetAfterRowIndex(e,a)})}return{expandedRowKeys:p,lastRenderedRowIndex:f,isDynamic:C,isResetting:u,rowHeights:g,resetAfterIndex:E,onRowExpanded:function({expanded:t,rowData:r,rowIndex:a,rowKey:n}){var o,i;const c=[...h(p)],u=c.indexOf(n);t?-1===u&&c.push(n):u>-1&&c.splice(u,1),p.value=c,d("update:expandedRowKeys",c),null==(o=e.onRowExpand)||o.call(e,{expanded:t,rowData:r,rowIndex:a,rowKey:n}),null==(i=e.onExpandedRowsChange)||i.call(e,c),l.vnode.el.querySelector(`.${s.is("hovered")}[rowkey="${String(n)}"]`)&&S(()=>I({hovered:!0,rowKey:n}))},onRowHovered:I,onRowsRendered:function(t){var r;null==(r=e.onRowsRendered)||r.call(e,t),t.rowCacheEnd>h(f)&&(f.value=t.rowCacheEnd)},onRowHeightChange:function({rowKey:e,height:t,rowIndex:r},a){a?a===$t.RIGHT?k.value[e]=t:v.value[e]=t:R.value[e]=t;const n=Math.max(...[v,k,R].map(t=>t.value[e]||0));h(g)[e]!==n&&(!function(e,t,r){const a=h(y);(null===a||a>r)&&(y.value=r),w.value[e]=t}(e,n,r),T())}}},zt=(e,t)=>e+t,Kt=e=>R(e)?e.reduce(zt,0):e,Bt=(e,t,r={})=>I(e)?e(t):null!=e?e:r,Pt=e=>(["width","maxWidth","minWidth","height"].forEach(t=>{e[t]=k(e[t])}),e),_t=e=>C(e)?t=>g(e,t):e;function Vt(e){const t=m(),r=m(),o=m(),{columns:l,columnsStyles:s,columnsTotalWidth:i,fixedColumnsOnLeft:c,fixedColumnsOnRight:d,hasFixedColumns:p,mainColumns:y,onColumnSorted:g}=function(e,t,r){const a=n(()=>h(t).map((e,t)=>{var r,a;return{...e,key:null!=(a=null!=(r=e.key)?r:e.dataKey)?a:t}})),o=n(()=>h(a).filter(e=>!e.hidden)),l=n(()=>h(o).filter(e=>"left"===e.fixed||!0===e.fixed)),s=n(()=>h(o).filter(e=>"right"===e.fixed)),i=n(()=>h(o).filter(e=>!e.fixed)),c=n(()=>{const e=[];return h(l).forEach(t=>{e.push({...t,placeholderSign:Ot})}),h(i).forEach(t=>{e.push(t)}),h(s).forEach(t=>{e.push({...t,placeholderSign:Ot})}),e}),d=n(()=>h(l).length||h(s).length),u=n(()=>h(a).reduce((t,a)=>(t[a.key]=((e,t,r)=>{var a;const n={flexGrow:0,flexShrink:0,...r?{}:{flexGrow:e.flexGrow||0,flexShrink:e.flexShrink||1}};r||(n.flexShrink=1);const o={...null!=(a=e.style)?a:{},...n,flexBasis:"auto",width:e.width};return t||(e.maxWidth&&(o.maxWidth=e.maxWidth),e.minWidth&&(o.minWidth=e.minWidth)),o})(a,h(r),e.fixed),t),{})),m=n(()=>h(o).reduce((e,t)=>e+t.width,0)),p=e=>h(a).find(t=>t.key===e);return{columns:a,columnsStyles:u,columnsTotalWidth:m,fixedColumnsOnLeft:l,fixedColumnsOnRight:s,hasFixedColumns:d,mainColumns:c,normalColumns:i,visibleColumns:o,getColumn:p,getColumnStyle:e=>h(u)[e],updateColumnWidth:(e,t)=>{e.width=t},onColumnSorted:function(t){var r;const{key:a}=t.currentTarget.dataset;if(!a)return;const{sortState:n,sortBy:o}=e;let l=Lt.ASC;l=v(n)?At[n[a]]:At[o.order],null==(r=e.onColumnSort)||r.call(e,{column:p(a),key:a,order:l})}}}(e,T(e,"columns"),T(e,"fixed")),{scrollTo:w,scrollToLeft:S,scrollToTop:C,scrollToRow:I,onScroll:E,onVerticalScroll:H,scrollPos:F}=((e,{mainTableRef:t,leftTableRef:r,rightTableRef:a,onMaybeEndReached:n})=>{const o=m({scrollLeft:0,scrollTop:0});function l(e){var n,o,l;const{scrollTop:s}=e;null==(n=t.value)||n.scrollTo(e),null==(o=r.value)||o.scrollToTop(s),null==(l=a.value)||l.scrollToTop(s)}function s(e){o.value=e,l(e)}function i(e){o.value.scrollTop=e,l(h(o))}return f(()=>h(o).scrollTop,(e,t)=>{e>t&&n()}),{scrollPos:o,scrollTo:s,scrollToLeft:function(e){var r,a;o.value.scrollLeft=e,null==(a=null==(r=t.value)?void 0:r.scrollTo)||a.call(r,h(o))},scrollToTop:i,scrollToRow:function(e,r="auto"){var a;null==(a=t.value)||a.scrollToRow(e,r)},onScroll:function(t){var r;s(t),null==(r=e.onScroll)||r.call(e,t)},onVerticalScroll:function({scrollTop:e}){const{scrollTop:t}=h(o);e!==t&&i(e)}}})(e,{mainTableRef:t,leftTableRef:r,rightTableRef:o,onMaybeEndReached:function(){const{onEndReached:t}=e;if(!t)return;const{scrollTop:r}=h(F),a=h(G),n=h(J),o=a-(r+n)+e.hScrollbarSize;!oe.value&&h(N)>=0&&a<=r+h(Z)-h(re)?(oe.value=!0,t(o)):oe.value=!1}}),D=u("table-v2"),j=a(),M=b(!1),{expandedRowKeys:L,lastRenderedRowIndex:N,isDynamic:$,isResetting:A,rowHeights:O,resetAfterIndex:W,onRowExpanded:z,onRowHeightChange:K,onRowHovered:B,onRowsRendered:P}=Wt(e,{mainTableRef:t,leftTableRef:r,rightTableRef:o,tableInstance:j,ns:D,isScrolling:M}),{data:_,depthMap:V}=((e,{expandedRowKeys:t,lastRenderedRowIndex:r,resetAfterIndex:a})=>{const o=m({}),l=n(()=>{const r={},{data:a,rowKey:n}=e,l=h(t);if(!l||!l.length)return a;const s=[],i=new Set;l.forEach(e=>i.add(e));let c=a.slice();for(c.forEach(e=>r[e[n]]=0);c.length>0;){const e=c.shift();s.push(e),i.has(e[n])&&R(e.children)&&e.children.length>0&&(c=[...e.children,...c],e.children.forEach(t=>r[t[n]]=r[e[n]]+1))}return o.value=r,s}),s=n(()=>{const{data:t,expandColumnKey:r}=e;return r?h(l):t});return f(s,(e,t)=>{e!==t&&(r.value=-1,a(0,!0))}),{data:s,depthMap:o}})(e,{expandedRowKeys:L,lastRenderedRowIndex:N,resetAfterIndex:W}),G=n(()=>{const{estimatedRowHeight:t,rowHeight:r}=e,a=h(_);return x(t)?Object.values(h(O)).reduce((e,t)=>e+t,0):a.length*r}),{bodyWidth:q,fixedTableHeight:U,mainTableHeight:Z,leftTableWidth:Y,rightTableWidth:X,windowHeight:J,footerHeight:Q,emptyStyle:ee,rootStyle:te,headerHeight:re}=((e,{columnsTotalWidth:t,rowsHeight:r,fixedColumnsOnLeft:a,fixedColumnsOnRight:o})=>{const l=n(()=>{const{fixed:r,width:a,vScrollbarSize:n}=e,o=a-n;return r?Math.max(Math.round(h(t)),o):o}),s=n(()=>{const{height:t=0,maxHeight:a=0,footerHeight:n,hScrollbarSize:o}=e;if(a>0){const e=h(p),t=h(r),l=h(m)+e+t+o;return Math.min(l,a-n)}return t-n}),i=n(()=>{const{maxHeight:t}=e,a=h(s);if(x(t)&&t>0)return a;const n=h(r)+h(m)+h(p);return Math.min(a,n)}),c=e=>e.width,d=n(()=>Kt(h(a).map(c))),u=n(()=>Kt(h(o).map(c))),m=n(()=>Kt(e.headerHeight)),p=n(()=>{var t;return((null==(t=e.fixedData)?void 0:t.length)||0)*e.rowHeight}),f=n(()=>h(s)-h(m)-h(p)),y=n(()=>{const{style:t={},height:r,width:a}=e;return Pt({...t,height:r,width:a})}),g=n(()=>Pt({height:e.footerHeight})),w=n(()=>({top:k(h(m)),bottom:k(e.footerHeight),width:k(e.width)}));return{bodyWidth:l,fixedTableHeight:i,mainTableHeight:s,leftTableWidth:d,rightTableWidth:u,windowHeight:f,footerHeight:g,emptyStyle:w,rootStyle:y,headerHeight:m}})(e,{columnsTotalWidth:i,fixedColumnsOnLeft:c,fixedColumnsOnRight:d,rowsHeight:G}),ae=m(),ne=n(()=>{const t=0===h(_).length;return R(e.fixedData)?0===e.fixedData.length&&t:t});const oe=m(!1);return f(()=>h(G),()=>oe.value=!1),f(()=>e.expandedRowKeys,e=>L.value=e,{deep:!0}),{columns:l,containerRef:ae,mainTableRef:t,leftTableRef:r,rightTableRef:o,isDynamic:$,isResetting:A,isScrolling:M,hasFixedColumns:p,columnsStyles:s,columnsTotalWidth:i,data:_,expandedRowKeys:L,depthMap:V,fixedColumnsOnLeft:c,fixedColumnsOnRight:d,mainColumns:y,bodyWidth:q,emptyStyle:ee,rootStyle:te,footerHeight:Q,mainTableHeight:Z,fixedTableHeight:U,leftTableWidth:Y,rightTableWidth:X,showEmpty:ne,getRowHeight:function(t){const{estimatedRowHeight:r,rowHeight:a,rowKey:n}=e;return r?h(O)[h(_)[t][n]]||r:a},onColumnSorted:g,onRowHovered:B,onRowExpanded:z,onRowsRendered:P,onRowHeightChange:K,scrollTo:w,scrollToLeft:S,scrollToTop:C,scrollToRow:I,onScroll:E,onVerticalScroll:H}}const Gt=Symbol("tableV2"),qt="tableV2GridScrollLeft",Ut=String,Zt={type:i(Array),required:!0},Yt={type:i(Array)},Xt={...Yt,required:!0},Jt=String,Qt={type:i(Array),default:()=>c([])},er={type:Number,required:!0},tr={type:i([String,Number,Symbol]),default:"id"},rr={type:i(Object)},ar=l({class:String,columns:Zt,columnsStyles:{type:i(Object),required:!0},depth:Number,expandColumnKey:Jt,estimatedRowHeight:{...Tt.estimatedRowHeight,default:void 0},isScrolling:Boolean,onRowExpand:{type:i(Function)},onRowHover:{type:i(Function)},onRowHeightChange:{type:i(Function)},rowData:{type:i(Object),required:!0},rowEventHandlers:{type:i(Object)},rowIndex:{type:Number,required:!0},rowKey:tr,style:{type:i(Object)}}),nr={type:Number,required:!0},or=l({class:String,columns:Zt,fixedHeaderData:{type:i(Array)},headerData:{type:i(Array),required:!0},headerHeight:{type:i([Number,Array]),default:50},rowWidth:nr,rowHeight:{type:Number,default:50},height:nr,width:nr}),lr=l({columns:Zt,data:Xt,fixedData:Yt,estimatedRowHeight:ar.estimatedRowHeight,width:er,height:er,headerWidth:er,headerHeight:or.headerHeight,bodyWidth:er,rowHeight:er,cache:Rt.cache,useIsScrolling:Boolean,scrollbarAlwaysOn:Tt.scrollbarAlwaysOn,scrollbarStartGap:Tt.scrollbarStartGap,scrollbarEndGap:Tt.scrollbarEndGap,class:Ut,style:rr,containerStyle:rr,getRowHeight:{type:i(Function),required:!0},rowKey:ar.rowKey,onRowsRendered:{type:i(Function)},onScroll:{type:i(Function)}}),sr=l({cache:lr.cache,estimatedRowHeight:ar.estimatedRowHeight,rowKey:tr,headerClass:{type:i([String,Function])},headerProps:{type:i([Object,Function])},headerCellProps:{type:i([Object,Function])},headerHeight:or.headerHeight,footerHeight:{type:Number,default:0},rowClass:{type:i([String,Function])},rowProps:{type:i([Object,Function])},rowHeight:{type:Number,default:50},cellProps:{type:i([Object,Function])},columns:Zt,data:Xt,dataGetter:{type:i(Function)},fixedData:Yt,expandColumnKey:ar.expandColumnKey,expandedRowKeys:Qt,defaultExpandedRowKeys:Qt,class:Ut,fixed:Boolean,style:{type:i(Object)},width:er,height:er,maxHeight:Number,useIsScrolling:Boolean,indentSize:{type:Number,default:12},iconSize:{type:Number,default:12},hScrollbarSize:Tt.hScrollbarSize,vScrollbarSize:Tt.vScrollbarSize,scrollbarAlwaysOn:Et.alwaysOn,sortBy:{type:i(Object),default:()=>({})},sortState:{type:i(Object),default:void 0},onColumnSort:{type:i(Function)},onExpandedRowsChange:{type:i(Function)},onEndReached:{type:i(Function)},onRowExpand:ar.onRowExpand,onScroll:lr.onScroll,onRowsRendered:lr.onRowsRendered,rowEventHandlers:ar.rowEventHandlers});var ir=d({name:"ElTableV2Header",props:or,setup(e,{slots:t,expose:r}){const a=u("table-v2"),o=E(qt),l=m(),s=n(()=>Pt({width:e.width,height:e.height})),i=n(()=>Pt({width:e.rowWidth,height:e.height})),c=n(()=>Ee(h(e.headerHeight))),d=e=>{const t=h(l);S(()=>{(null==t?void 0:t.scroll)&&t.scroll({left:e})})},p=()=>{const r=a.e("fixed-header-row"),{columns:n,fixedHeaderData:o,rowHeight:l}=e;return null==o?void 0:o.map((e,a)=>{var o;const s=Pt({height:l,width:"100%"});return null==(o=t.fixed)?void 0:o.call(t,{class:r,columns:n,rowData:e,rowIndex:-(a+1),style:s})})},f=()=>{const r=a.e("dynamic-header-row"),{columns:n}=e;return h(c).map((e,a)=>{var o;const l=Pt({width:"100%",height:e});return null==(o=t.dynamic)?void 0:o.call(t,{class:r,columns:n,headerIndex:a,style:l})})};return H(()=>{(null==o?void 0:o.value)&&d(o.value)}),r({scrollToLeft:d}),()=>{if(!(e.height<=0))return F("div",{ref:l,class:e.class,style:h(s),role:"rowgroup"},[F("div",{style:h(i),class:a.e("header")},[f(),p()])])}}});const cr=({name:e,clearCache:t,getColumnPosition:r,getColumnStartIndexForOffset:o,getColumnStopIndexForStartIndex:l,getEstimatedTotalHeight:s,getEstimatedTotalWidth:i,getColumnOffset:c,getRowOffset:p,getRowPosition:f,getRowStartIndexForOffset:y,getRowStopIndexForStartIndex:w,initCache:v,injectToInstance:b,validateProps:R})=>d({name:null!=e?e:"ElVirtualList",props:Tt,emits:[et,tt],setup(e,{emit:d,expose:k,slots:C}){const I=u("vl");R(e);const T=a(),E=m(v(e,T));null==b||b(T,E);const H=m(),F=m(),W=m(),z=m(null),K=m({isScrolling:!1,scrollLeft:x(e.initScrollLeft)?e.initScrollLeft:0,scrollTop:x(e.initScrollTop)?e.initScrollTop:0,updateRequested:!1,xAxisScrollDir:rt,yAxisScrollDir:rt}),B=Qe(),P=n(()=>Number.parseInt(`${e.height}`,10)),_=n(()=>Number.parseInt(`${e.width}`,10)),V=n(()=>{const{totalColumn:t,totalRow:r,columnCache:a}=e,{isScrolling:n,xAxisScrollDir:s,scrollLeft:i}=h(K);if(0===t||0===r)return[0,0,0,0];const c=o(e,i,h(E)),d=l(e,c,i,h(E)),u=n&&s!==at?1:Math.max(1,a),m=n&&s!==rt?1:Math.max(1,a);return[Math.max(0,c-u),Math.max(0,Math.min(t-1,d+m)),c,d]}),G=n(()=>{const{totalColumn:t,totalRow:r,rowCache:a}=e,{isScrolling:n,yAxisScrollDir:o,scrollTop:l}=h(K);if(0===t||0===r)return[0,0,0,0];const s=y(e,l,h(E)),i=w(e,s,l,h(E)),c=n&&o!==at?1:Math.max(1,a),d=n&&o!==rt?1:Math.max(1,a);return[Math.max(0,s-c),Math.max(0,Math.min(r-1,i+d)),s,i]}),q=n(()=>s(e,h(E))),U=n(()=>i(e,h(E))),Z=n(()=>{var t;return[{position:"relative",overflow:"hidden",WebkitOverflowScrolling:"touch",willChange:"transform"},{direction:e.direction,height:x(e.height)?`${e.height}px`:e.height,width:x(e.width)?`${e.width}px`:e.width},null!=(t=e.style)?t:{}]}),Y=n(()=>{const e=`${h(U)}px`;return{height:`${h(q)}px`,pointerEvents:h(K).isScrolling?"none":void 0,width:e}}),X=()=>{const{totalColumn:t,totalRow:r}=e;if(t>0&&r>0){const[e,t,r,a]=h(V),[n,o,l,s]=h(G);d(et,{columnCacheStart:e,columnCacheEnd:t,rowCacheStart:n,rowCacheEnd:o,columnVisibleStart:r,columnVisibleEnd:a,rowVisibleStart:l,rowVisibleEnd:s})}const{scrollLeft:a,scrollTop:n,updateRequested:o,xAxisScrollDir:l,yAxisScrollDir:s}=h(K);d(tt,{xAxisScrollDir:l,scrollLeft:a,yAxisScrollDir:s,scrollTop:n,updateRequested:o})},J=t=>{const{clientHeight:r,clientWidth:a,scrollHeight:n,scrollLeft:o,scrollTop:l,scrollWidth:s}=t.currentTarget,i=h(K);if(i.scrollTop===l&&i.scrollLeft===o)return;let c=o;if(Ft(e.direction))switch(jt()){case ut:c=-o;break;case pt:c=s-a-o}K.value={...i,isScrolling:!0,scrollLeft:c,scrollTop:Math.max(0,Math.min(l,n-r)),updateRequested:!0,xAxisScrollDir:Ht(i.scrollLeft,c),yAxisScrollDir:Ht(i.scrollTop,l)},S(()=>ne()),oe(),X()},Q=(e,t)=>{const r=h(P),a=(q.value-r)/t*e;re({scrollTop:Math.min(q.value-r,a)})},ee=(e,t)=>{const r=h(_),a=(U.value-r)/t*e;re({scrollLeft:Math.min(U.value-r,a)})},{onWheel:te}=(({atXEndEdge:e,atXStartEdge:t,atYEndEdge:r,atYStartEdge:a},n)=>{let o=null,l=0,s=0;const i=(n,o)=>{const l=n<=0&&t.value||n>=0&&e.value,s=o<=0&&a.value||o>=0&&r.value;return l&&s};return{hasReachedEdge:i,onWheel:e=>{Oe(o);let t=e.deltaX,r=e.deltaY;Math.abs(t)>Math.abs(r)?r=0:t=0,e.shiftKey&&0!==r&&(t=r,r=0),i(l,s)&&i(l+t,s+r)||(l+=t,s+=r,e.preventDefault(),o=We(()=>{n(l,s),l=0,s=0}))}}})({atXStartEdge:n(()=>K.value.scrollLeft<=0),atXEndEdge:n(()=>K.value.scrollLeft>=U.value-h(_)),atYStartEdge:n(()=>K.value.scrollTop<=0),atYEndEdge:n(()=>K.value.scrollTop>=q.value-h(P))},(e,t)=>{var r,a,n,o;null==(a=null==(r=F.value)?void 0:r.onMouseUp)||a.call(r),null==(o=null==(n=W.value)?void 0:n.onMouseUp)||o.call(n);const l=h(_),s=h(P);re({scrollLeft:Math.min(K.value.scrollLeft+e,U.value-l),scrollTop:Math.min(K.value.scrollTop+t,q.value-s)})});D(H,"wheel",te,{passive:!1});const re=({scrollLeft:e=K.value.scrollLeft,scrollTop:t=K.value.scrollTop})=>{e=Math.max(e,0),t=Math.max(t,0);const r=h(K);t===r.scrollTop&&e===r.scrollLeft||(K.value={...r,xAxisScrollDir:Ht(r.scrollLeft,e),yAxisScrollDir:Ht(r.scrollTop,t),scrollLeft:e,scrollTop:t,updateRequested:!0},S(()=>ne()),oe(),X())},ae=(a,n)=>{const{columnWidth:o,direction:l,rowHeight:s}=e,i=B.value(t&&o,t&&s,t&&l),c=`${a},${n}`;if(O(i,c))return i[c];{const[,t]=r(e,n,h(E)),o=h(E),s=Ft(l),[d,u]=f(e,a,o),[m]=r(e,n,o);return i[c]={position:"absolute",left:s?void 0:`${t}px`,right:s?`${t}px`:void 0,top:`${u}px`,height:`${d}px`,width:`${m}px`},i[c]}},ne=()=>{K.value.isScrolling=!1,S(()=>{B.value(-1,null,null)})};j(()=>{if(!M)return;const{initScrollLeft:t,initScrollTop:r}=e,a=h(H);a&&(x(t)&&(a.scrollLeft=t),x(r)&&(a.scrollTop=r)),X()});const oe=()=>{const{direction:t}=e,{scrollLeft:r,scrollTop:a,updateRequested:n}=h(K),o=h(H);if(n&&o){if("rtl"===t)switch(jt()){case ut:o.scrollLeft=-r;break;case mt:o.scrollLeft=r;break;default:{const{clientWidth:e,scrollWidth:t}=o;o.scrollLeft=t-e-r;break}}else o.scrollLeft=Math.max(0,r);o.scrollTop=Math.max(0,a)}},{resetAfterColumnIndex:le,resetAfterRowIndex:se,resetAfter:ie}=T.proxy;k({windowRef:H,innerRef:z,getItemStyleCache:B,scrollTo:re,scrollToItem:(t=0,r=0,a=nt)=>{const n=h(K);r=Math.max(0,Math.min(r,e.totalColumn-1)),t=Math.max(0,Math.min(t,e.totalRow-1));const o=ze(I.namespace.value),l=h(E),d=s(e,l),u=i(e,l);re({scrollLeft:c(e,r,a,n.scrollLeft,l,u>e.width?o:0),scrollTop:p(e,t,a,n.scrollTop,l,d>e.height?o:0)})},states:K,resetAfterColumnIndex:le,resetAfterRowIndex:se,resetAfter:ie});const ce=()=>{const t=L(e.innerElement),r=(()=>{var t;const[r,a]=h(V),[n,o]=h(G),{data:l,totalColumn:s,totalRow:i,useIsScrolling:c,itemKey:d}=e,u=[];if(i>0&&s>0)for(let e=n;e<=o;e++)for(let n=r;n<=a;n++){const r=d({columnIndex:n,data:l,rowIndex:e});u.push(g(A,{key:r},null==(t=C.default)?void 0:t.call(C,{columnIndex:n,data:l,isScrolling:c?h(K).isScrolling:void 0,style:ae(e,n),rowIndex:e})))}return u})();return[g(t,$(e.innerProps,{style:h(Y),ref:z}),N(t)?r:{default:()=>r})]};return()=>{const t=L(e.containerElement),{horizontalScrollbar:r,verticalScrollbar:a}=(()=>{const{scrollbarAlwaysOn:t,scrollbarStartGap:r,scrollbarEndGap:a,totalColumn:n,totalRow:o}=e,l=h(_),s=h(P),i=h(U),c=h(q),{scrollLeft:d,scrollTop:u}=h(K);return{horizontalScrollbar:g(Mt,{ref:F,alwaysOn:t,startGap:r,endGap:a,class:I.e("horizontal"),clientSize:l,layout:"horizontal",onScroll:ee,ratio:100*l/i,scrollFrom:d/(i-l),total:o,visible:!0}),verticalScrollbar:g(Mt,{ref:W,alwaysOn:t,startGap:r,endGap:a,class:I.e("vertical"),clientSize:s,layout:"vertical",onScroll:Q,ratio:100*s/c,scrollFrom:u/(c-s),total:n,visible:!0})}})(),n=ce();return g("div",{key:0,class:I.e("wrapper"),role:e.role},[g(t,{class:e.className,style:h(Z),onScroll:J,ref:H},N(t)?n:{default:()=>n}),r,a])}}}),{max:dr,min:ur,floor:mr}=Math,pr={column:"columnWidth",row:"rowHeight"},hr={column:"lastVisitedColumnIndex",row:"lastVisitedRowIndex"},fr=(e,t,r,a)=>{const[n,o,l]=[r[a],e[pr[a]],r[hr[a]]];if(t>l){let e=0;if(l>=0){const t=n[l];e=t.offset+t.size}for(let r=l+1;r<=t;r++){const t=o(r);n[r]={offset:e,size:t},e+=t}r[hr[a]]=t}return n[t]},yr=(e,t,r,a,n,o)=>{for(;r<=a;){const l=r+mr((a-r)/2),s=fr(e,l,t,o).offset;if(s===n)return l;s<n?r=l+1:a=l-1}return dr(0,r-1)},gr=(e,t,r,a)=>{const[n,o]=[t[a],t[hr[a]]];return(o>0?n[o].offset:0)>=r?yr(e,t,0,o,r,a):((e,t,r,a,n)=>{const o="column"===n?e.totalColumn:e.totalRow;let l=1;for(;r<o&&fr(e,r,t,n).offset<a;)r+=l,l*=2;return yr(e,t,mr(r/2),ur(r,o-1),a,n)})(e,t,dr(0,o),r,a)},wr=({totalRow:e},{estimatedRowHeight:t,lastVisitedRowIndex:r,row:a})=>{let n=0;if(r>=e&&(r=e-1),r>=0){const e=a[r];n=e.offset+e.size}return n+(e-r-1)*t},vr=({totalColumn:e},{column:t,estimatedColumnWidth:r,lastVisitedColumnIndex:a})=>{let n=0;if(a>e&&(a=e-1),a>=0){const e=t[a];n=e.offset+e.size}return n+(e-a-1)*r},br={column:vr,row:wr},xr=(e,t,r,a,n,o,l)=>{const[s,i]=["row"===o?e.height:e.width,br[o]],c=fr(e,t,n,o),d=i(e,n),u=dr(0,ur(d-s,c.offset)),m=dr(0,c.offset-s+l+c.size);switch(r===ot&&(r=a>=m-s&&a<=u+s?nt:st),r){case lt:return u;case it:return m;case st:return Math.round(m+(u-m)/2);default:return a>=m&&a<=u?a:m>u||a<m?m:u}},Sr=cr({name:"ElDynamicSizeGrid",getColumnPosition:(e,t,r)=>{const a=fr(e,t,r,"column");return[a.size,a.offset]},getRowPosition:(e,t,r)=>{const a=fr(e,t,r,"row");return[a.size,a.offset]},getColumnOffset:(e,t,r,a,n,o)=>xr(e,t,r,a,n,"column",o),getRowOffset:(e,t,r,a,n,o)=>xr(e,t,r,a,n,"row",o),getColumnStartIndexForOffset:(e,t,r)=>gr(e,r,t,"column"),getColumnStopIndexForStartIndex:(e,t,r,a)=>{const n=fr(e,t,a,"column"),o=r+e.width;let l=n.offset+n.size,s=t;for(;s<e.totalColumn-1&&l<o;)s++,l+=fr(e,t,a,"column").size;return s},getEstimatedTotalHeight:wr,getEstimatedTotalWidth:vr,getRowStartIndexForOffset:(e,t,r)=>gr(e,r,t,"row"),getRowStopIndexForStartIndex:(e,t,r,a)=>{const{totalRow:n,height:o}=e,l=fr(e,t,a,"row"),s=r+o;let i=l.size+l.offset,c=t;for(;c<n-1&&i<s;)c++,i+=fr(e,c,a,"row").size;return c},injectToInstance:(e,t)=>{const r=({columnIndex:r,rowIndex:a},n)=>{var o,l;n=!!W(n)||n,x(r)&&(t.value.lastVisitedColumnIndex=Math.min(t.value.lastVisitedColumnIndex,r-1)),x(a)&&(t.value.lastVisitedRowIndex=Math.min(t.value.lastVisitedRowIndex,a-1)),null==(o=e.exposed)||o.getItemStyleCache.value(-1,null,null),n&&(null==(l=e.proxy)||l.$forceUpdate())};Object.assign(e.proxy,{resetAfterColumnIndex:(e,t)=>{r({columnIndex:e},t)},resetAfterRowIndex:(e,t)=>{r({rowIndex:e},t)},resetAfter:r})},initCache:({estimatedColumnWidth:e=50,estimatedRowHeight:t=50})=>({column:{},estimatedColumnWidth:e,estimatedRowHeight:t,lastVisitedColumnIndex:-1,lastVisitedRowIndex:-1,row:{}}),clearCache:!1,validateProps:({columnWidth:e,rowHeight:t})=>{}}),Rr=cr({name:"ElFixedSizeGrid",getColumnPosition:({columnWidth:e},t)=>[e,t*e],getRowPosition:({rowHeight:e},t)=>[e,t*e],getEstimatedTotalHeight:({totalRow:e,rowHeight:t})=>t*e,getEstimatedTotalWidth:({totalColumn:e,columnWidth:t})=>t*e,getColumnOffset:({totalColumn:e,columnWidth:t,width:r},a,n,o,l,s)=>{r=Number(r);const i=Math.max(0,e*t-r),c=Math.min(i,a*t),d=Math.max(0,a*t-r+s+t);switch("smart"===n&&(n=o>=d-r&&o<=c+r?nt:st),n){case lt:return c;case it:return d;case st:{const e=Math.round(d+(c-d)/2);return e<Math.ceil(r/2)?0:e>i+Math.floor(r/2)?i:e}default:return o>=d&&o<=c?o:d>c||o<d?d:c}},getRowOffset:({rowHeight:e,height:t,totalRow:r},a,n,o,l,s)=>{t=Number(t);const i=Math.max(0,r*e-t),c=Math.min(i,a*e),d=Math.max(0,a*e-t+s+e);switch(n===ot&&(n=o>=d-t&&o<=c+t?nt:st),n){case lt:return c;case it:return d;case st:{const e=Math.round(d+(c-d)/2);return e<Math.ceil(t/2)?0:e>i+Math.floor(t/2)?i:e}default:return o>=d&&o<=c?o:d>c||o<d?d:c}},getColumnStartIndexForOffset:({columnWidth:e,totalColumn:t},r)=>Math.max(0,Math.min(t-1,Math.floor(r/e))),getColumnStopIndexForStartIndex:({columnWidth:e,totalColumn:t,width:r},a,n)=>{const o=a*e,l=Math.ceil((r+n-o)/e);return Math.max(0,Math.min(t-1,a+l-1))},getRowStartIndexForOffset:({rowHeight:e,totalRow:t},r)=>Math.max(0,Math.min(t-1,Math.floor(r/e))),getRowStopIndexForStartIndex:({rowHeight:e,totalRow:t,height:r},a,n)=>{const o=a*e,l=Math.ceil((r+n-o)/e);return Math.max(0,Math.min(t-1,a+l-1))},initCache:()=>{},clearCache:!0,validateProps:({columnWidth:e,rowHeight:t})=>{}});var kr=d({name:"ElTableV2Grid",props:lr,setup(e,{slots:t,expose:r}){const{ns:a}=E(Gt),{bodyRef:o,fixedRowHeight:l,gridHeight:s,hasHeader:i,headerRef:c,headerHeight:d,totalHeight:u,forceUpdate:p,itemKey:y,onItemRendered:g,resetAfterRowIndex:w,scrollTo:b,scrollToTop:R,scrollToRow:k,scrollLeft:C}=(e=>{const t=m(),r=m(),a=m(0),o=n(()=>{const{data:t,rowHeight:r,estimatedRowHeight:a}=e;if(!a)return t.length*r}),l=n(()=>{const{fixedData:t,rowHeight:r}=e;return((null==t?void 0:t.length)||0)*r}),s=n(()=>Kt(e.headerHeight)),i=n(()=>{const{height:t}=e;return Math.max(0,t-h(s)-h(l))}),c=n(()=>h(s)+h(l)>0);return f(()=>e.bodyWidth,()=>{var t;x(e.estimatedRowHeight)&&(null==(t=r.value)||t.resetAfter({columnIndex:0},!1))}),{bodyRef:r,forceUpdate:function(){var e,a;null==(e=h(r))||e.$forceUpdate(),null==(a=h(t))||a.$forceUpdate()},fixedRowHeight:l,gridHeight:i,hasHeader:c,headerHeight:s,headerRef:t,totalHeight:o,itemKey:({data:t,rowIndex:r})=>t[r][e.rowKey],onItemRendered:function({rowCacheStart:t,rowCacheEnd:r,rowVisibleStart:a,rowVisibleEnd:n}){var o;null==(o=e.onRowsRendered)||o.call(e,{rowCacheStart:t,rowCacheEnd:r,rowVisibleStart:a,rowVisibleEnd:n})},resetAfterRowIndex:function(e,t){var a;null==(a=r.value)||a.resetAfterRowIndex(e,t)},scrollTo:function(e,n){const o=h(t),l=h(r);v(e)?(null==o||o.scrollToLeft(e.scrollLeft),a.value=e.scrollLeft,null==l||l.scrollTo(e)):(null==o||o.scrollToLeft(e),a.value=e,null==l||l.scrollTo({scrollLeft:e,scrollTop:n}))},scrollToTop:function(e){var t;null==(t=h(r))||t.scrollTo({scrollTop:e})},scrollToRow:function(e,t){var a;null==(a=h(r))||a.scrollToItem(e,1,t)},scrollLeft:a}})(e);K(qt,C),z(async()=>{var e;await S();const t=null==(e=o.value)?void 0:e.states.scrollTop;t&&R(Math.round(t)+1)}),r({forceUpdate:p,totalHeight:u,scrollTo:b,scrollToTop:R,scrollToRow:k,resetAfterRowIndex:w});const I=()=>e.bodyWidth;return()=>{const{cache:r,columns:n,data:u,fixedData:m,useIsScrolling:p,scrollbarAlwaysOn:f,scrollbarEndGap:w,scrollbarStartGap:v,style:b,rowHeight:S,bodyWidth:R,estimatedRowHeight:k,headerWidth:C,height:T,width:E,getRowHeight:H,onScroll:D}=e,j=x(k),M=j?Sr:Rr,L=h(d);return F("div",{role:"table",class:[a.e("table"),e.class],style:b},[F(M,{ref:o,data:u,useIsScrolling:p,itemKey:y,columnCache:0,columnWidth:j?I:R,totalColumn:1,totalRow:u.length,rowCache:r,rowHeight:j?H:S,width:E,height:h(s),class:a.e("body"),role:"rowgroup",scrollbarStartGap:v,scrollbarEndGap:w,scrollbarAlwaysOn:f,onScroll:D,onItemRendered:g,perfMode:!1},{default:e=>{var r;const a=u[e.rowIndex];return null==(r=t.row)?void 0:r.call(t,{...e,columns:n,rowData:a})}}),h(i)&&F(ir,{ref:c,class:a.e("header-wrapper"),columns:n,headerData:u,headerHeight:e.headerHeight,fixedHeaderData:m,rowWidth:C,rowHeight:S,width:E,height:Math.min(L+h(l),T)},{dynamic:t.header,fixed:t.row})])}}});var Cr=(e,{slots:t})=>{const{mainTableRef:r,...a}=e;return F(kr,$({ref:r},a),"function"==typeof(n=t)||"[object Object]"===Object.prototype.toString.call(n)&&!C(n)?t:{default:()=>[t]});var n};var Ir=(e,{slots:t})=>{if(!e.columns.length)return;const{leftTableRef:r,...a}=e;return F(kr,$({ref:r},a),"function"==typeof(n=t)||"[object Object]"===Object.prototype.toString.call(n)&&!C(n)?t:{default:()=>[t]});var n};var Tr=(e,{slots:t})=>{if(!e.columns.length)return;const{rightTableRef:r,...a}=e;return F(kr,$({ref:r},a),"function"==typeof(n=t)||"[object Object]"===Object.prototype.toString.call(n)&&!C(n)?t:{default:()=>[t]});var n};const Er=e=>{const{isScrolling:t}=E(Gt),r=m(!1),a=m(),o=n(()=>x(e.estimatedRowHeight)&&e.rowIndex>=0),l=n(()=>{const{rowData:t,rowIndex:r,rowKey:a,onRowHover:n}=e,o=e.rowEventHandlers||{},l={};return Object.entries(o).forEach(([e,n])=>{I(n)&&(l[e]=e=>{n({event:e,rowData:t,rowIndex:r,rowKey:a})})}),n&&[{name:"onMouseleave",hovered:!1},{name:"onMouseenter",hovered:!0}].forEach(({name:e,hovered:o})=>{const s=l[e];l[e]=e=>{n({event:e,hovered:o,rowData:t,rowIndex:r,rowKey:a}),null==s||s(e)}}),l});return j(()=>{h(o)&&((t=!1)=>{const n=h(a);if(!n)return;const{columns:o,onRowHeightChange:l,rowKey:s,rowIndex:i,style:c}=e,{height:d}=n.getBoundingClientRect();r.value=!0,S(()=>{if(t||d!==Number.parseInt(c.height)){const e=o[0],t=(null==e?void 0:e.placeholderSign)===Ot;null==l||l({rowKey:s,height:d,rowIndex:i},e&&!t&&e.fixed)}})})(!0)}),{isScrolling:t,measurable:o,measured:r,rowRef:a,eventHandlers:l,onExpand:t=>{const{onRowExpand:r,rowData:a,rowIndex:n,rowKey:o}=e;null==r||r({expanded:t,rowData:a,rowIndex:n,rowKey:o})}}};var Hr=d({name:"ElTableV2TableRow",props:ar,setup(e,{expose:t,slots:r,attrs:a}){const{eventHandlers:n,isScrolling:o,measurable:l,measured:s,rowRef:i,onExpand:c}=Er(e);return t({onExpand:c}),()=>{const{columns:t,columnsStyles:d,expandColumnKey:u,depth:m,rowData:p,rowIndex:f,style:y}=e;let g=t.map((e,a)=>{const n=R(p.children)&&p.children.length>0&&e.key===u;return r.cell({column:e,columns:t,columnIndex:a,depth:m,style:d[e.key],rowData:p,rowIndex:f,isScrolling:h(o),expandIconProps:n?{rowData:p,rowIndex:f,onExpand:c}:void 0})});if(r.row&&(g=r.row({cells:g.map(e=>R(e)&&1===e.length?e[0]:e),style:y,columns:t,depth:m,rowData:p,rowIndex:f,isScrolling:h(o)})),h(l)){const{height:t,...r}=y||{},o=h(s);return F("div",$({ref:i,class:e.class,style:o?y:r,role:"row"},a,h(n)),[g])}return F("div",$(a,{ref:i,class:e.class,style:y,role:"row"},h(n)),[g])}}});var Fr=(e,{slots:t})=>{const{columns:r,columnsStyles:a,depthMap:n,expandColumnKey:o,expandedRowKeys:l,estimatedRowHeight:s,hasFixedColumns:i,rowData:c,rowIndex:d,style:u,isScrolling:m,rowProps:p,rowClass:h,rowKey:f,rowEventHandlers:y,ns:g,onRowHovered:w,onRowExpanded:v}=e,b=Bt(h,{columns:r,rowData:c,rowIndex:d},""),x=Bt(p,{columns:r,rowData:c,rowIndex:d}),S=c[f],R=n[S]||0,k=Boolean(o),I=d<0,T=[g.e("row"),b,{[g.e(`row-depth-${R}`)]:k&&d>=0,[g.is("expanded")]:k&&l.includes(S),[g.is("fixed")]:!R&&I,[g.is("customized")]:Boolean(t.row)}],E=i?w:void 0,H={...x,columns:r,columnsStyles:a,class:T,depth:R,expandColumnKey:o,estimatedRowHeight:I?void 0:s,isScrolling:m,rowIndex:d,rowData:c,rowKey:S,rowEventHandlers:y,style:u};return F(Hr,$(H,{onRowExpand:v,onMouseenter:e=>{null==E||E({hovered:!0,rowKey:S,event:e,rowData:c,rowIndex:d})},onMouseleave:e=>{null==E||E({hovered:!1,rowKey:S,event:e,rowData:c,rowIndex:d})},rowkey:S}),"function"==typeof(D=t)||"[object Object]"===Object.prototype.toString.call(D)&&!C(D)?t:{default:()=>[t]});var D};const Dr=(e,{slots:t})=>{var r;const{cellData:a,style:n}=e,o=(null==(r=null==a?void 0:a.toString)?void 0:r.call(a))||"",l=B(t,"default",e,()=>[o]);return F("div",{class:e.class,title:o,style:n},[l])};Dr.displayName="ElTableV2Cell",Dr.inheritAttrs=!1;var jr=Dr;var Mr=e=>{const{expanded:t,expandable:r,onExpand:a,style:n,size:o}=e,l={onClick:r?()=>a(!t):void 0,class:e.class};return F(_,$(l,{size:o,style:n}),{default:()=>[F(P,null,null)]})};const Lr=({columns:e,column:t,columnIndex:r,depth:a,expandIconProps:n,isScrolling:o,rowData:l,rowIndex:s,style:i,expandedRowKeys:c,ns:d,cellProps:u,expandColumnKey:m,indentSize:p,iconSize:h,rowKey:f},{slots:y})=>{const g=Pt(i);if(t.placeholderSign===Ot)return F("div",{class:d.em("row-cell","placeholder"),style:g},null);const{cellRenderer:w,dataKey:b,dataGetter:x}=t,S=I(x)?x({columns:e,column:t,columnIndex:r,rowData:l,rowIndex:s}):V(l,null!=b?b:""),R=Bt(u,{cellData:S,columns:e,column:t,columnIndex:r,rowIndex:s,rowData:l}),k={class:d.e("cell-text"),columns:e,column:t,columnIndex:r,cellData:S,isScrolling:o,rowData:l,rowIndex:s},C=_t(w),T=C?C(k):B(y,"default",k,()=>[F(jr,k,null)]),E=[d.e("row-cell"),t.class,t.align===Nt.CENTER&&d.is("align-center"),t.align===Nt.RIGHT&&d.is("align-right")],H=s>=0&&m&&t.key===m,D=s>=0&&c.includes(l[f]);let j;const M=`margin-inline-start: ${a*p}px;`;return H&&(j=v(n)?F(Mr,$(n,{class:[d.e("expand-icon"),d.is("expanded",D)],size:h,expanded:D,style:M,expandable:!0}),null):F("div",{style:[M,`width: ${h}px; height: ${h}px;`].join(" ")},null)),F("div",$({class:E,style:g},R,{role:"cell"}),[j,T])};Lr.inheritAttrs=!1;var Nr=Lr;const $r=l({class:String,columns:Zt,columnsStyles:{type:i(Object),required:!0},headerIndex:Number,style:{type:i(Object)}});var Ar=d({name:"ElTableV2HeaderRow",props:$r,setup:(e,{slots:t})=>()=>{const{columns:r,columnsStyles:a,headerIndex:n,style:o}=e;let l=r.map((e,o)=>t.cell({columns:r,column:e,columnIndex:o,headerIndex:n,style:a[e.key]}));return t.header&&(l=t.header({cells:l.map(e=>R(e)&&1===e.length?e[0]:e),columns:r,headerIndex:n})),F("div",{class:e.class,style:o,role:"row"},[l])}});var Or=({columns:e,columnsStyles:t,headerIndex:r,style:a,headerClass:n,headerProps:o,ns:l},{slots:s})=>{const i={columns:e,headerIndex:r},c=[l.e("header-row"),Bt(n,i,""),{[l.is("customized")]:Boolean(s.header)}],d={...Bt(o,i),columnsStyles:t,class:c,columns:e,headerIndex:r,style:a};return F(Ar,d,"function"==typeof(u=s)||"[object Object]"===Object.prototype.toString.call(u)&&!C(u)?s:{default:()=>[s]});var u};const Wr=(e,{slots:t})=>B(t,"default",e,()=>{var t,r;return[F("div",{class:e.class,title:null==(t=e.column)?void 0:t.title},[null==(r=e.column)?void 0:r.title])]});Wr.displayName="ElTableV2HeaderCell",Wr.inheritAttrs=!1;var zr=Wr;var Kr=e=>{const{sortOrder:t}=e;return F(_,{size:14,class:e.class},{default:()=>[t===Lt.ASC?F(G,null,null):F(q,null,null)]})};var Br=(e,{slots:t})=>{const{column:r,ns:a,style:n,onColumnSorted:o}=e,l=Pt(n);if(r.placeholderSign===Ot)return F("div",{class:a.em("header-row-cell","placeholder"),style:l},null);const{headerCellRenderer:s,headerClass:i,sortable:c}=r,d={...e,class:a.e("header-cell-text")},u=_t(s),m=u?u(d):B(t,"default",d,()=>[F(zr,d,null)]),{sortBy:p,sortState:h,headerCellProps:f}=e;let y,g;if(h){const e=h[r.key];y=Boolean(At[e]),g=y?e:Lt.ASC}else y=r.key===p.key,g=y?p.order:Lt.ASC;const w=[a.e("header-cell"),Bt(i,e,""),r.align===Nt.CENTER&&a.is("align-center"),r.align===Nt.RIGHT&&a.is("align-right"),c&&a.is("sortable")],v={...Bt(f,e),onClick:r.sortable?o:void 0,class:w,style:l,"data-key":r.key};return F("div",$(v,{role:"columnheader"}),[m,c&&F(Kr,{class:[a.e("sort-icon"),y&&a.is("sorting")],sortOrder:g},null)])};const Pr=(e,{slots:t})=>{var r;return F("div",{class:e.class,style:e.style},[null==(r=t.default)?void 0:r.call(t)])};Pr.displayName="ElTableV2Footer";var _r=Pr;const Vr=(e,{slots:t})=>{const r=B(t,"default",{},()=>[F(Ce,null,null)]);return F("div",{class:e.class,style:e.style},[r])};Vr.displayName="ElTableV2Empty";var Gr=Vr;const qr=(e,{slots:t})=>{var r;return F("div",{class:e.class,style:e.style},[null==(r=t.default)?void 0:r.call(t)])};qr.displayName="ElTableV2Overlay";var Ur=qr;function Zr(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!C(e)}var Yr=d({name:"ElTableV2",props:sr,setup(e,{slots:t,expose:r}){const a=u("table-v2"),{columnsStyles:n,fixedColumnsOnLeft:o,fixedColumnsOnRight:l,mainColumns:s,mainTableHeight:i,fixedTableHeight:c,leftTableWidth:d,rightTableWidth:m,data:p,depthMap:f,expandedRowKeys:y,hasFixedColumns:g,mainTableRef:w,leftTableRef:v,rightTableRef:b,isDynamic:x,isResetting:S,isScrolling:R,bodyWidth:k,emptyStyle:C,rootStyle:I,footerHeight:T,showEmpty:E,scrollTo:H,scrollToLeft:D,scrollToTop:j,scrollToRow:M,getRowHeight:L,onColumnSorted:N,onRowHeightChange:A,onRowHovered:O,onRowExpanded:W,onRowsRendered:z,onScroll:B,onVerticalScroll:P}=Vt(e);return r({scrollTo:H,scrollToLeft:D,scrollToTop:j,scrollToRow:M}),K(Gt,{ns:a,isResetting:S,isScrolling:R}),()=>{const{cache:r,cellProps:u,estimatedRowHeight:S,expandColumnKey:R,fixedData:H,headerHeight:D,headerClass:j,headerProps:M,headerCellProps:K,sortBy:_,sortState:V,rowHeight:G,rowClass:q,rowEventHandlers:U,rowKey:Z,rowProps:Y,scrollbarAlwaysOn:X,indentSize:J,iconSize:Q,useIsScrolling:ee,vScrollbarSize:te,width:re}=e,ae=h(p),ne={cache:r,class:a.e("main"),columns:h(s),data:ae,fixedData:H,estimatedRowHeight:S,bodyWidth:h(k),headerHeight:D,headerWidth:h(k),height:h(i),mainTableRef:w,rowKey:Z,rowHeight:G,scrollbarAlwaysOn:X,scrollbarStartGap:2,scrollbarEndGap:te,useIsScrolling:ee,width:re,getRowHeight:L,onRowsRendered:z,onScroll:B},oe=h(d),le=h(c),se={cache:r,class:a.e("left"),columns:h(o),data:ae,fixedData:H,estimatedRowHeight:S,leftTableRef:v,rowHeight:G,bodyWidth:oe,headerWidth:oe,headerHeight:D,height:le,rowKey:Z,scrollbarAlwaysOn:X,scrollbarStartGap:2,scrollbarEndGap:te,useIsScrolling:ee,width:oe,getRowHeight:L,onScroll:P},ie=h(m),ce={cache:r,class:a.e("right"),columns:h(l),data:ae,fixedData:H,estimatedRowHeight:S,rightTableRef:b,rowHeight:G,bodyWidth:ie,headerWidth:ie,headerHeight:D,height:le,rowKey:Z,scrollbarAlwaysOn:X,scrollbarStartGap:2,scrollbarEndGap:te,width:ie,style:`${a.cssVarName("table-scrollbar-size")}: ${te}px`,useIsScrolling:ee,getRowHeight:L,onScroll:P},de=h(n),ue={ns:a,depthMap:h(f),columnsStyles:de,expandColumnKey:R,expandedRowKeys:h(y),estimatedRowHeight:S,hasFixedColumns:h(g),rowProps:Y,rowClass:q,rowKey:Z,rowEventHandlers:U,onRowHovered:O,onRowExpanded:W,onRowHeightChange:A},me={cellProps:u,expandColumnKey:R,indentSize:J,iconSize:Q,rowKey:Z,expandedRowKeys:h(y),ns:a},pe={ns:a,headerClass:j,headerProps:M,columnsStyles:de},he={ns:a,sortBy:_,sortState:V,headerCellProps:K,onColumnSorted:N},fe={row:e=>F(Fr,$(e,ue),{row:t.row,cell:e=>{let r;return t.cell?F(Nr,$(e,me,{style:de[e.column.key]}),Zr(r=t.cell(e))?r:{default:()=>[r]}):F(Nr,$(e,me,{style:de[e.column.key]}),null)}}),header:e=>F(Or,$(e,pe),{header:t.header,cell:e=>{let r;return t["header-cell"]?F(Br,$(e,he,{style:de[e.column.key]}),Zr(r=t["header-cell"](e))?r:{default:()=>[r]}):F(Br,$(e,he,{style:de[e.column.key]}),null)}})},ye=[e.class,a.b(),a.e("root"),{[a.is("dynamic")]:h(x)}],ge={class:a.e("footer"),style:h(T)};return F("div",{class:ye,style:h(I)},[F(Cr,ne,Zr(fe)?fe:{default:()=>[fe]}),F(Ir,se,Zr(fe)?fe:{default:()=>[fe]}),F(Tr,ce,Zr(fe)?fe:{default:()=>[fe]}),t.footer&&F(_r,ge,{default:t.footer}),h(E)&&F(Gr,{class:a.e("empty"),style:h(C)},{default:t.empty}),t.overlay&&F(Ur,{class:a.e("overlay")},{default:t.overlay})])}}});const Xr=l({disableWidth:Boolean,disableHeight:Boolean,onResize:{type:i(Function)}});var Jr=d({name:"ElAutoResizer",props:Xr,setup(e,{slots:t}){const r=u("auto-resizer"),{height:a,width:n,sizer:o}=(e=>{const t=m(),r=m(0),a=m(0);let n;return j(()=>{n=U(t,([e])=>{const{width:t,height:n}=e.contentRect,{paddingLeft:o,paddingRight:l,paddingTop:s,paddingBottom:i}=getComputedStyle(e.target),c=Number.parseInt(o)||0,d=Number.parseInt(l)||0,u=Number.parseInt(s)||0,m=Number.parseInt(i)||0;r.value=t-c-d,a.value=n-u-m}).stop}),y(()=>{null==n||n()}),f([r,a],([t,r])=>{var a;null==(a=e.onResize)||a.call(e,{width:t,height:r})}),{sizer:t,width:r,height:a}})(e),l={width:"100%",height:"100%"};return()=>{var e;return F("div",{ref:o,class:r.b(),style:l},[null==(e=t.default)?void 0:e.call(t,{height:a.value,width:n.value})])}}});const Qr=Z(Yr),ea=Z(Jr),ta={class:"upload select"},ra={class:"upload text"},aa=ke(d({__name:"TestLog",emits:["handleLine","beforeHandle","afterHandle"],setup(t,{emit:a}){const{t:n}=e(),o=a,l=m(null),s=m(null);async function i(e){s.value?.classList.remove("drag");const t=e.target.files;if(!t||0===t.length)return;o("beforeHandle");const a=r.service({fullscreen:!0,text:n("testLog.loading"),lock:!0,spinner:'<div style="width:0;height:0"></div>'});for(let r=0;r<t.length;r++){const e=t[r],a=await e.text();for(const t of a.split("\n"))o("handleLine",t)}a.close(),o("afterHandle"),s.value?.classList.remove("drag")}function c(e){e.preventDefault(),s.value?.classList.add("drag")}function d(e){e.preventDefault(),s.value?.classList.remove("drag")}return j(()=>{l.value?.addEventListener("change",i),s.value?.addEventListener("dragover",c),s.value?.addEventListener("dragleave",d)}),Y(()=>{l.value?.removeEventListener("change",i),s.value?.removeEventListener("dragover",c),s.value?.removeEventListener("dragleave",d)}),(e,t)=>(J(),X("div",ta,[Q("div",{ref_key:"select",ref:s,class:"upload-select"},[Q("div",ra,[t[0]||(t[0]=Q("span",null,"+",-1)),Q("p",null,ee(e.$t("testLog.upload")),1)]),Q("input",{ref_key:"input",ref:l,type:"file"},null,512)],512)]))}}),[["__scopeId","data-v-36beaa21"]]),na=re("hash"),oa=te("keigennRecord2",{state:()=>({userOptions:{scale:n(()=>la(na.scale,1)),opacity:n(()=>la(na.opacity,.9)),targetType:n(()=>la(na.targetType,"icon")),iconType:n(()=>la(na.iconType,2)),parseAA:n(()=>la(na.parseAA,!0)),parseDoT:n(()=>la(na.parseDoT,!1)),minimize:n(()=>la(na.minimize,!1)),actionCN:n(()=>la(na.actionCN,!0)),statusCN:n(()=>la(na.statusCN,!0))},isBrowser:!1}),getters:{icon4k:e=>e.userOptions.scale>=2||window.devicePixelRatio>=2?"_hr1":""},actions:{checkIsBrowser(){this.isBrowser=!window.OverlayPluginApi&&!na.OVERLAY_WS&&!na.HOST_PORT,this.isBrowser&&setTimeout(()=>this.checkIsBrowser(),1e3)},formatterName(e){const t=/^([A-Z])\S+ ([A-Z])\S+/;return t.test(e)?e.replace(t,"$1.$2"):`${e.at(0)}.${e.at(-1)}`}}});function la(e,t){return"boolean"==typeof t?"0"!==e&&"false"!==e?.toLocaleLowerCase()&&("1"===e||"true"===e?.toLocaleLowerCase()||t):"number"==typeof t?Number.isNaN(+e)?t:+e:"string"==typeof t?e:t}const sa=[Number(409).toString(16).toUpperCase(),Number(810).toString(16).toUpperCase(),Number(811).toString(16).toUpperCase(),Number(1836).toString(16).toUpperCase()];function ia(e){return e.currentHp-e.amount<0&&!e.keigenns.find(e=>sa.includes(e.effectId))}const ca={class:"amount"},da={class:"row-info"},ua=ke(d({__name:"Amount",props:{row:{}},setup(e){const t=e,{amount:r,maxHp:a,currentHp:o,shield:l,source:s,type:i}=t.row,c=Math.round(a*+l/100),d=Math.round(o/a*100),u=t.row.reduction,m=(r&&Math.round((r+c)/(1-u))||0).toLocaleString(),p=n(()=>r>999999?`${(r/1e4).toFixed(0)}万`:r.toLocaleString()),f=i,y=ia(t.row);return(e,t)=>{const r=De,a=je;return J(),ae(a,{"append-to":".wrapper",trigger:"hover",enterable:!1,"hide-after":0,width:180},{reference:ne(()=>[Q("span",ca,[Q("span",{class:se(h(f))},[Q("span",{class:se({lethal:h(y)})},ee(h(p)),3)],2)])]),default:ne(()=>[Q("ul",da,[Q("li",null,ee(e.$t("keigennRecord.source"))+": "+ee(h(s)),1),Q("li",null,ee(e.$t("keigennRecord.playerShield"))+": "+ee(h(l))+"%",1),Q("li",null,ee(e.$t("keigennRecord.playerHp"))+": "+ee(h(d))+"%",1),h(u)<1&&"dot"!==h(i)?(J(),X(A,{key:0},[F(r),Q("li",null,ee(e.$t("keigennRecord.reductionRate"))+": "+ee((100*h(u)).toFixed(3))+"% ",1),Q("li",null,[le(ee(e.$t("keigennRecord.originalDamage"))+": ",1),Q("span",{class:se(h(f))},ee(h(m)),3)])],64)):oe("",!0)])]),_:1})}}}),[["__scopeId","data-v-43628410"]]),ma=[{name:"受伤减轻",id:1100,type:"multiplier",performance:{physics:.6,magic:.6,darkness:1},isFriendly:!0},{name:"铁壁",id:1191,type:"multiplier",performance:{physics:.8,magic:.8,darkness:1},isFriendly:!0},{name:"盾阵",id:1856,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"干预",id:1174,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"预警",id:74,type:"multiplier",performance:{physics:.7,magic:.7,darkness:1},isFriendly:!0},{name:"武装",id:1176,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"神圣领域",id:82,type:"multiplier",performance:{physics:0,magic:0,darkness:0},isFriendly:!0},{name:"圣光幕帘",id:1362,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣盾阵",id:2674,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"骑士的坚守",id:2675,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"壁垒",id:77,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"极致防御",id:3829,type:"multiplier",performance:{physics:.6,magic:.6,darkness:1},isFriendly:!0},{name:"极致护盾",id:3830,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的直觉",id:735,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"原初的勇猛",id:1857,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"原初的武猛",id:1858,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"战栗",id:87,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"复仇",id:89,type:"multiplier",performance:{physics:.7,magic:.7,darkness:1},isFriendly:!0},{name:"摆脱",id:1457,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死斗",id:409,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血气",id:2678,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"原初的血潮",id:2679,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"原初的血烟",id:2680,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"戮罪",id:3832,type:"multiplier",performance:{physics:.6,magic:.6,darkness:1},isFriendly:!0},{name:"至黑之夜",id:1178,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"弃明投暗",id:746,type:"multiplier",performance:{physics:.9,magic:.8,darkness:1},isFriendly:!0},{name:"暗影墙",id:747,type:"multiplier",performance:{physics:.7,magic:.7,darkness:1},isFriendly:!0},{name:"暗黑布道",id:1894,type:"multiplier",performance:{physics:.95,magic:.9,darkness:1},isFriendly:!0},{name:"暗影卫",id:3835,type:"multiplier",performance:{physics:.6,magic:.6,darkness:1},isFriendly:!0},{name:"行尸走肉",id:810,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死而不僵",id:811,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"出死入生",id:3255,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"献奉",id:2682,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"石之心",id:1840,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"残暴弹",id:1898,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"伪装",id:1832,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"星云",id:1834,type:"multiplier",performance:{physics:.7,magic:.7,darkness:1},isFriendly:!0},{name:"光之心",id:1839,type:"multiplier",performance:{physics:.95,magic:.85,darkness:1},isFriendly:!0},{name:"超火流星",id:1836,type:"multiplier",performance:{physics:0,magic:0,darkness:0},isFriendly:!0},{name:"刚玉之心",id:2683,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"刚玉之清",id:2684,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"神祝祷",id:1218,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"节制",id:1873,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"水流幕",id:2708,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"鼓舞",id:297,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"激励",id:1918,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"炽天的幕帘",id:1917,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"野战治疗阵",id:299,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"异想的幻光",id:317,type:"multiplier",performance:{physics:1,magic:.95,darkness:1},isFriendly:!0},{name:"炽天的幻光",id:1875,type:"multiplier",performance:{physics:1,magic:.95,darkness:1},isFriendly:!0},{name:"生命回生法",id:2710,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"怒涛之计",id:2711,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"命运之轮",id:849,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"天星交错",id:1889,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"擢升",id:2717,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"中间学派",id:1921,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡诊断",id:2607,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"齐衡诊断",id:2608,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡预后",id:2609,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚角清汁",id:2618,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"白牛清汁",id:2619,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"整体论",id:3003,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"整体盾",id:3365,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"输血",id:2612,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"泛输血",id:2613,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"心眼",id:1232,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"金刚极意",id:1179,type:"multiplier",performance:{physics:.8,magic:.8,darkness:1},isFriendly:!0},{name:"行吟",id:1934,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"策动",id:1951,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"防守之桑巴",id:1826,type:"multiplier",performance:{physics:.85,magic:.85,darkness:1},isFriendly:!0},{name:"即兴表演结束",id:2697,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残影",id:488,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"魔罩",id:168,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护之光",id:2702,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护纹",id:2597,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"抗死",id:2707,type:"multiplier",performance:{physics:1,magic:.9,darkness:1},isFriendly:!0},{name:"雪仇",id:1193,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!1},{name:"牵制",id:1195,type:"multiplier",performance:{physics:.9,magic:.95,darkness:1},isFriendly:!1},{name:"昏乱",id:1203,type:"multiplier",performance:{physics:.95,magic:.9,darkness:1},isFriendly:!1},{name:"武装解除",id:860,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!1},{name:"减速",id:9,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"体力增加",id:2120,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"腐臭",id:1715,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!1},{name:"智力精神降低",id:2115,type:"multiplier",performance:{physics:1,magic:.9,darkness:1},isFriendly:!1},{name:"龙之力",id:2500,type:"multiplier",performance:{physics:.6,magic:.6,darkness:1},isFriendly:!0},{name:"超硬化",id:1722,type:"multiplier",performance:{physics:.1,magic:.1,darkness:1},isFriendly:!0},{name:"玄结界",id:2496,type:"multiplier",performance:{physics:.8,magic:.8,darkness:1},isFriendly:!0},{name:"仙人盾",id:2119,type:"multiplier",performance:{physics:.95,magic:.95,darkness:1},isFriendly:!0},{name:"强力守护",id:1719,type:"multiplier",performance:{physics:.6,magic:.6,darkness:1},isFriendly:!0},{name:"哥布防御",id:2114,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"铜墙铁盾",id:194,type:"multiplier",performance:{physics:.8,magic:.8,darkness:1},isFriendly:!0},{name:"坚守要塞",id:195,type:"multiplier",performance:{physics:.6,magic:.6,darkness:1},isFriendly:!0},{name:"终极堡垒",id:196,type:"multiplier",performance:{physics:.2,magic:.2,darkness:1},isFriendly:!0},{name:"原初大地",id:863,type:"multiplier",performance:{physics:.2,magic:.2,darkness:1},isFriendly:!0},{name:"暗黑之力",id:864,type:"multiplier",performance:{physics:.2,magic:.2,darkness:1},isFriendly:!0},{name:"灵魂之青",id:1931,type:"multiplier",performance:{physics:.2,magic:.2,darkness:1},isFriendly:!0},{name:"坦培拉涂层",id:3686,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"油性坦培拉涂层",id:3687,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"世界树之干",id:3890,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"建筑神之塔",id:3892,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"太阳星座",id:3896,type:"multiplier",performance:{physics:.9,magic:.9,darkness:1},isFriendly:!0},{name:"神爱抚",id:3903,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0}],pa=new Map;for(const hn of ma){const e=Me[hn.id][1];hn.fullIcon=Le(e),pa.set(hn.id.toString(16).toUpperCase().padStart(2,"0"),hn)}function ha(e){return pa.get(e)}function fa(e,t){if("absorbed"===e.type)return"useful";if("dot"===t||"darkness"===t)return"unuseful";if(0===e.performance.darkness&&0===e.performance.magic&&0===e.performance.physics||1===e.performance.darkness&&1===e.performance.magic&&1===e.performance.physics)return"useful";const r="physics"===t?"magic":"physics";return 2*(100-100*e.performance[t])===100-100*e.performance[r]?"half-useful":1===e.performance[t]?"unuseful":"useful"}function ya(e,t){return Object.entries(Me).reduce((r,[a,[n,o]])=>(e.test(n)&&r.set(a,{name:n,icon:o,isFriendly:t}),r),new Map)}const ga=ya(/(?:耐性|防御力)(?:大幅)?(?:降低|提升|低下|下降)|受伤(?:加重|减轻)|体力(?:增加|衰减|减少)|伤害屏障/,!0),wa=ya(/(?:精神|力量|灵巧|智力){1,2}(?:大幅)?降低/,!1),va={key:0},ba={key:1,class:"status-container"},xa=["title","data-duration","data-sourcePov"],Sa=["src","alt"],Ra={class:"flags"},ka=ke(d({__name:"StatusShow",props:{row:{type:Object,required:!0}},setup(e){const t=e,r=oa(),a=r.userOptions,n=r.icon4k;return(e,r)=>"dot"===t.row.type?(J(),X("div",va,ee(e.$t("keigennRecord.noSupport")),1)):(J(),X("div",ba,[(J(!0),X(A,null,ie(t.row.keigenns,(e,o)=>(J(),X("span",{key:o},[Q("span",{class:"status",title:`${h(a).statusCN?e.name:e.effect}(${e.source})`,"data-duration":e.remainingDuration,"data-sourcePov":e.isPov},[Q("img",{class:se(`statusIcon ${h(fa)(e,t.row.type)}`),src:h(Ae)(`/i/${e.fullIcon}${h(n)}.png`),alt:e.effect,loading:"lazy",onError:r[0]||(r[0]=(...e)=>h($e)&&h($e)(...e))},null,42,Sa)],8,xa)]))),128)),Q("span",Ra,ee("damage done"===t.row.effect?"":e.$t(`keigennRecord.${t.row.effect}`)),1)]))}}),[["__scopeId","data-v-e479f52a"]]),Ca={class:"target"},Ia=["src","alt"],Ta={key:1,class:"alt-text"},Ea={key:3,class:"has-duplicate"},Ha=ke(d({__name:"Target",props:{row:{type:Object,required:!0}},setup(e){const t=e,r=oa(),a=m(!1);function o(e){a.value=!0;e.target.style.display="none"}const l=n(()=>!a.value&&"icon"===(r.userOptions.targetType??"icon")),s=n(()=>ia(t.row));return(e,a)=>{return J(),X("div",Ca,[h(l)?(J(),X("img",{key:0,class:se(`${h(r).isBrowser?"browser":"act"} jobIcon cj${h(r).userOptions.iconType} ${h(s)?"lethal-icon":""}`),src:(n=t.row.jobIcon,i=h(r).userOptions.iconType,`https://souma.diemoe.net/resources/img/cj${i}/${n.replaceAll(/([A-Z])/g," $1").trim()}.png`),alt:t.row.jobIcon,onError:o},null,42,Ia)):(J(),X("span",Ta,ee(t.row.job),1)),h(s)?(J(),X("span",{key:2,class:se(`lethal-emoji ${h(r).isBrowser?"browser":"act"} emoji-cj${h(r).userOptions.iconType}`)}," 💀 ",2)):oe("",!0),t.row.hasDuplicate?(J(),X("span",Ea,ee(h(r).formatterName(t.row.target)),1)):oe("",!0)]);var n,i}}}),[["__scopeId","data-v-c1476431"]]),Fa=ke(d({__name:"Table",props:{rows:{},actionKey:{}},setup(t){const{t:r}=e(),a=t,o=oa().userOptions,l=ce("contextMenu"),s=m(""),i=m("");f(()=>a.rows,e=>{0===e.length&&(s.value="",i.value="")},{immediate:!0});const c=m(!1),d=m(0),u=m(0),p=m(null);de(l,()=>{c.value=!1});const y=r("keigennRecord.cancelFilter"),w=n(()=>{const e=Array.from(new Set(a.rows.map(e=>e[a.actionKey])));return[{label:y,value:""},...e.map(e=>({label:e,value:e}))]}),v=n(()=>{const e=Array.from(new Map(a.rows.map(e=>[e.target,e])).values());return[{label:y,value:"",job:-1},...e.map(e=>({label:`${e.job}(${e.target})`,value:e.target,job:e.jobEnum}))].sort((e,t)=>Fe.enumSortMethod(e.job,t.job))});function b(){if(p.value){const e=p.value[a.actionKey];s.value===e?s.value="":s.value=e,c.value=!1}}function x(){if(p.value){const e=p.value.target;i.value===e?i.value="":i.value=e,c.value=!1}}const S=n(()=>a.rows.filter(e=>{const t=!s.value||s.value===y||e[a.actionKey]===s.value,r=!i.value||i.value===y||e.target===i.value;return t&&r}));function R(e){const t=[88,88,88],r=[50,250,200],a=Math.min(1,e/.5),n=Math.min(9,Math.floor(10*a))/9,o=Math.pow(n,.8),l=t[0]+(r[0]-t[0])*o,s=t[1]+(r[1]-t[1])*o,i=t[2]+(r[2]-t[2])*o;return`rgba(${Math.round(l)}, ${Math.round(s)}, ${Math.round(i)}, 1)`}const k=n(()=>[{key:"time",title:r("keigennRecord.time"),dataKey:"time",width:40,align:"center",class:"col-time",headerCellRenderer:()=>g("div",{class:"header-time"},r("keigennRecord.time"))},{key:"action",title:r("keigennRecord.action"),dataKey:a.actionKey,width:64,align:"center",class:"col-action",headerCellRenderer:()=>g("div",{class:"header-filter"},[g(Ke,{size:"small",modelValue:s.value,placeholder:r("keigennRecord.action"),clearable:!1,style:"width:4.5em",teleported:!1,onChange:e=>s.value=e===y?"":e},()=>w.value.map(e=>g(Be,{key:e.value,label:e.label,value:e.value})))]),cellRenderer:({rowData:e})=>g("span",e[a.actionKey]??"")},{key:"target",title:r("keigennRecord.target"),dataKey:"target",width:34,align:"center",class:"col-target",headerCellRenderer:()=>g("div",{class:"header-filter"},[g(Ke,{size:"small",modelValue:i.value,placeholder:r("keigennRecord.target"),clearable:!1,style:"width:4.7em;text-overflow:clip;white-space:nowrap",class:"col-target-select",teleported:!1,onChange:e=>{i.value=e===y?"":e}},()=>v.value.map(e=>g(Be,{key:e.value,label:e.label,value:e.value})))]),cellRenderer:({rowData:e})=>g(Ha,{row:e})},{key:"amount",title:r("keigennRecord.amount"),dataKey:"amount",width:52,align:"right",class:"col-amount",cellRenderer:({rowData:e})=>g(ua,{row:e})},{key:"reduction",title:r("keigennRecord.reduction"),dataKey:"reduction",width:35,align:"right",class:"col-reduction",headerCellRenderer:()=>g("div",{class:"header-reduction"},r("keigennRecord.reduction")),cellRenderer:({rowData:e})=>g("span",{class:"col-reduction-number",style:{color:R(e.reduction)}},`${(100*e.reduction).toFixed(0)}`)},{key:"keigenns",title:r("keigennRecord.keigenns"),dataKey:"keigenns",width:100,align:"left",flexGrow:1,class:"col-keigenns",cellRenderer:({rowData:e})=>g(ka,{row:e})}]);let C=null;const I=n(()=>({onClick:({rowData:e})=>{const{actionCN:t,amount:a,job:n,keigenns:l,time:s,type:i,effect:c,currentHp:d,maxHp:u,shield:m,reduction:p}=e,h="damage done"===c?"":`,${r(`keigennRecord.${c}`)}`,f=`${s} ${n} ${t} ${a.toLocaleString()}(${r(`keigennRecord.${i}`)}) ${r("keigennRecord.reduction")}(${(100*p).toFixed(0)}%):${0===l.length&&""===h?r("keigennRecord.none"):l.map(e=>o.statusCN?e.name:e.effect).join(",")+h} ${r("keigennRecord.hp")}}:${d}/${u}(${Math.round(d/u*100)}%)+${r("keigennRecord.shield")}:${Math.round(u*+m/100)}(${m}%)`;He(f).then(()=>{C?.close(),C=me.success({message:r("keigennRecord.copySuccess"),duration:800})}).catch(()=>me.error(r("keigennRecord.copyFailed")))},onContextmenu:({rowData:e,event:t})=>{const r=t;p.value=e,d.value=r.clientX,u.value=r.clientY,c.value=!0}}));return(e,a)=>{const n=Qr,o=ea;return J(),ae(o,{style:{height:"100%",width:"100%"}},{default:ne(({height:e,width:a})=>[F(n,{"header-class":"keigenn-table-header",class:"keigenn-table",columns:k.value,data:S.value,width:a,height:e,"row-height":28,"header-height":24,"row-key":"key","scrollbar-always-on":"","row-event-handlers":I.value},null,8,["columns","data","width","height","row-event-handlers"]),h(c)?(J(),X("div",{key:0,ref_key:"contextMenu",ref:l,class:"context-menu",style:ue({top:`${h(u)}px`,left:`${h(d)}px`})},[Q("ul",null,[Q("li",{onClick:b},ee(h(s)===(h(p)?.[t.actionKey]??"")?h(r)("keigennRecord.filter.action_cancel",{actionName:h(p)?.[t.actionKey]??h(r)("keigennRecord.this_skill")}):h(r)("keigennRecord.filter.action_only",{actionName:h(p)?.[t.actionKey]??h(r)("keigennRecord.this_skill")})),1),Q("li",{onClick:x},ee(h(i)===h(p)?.target?h(r)("keigennRecord.filter.target_cancel",{jobName:h(p)?.job??h(r)("keigennRecord.this_job")}):h(r)("keigennRecord.filter.target_only",{jobName:h(p)?.job??h(r)("keigennRecord.this_job")})),1)])],4)):oe("",!0)]),_:1})}}}),[["__scopeId","data-v-33baeda1"]]),Da=(e,t)=>t.some(t=>e instanceof t);let ja,Ma;const La=new WeakMap,Na=new WeakMap,$a=new WeakMap;let Aa={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return La.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Ka(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Oa(e){Aa=e(Aa)}function Wa(e){return(Ma||(Ma=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Ba(this),t),Ka(this.request)}:function(...t){return Ka(e.apply(Ba(this),t))}}function za(e){return"function"==typeof e?Wa(e):(e instanceof IDBTransaction&&function(e){if(La.has(e))return;const t=new Promise((t,r)=>{const a=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",o),e.removeEventListener("abort",o)},n=()=>{t(),a()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",n),e.addEventListener("error",o),e.addEventListener("abort",o)});La.set(e,t)}(e),Da(e,ja||(ja=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Aa):e)}function Ka(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,r)=>{const a=()=>{e.removeEventListener("success",n),e.removeEventListener("error",o)},n=()=>{t(Ka(e.result)),a()},o=()=>{r(e.error),a()};e.addEventListener("success",n),e.addEventListener("error",o)});return $a.set(t,e),t}(e);if(Na.has(e))return Na.get(e);const t=za(e);return t!==e&&(Na.set(e,t),$a.set(t,e)),t}const Ba=e=>$a.get(e);const Pa=["get","getKey","getAll","getAllKeys","count"],_a=["put","add","delete","clear"],Va=new Map;function Ga(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Va.get(t))return Va.get(t);const r=t.replace(/FromIndex$/,""),a=t!==r,n=_a.includes(r);if(!(r in(a?IDBIndex:IDBObjectStore).prototype)||!n&&!Pa.includes(r))return;const o=async function(e,...t){const o=this.transaction(e,n?"readwrite":"readonly");let l=o.store;return a&&(l=l.index(t.shift())),(await Promise.all([l[r](...t),n&&o.done]))[0]};return Va.set(t,o),o}Oa(e=>({...e,get:(t,r,a)=>Ga(t,r)||e.get(t,r,a),has:(t,r)=>!!Ga(t,r)||e.has(t,r)}));const qa=["continue","continuePrimaryKey","advance"],Ua={},Za=new WeakMap,Ya=new WeakMap,Xa={get(e,t){if(!qa.includes(t))return e[t];let r=Ua[t];return r||(r=Ua[t]=function(...e){Za.set(this,Ya.get(this)[t](...e))}),r}};async function*Ja(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const r=new Proxy(t,Xa);for(Ya.set(r,t),$a.set(r,Ba(t));t;)yield r,t=await(Za.get(r)||t.continue()),Za.delete(r)}function Qa(e,t){return t===Symbol.asyncIterator&&Da(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&Da(e,[IDBIndex,IDBObjectStore])}Oa(e=>({...e,get:(t,r,a)=>Qa(t,r)?Ja:e.get(t,r,a),has:(t,r)=>Qa(t,r)||e.has(t,r)}));let en=null;async function tn(e){return en||(en=function(e,t,{blocked:r,upgrade:a,blocking:n,terminated:o}={}){const l=indexedDB.open(e,t),s=Ka(l);return a&&l.addEventListener("upgradeneeded",e=>{a(Ka(l.result),e.oldVersion,e.newVersion,Ka(l.transaction),e)}),r&&l.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),s.then(e=>{o&&e.addEventListener("close",()=>o()),n&&e.addEventListener("versionchange",e=>n(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}("souma",1,{upgrade(t){t.objectStoreNames.contains(e)||t.createObjectStore(e,{keyPath:"key"})}})),en}const rn="function"==typeof structuredClone?structuredClone:e=>{if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e.source,e.flags);if(Array.isArray(e))return e.map(e=>rn(e));if(Object.getPrototypeOf(e)===Object.prototype){const t={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=rn(e[r]));return t}return e};function an(e){const t=function(e){switch(!0){case e.endsWith("33"):return"instant death";case/2\w{4}4$/.test(e):return"crit heal";case e.endsWith("1"):return"dodge";case e.endsWith("3"):return"damage done";case e.endsWith("4"):return"heal";case e.endsWith("5"):return"blocked damage";case e.endsWith("6"):return"parried damage";default:throw new Error(`Unknown effect flag ${e}`)}}(e),r=function(e){switch(!0){case/2\w{3}$/.test(e):return"crit damage";case/4\w{3}$/.test(e):return"direct hit damage";case/6\w{3}$/.test(e):return"crit direct hit damage";default:return"damage"}}(e),a=function(e){switch(!0){case/7?[1-4]\w{3}[35]$/.test(e):case/[16]$/.test(e):return"physics";case/^E$/.test(e):case/5\w{4}$/.test(e):return"magic";case/^(?:\d0)?3$/.test(e):case/6\w{4}$/.test(e):return"darkness";default:return"physics"}}(e);return{effect:t,properties:r,type:a}}const nn=["3E","113","213","313"],on=["A10","E"],ln=["04"],sn=["01","03","05","06","36"];function cn(e){let t=0,r=e[8]??"",a=e[9]??"";nn.includes(r)&&(t+=2,r=e[8+t]??r,a=e[8+t+1]??a),on.includes(r)&&(t+=2,r=e[8+t]??r,a=e[8+t+1]??a);const n=function(e){if(void 0===e)return 0;const t=e.length;if(t<=4)return 0;let r=Number.parseInt(e.slice(0,t-4),16);if("4"===e[t-4]){const a=Number.parseInt(e.slice(t-2,t),16);r=r-a+(a<<16)}return r}(a),o=`00${r}`.slice(-2);return{amount:n,lowByte:o,flags:r,isHeal:ln.includes(o),isAttack:sn.includes(o)}}const dn={class:"header-select"},un={style:{height:"100%"}},mn={key:0,class:"testLog"},pn=ke(d({__name:"keigennRecord2",setup(e){const r=_e(),a=oa(),o=a.userOptions;a.checkIsBrowser();const l=m(o.minimize),s=n(()=>o.actionCN?"actionCN":"action"),i=m(!1),c=pe("keigenn-record-2-pov-id",""),d=pe("keigenn-record-2-party-list",[]),u=pe("keigenn-record-2-job-map",{}),p=pe("keigenn-record-2-party-event-party",[]),f=m(0),y=m([{zoneName:"",duration:"00:00",table:he([]),key:"init",timestamp:-1}]),g={rsv:/^262\|(?<timestamp>[^|]*)\|[^|]*\|[^|]*\|_rsv_(?<id>\d+)_[^|]+\|(?<real>[^|]*)\|/i,ability:qe.ability(),statusEffectExplicit:qe.statusEffectExplicit(),gainsEffect:qe.gainsEffect(),losesEffect:qe.losesEffect(),inCombat:/^260\|(?<timestamp>[^|]*)\|(?<inACTCombat>[^|]*)\|(?<inGameCombat>[^|]*)\|/,changeZone:qe.changeZone(),partyList:/^11\|(?<timestamp>[^|]*)\|(?<partyCount>\d*)\|(?<list>(?:\w{8}\|)*)\w{16}/,primaryPlayer:/^02\|(?<timestamp>[^|]*)\|(?<id>[^|]*)\|(?<name>[^|]*)/,addCombatant:qe.addedCombatant(),removingCombatant:qe.removingCombatant(),networkDoT:qe.networkDoT()},v=m(0),b=pe("souma-keigenn-record-2-zone-name",""),x=pe("souma-keigenn-record-2-rsv-data",{}),S={},R={friendly:{},enemy:{}},k=function(e){const t=async t=>t(await tn(e));return{getAll:()=>t(t=>t.getAll(e)),get:r=>t(t=>t.get(e,r)),set:r=>t(t=>t.put(e,r)),bulkSet:r=>t(async t=>{const a=t.transaction(e,"readwrite");for(const e of r)a.store.put(e);await a.done}),remove:r=>t(t=>t.delete(e,r)),clear:()=>t(t=>t.clear(e))}}("keigenn-record-2");function C(){i.value=!0,v.value=0,f.value=0,y.value.length=0,y.value.push({zoneName:"",duration:"00:00",table:he([]),key:"init",timestamp:-1})}function I(){i.value=!1,M()}function T(e){for(const r in g){const a=g[r].exec(e);if(a){const n=e.split("|");switch(r){case"statusEffectExplicit":a.groups?.targetId.startsWith("1")&&(S[a.groups.targetId]=a.groups.currentShield);break;case"gainsEffect":{const e=n[Ge.GainsEffect.fields.effectId],t=n[Ge.GainsEffect.fields.effect],r=n[Ge.GainsEffect.fields.target],a=n[Ge.GainsEffect.fields.targetId],o=Number.parseInt(n[Ge.GainsEffect.fields.count],16);let l=ha(e);if(!l){const t=a.startsWith("1")&&ga.get(Number.parseInt(e,16).toString())||a.startsWith("4")&&wa.get(Number.parseInt(e,16).toString());if(!t)return;const r=Le(t.icon),n=o>1?Ne(r,o):r;l={type:"multiplier",performance:{physics:1,magic:1,darkness:1},id:Number.parseInt(e,16),fullIcon:n,name:t.name,isFriendly:t.isFriendly}}const s=n[Ge.GainsEffect.fields.duration],i=n[Ge.GainsEffect.fields.source],d=n[Ge.GainsEffect.fields.sourceId],u=new Date(n[Ge.GainsEffect.fields.timestamp]).getTime()+1e3*Number.parseFloat(s),m={name:l.name,type:l.type,count:o,effect:t,effectId:e,source:i,sourceId:d,target:r,targetId:a,expirationTimestamp:u,performance:l.performance,fullIcon:l.fullIcon,isPov:c.value===d};a.startsWith("1")&&l.isFriendly?(void 0===R.friendly[a]&&(R.friendly[a]={}),R.friendly[a][e]=m):a.startsWith("4")&&!l.isFriendly&&(void 0===R.enemy[r]&&(R.enemy[r]={}),R.enemy[r][e]=m)}break;case"losesEffect":{const e=n[Ge.LosesEffect.fields.target],t=n[Ge.LosesEffect.fields.targetId],r=n[Ge.LosesEffect.fields.effectId];t.startsWith("1")?R.friendly[t]&&Reflect.deleteProperty(R.friendly[t],r):R.enemy[e]&&Reflect.deleteProperty(R.enemy[e],r)}break;case"addCombatant":if("00"!==n[Ge.AddedCombatant.fields.job]){const e=n[Ge.AddedCombatant.fields.job],t=new Date(n[Ge.AddedCombatant.fields.timestamp]).getTime();u.value[n[Ge.AddedCombatant.fields.id]]={job:Number.parseInt(e,16),timestamp:t}}break;case"removingCombatant":Reflect.deleteProperty(u.value,n[Ge.RemovedCombatant.fields.id]);break;case"primaryPlayer":c.value=n[Ge.ChangedPlayer.fields.id];break;case"partyList":d.value=(a.groups?.list?.split("|")??[]).filter(Boolean);break;case"changeZone":{const e=parseInt(n[Ge.ChangeZone.fields.id],16);if(b.value=n[Ge.ChangeZone.fields.name],Ze[e]?.name){const r=t(Ze[e]?.name);r&&"Unknown"!==r&&(b.value=r)}D(new Date(n[Ge.ChangeZone.fields.timestamp]).getTime());break}case"inCombat":{const e="1"===n[Ge.InCombat.fields.inACTCombat],t="1"===n[Ge.InCombat.fields.inGameCombat],r=new Date(n[Ge.InCombat.fields.timestamp]).getTime();if(e||t){const e=n[Ge.InCombat.fields.timestamp];if(v.value>0)return;return 0!==y.value[0].table.length&&y.value.unshift({zoneName:"",duration:"00:00",table:he([]),key:e,timestamp:r}),v.value=r,y.value[0].zoneName=b.value,y.value[0].timestamp=r,y.value[0].key=e,void(f.value=0)}if(!e&&!t)return void D(r)}break;case"rsv":{const e=Number(a.groups?.id),t=n[Ge.RSVData.fields.value];e&&t&&(x.value[Number(e)]=t)}break;case"networkDoT":if(!o.parseDoT)return;{const e=n[Ge.NetworkDoT.fields.which],t=n[Ge.NetworkDoT.fields.id];if("DoT"!==e||t.startsWith("4")||t!==c.value&&!d.value.includes(t)&&!p.value.find(e=>e.id===t))return;const r=n[Ge.NetworkDoT.fields.name],a=n[Ge.NetworkDoT.fields.damage],o=Number.parseInt(a,16),l=new Date(n[Ge.Ability.fields.timestamp]??"???").getTime(),s=Number(n[Ge.NetworkDoT.fields.currentHp]),i=Number(n[Ge.NetworkDoT.fields.maxHp]),u=L(0===v.value?0:l-v.value),{job:m,hasDuplicate:h}=E(t),f=Fe.jobToFullName(Fe.jobEnumToJob(m)).simple2,g=m,w=Fe.jobEnumToIcon(g);H({key:y.value[0].table.length.toString(),time:u,id:void 0,action:e,actionCN:e,source:"",target:r,targetId:t,job:f,jobIcon:w,jobEnum:g,hasDuplicate:h,amount:o,keigenns:[],currentHp:s,maxHp:i,effect:"damage done",type:"dot",shield:S[t]??"0",povId:c.value,reduction:0})}break;case"ability":if(0===v.value)return;{const e=cn(n);if(e.isAttack&&e.amount>=0){const t=n[Ge.Ability.fields.sourceId]??"???",r=n[Ge.Ability.fields.targetId]??"???";if(!t.startsWith("4")||!r.startsWith("1"))return;if(r!==c.value&&!d.value.includes(r)&&!p.value.find(e=>e.id===r))return;const l=new Date(n[Ge.Ability.fields.timestamp]??"???").getTime(),s=n[Ge.Ability.fields.ability],i=s.match(/^_rsv_(?<id>\d+)_/),u=n[Ge.Ability.fields.id]??"???";let m=s;if(i){const e=Number(i.groups?.id);m=x.value[e]??s.match(/^_(?<id>rsv_\d+)_/)?.groups?.id}else if(m=m.replace(/unknown_.*/,"攻击"),!1===o.parseAA&&/^攻击|攻撃|[Aa]ttack$/.test(m))return;const h=Ve(Number.parseInt(u,16)),f=h&&""!==h?h:m,g=Number(n[Ge.Ability.fields.targetCurrentHp]),w=Number(n[Ge.Ability.fields.targetMaxHp]),b=n[Ge.Ability.fields.source]??"???",k=n[Ge.Ability.fields.target]??"???",{effect:C,type:I}=an(e.flags),T=L(0===v.value?0:l-v.value),{job:F,hasDuplicate:D}=E(r),j=Fe.jobToFullName(Fe.jobEnumToJob(F)).simple2,M=F,N=Fe.jobEnumToIcon(M),$=rn(Object.values(R.friendly[r]??[]).concat(Object.values(R.enemy[b]??[])).filter(e=>{const t=Math.max(0,(e.expirationTimestamp-l)/1e3);return e.remainingDuration=t>=999?"":t.toFixed(t>.05&&t<.95?1:0),Number(e.remainingDuration)>-3})),A=S[a.groups.targetId]??"0",O=e.amount;let W=0;if("instant death"!==C&&"dodge"!==C){let e=1;"blocked damage"===C?e=.8:"parried damage"===C&&(e=.85);let t=1;for(const r of $)"absorbed"!==r.type&&(t*=r.performance[I]??1);W=1-t*e}H({key:y.value[0].table.length.toString(),time:T,id:u,action:m,actionCN:f,source:b,target:k,targetId:r,job:j,jobIcon:N,jobEnum:M,hasDuplicate:D,amount:O,keigenns:$,currentHp:g,maxHp:w,effect:C,type:I,shield:A,povId:c.value,reduction:W}),y.value[0].duration=L(new Date(n[Ge.Ability.fields.timestamp]).getTime()-v.value)}}}}}}function E(e){const t=u.value[e],r=p.value.find(t=>t.id===e)??{job:0,timestamp:0},a=(t?.timestamp??0)>r.timestamp?t:r,n=a===t?Object.entries(u.value).some(([t,r])=>t!==e&&r.job===a?.job&&d.value.includes(t)):p.value.some(t=>t.id!==e&&t.job===a?.job);return{job:a?.job??0,hasDuplicate:n}}function H(e){y.value[0].table.unshift(e)}function D(e){0!==v.value&&(y.value[0].duration=L(e-v.value),y.value[0]=Se(y.value[0]),v.value=0,R.friendly={},R.enemy={},M())}async function M(){if(i.value)return;const e=y.value.filter(e=>"init"!==e.key&&e.timestamp>0).map(e=>{const t=Array.isArray(e.table)?Re(e.table):[];return{...Re(e),table:t}});await k.clear(),await k.bulkSet(e)}function L(e){const t=Math.max(Math.floor(e/6e4),0),r=Math.max(Math.floor((e-6e4*t)/1e3),0);return`${t<10?"0":""}${t}:${r<10?"0":""}${r}`}function N(){l.value=!l.value}function $(){y.value.unshift({zoneName:"",duration:"00:00",table:he([]),key:"test",timestamp:Date.now()}),f.value=0}function O(e){const t=new Date(e),r=t.getHours();return`${(r%12||12).toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")} ${r>=12?"PM":"AM"}`}return j(()=>{const e=fe({storageKey:"keigenn-record-2-theme"}),t=ye(e);!1===e.value&&t();for(const r in u.value){const e=u.value[r];Date.now()-e.timestamp>864e5&&Reflect.deleteProperty(u.value,r)}!async function(){f.value=0;try{const e=await k.getAll();e.length&&(y.value.length=0,y.value.push(...e.filter(e=>e.timestamp>Date.now()-2592e5).reverse()),0===y.value.length&&y.value.push({zoneName:"",duration:"00:00",table:he([]),key:"init",timestamp:-1}))}catch(e){throw y.value.length=0,e}}(),Ue("LogLine",e=>{T(e.rawLine)}),Ue("PartyChanged",e=>{p.value=e.party.map(e=>({...e,timestamp:Date.now()}))}),Ue("ChangePrimaryPlayer",e=>{c.value=Number(e.charID).toString(16).toUpperCase()})}),(e,t)=>{const n=Be,i=Ke,c=Pe,d=Fa,u=aa;return J(),X(A,null,[Q("div",{class:"wrapper",style:ue({"--scale":h(o).scale,"--opacity":h(o).opacity}),onContextmenu:t[1]||(t[1]=w(()=>{},["prevent"]))},[Q("header",null,[Q("div",dn,[ge(F(i,{modelValue:h(f),"onUpdate:modelValue":t[0]||(t[0]=e=>ve(f)?f.value=e:null),size:"small",class:se(["combat-select",h(a).isBrowser?"browser":"act"]),"popup-class-name":"combat-select-popup",offset:0,"show-arrow":!1},{default:ne(()=>[(J(!0),X(A,null,ie(h(y).length,e=>(J(),ae(n,{key:`${h(y)[e-1].key}-${h(y)[e-1].duration}-${h(y)[e-1].zoneName}`,value:e-1,label:`${h(y)[e-1].zoneName}${""===h(y)[e-1].zoneName?"":` - [${h(y)[e-1].duration}] ${O(h(y)[e-1].timestamp)}`}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue","class"]),[[we,!h(l)]])]),h(a).isBrowser?oe("",!0):(J(),ae(c,{key:0,class:se(["minimize",h(l)?"in-minimize":"not-minimize"]),icon:h(l)?h(be):h(xe),circle:"",style:ue({opacity:h(l)?.5:1}),onClick:N},null,8,["class","icon","style"]))]),ge(Q("main",un,[F(d,{rows:h(y)[h(f)].table,"action-key":h(s)},null,8,["rows","action-key"])],512),[[we,!h(l)]])],36),h(a).isBrowser||h(r)?(J(),X("div",mn,[h(r)?(J(),ae(c,{key:0,onClick:$},{default:ne(()=>[...t[2]||(t[2]=[le(" 测试 ",-1)])]),_:1})):oe("",!0),F(u,{"m-1":"",onBeforeHandle:C,onAfterHandle:I,onHandleLine:T})])):oe("",!0)],64)}}}),[["__scopeId","data-v-1fa378d4"]]);export{pn as default};
